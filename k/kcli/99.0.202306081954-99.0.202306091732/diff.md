# Comparing `tmp/kcli-99.0.202306081954-py3-none-any.whl.zip` & `tmp/kcli-99.0.202306091732-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,599 +1,604 @@
-Zip file size: 1474877 bytes, number of entries: 597
--rw-r--r--  2.0 unx       15 b- defN 23-Jun-08 19:48 kvirt/__init__.py
--rw-r--r--  2.0 unx   100193 b- defN 23-Jun-08 19:48 kvirt/baseconfig.py
--rw-r--r--  2.0 unx   171487 b- defN 23-Jun-08 19:48 kvirt/bottle.py
--rw-r--r--  2.0 unx   250355 b- defN 23-Jun-08 19:48 kvirt/cli.py
--rw-r--r--  2.0 unx   186172 b- defN 23-Jun-08 19:48 kvirt/config.py
--rw-r--r--  2.0 unx     2851 b- defN 23-Jun-08 19:48 kvirt/containerconfig.py
--rw-r--r--  2.0 unx    11514 b- defN 23-Jun-08 19:48 kvirt/defaults.py
--rw-r--r--  2.0 unx    19097 b- defN 23-Jun-08 19:48 kvirt/examples.py
--rw-r--r--  2.0 unx     4333 b- defN 23-Jun-08 19:48 kvirt/ignitionmerger.py
--rw-r--r--  2.0 unx    10074 b- defN 23-Jun-08 19:48 kvirt/keywords.yaml
--rw-r--r--  2.0 unx     3487 b- defN 23-Jun-08 19:48 kvirt/klist.py
--rw-r--r--  2.0 unx     6009 b- defN 23-Jun-08 19:48 kvirt/ansibleutils/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-08 19:48 kvirt/cluster/__init__.py
--rw-r--r--  2.0 unx      931 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/99-apps.yaml
--rw-r--r--  2.0 unx      694 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/99-forcedns
--rw-r--r--  2.0 unx     1480 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/99-notifications.yaml
--rw-r--r--  2.0 unx      653 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/Corefile
--rw-r--r--  2.0 unx    43440 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/__init__.py
--rw-r--r--  2.0 unx     1121 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/assisted_infra.yml
--rw-r--r--  2.0 unx     1269 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/assisted_ingress.yml
--rw-r--r--  2.0 unx     1366 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/autoapprovercron.yml
--rw-r--r--  2.0 unx     1106 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/bmc.yml.j2
--rw-r--r--  2.0 unx      511 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/calico.sh.j2
--rw-r--r--  2.0 unx      200 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/cloud_lb_apps.yml
--rw-r--r--  2.0 unx     1433 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/disconnected.sh
--rw-r--r--  2.0 unx      184 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/extras.service
--rw-r--r--  2.0 unx      839 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/extras.sh
--rw-r--r--  2.0 unx     2954 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/hostedcluster.yaml
--rw-r--r--  2.0 unx     1174 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/httpd.yaml
--rw-r--r--  2.0 unx      889 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/ignition.sh
--rw-r--r--  2.0 unx     2307 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/kcli_plan.yml
--rw-r--r--  2.0 unx     2052 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/kcli_plan_default.yml
--rw-r--r--  2.0 unx      502 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/keepalived.conf
--rw-r--r--  2.0 unx     1587 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/nmstateconfig.yml.j2
--rw-r--r--  2.0 unx      752 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/nodepool.yaml
--rw-r--r--  2.0 unx       60 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/nonlocalbind.conf
--rw-r--r--  2.0 unx     1890 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/staticpods/coredns.yml
--rw-r--r--  2.0 unx     2142 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/staticpods/keepalived.yml
--rw-r--r--  2.0 unx     1619 b- defN 23-Jun-08 19:48 kvirt/cluster/hypershift/staticpods/mdns.yml
--rw-r--r--  2.0 unx    11471 b- defN 23-Jun-08 19:48 kvirt/cluster/k3s/__init__.py
--rw-r--r--  2.0 unx     1117 b- defN 23-Jun-08 19:48 kvirt/cluster/k3s/bootstrap.sh
--rw-r--r--  2.0 unx     1050 b- defN 23-Jun-08 19:48 kvirt/cluster/k3s/bootstrap.yml
--rw-r--r--  2.0 unx      409 b- defN 23-Jun-08 19:48 kvirt/cluster/k3s/cloud_lb_api.yml
--rw-r--r--  2.0 unx      438 b- defN 23-Jun-08 19:48 kvirt/cluster/k3s/ctlplanes.sh
--rw-r--r--  2.0 unx     1068 b- defN 23-Jun-08 19:48 kvirt/cluster/k3s/ctlplanes.yml
--rw-r--r--  2.0 unx      374 b- defN 23-Jun-08 19:48 kvirt/cluster/k3s/join.sh
--rw-r--r--  2.0 unx     1260 b- defN 23-Jun-08 19:48 kvirt/cluster/k3s/kcli_default.yml
--rw-r--r--  2.0 unx      511 b- defN 23-Jun-08 19:48 kvirt/cluster/k3s/keepalived.conf
--rw-r--r--  2.0 unx      352 b- defN 23-Jun-08 19:48 kvirt/cluster/k3s/keepalived.sh
--rw-r--r--  2.0 unx      166 b- defN 23-Jun-08 19:48 kvirt/cluster/k3s/workers.sh
--rw-r--r--  2.0 unx      709 b- defN 23-Jun-08 19:48 kvirt/cluster/k3s/workers.yml
--rw-r--r--  2.0 unx    13543 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/__init__.py
--rwxr-xr-x  2.0 unx     2707 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/bootstrap.sh
--rw-r--r--  2.0 unx     1621 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/bootstrap.yml
--rw-r--r--  2.0 unx      325 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/cloud_lb_api.yml
--rw-r--r--  2.0 unx     1172 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/ctlplanes.yml
--rwxr-xr-x  2.0 unx      343 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/deploy.sh
--rwxr-xr-x  2.0 unx      412 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/join.sh
--rw-r--r--  2.0 unx     1822 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/kcli_default.yml
--rw-r--r--  2.0 unx      563 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/keepalived.conf
--rw-r--r--  2.0 unx      424 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/keepalived.sh
--rw-r--r--  2.0 unx      140 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/kubernetes.repo
--rw-r--r--  2.0 unx      179 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/multus.sh
--rw-r--r--  2.0 unx      572 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/nfs.sh
--rw-r--r--  2.0 unx      226 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/nfs.yml
--rw-r--r--  2.0 unx     4021 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/pre_el.sh
--rw-r--r--  2.0 unx     3906 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/pre_ubuntu.sh
--rw-r--r--  2.0 unx     2127 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/registry.yml
--rw-r--r--  2.0 unx      949 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/workers.yml
--rw-r--r--  2.0 unx      487 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/argocd/ingress.yml
--rw-r--r--  2.0 unx     2134 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/argocd/install.sh
--rw-r--r--  2.0 unx       71 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/argocd/kcli_default.yml
--rw-r--r--  2.0 unx      314 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/argocd/uninstall.sh
--rw-r--r--  2.0 unx       90 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/autolabeller/install.sh
--rw-r--r--  2.0 unx       91 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/autolabeller/uninstall.sh
--rw-r--r--  2.0 unx      380 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/certmanager/install.sh
--rw-r--r--  2.0 unx      317 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/dashboard/admin.yml
--rw-r--r--  2.0 unx      452 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/dashboard/ingress.yml
--rw-r--r--  2.0 unx     1433 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/dashboard/install.sh
--rw-r--r--  2.0 unx       23 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/dashboard/kcli_default.yml
--rw-r--r--  2.0 unx      373 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/dashboard/user.yml
--rw-r--r--  2.0 unx      157 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/falco/falco_advertisements.yml
--rw-r--r--  2.0 unx      185 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/falco/falco_ip.yml
--rw-r--r--  2.0 unx      839 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/falco/install.sh
--rw-r--r--  2.0 unx       57 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/falco/kcli_default.yml
--rw-r--r--  2.0 unx      133 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/falco/uninstall.sh
--rw-r--r--  2.0 unx      175 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/ingress/install.sh
--rw-r--r--  2.0 unx      176 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/ingress/uninstall.sh
--rw-r--r--  2.0 unx      112 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/istio/install.sh
--rw-r--r--  2.0 unx      910 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/istio/istio-minimal-operator.yaml
--rw-r--r--  2.0 unx      766 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/katacontainer/install.sh
--rw-r--r--  2.0 unx      913 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/katacontainer/uninstall.sh
--rw-r--r--  2.0 unx      198 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/knative/cr_eventing.yml
--rw-r--r--  2.0 unx      194 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/knative/cr_serving.yml
--rw-r--r--  2.0 unx      253 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/knative/install.sh
--rw-r--r--  2.0 unx      670 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/kubevirt/install.sh
--rw-r--r--  2.0 unx       30 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/kubevirt/kcli_default.yml
--rw-r--r--  2.0 unx      534 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/metallb/install.sh
--rw-r--r--  2.0 unx       47 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/metallb/kcli_default.yml
--rw-r--r--  2.0 unx      157 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/metallb/metallb_advertisements.yml
--rw-r--r--  2.0 unx      150 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/metallb/metallb_cr.yml
--rw-r--r--  2.0 unx      283 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/metallb/uninstall.sh
--rw-r--r--  2.0 unx      348 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/olm/install.sh
--rw-r--r--  2.0 unx      350 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/olm/uninstall.sh
--rw-r--r--  2.0 unx      320 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/policy_as_code/install.sh
--rw-r--r--  2.0 unx       34 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/policy_as_code/kcli_default.yml
--rw-r--r--  2.0 unx      322 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/policy_as_code/uninstall.sh
--rw-r--r--  2.0 unx     1662 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/rancher/install.sh
--rw-r--r--  2.0 unx      103 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/rancher/kcli_default.yml
--rw-r--r--  2.0 unx      161 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/rancher/rancher_advertisements.yml
--rw-r--r--  2.0 unx      191 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/rancher/rancher_ip.yml
--rw-r--r--  2.0 unx      151 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/rancher/uninstall.sh
--rw-r--r--  2.0 unx      572 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/rook/install.sh
--rw-r--r--  2.0 unx      190 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/submariner/install.sh
--rw-r--r--  2.0 unx       22 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/submariner/kcli_default.yml
--rw-r--r--  2.0 unx      277 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/tekton/install.sh
--rw-r--r--  2.0 unx      278 b- defN 23-Jun-08 19:48 kvirt/cluster/kubeadm/apps/tekton/uninstall.sh
--rw-r--r--  2.0 unx     2970 b- defN 23-Jun-08 19:48 kvirt/cluster/kubecommon/__init__.py
--rw-r--r--  2.0 unx     9395 b- defN 23-Jun-08 19:48 kvirt/cluster/kubernetes/__init__.py
--rw-r--r--  2.0 unx     4805 b- defN 23-Jun-08 19:48 kvirt/cluster/microshift/__init__.py
--rw-r--r--  2.0 unx      603 b- defN 23-Jun-08 19:48 kvirt/cluster/microshift/kcli_plan.yml
--rw-r--r--  2.0 unx      625 b- defN 23-Jun-08 19:48 kvirt/cluster/microshift/kcli_plan_default.yml
--rw-r--r--  2.0 unx      262 b- defN 23-Jun-08 19:48 kvirt/cluster/microshift/scripts/00_sslip.sh
--rw-r--r--  2.0 unx      799 b- defN 23-Jun-08 19:48 kvirt/cluster/microshift/scripts/01_clients.sh
--rw-r--r--  2.0 unx      183 b- defN 23-Jun-08 19:48 kvirt/cluster/microshift/scripts/02_crio.sh
--rw-r--r--  2.0 unx      538 b- defN 23-Jun-08 19:48 kvirt/cluster/microshift/scripts/03_microshift.sh
--rw-r--r--  2.0 unx      341 b- defN 23-Jun-08 19:48 kvirt/cluster/microshift/scripts/04_kubeconfig.sh
--rw-r--r--  2.0 unx     2252 b- defN 23-Jun-08 19:48 kvirt/cluster/microshift/scripts/05_acm.sh
--rw-r--r--  2.0 unx      696 b- defN 23-Jun-08 19:48 kvirt/cluster/microshift/scripts/deploy.sh
--rw-r--r--  2.0 unx      219 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/01-workload-partitioning
--rw-r--r--  2.0 unx      573 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/10-node-ip-hint.yaml
--rw-r--r--  2.0 unx      980 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/99-apps.yaml
--rw-r--r--  2.0 unx      618 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/99-bootstrap-deletion-2.yaml
--rw-r--r--  2.0 unx     1239 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/99-bootstrap-deletion.yaml
--rw-r--r--  2.0 unx      529 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/99-chrony.yaml
--rw-r--r--  2.0 unx      646 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/99-forcedns
--rw-r--r--  2.0 unx      476 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/99-forcedns-ibm
--rw-r--r--  2.0 unx      854 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/99-kubevirt-fix.yaml
--rw-r--r--  2.0 unx     1127 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/99-localhost-fix.yaml
--rw-r--r--  2.0 unx      250 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/99-metal3-fake-machine.yaml
--rw-r--r--  2.0 unx      162 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/99-metal3-provisioning.yaml
--rw-r--r--  2.0 unx     1659 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/99-notifications.yaml
--rw-r--r--  2.0 unx      118 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/99-operatorhub.yaml
--rw-r--r--  2.0 unx      314 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/99-ovn.yaml
--rw-r--r--  2.0 unx      912 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/99-sno.yaml
--rw-r--r--  2.0 unx      762 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/Corefile
--rw-r--r--  2.0 unx    81585 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/__init__.py
--rw-r--r--  2.0 unx     1326 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/autoapprovercron.yml
--rw-r--r--  2.0 unx      987 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/autorules.yml
--rw-r--r--  2.0 unx     1630 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/bootstrap.yml
--rw-r--r--  2.0 unx      250 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/calico.sh.j2
--rw-r--r--  2.0 unx      107 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/chrony.conf
--rw-r--r--  2.0 unx      629 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/cloud_bootstrap.yml
--rw-r--r--  2.0 unx      792 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/cloud_ctlplanes.yml
--rw-r--r--  2.0 unx      217 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/cloud_dns.yml
--rw-r--r--  2.0 unx      616 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/cloud_lb_api.yml
--rw-r--r--  2.0 unx      224 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/cloud_lb_apps.yml
--rw-r--r--  2.0 unx      703 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/cloud_workers.yml
--rw-r--r--  2.0 unx      123 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/cluster-ingress-02-config.yml
--rw-r--r--  2.0 unx      159 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/cluster-scheduler-02-config.yml
--rw-r--r--  2.0 unx      224 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/config.hcl.templ
--rw-r--r--  2.0 unx       98 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/contrail-ca-patch.service
--rw-r--r--  2.0 unx      486 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/contrail-ca-patch.sh
--rw-r--r--  2.0 unx       87 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/contrail.auth
--rw-r--r--  2.0 unx     1108 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/contrail.sh.j2
--rw-r--r--  2.0 unx     2278 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/ctlplanes.yml
--rw-r--r--  2.0 unx      326 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/dhcp.conf
--rw-r--r--  2.0 unx      106 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/dhcp.sh
--rw-r--r--  2.0 unx      536 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/dhcp.yml
--rw-r--r--  2.0 unx      836 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/disconnected.yml
--rw-r--r--  2.0 unx     8945 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/fake_kubeconfig.json
--rw-r--r--  2.0 unx       35 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/fake_pull.json
--rw-r--r--  2.0 unx     1792 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/haproxy.cfg
--rw-r--r--  2.0 unx     2483 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/haproxy.cfg.kubevirt
--rw-r--r--  2.0 unx      902 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/httpd.yaml
--rw-r--r--  2.0 unx      524 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/ignition.j2
--rw-r--r--  2.0 unx     3562 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/install-config.yaml
--rw-r--r--  2.0 unx     2691 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/iso.sh
--rw-r--r--  2.0 unx      237 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/kcli-ipv6.conf.j2
--rw-r--r--  2.0 unx     4257 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/kcli_default.yml
--rw-r--r--  2.0 unx      982 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/keepalived.conf
--rw-r--r--  2.0 unx       60 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/nonlocalbind.conf
--rw-r--r--  2.0 unx       59 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/openshift-workload-pinning
--rw-r--r--  2.0 unx      157 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/relocate-ip-bootstrap.service
--rw-r--r--  2.0 unx      281 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/relocate-ip-bootstrap.sh
--rw-r--r--  2.0 unx      690 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/relocate-ip.sh
--rw-r--r--  2.0 unx      212 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/sno-finish.service
--rw-r--r--  2.0 unx     2085 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/sno-finish.sh
--rw-r--r--  2.0 unx      660 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/sno.yml
--rw-r--r--  2.0 unx     1615 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/workers.yml
--rw-r--r--  2.0 unx       40 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/cr.sh
--rw-r--r--  2.0 unx      768 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/install.yml.j2
--rw-r--r--  2.0 unx      162 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/advanced-cluster-management/99-metal3-provisioning.yaml
--rw-r--r--  2.0 unx     2754 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sample.yml
--rwxr-xr-x  2.0 unx     2838 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sh
--rw-r--r--  2.0 unx      418 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/advanced-cluster-management/cr.yml
--rw-r--r--  2.0 unx      625 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/advanced-cluster-management/gen_registries.py
--rw-r--r--  2.0 unx      259 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/advanced-cluster-management/kcli_default.yml
--rw-r--r--  2.0 unx     1219 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/advanced-cluster-management/post.sh
--rw-r--r--  2.0 unx      645 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/argocd/configmap.yml
--rw-r--r--  2.0 unx     2423 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/argocd/install.sh
--rw-r--r--  2.0 unx       49 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/argocd/kcli_default.yml
--rw-r--r--  2.0 unx     1093 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/autolabeller/cr.yml
--rw-r--r--  2.0 unx      142 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/autolabeller/install.sh
--rw-r--r--  2.0 unx     1093 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/autolabeller/install.yml
--rw-r--r--  2.0 unx      165 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/autolabeller/kcli_default.yml
--rw-r--r--  2.0 unx       25 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/autolabeller/uninstall.sh
--rw-r--r--  2.0 unx      873 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/cluster-logging/cr.yml
--rw-r--r--  2.0 unx       63 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/cluster-logging/kcli_default.yml
--rw-r--r--  2.0 unx      265 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/istio/install.sh
--rw-r--r--  2.0 unx      377 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/istio/istio-cni.yaml
--rw-r--r--  2.0 unx     1039 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/cr.yml
--rw-r--r--  2.0 unx      154 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/kcli_default.yml
--rw-r--r--  2.0 unx      775 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/local-storage-operator/cr.yml
--rw-r--r--  2.0 unx      227 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/local-storage-operator/kcli_default.yml
--rw-r--r--  2.0 unx      642 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/local-storage-operator/post.sh
--rw-r--r--  2.0 unx      349 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/lvms-operator/cr.yml
--rw-r--r--  2.0 unx      137 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/lvms-operator/kcli_default.yml
--rw-r--r--  2.0 unx      595 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/lvms-operator/post.sh
--rw-r--r--  2.0 unx      510 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/metallb-operator/cr.yml
--rw-r--r--  2.0 unx       94 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/metallb-operator/kcli_default.yml
--rw-r--r--  2.0 unx      162 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/multicluster-engine/99-metal3-provisioning.yaml
--rw-r--r--  2.0 unx     2754 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sample.yml
--rwxr-xr-x  2.0 unx     2845 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sh
--rw-r--r--  2.0 unx      245 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/multicluster-engine/cr.yml
--rw-r--r--  2.0 unx      625 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/multicluster-engine/gen_registries.py
--rw-r--r--  2.0 unx      118 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/multicluster-engine/kcli_default.yml
--rwxr-xr-x  2.0 unx       55 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/multicluster-engine/post.sh
--rwxr-xr-x  2.0 unx     2298 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/nfs/install.sh
--rw-r--r--  2.0 unx      117 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/nfs/kcli_default.yml
--rw-r--r--  2.0 unx      185 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/nfs/uninstall.sh
--rw-r--r--  2.0 unx      849 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/odf-operator/cr.yml
--rw-r--r--  2.0 unx      298 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/odf-operator/kcli_default.yml
--rw-r--r--  2.0 unx      364 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/odf-operator/nad_cluster.yml
--rw-r--r--  2.0 unx      362 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/odf-operator/nad_public.yml
--rw-r--r--  2.0 unx      745 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/odf-operator/post.sh
--rw-r--r--  2.0 unx      530 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/odf-operator/pre.sh
--rw-r--r--  2.0 unx      363 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/serverless-operator/cr.yml
--rw-r--r--  2.0 unx      157 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/serverless-operator/kcli_default.yml
--rw-r--r--  2.0 unx      278 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/serverless-operator/post.sh
--rw-r--r--  2.0 unx     1227 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/users/install.sh
--rw-r--r--  2.0 unx       84 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/users/kcli_default.yml
--rw-r--r--  2.0 unx      258 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/users/oauth.yml
--rw-r--r--  2.0 unx      249 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/users/oauth_hypershift.yml
--rw-r--r--  2.0 unx      422 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/apps/users/uninstall.sh
--rw-r--r--  2.0 unx       60 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/customisation/00-kcli-namespace.yaml
--rw-r--r--  2.0 unx       91 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/customisation/97-autoapprovercron-sa.yaml
--rw-r--r--  2.0 unx      264 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/customisation/98-autoapprovercron-binding.yaml
--rw-r--r--  2.0 unx      912 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/customisation/99-autoapprovercron-cronjob.yaml
--rw-r--r--  2.0 unx      389 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/customisation/99-ingress-controller.yaml
--rw-r--r--  2.0 unx      184 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/customisation/99-monitoring.yaml
--rw-r--r--  2.0 unx      289 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/customisation/99-registry.yaml
--rw-r--r--  2.0 unx     1685 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/disconnected/haproxy.cfg
--rw-r--r--  2.0 unx      211 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/disconnected/registry.service
--rwxr-xr-x  2.0 unx      328 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/disconnected/bin/sync_image.sh
--rwxr-xr-x  2.0 unx      201 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/disconnected/scripts/01_get_oc.sh
--rwxr-xr-x  2.0 unx     2484 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/disconnected/scripts/03_mirror.sh
--rwxr-xr-x  2.0 unx     2046 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/disconnected/scripts/03_registry.sh
--rwxr-xr-x  2.0 unx      337 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/disconnected/scripts/04_extras.sh
--rwxr-xr-x  2.0 unx     2390 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/disconnected/scripts/05_olm.sh
--rwxr-xr-x  2.0 unx      241 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/disconnected/scripts/06_web.sh
--rwxr-xr-x  2.0 unx      733 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/disconnected/scripts/deploy.sh
--rw-r--r--  2.0 unx     1768 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/disconnected/scripts/mirror-config.yaml.sample
--rw-r--r--  2.0 unx     2557 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/staticpods/coredns.yml
--rw-r--r--  2.0 unx      987 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/staticpods/haproxy.yml
--rw-r--r--  2.0 unx     2539 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/staticpods/keepalived.yml
--rw-r--r--  2.0 unx     1721 b- defN 23-Jun-08 19:48 kvirt/cluster/openshift/staticpods/mdns.yml
--rw-r--r--  2.0 unx      193 b- defN 23-Jun-08 19:48 kvirt/cluster/profiles/sample-kubeadm-default.yml
--rw-r--r--  2.0 unx      135 b- defN 23-Jun-08 19:48 kvirt/cluster/profiles/sample-openshift-compact.yml
--rw-r--r--  2.0 unx      210 b- defN 23-Jun-08 19:48 kvirt/cluster/profiles/sample-openshift-contrail.yml
--rw-r--r--  2.0 unx      157 b- defN 23-Jun-08 19:48 kvirt/cluster/profiles/sample-openshift-ipv6.yml
--rw-r--r--  2.0 unx       55 b- defN 23-Jun-08 19:48 kvirt/cluster/profiles/sample-openshift-sno-bm.yml
--rw-r--r--  2.0 unx      148 b- defN 23-Jun-08 19:48 kvirt/cluster/profiles/sample-openshift-sno.yml
--rw-r--r--  2.0 unx     3377 b- defN 23-Jun-08 19:48 kvirt/common/Jenkinsfile.j2
--rw-r--r--  2.0 unx    96428 b- defN 23-Jun-08 19:48 kvirt/common/__init__.py
--rw-r--r--  2.0 unx     1406 b- defN 23-Jun-08 19:48 kvirt/common/autoscale.yaml.j2
--rw-r--r--  2.0 unx     8945 b- defN 23-Jun-08 19:48 kvirt/common/fake_kubeconfig.json
--rw-r--r--  2.0 unx      669 b- defN 23-Jun-08 19:48 kvirt/common/ignition.j2
--rw-r--r--  2.0 unx      125 b- defN 23-Jun-08 19:48 kvirt/common/kubevirt_kcli_conf.j2
--rw-r--r--  2.0 unx       99 b- defN 23-Jun-08 19:48 kvirt/common/local_kcli_conf.j2
--rw-r--r--  2.0 unx     3068 b- defN 23-Jun-08 19:48 kvirt/common/pipeline.yml.j2
--rw-r--r--  2.0 unx     2377 b- defN 23-Jun-08 19:48 kvirt/common/pipeline_kube.yml.j2
--rw-r--r--  2.0 unx     1381 b- defN 23-Jun-08 19:48 kvirt/common/playbook.j2
--rw-r--r--  2.0 unx     1557 b- defN 23-Jun-08 19:48 kvirt/common/storage.sh.j2
--rw-r--r--  2.0 unx     4562 b- defN 23-Jun-08 19:48 kvirt/common/vm.ovf.j2
--rw-r--r--  2.0 unx     2241 b- defN 23-Jun-08 19:48 kvirt/common/workflow.yml.j2
--rw-r--r--  2.0 unx     2208 b- defN 23-Jun-08 19:48 kvirt/common/workflow_script.yml.j2
--rw-r--r--  2.0 unx    15041 b- defN 23-Jun-08 19:48 kvirt/container/__init__.py
--rw-r--r--  2.0 unx    11716 b- defN 23-Jun-08 19:48 kvirt/expose/__init__.py
--rw-r--r--  2.0 unx     4319 b- defN 23-Jun-08 19:48 kvirt/expose/swagger.yml
--rw-r--r--  2.0 unx      408 b- defN 23-Jun-08 19:48 kvirt/expose/static/css/bootstrap-notify.css
--rw-r--r--  2.0 unx   121125 b- defN 23-Jun-08 19:48 kvirt/expose/static/css/bootstrap.min.css
--rw-r--r--  2.0 unx      399 b- defN 23-Jun-08 19:48 kvirt/expose/static/css/dataTables.checkboxes.css
--rw-r--r--  2.0 unx    13587 b- defN 23-Jun-08 19:48 kvirt/expose/static/css/jquery.dataTables.min.css
--rw-r--r--  2.0 unx      868 b- defN 23-Jun-08 19:48 kvirt/expose/static/css/kcli.css
--rw-r--r--  2.0 unx      269 b- defN 23-Jun-08 19:48 kvirt/expose/static/css/wheel.css
--rw-r--r--  2.0 unx     1406 b- defN 23-Jun-08 19:48 kvirt/expose/static/images/favicon.ico
--rw-r--r--  2.0 unx      160 b- defN 23-Jun-08 19:48 kvirt/expose/static/images/sort_asc.png
--rw-r--r--  2.0 unx      201 b- defN 23-Jun-08 19:48 kvirt/expose/static/images/sort_both.png
--rw-r--r--  2.0 unx      158 b- defN 23-Jun-08 19:48 kvirt/expose/static/images/sort_desc.png
--rw-r--r--  2.0 unx    24772 b- defN 23-Jun-08 19:48 kvirt/expose/static/images/wheel.gif
--rw-r--r--  2.0 unx    12398 b- defN 23-Jun-08 19:48 kvirt/expose/static/js/dataTables.checkboxes.min.js
--rw-r--r--  2.0 unx      367 b- defN 23-Jun-08 19:48 kvirt/expose/static/js/exposeactions.js
--rw-r--r--  2.0 unx    83059 b- defN 23-Jun-08 19:48 kvirt/expose/static/js/jquery.dataTables.min.js
--rw-r--r--  2.0 unx    89795 b- defN 23-Jun-08 19:48 kvirt/expose/static/js/jquery.min.js
--rw-r--r--  2.0 unx      263 b- defN 23-Jun-08 19:48 kvirt/expose/static/js/list.js
--rw-r--r--  2.0 unx     1605 b- defN 23-Jun-08 19:48 kvirt/expose/templates/form.html
--rw-r--r--  2.0 unx     1035 b- defN 23-Jun-08 19:48 kvirt/expose/templates/head.html
--rw-r--r--  2.0 unx      406 b- defN 23-Jun-08 19:48 kvirt/expose/templates/index.html
--rw-r--r--  2.0 unx     1220 b- defN 23-Jun-08 19:48 kvirt/expose/templates/infoplan.html
--rw-r--r--  2.0 unx      574 b- defN 23-Jun-08 19:48 kvirt/expose/templates/planstable.html
--rw-r--r--  2.0 unx      550 b- defN 23-Jun-08 19:48 kvirt/expose/templates/result.html
--rw-r--r--  2.0 unx     1754 b- defN 23-Jun-08 19:48 kvirt/internalplans/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-08 19:48 kvirt/jinjafilters/__init__.py
--rw-r--r--  2.0 unx     5249 b- defN 23-Jun-08 19:48 kvirt/jinjafilters/jinjafilters.py
--rw-r--r--  2.0 unx     8477 b- defN 23-Jun-08 19:48 kvirt/kfish/__init__.py
--rw-r--r--  2.0 unx     9124 b- defN 23-Jun-08 19:48 kvirt/ksushy/__init__.py
--rw-r--r--  2.0 unx      121 b- defN 23-Jun-08 19:48 kvirt/ksushy/main.py
--rw-r--r--  2.0 unx     1028 b- defN 23-Jun-08 19:48 kvirt/ksushy/templates/bios.json
--rw-r--r--  2.0 unx      443 b- defN 23-Jun-08 19:48 kvirt/ksushy/templates/interface.json
--rw-r--r--  2.0 unx      418 b- defN 23-Jun-08 19:48 kvirt/ksushy/templates/interfaces.json
--rw-r--r--  2.0 unx     1050 b- defN 23-Jun-08 19:48 kvirt/ksushy/templates/manager.json
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-08 19:48 kvirt/ksushy/templates/managers.json
--rw-r--r--  2.0 unx      535 b- defN 23-Jun-08 19:48 kvirt/ksushy/templates/root.json
--rw-r--r--  2.0 unx     2732 b- defN 23-Jun-08 19:48 kvirt/ksushy/templates/system.json
--rw-r--r--  2.0 unx      511 b- defN 23-Jun-08 19:48 kvirt/ksushy/templates/systems.json
--rw-r--r--  2.0 unx     1219 b- defN 23-Jun-08 19:48 kvirt/ksushy/templates/virtualmedia_cd.json
--rw-r--r--  2.0 unx      705 b- defN 23-Jun-08 19:48 kvirt/ksushy/templates/virtualmedias.json
--rw-r--r--  2.0 unx     2780 b- defN 23-Jun-08 19:48 kvirt/miniconsole/__init__.py
--rw-r--r--  2.0 unx     3488 b- defN 23-Jun-08 19:48 kvirt/nameutils/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-08 19:48 kvirt/providers/__init__.py
--rw-r--r--  2.0 unx     8935 b- defN 23-Jun-08 19:48 kvirt/providers/sampleprovider.py
--rw-r--r--  2.0 unx    65812 b- defN 23-Jun-08 19:48 kvirt/providers/aws/__init__.py
--rw-r--r--  2.0 unx      479 b- defN 23-Jun-08 19:48 kvirt/providers/fake/__init__.py
--rw-r--r--  2.0 unx    67762 b- defN 23-Jun-08 19:48 kvirt/providers/gcp/__init__.py
--rw-r--r--  2.0 unx      175 b- defN 23-Jun-08 19:48 kvirt/providers/gcp/gcp-hack.service
--rw-r--r--  2.0 unx      231 b- defN 23-Jun-08 19:48 kvirt/providers/gcp/gcp-hack.sh
--rw-r--r--  2.0 unx    65048 b- defN 23-Jun-08 19:48 kvirt/providers/ibm/__init__.py
--rw-r--r--  2.0 unx    80962 b- defN 23-Jun-08 19:48 kvirt/providers/kubevirt/__init__.py
--rw-r--r--  2.0 unx   184246 b- defN 23-Jun-08 19:48 kvirt/providers/kvm/__init__.py
--rw-r--r--  2.0 unx     1965 b- defN 23-Jun-08 19:48 kvirt/providers/kvm/helpers.py
--rw-r--r--  2.0 unx    57076 b- defN 23-Jun-08 19:48 kvirt/providers/openstack/__init__.py
--rw-r--r--  2.0 unx    62544 b- defN 23-Jun-08 19:48 kvirt/providers/ovirt/__init__.py
--rw-r--r--  2.0 unx    31112 b- defN 23-Jun-08 19:48 kvirt/providers/packet/__init__.py
--rw-r--r--  2.0 unx    73099 b- defN 23-Jun-08 19:48 kvirt/providers/vsphere/__init__.py
--rw-r--r--  2.0 unx    13655 b- defN 23-Jun-08 19:48 kvirt/providers/vsphere/helpers.py
--rw-r--r--  2.0 unx     4893 b- defN 23-Jun-08 19:48 kvirt/providers/vsphere/tagging.py
--rw-r--r--  2.0 unx    21286 b- defN 23-Jun-08 19:48 kvirt/providers/web/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-08 19:48 kvirt/version/__init__.py
--rw-r--r--  2.0 unx       19 b- defN 23-Jun-08 19:54 kvirt/version/git
--rw-r--r--  2.0 unx    46592 b- defN 23-Jun-08 19:48 kvirt/web/__init__.py
--rw-r--r--  2.0 unx      261 b- defN 23-Jun-08 19:48 kvirt/web/main.py
--rw-r--r--  2.0 unx      408 b- defN 23-Jun-08 19:48 kvirt/web/static/css/bootstrap-notify.css
--rw-r--r--  2.0 unx    23409 b- defN 23-Jun-08 19:48 kvirt/web/static/css/bootstrap-theme.min.css
--rw-r--r--  2.0 unx   121125 b- defN 23-Jun-08 19:48 kvirt/web/static/css/bootstrap.min.css
--rw-r--r--  2.0 unx      399 b- defN 23-Jun-08 19:48 kvirt/web/static/css/dataTables.checkboxes.css
--rw-r--r--  2.0 unx    13587 b- defN 23-Jun-08 19:48 kvirt/web/static/css/jquery.dataTables.min.css
--rw-r--r--  2.0 unx      816 b- defN 23-Jun-08 19:48 kvirt/web/static/css/kcli.css
--rw-r--r--  2.0 unx     3033 b- defN 23-Jun-08 19:48 kvirt/web/static/css/navbar.css
--rw-r--r--  2.0 unx     2908 b- defN 23-Jun-08 19:48 kvirt/web/static/css/spice.css
--rw-r--r--  2.0 unx      271 b- defN 23-Jun-08 19:48 kvirt/web/static/css/wheel.css
--rw-r--r--  2.0 unx    18028 b- defN 23-Jun-08 19:48 kvirt/web/static/fonts/glyphicons-halflings-regular.woff2
--rw-r--r--  2.0 unx      715 b- defN 23-Jun-08 19:48 kvirt/web/static/images/Centos.png
--rw-r--r--  2.0 unx      294 b- defN 23-Jun-08 19:48 kvirt/web/static/images/Debian.png
--rw-r--r--  2.0 unx      987 b- defN 23-Jun-08 19:48 kvirt/web/static/images/Fedora.png
--rw-r--r--  2.0 unx      672 b- defN 23-Jun-08 19:48 kvirt/web/static/images/Redhat.png
--rw-r--r--  2.0 unx     1278 b- defN 23-Jun-08 19:48 kvirt/web/static/images/Suse.png
--rw-r--r--  2.0 unx     1782 b- defN 23-Jun-08 19:48 kvirt/web/static/images/Tux.png
--rw-r--r--  2.0 unx      544 b- defN 23-Jun-08 19:48 kvirt/web/static/images/Ubuntu.png
--rw-r--r--  2.0 unx     4213 b- defN 23-Jun-08 19:48 kvirt/web/static/images/delete.png
--rw-r--r--  2.0 unx     1406 b- defN 23-Jun-08 19:48 kvirt/web/static/images/favicon.ico
--rw-r--r--  2.0 unx    23320 b- defN 23-Jun-08 19:48 kvirt/web/static/images/kcli-small.png
--rw-r--r--  2.0 unx    27185 b- defN 23-Jun-08 19:48 kvirt/web/static/images/kcli.jpg
--rw-r--r--  2.0 unx   113928 b- defN 23-Jun-08 19:48 kvirt/web/static/images/kcli.png
--rw-r--r--  2.0 unx    48809 b- defN 23-Jun-08 19:48 kvirt/web/static/images/logo-header.svg
--rw-r--r--  2.0 unx    48809 b- defN 23-Jun-08 19:48 kvirt/web/static/images/logo-main.svg
--rw-r--r--  2.0 unx      160 b- defN 23-Jun-08 19:48 kvirt/web/static/images/sort_asc.png
--rw-r--r--  2.0 unx      201 b- defN 23-Jun-08 19:48 kvirt/web/static/images/sort_both.png
--rw-r--r--  2.0 unx      158 b- defN 23-Jun-08 19:48 kvirt/web/static/images/sort_desc.png
--rw-r--r--  2.0 unx     3927 b- defN 23-Jun-08 19:48 kvirt/web/static/images/start.png
--rw-r--r--  2.0 unx     3631 b- defN 23-Jun-08 19:48 kvirt/web/static/images/stop.png
--rw-r--r--  2.0 unx    24772 b- defN 23-Jun-08 19:48 kvirt/web/static/images/wheel.gif
--rw-r--r--  2.0 unx     2933 b- defN 23-Jun-08 19:48 kvirt/web/static/js/bootstrap-notify.js
--rw-r--r--  2.0 unx    37045 b- defN 23-Jun-08 19:48 kvirt/web/static/js/bootstrap.min.js
--rw-r--r--  2.0 unx     2523 b- defN 23-Jun-08 19:48 kvirt/web/static/js/containeraction.js
--rw-r--r--  2.0 unx    12398 b- defN 23-Jun-08 19:48 kvirt/web/static/js/dataTables.checkboxes.min.js
--rw-r--r--  2.0 unx     1642 b- defN 23-Jun-08 19:48 kvirt/web/static/js/hostaction.js
--rw-r--r--  2.0 unx     1187 b- defN 23-Jun-08 19:48 kvirt/web/static/js/imageaction.js
--rw-r--r--  2.0 unx    83059 b- defN 23-Jun-08 19:48 kvirt/web/static/js/jquery.dataTables.min.js
--rw-r--r--  2.0 unx    87462 b- defN 23-Jun-08 19:48 kvirt/web/static/js/jquery.min.js
--rw-r--r--  2.0 unx     2704 b- defN 23-Jun-08 19:48 kvirt/web/static/js/kcli.js
--rw-r--r--  2.0 unx     1594 b- defN 23-Jun-08 19:48 kvirt/web/static/js/kubeaction.js
--rw-r--r--  2.0 unx     3907 b- defN 23-Jun-08 19:48 kvirt/web/static/js/list.js
--rw-r--r--  2.0 unx     1376 b- defN 23-Jun-08 19:48 kvirt/web/static/js/networkaction.js
--rw-r--r--  2.0 unx     2457 b- defN 23-Jun-08 19:48 kvirt/web/static/js/planaction.js
--rw-r--r--  2.0 unx     1237 b- defN 23-Jun-08 19:48 kvirt/web/static/js/poolaction.js
--rw-r--r--  2.0 unx      846 b- defN 23-Jun-08 19:48 kvirt/web/static/js/productaction.js
--rw-r--r--  2.0 unx      270 b- defN 23-Jun-08 19:48 kvirt/web/static/js/refresh.js
--rw-r--r--  2.0 unx     1835 b- defN 23-Jun-08 19:48 kvirt/web/static/js/repoaction.js
--rw-r--r--  2.0 unx     3463 b- defN 23-Jun-08 19:48 kvirt/web/static/js/snapshotaction.js
--rw-r--r--  2.0 unx     2745 b- defN 23-Jun-08 19:48 kvirt/web/static/js/vmaction.js
--rw-r--r--  2.0 unx      123 b- defN 23-Jun-08 19:48 kvirt/web/static/js/wheel.js
--rw-r--r--  2.0 unx     9944 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/atKeynames.js
--rw-r--r--  2.0 unx     2335 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/bitmap.js
--rw-r--r--  2.0 unx     4795 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/cursor.js
--rw-r--r--  2.0 unx    49214 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/display.js
--rw-r--r--  2.0 unx    13253 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/enums.js
--rw-r--r--  2.0 unx     2847 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/filexfer.js
--rw-r--r--  2.0 unx     9535 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/inputs.js
--rw-r--r--  2.0 unx     6176 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/lz.js
--rw-r--r--  2.0 unx    18370 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/main.js
--rw-r--r--  2.0 unx    12677 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/playback.js
--rw-r--r--  2.0 unx     7036 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/png.js
--rw-r--r--  2.0 unx     3110 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/port.js
--rw-r--r--  2.0 unx    44531 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/quic.js
--rw-r--r--  2.0 unx     3030 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/resize.js
--rw-r--r--  2.0 unx     7282 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/simulatecursor.js
--rw-r--r--  2.0 unx     1895 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/spicearraybuffer.js
--rw-r--r--  2.0 unx    18202 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/spiceconn.js
--rw-r--r--  2.0 unx     3616 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/spicedataview.js
--rw-r--r--  2.0 unx    33015 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/spicemsg.js
--rw-r--r--  2.0 unx    12767 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/spicetype.js
--rw-r--r--  2.0 unx     6808 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/ticket.js
--rw-r--r--  2.0 unx    13628 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/utils.js
--rw-r--r--  2.0 unx    21577 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/webm.js
--rw-r--r--  2.0 unx     4131 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/wire.js
--rw-r--r--  2.0 unx    16580 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/thirdparty/jsbn.js
--rw-r--r--  2.0 unx     2529 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/thirdparty/prng4.js
--rw-r--r--  2.0 unx     3442 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/thirdparty/rng.js
--rw-r--r--  2.0 unx     4257 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/thirdparty/rsa.js
--rw-r--r--  2.0 unx    10671 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/thirdparty/sha1.js
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/.npmignore
--rw-r--r--  2.0 unx      419 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/README.md
--rw-r--r--  2.0 unx      359 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/rollup.config.js
--rw-r--r--  2.0 unx     1113 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/babel-worker.js
--rw-r--r--  2.0 unx     8601 b- defN 23-Jun-08 19:48 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/browser-es-module-loader.js
--rw-r--r--  2.0 unx     2176 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/error-handler.js
--rw-r--r--  2.0 unx     5682 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/localization.js
--rw-r--r--  2.0 unx    56845 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/ui.js
--rw-r--r--  2.0 unx     6696 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/webutil.js
--rw-r--r--  2.0 unx     3553 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/alt.svg
--rw-r--r--  2.0 unx     3980 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/clipboard.svg
--rw-r--r--  2.0 unx     3430 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/connect.svg
--rw-r--r--  2.0 unx     4381 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/ctrl.svg
--rw-r--r--  2.0 unx     3237 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/ctrlaltdel.svg
--rw-r--r--  2.0 unx     5062 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/disconnect.svg
--rw-r--r--  2.0 unx     4684 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/drag.svg
--rw-r--r--  2.0 unx     3106 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/error.svg
--rw-r--r--  2.0 unx     4522 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/esc.svg
--rw-r--r--  2.0 unx     3066 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/expander.svg
--rw-r--r--  2.0 unx     3139 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/fullscreen.svg
--rw-r--r--  2.0 unx     2559 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/handle.svg
--rw-r--r--  2.0 unx     6386 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/handle_bg.svg
--rw-r--r--  2.0 unx     3204 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/info.svg
--rw-r--r--  2.0 unx     6404 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/keyboard.svg
--rw-r--r--  2.0 unx     7000 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/mouse_left.svg
--rw-r--r--  2.0 unx     7002 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/mouse_middle.svg
--rw-r--r--  2.0 unx     6993 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/mouse_none.svg
--rw-r--r--  2.0 unx     7001 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/mouse_right.svg
--rw-r--r--  2.0 unx     3985 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/power.svg
--rw-r--r--  2.0 unx     3082 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/settings.svg
--rw-r--r--  2.0 unx     2953 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/tab.svg
--rw-r--r--  2.0 unx     4441 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/toggleextrakeys.svg
--rw-r--r--  2.0 unx     3869 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/warning.svg
--rw-r--r--  2.0 unx     3178 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/windows.svg
--rw-r--r--  2.0 unx      871 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/icons/Makefile
--rw-r--r--  2.0 unx     4028 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/icons/novnc-120x120.png
--rw-r--r--  2.0 unx     4582 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/icons/novnc-144x144.png
--rw-r--r--  2.0 unx     5216 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/icons/novnc-152x152.png
--rw-r--r--  2.0 unx      675 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/icons/novnc-16x16.png
--rw-r--r--  2.0 unx     5787 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/icons/novnc-192x192.png
--rw-r--r--  2.0 unx     1000 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/icons/novnc-24x24.png
--rw-r--r--  2.0 unx     1064 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/icons/novnc-32x32.png
--rw-r--r--  2.0 unx     1397 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/icons/novnc-48x48.png
--rw-r--r--  2.0 unx     1932 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/icons/novnc-60x60.png
--rw-r--r--  2.0 unx     1946 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/icons/novnc-64x64.png
--rw-r--r--  2.0 unx     2699 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/icons/novnc-72x72.png
--rw-r--r--  2.0 unx     2874 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/icons/novnc-76x76.png
--rw-r--r--  2.0 unx     2351 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/icons/novnc-96x96.png
--rw-r--r--  2.0 unx    11685 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/icons/novnc-icon-sm.svg
--rw-r--r--  2.0 unx    11549 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/images/icons/novnc-icon.svg
--rw-r--r--  2.0 unx     2885 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/locale/cs.json
--rw-r--r--  2.0 unx     2854 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/locale/de.json
--rw-r--r--  2.0 unx     3906 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/locale/el.json
--rw-r--r--  2.0 unx     2671 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/locale/es.json
--rw-r--r--  2.0 unx     3354 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/locale/ja.json
--rw-r--r--  2.0 unx     2961 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/locale/ko.json
--rw-r--r--  2.0 unx     3035 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/locale/nl.json
--rw-r--r--  2.0 unx     2830 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/locale/pl.json
--rw-r--r--  2.0 unx     3825 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/locale/ru.json
--rw-r--r--  2.0 unx     2845 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/locale/sv.json
--rw-r--r--  2.0 unx     2811 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/locale/tr.json
--rw-r--r--  2.0 unx     2597 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/locale/zh_CN.json
--rw-r--r--  2.0 unx     2606 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/locale/zh_TW.json
--rw-r--r--  2.0 unx      157 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/sounds/CREDITS
--rw-r--r--  2.0 unx     4531 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/sounds/bell.mp3
--rw-r--r--  2.0 unx     8495 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/sounds/bell.oga
--rw-r--r--  2.0 unx    38580 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/styles/Orbitron700.ttf
--rw-r--r--  2.0 unx    17472 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/styles/Orbitron700.woff
--rw-r--r--  2.0 unx    18450 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/app/styles/base.css
--rw-r--r--  2.0 unx     4189 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/base64.js
--rw-r--r--  2.0 unx    11241 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/des.js
--rw-r--r--  2.0 unx    20381 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/display.js
--rw-r--r--  2.0 unx     1374 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/encodings.js
--rw-r--r--  2.0 unx     1170 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/inflator.js
--rw-r--r--  2.0 unx    74196 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/rfb.js
--rw-r--r--  2.0 unx     9130 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/websock.js
--rw-r--r--  2.0 unx      628 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/decoders/copyrect.js
--rw-r--r--  2.0 unx     4814 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/decoders/hextile.js
--rw-r--r--  2.0 unx     1739 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/decoders/raw.js
--rw-r--r--  2.0 unx     1210 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/decoders/rre.js
--rw-r--r--  2.0 unx     9662 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/decoders/tight.js
--rw-r--r--  2.0 unx      768 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/decoders/tightpng.js
--rw-r--r--  2.0 unx    11438 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/input/domkeytable.js
--rw-r--r--  2.0 unx     3804 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/input/fixedkeys.js
--rw-r--r--  2.0 unx    13090 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/input/keyboard.js
--rw-r--r--  2.0 unx    34609 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/input/keysym.js
--rw-r--r--  2.0 unx    25374 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/input/keysymdef.js
--rw-r--r--  2.0 unx     9995 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/input/mouse.js
--rw-r--r--  2.0 unx     5283 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/input/util.js
--rw-r--r--  2.0 unx     2580 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/input/vkeys.js
--rw-r--r--  2.0 unx    14256 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/input/xtscancodes.js
--rw-r--r--  2.0 unx     3155 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/util/browser.js
--rw-r--r--  2.0 unx     7556 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/util/cursor.js
--rw-r--r--  2.0 unx     4221 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/util/events.js
--rw-r--r--  2.0 unx      896 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/util/eventtarget.js
--rw-r--r--  2.0 unx     1358 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/util/logging.js
--rw-r--r--  2.0 unx     1866 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/util/polyfill.js
--rw-r--r--  2.0 unx      301 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/core/util/strings.js
--rw-r--r--  2.0 unx     7388 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/promise.js
--rw-r--r--  2.0 unx      419 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/browser-es-module-loader/README.md
--rw-r--r--  2.0 unx      295 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/browser-es-module-loader/rollup.config.js
--rw-r--r--  2.0 unx     1113 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/babel-worker.js
--rw-r--r--  2.0 unx     8498 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/browser-es-module-loader.js
--rw-r--r--  2.0 unx     1084 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/pako/LICENSE
--rw-r--r--  2.0 unx      301 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/pako/README.md
--rw-r--r--  2.0 unx     1062 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/pako/lib/utils/common.js
--rw-r--r--  2.0 unx      666 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/pako/lib/zlib/adler32.js
--rw-r--r--  2.0 unx     1334 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/pako/lib/zlib/constants.js
--rw-r--r--  2.0 unx      764 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/pako/lib/zlib/crc32.js
--rw-r--r--  2.0 unx    60016 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/pako/lib/zlib/deflate.js
--rw-r--r--  2.0 unx     1251 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/pako/lib/zlib/gzheader.js
--rw-r--r--  2.0 unx    11690 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/pako/lib/zlib/inffast.js
--rw-r--r--  2.0 unx    47128 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/pako/lib/zlib/inflate.js
--rw-r--r--  2.0 unx    11527 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/pako/lib/zlib/inftrees.js
--rw-r--r--  2.0 unx      560 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/pako/lib/zlib/messages.js
--rw-r--r--  2.0 unx    38767 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/pako/lib/zlib/trees.js
--rw-r--r--  2.0 unx      823 b- defN 23-Jun-08 19:48 kvirt/web/static/vnc/vendor/pako/lib/zlib/zstream.js
--rw-r--r--  2.0 unx     2509 b- defN 23-Jun-08 19:48 kvirt/web/templates/bootstrap.html
--rw-r--r--  2.0 unx    14595 b- defN 23-Jun-08 19:48 kvirt/web/templates/console.html
--rw-r--r--  2.0 unx      717 b- defN 23-Jun-08 19:48 kvirt/web/templates/containercreate.html
--rw-r--r--  2.0 unx      493 b- defN 23-Jun-08 19:48 kvirt/web/templates/containerprofiles.html
--rw-r--r--  2.0 unx     1050 b- defN 23-Jun-08 19:48 kvirt/web/templates/containerprofilestable.html
--rw-r--r--  2.0 unx      490 b- defN 23-Jun-08 19:48 kvirt/web/templates/containers.html
--rw-r--r--  2.0 unx     1746 b- defN 23-Jun-08 19:48 kvirt/web/templates/containerstable.html
--rw-r--r--  2.0 unx     2123 b- defN 23-Jun-08 19:48 kvirt/web/templates/head.html
--rw-r--r--  2.0 unx      473 b- defN 23-Jun-08 19:48 kvirt/web/templates/hosts.html
--rw-r--r--  2.0 unx     1705 b- defN 23-Jun-08 19:48 kvirt/web/templates/hoststable.html
--rw-r--r--  2.0 unx     1119 b- defN 23-Jun-08 19:48 kvirt/web/templates/imagecreate.html
--rw-r--r--  2.0 unx      478 b- defN 23-Jun-08 19:48 kvirt/web/templates/images.html
--rw-r--r--  2.0 unx      646 b- defN 23-Jun-08 19:48 kvirt/web/templates/imagestable.html
--rw-r--r--  2.0 unx      472 b- defN 23-Jun-08 19:48 kvirt/web/templates/isos.html
--rw-r--r--  2.0 unx      261 b- defN 23-Jun-08 19:48 kvirt/web/templates/isostable.html
--rw-r--r--  2.0 unx      609 b- defN 23-Jun-08 19:48 kvirt/web/templates/kubecreate.html
--rw-r--r--  2.0 unx      622 b- defN 23-Jun-08 19:48 kvirt/web/templates/kubeinfo.html
--rw-r--r--  2.0 unx      488 b- defN 23-Jun-08 19:48 kvirt/web/templates/kubeprofiles.html
--rw-r--r--  2.0 unx      845 b- defN 23-Jun-08 19:48 kvirt/web/templates/kubeprofilestable.html
--rw-r--r--  2.0 unx      475 b- defN 23-Jun-08 19:48 kvirt/web/templates/kubes.html
--rw-r--r--  2.0 unx     1850 b- defN 23-Jun-08 19:48 kvirt/web/templates/kubestable.html
--rw-r--r--  2.0 unx      151 b- defN 23-Jun-08 19:48 kvirt/web/templates/layout.html
--rw-r--r--  2.0 unx     5517 b- defN 23-Jun-08 19:48 kvirt/web/templates/navbar.html
--rw-r--r--  2.0 unx      882 b- defN 23-Jun-08 19:48 kvirt/web/templates/networkcreate.html
--rw-r--r--  2.0 unx      537 b- defN 23-Jun-08 19:48 kvirt/web/templates/networks.html
--rw-r--r--  2.0 unx      845 b- defN 23-Jun-08 19:48 kvirt/web/templates/networkstable.html
--rw-r--r--  2.0 unx      750 b- defN 23-Jun-08 19:48 kvirt/web/templates/plancreate.html
--rw-r--r--  2.0 unx      475 b- defN 23-Jun-08 19:48 kvirt/web/templates/plans.html
--rw-r--r--  2.0 unx     1525 b- defN 23-Jun-08 19:48 kvirt/web/templates/planstable.html
--rw-r--r--  2.0 unx      859 b- defN 23-Jun-08 19:48 kvirt/web/templates/poolcreate.html
--rw-r--r--  2.0 unx      475 b- defN 23-Jun-08 19:48 kvirt/web/templates/pools.html
--rw-r--r--  2.0 unx      554 b- defN 23-Jun-08 19:48 kvirt/web/templates/poolstable.html
--rw-r--r--  2.0 unx     1282 b- defN 23-Jun-08 19:48 kvirt/web/templates/productcreate.html
--rw-r--r--  2.0 unx      484 b- defN 23-Jun-08 19:48 kvirt/web/templates/products.html
--rw-r--r--  2.0 unx      895 b- defN 23-Jun-08 19:48 kvirt/web/templates/productstable.html
--rw-r--r--  2.0 unx      699 b- defN 23-Jun-08 19:48 kvirt/web/templates/repocreate.html
--rw-r--r--  2.0 unx      475 b- defN 23-Jun-08 19:48 kvirt/web/templates/repos.html
--rw-r--r--  2.0 unx     1203 b- defN 23-Jun-08 19:48 kvirt/web/templates/repostable.html
--rw-r--r--  2.0 unx      958 b- defN 23-Jun-08 19:48 kvirt/web/templates/vmcreate.html
--rw-r--r--  2.0 unx      486 b- defN 23-Jun-08 19:48 kvirt/web/templates/vmprofiles.html
--rw-r--r--  2.0 unx     1420 b- defN 23-Jun-08 19:48 kvirt/web/templates/vmprofilestable.html
--rw-r--r--  2.0 unx      470 b- defN 23-Jun-08 19:48 kvirt/web/templates/vms.html
--rw-r--r--  2.0 unx     4894 b- defN 23-Jun-08 19:48 kvirt/web/templates/vmstable.html
--rw-r--r--  2.0 unx    11358 b- defN 23-Jun-08 19:54 kcli-99.0.202306081954.dist-info/LICENSE
--rw-r--r--  2.0 unx     2914 b- defN 23-Jun-08 19:54 kcli-99.0.202306081954.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jun-08 19:54 kcli-99.0.202306081954.dist-info/WHEEL
--rw-r--r--  2.0 unx      209 b- defN 23-Jun-08 19:54 kcli-99.0.202306081954.dist-info/entry_points.txt
--rw-r--r--  2.0 unx        6 b- defN 23-Jun-08 19:54 kcli-99.0.202306081954.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx    58624 b- defN 23-Jun-08 19:54 kcli-99.0.202306081954.dist-info/RECORD
-597 files, 4548835 bytes uncompressed, 1379705 bytes compressed:  69.7%
+Zip file size: 1479418 bytes, number of entries: 602
+-rw-r--r--  2.0 unx       15 b- defN 23-Jun-09 17:27 kvirt/__init__.py
+-rw-r--r--  2.0 unx   100451 b- defN 23-Jun-09 17:27 kvirt/baseconfig.py
+-rw-r--r--  2.0 unx   171487 b- defN 23-Jun-09 17:27 kvirt/bottle.py
+-rw-r--r--  2.0 unx   252835 b- defN 23-Jun-09 17:27 kvirt/cli.py
+-rw-r--r--  2.0 unx   188519 b- defN 23-Jun-09 17:27 kvirt/config.py
+-rw-r--r--  2.0 unx     2851 b- defN 23-Jun-09 17:27 kvirt/containerconfig.py
+-rw-r--r--  2.0 unx    11514 b- defN 23-Jun-09 17:27 kvirt/defaults.py
+-rw-r--r--  2.0 unx    19475 b- defN 23-Jun-09 17:27 kvirt/examples.py
+-rw-r--r--  2.0 unx     4333 b- defN 23-Jun-09 17:27 kvirt/ignitionmerger.py
+-rw-r--r--  2.0 unx    10074 b- defN 23-Jun-09 17:27 kvirt/keywords.yaml
+-rw-r--r--  2.0 unx     3487 b- defN 23-Jun-09 17:27 kvirt/klist.py
+-rw-r--r--  2.0 unx     6009 b- defN 23-Jun-09 17:27 kvirt/ansibleutils/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-09 17:27 kvirt/cluster/__init__.py
+-rw-r--r--  2.0 unx      204 b- defN 23-Jun-09 17:27 kvirt/cluster/sampleprovider.py
+-rw-r--r--  2.0 unx     8490 b- defN 23-Jun-09 17:27 kvirt/cluster/gke/__init__.py
+-rw-r--r--  2.0 unx       16 b- defN 23-Jun-09 17:27 kvirt/cluster/gke/fake.yml
+-rw-r--r--  2.0 unx      194 b- defN 23-Jun-09 17:27 kvirt/cluster/gke/kcli_default.yml
+-rw-r--r--  2.0 unx      312 b- defN 23-Jun-09 17:27 kvirt/cluster/gke/kubeconfig.j2
+-rw-r--r--  2.0 unx      931 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/99-apps.yaml
+-rw-r--r--  2.0 unx      694 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/99-forcedns
+-rw-r--r--  2.0 unx     1480 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/99-notifications.yaml
+-rw-r--r--  2.0 unx      653 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/Corefile
+-rw-r--r--  2.0 unx    43440 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/__init__.py
+-rw-r--r--  2.0 unx     1121 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/assisted_infra.yml
+-rw-r--r--  2.0 unx     1269 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/assisted_ingress.yml
+-rw-r--r--  2.0 unx     1366 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/autoapprovercron.yml
+-rw-r--r--  2.0 unx     1106 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/bmc.yml.j2
+-rw-r--r--  2.0 unx      511 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/calico.sh.j2
+-rw-r--r--  2.0 unx      200 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/cloud_lb_apps.yml
+-rw-r--r--  2.0 unx     1433 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/disconnected.sh
+-rw-r--r--  2.0 unx      184 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/extras.service
+-rw-r--r--  2.0 unx      839 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/extras.sh
+-rw-r--r--  2.0 unx     2954 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/hostedcluster.yaml
+-rw-r--r--  2.0 unx     1174 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/httpd.yaml
+-rw-r--r--  2.0 unx      889 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/ignition.sh
+-rw-r--r--  2.0 unx     2307 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/kcli_plan.yml
+-rw-r--r--  2.0 unx     2052 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/kcli_plan_default.yml
+-rw-r--r--  2.0 unx      502 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/keepalived.conf
+-rw-r--r--  2.0 unx     1587 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/nmstateconfig.yml.j2
+-rw-r--r--  2.0 unx      752 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/nodepool.yaml
+-rw-r--r--  2.0 unx       60 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/nonlocalbind.conf
+-rw-r--r--  2.0 unx     1890 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/staticpods/coredns.yml
+-rw-r--r--  2.0 unx     2142 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/staticpods/keepalived.yml
+-rw-r--r--  2.0 unx     1619 b- defN 23-Jun-09 17:27 kvirt/cluster/hypershift/staticpods/mdns.yml
+-rw-r--r--  2.0 unx    11448 b- defN 23-Jun-09 17:27 kvirt/cluster/k3s/__init__.py
+-rw-r--r--  2.0 unx     1117 b- defN 23-Jun-09 17:27 kvirt/cluster/k3s/bootstrap.sh
+-rw-r--r--  2.0 unx     1050 b- defN 23-Jun-09 17:27 kvirt/cluster/k3s/bootstrap.yml
+-rw-r--r--  2.0 unx      409 b- defN 23-Jun-09 17:27 kvirt/cluster/k3s/cloud_lb_api.yml
+-rw-r--r--  2.0 unx      438 b- defN 23-Jun-09 17:27 kvirt/cluster/k3s/ctlplanes.sh
+-rw-r--r--  2.0 unx     1068 b- defN 23-Jun-09 17:27 kvirt/cluster/k3s/ctlplanes.yml
+-rw-r--r--  2.0 unx      374 b- defN 23-Jun-09 17:27 kvirt/cluster/k3s/join.sh
+-rw-r--r--  2.0 unx     1260 b- defN 23-Jun-09 17:27 kvirt/cluster/k3s/kcli_default.yml
+-rw-r--r--  2.0 unx      511 b- defN 23-Jun-09 17:27 kvirt/cluster/k3s/keepalived.conf
+-rw-r--r--  2.0 unx      352 b- defN 23-Jun-09 17:27 kvirt/cluster/k3s/keepalived.sh
+-rw-r--r--  2.0 unx      166 b- defN 23-Jun-09 17:27 kvirt/cluster/k3s/workers.sh
+-rw-r--r--  2.0 unx      709 b- defN 23-Jun-09 17:27 kvirt/cluster/k3s/workers.yml
+-rw-r--r--  2.0 unx    13520 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/__init__.py
+-rwxr-xr-x  2.0 unx     2707 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/bootstrap.sh
+-rw-r--r--  2.0 unx     1621 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/bootstrap.yml
+-rw-r--r--  2.0 unx      325 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/cloud_lb_api.yml
+-rw-r--r--  2.0 unx     1172 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/ctlplanes.yml
+-rwxr-xr-x  2.0 unx      343 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/deploy.sh
+-rwxr-xr-x  2.0 unx      412 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/join.sh
+-rw-r--r--  2.0 unx     1822 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/kcli_default.yml
+-rw-r--r--  2.0 unx      563 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/keepalived.conf
+-rw-r--r--  2.0 unx      424 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/keepalived.sh
+-rw-r--r--  2.0 unx      140 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/kubernetes.repo
+-rw-r--r--  2.0 unx      179 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/multus.sh
+-rw-r--r--  2.0 unx      572 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/nfs.sh
+-rw-r--r--  2.0 unx      226 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/nfs.yml
+-rw-r--r--  2.0 unx     4021 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/pre_el.sh
+-rw-r--r--  2.0 unx     3906 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/pre_ubuntu.sh
+-rw-r--r--  2.0 unx     2127 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/registry.yml
+-rw-r--r--  2.0 unx      949 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/workers.yml
+-rw-r--r--  2.0 unx      487 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/argocd/ingress.yml
+-rw-r--r--  2.0 unx     2134 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/argocd/install.sh
+-rw-r--r--  2.0 unx       71 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/argocd/kcli_default.yml
+-rw-r--r--  2.0 unx      314 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/argocd/uninstall.sh
+-rw-r--r--  2.0 unx       90 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/autolabeller/install.sh
+-rw-r--r--  2.0 unx       91 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/autolabeller/uninstall.sh
+-rw-r--r--  2.0 unx      380 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/certmanager/install.sh
+-rw-r--r--  2.0 unx      317 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/dashboard/admin.yml
+-rw-r--r--  2.0 unx      452 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/dashboard/ingress.yml
+-rw-r--r--  2.0 unx     1433 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/dashboard/install.sh
+-rw-r--r--  2.0 unx       23 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/dashboard/kcli_default.yml
+-rw-r--r--  2.0 unx      373 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/dashboard/user.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/falco/falco_advertisements.yml
+-rw-r--r--  2.0 unx      185 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/falco/falco_ip.yml
+-rw-r--r--  2.0 unx      839 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/falco/install.sh
+-rw-r--r--  2.0 unx       57 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/falco/kcli_default.yml
+-rw-r--r--  2.0 unx      133 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/falco/uninstall.sh
+-rw-r--r--  2.0 unx      175 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/ingress/install.sh
+-rw-r--r--  2.0 unx      176 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/ingress/uninstall.sh
+-rw-r--r--  2.0 unx      112 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/istio/install.sh
+-rw-r--r--  2.0 unx      910 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/istio/istio-minimal-operator.yaml
+-rw-r--r--  2.0 unx      766 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/katacontainer/install.sh
+-rw-r--r--  2.0 unx      913 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/katacontainer/uninstall.sh
+-rw-r--r--  2.0 unx      198 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/knative/cr_eventing.yml
+-rw-r--r--  2.0 unx      194 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/knative/cr_serving.yml
+-rw-r--r--  2.0 unx      253 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/knative/install.sh
+-rw-r--r--  2.0 unx      670 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/kubevirt/install.sh
+-rw-r--r--  2.0 unx       30 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/kubevirt/kcli_default.yml
+-rw-r--r--  2.0 unx      534 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/metallb/install.sh
+-rw-r--r--  2.0 unx       47 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/metallb/kcli_default.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/metallb/metallb_advertisements.yml
+-rw-r--r--  2.0 unx      150 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/metallb/metallb_cr.yml
+-rw-r--r--  2.0 unx      283 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/metallb/uninstall.sh
+-rw-r--r--  2.0 unx      348 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/olm/install.sh
+-rw-r--r--  2.0 unx      350 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/olm/uninstall.sh
+-rw-r--r--  2.0 unx      320 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/policy_as_code/install.sh
+-rw-r--r--  2.0 unx       34 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/policy_as_code/kcli_default.yml
+-rw-r--r--  2.0 unx      322 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/policy_as_code/uninstall.sh
+-rw-r--r--  2.0 unx     1662 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/rancher/install.sh
+-rw-r--r--  2.0 unx      103 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/rancher/kcli_default.yml
+-rw-r--r--  2.0 unx      161 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/rancher/rancher_advertisements.yml
+-rw-r--r--  2.0 unx      191 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/rancher/rancher_ip.yml
+-rw-r--r--  2.0 unx      151 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/rancher/uninstall.sh
+-rw-r--r--  2.0 unx      572 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/rook/install.sh
+-rw-r--r--  2.0 unx      190 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/submariner/install.sh
+-rw-r--r--  2.0 unx       22 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/submariner/kcli_default.yml
+-rw-r--r--  2.0 unx      277 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/tekton/install.sh
+-rw-r--r--  2.0 unx      278 b- defN 23-Jun-09 17:27 kvirt/cluster/kubeadm/apps/tekton/uninstall.sh
+-rw-r--r--  2.0 unx     2970 b- defN 23-Jun-09 17:27 kvirt/cluster/kubecommon/__init__.py
+-rw-r--r--  2.0 unx     9395 b- defN 23-Jun-09 17:27 kvirt/cluster/kubernetes/__init__.py
+-rw-r--r--  2.0 unx     4782 b- defN 23-Jun-09 17:27 kvirt/cluster/microshift/__init__.py
+-rw-r--r--  2.0 unx      603 b- defN 23-Jun-09 17:27 kvirt/cluster/microshift/kcli_plan.yml
+-rw-r--r--  2.0 unx      625 b- defN 23-Jun-09 17:27 kvirt/cluster/microshift/kcli_plan_default.yml
+-rw-r--r--  2.0 unx      262 b- defN 23-Jun-09 17:27 kvirt/cluster/microshift/scripts/00_sslip.sh
+-rw-r--r--  2.0 unx      799 b- defN 23-Jun-09 17:27 kvirt/cluster/microshift/scripts/01_clients.sh
+-rw-r--r--  2.0 unx      183 b- defN 23-Jun-09 17:27 kvirt/cluster/microshift/scripts/02_crio.sh
+-rw-r--r--  2.0 unx      538 b- defN 23-Jun-09 17:27 kvirt/cluster/microshift/scripts/03_microshift.sh
+-rw-r--r--  2.0 unx      341 b- defN 23-Jun-09 17:27 kvirt/cluster/microshift/scripts/04_kubeconfig.sh
+-rw-r--r--  2.0 unx     2252 b- defN 23-Jun-09 17:27 kvirt/cluster/microshift/scripts/05_acm.sh
+-rw-r--r--  2.0 unx      696 b- defN 23-Jun-09 17:27 kvirt/cluster/microshift/scripts/deploy.sh
+-rw-r--r--  2.0 unx      219 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/01-workload-partitioning
+-rw-r--r--  2.0 unx      573 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/10-node-ip-hint.yaml
+-rw-r--r--  2.0 unx      980 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/99-apps.yaml
+-rw-r--r--  2.0 unx      618 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/99-bootstrap-deletion-2.yaml
+-rw-r--r--  2.0 unx     1239 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/99-bootstrap-deletion.yaml
+-rw-r--r--  2.0 unx      529 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/99-chrony.yaml
+-rw-r--r--  2.0 unx      646 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/99-forcedns
+-rw-r--r--  2.0 unx      476 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/99-forcedns-ibm
+-rw-r--r--  2.0 unx      854 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/99-kubevirt-fix.yaml
+-rw-r--r--  2.0 unx     1127 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/99-localhost-fix.yaml
+-rw-r--r--  2.0 unx      250 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/99-metal3-fake-machine.yaml
+-rw-r--r--  2.0 unx      162 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/99-metal3-provisioning.yaml
+-rw-r--r--  2.0 unx     1659 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/99-notifications.yaml
+-rw-r--r--  2.0 unx      118 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/99-operatorhub.yaml
+-rw-r--r--  2.0 unx      314 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/99-ovn.yaml
+-rw-r--r--  2.0 unx      912 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/99-sno.yaml
+-rw-r--r--  2.0 unx      762 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/Corefile
+-rw-r--r--  2.0 unx    81470 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/__init__.py
+-rw-r--r--  2.0 unx     1326 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/autoapprovercron.yml
+-rw-r--r--  2.0 unx      987 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/autorules.yml
+-rw-r--r--  2.0 unx     1630 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/bootstrap.yml
+-rw-r--r--  2.0 unx      250 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/calico.sh.j2
+-rw-r--r--  2.0 unx      107 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/chrony.conf
+-rw-r--r--  2.0 unx      629 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/cloud_bootstrap.yml
+-rw-r--r--  2.0 unx      792 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/cloud_ctlplanes.yml
+-rw-r--r--  2.0 unx      217 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/cloud_dns.yml
+-rw-r--r--  2.0 unx      616 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/cloud_lb_api.yml
+-rw-r--r--  2.0 unx      224 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/cloud_lb_apps.yml
+-rw-r--r--  2.0 unx      703 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/cloud_workers.yml
+-rw-r--r--  2.0 unx      123 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/cluster-ingress-02-config.yml
+-rw-r--r--  2.0 unx      159 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/cluster-scheduler-02-config.yml
+-rw-r--r--  2.0 unx      224 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/config.hcl.templ
+-rw-r--r--  2.0 unx       98 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/contrail-ca-patch.service
+-rw-r--r--  2.0 unx      486 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/contrail-ca-patch.sh
+-rw-r--r--  2.0 unx       87 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/contrail.auth
+-rw-r--r--  2.0 unx     1108 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/contrail.sh.j2
+-rw-r--r--  2.0 unx     2278 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/ctlplanes.yml
+-rw-r--r--  2.0 unx      326 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/dhcp.conf
+-rw-r--r--  2.0 unx      106 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/dhcp.sh
+-rw-r--r--  2.0 unx      536 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/dhcp.yml
+-rw-r--r--  2.0 unx      836 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/disconnected.yml
+-rw-r--r--  2.0 unx     8945 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/fake_kubeconfig.json
+-rw-r--r--  2.0 unx       35 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/fake_pull.json
+-rw-r--r--  2.0 unx     1792 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/haproxy.cfg
+-rw-r--r--  2.0 unx     2483 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/haproxy.cfg.kubevirt
+-rw-r--r--  2.0 unx      902 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/httpd.yaml
+-rw-r--r--  2.0 unx      524 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/ignition.j2
+-rw-r--r--  2.0 unx     3562 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/install-config.yaml
+-rw-r--r--  2.0 unx     2691 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/iso.sh
+-rw-r--r--  2.0 unx      237 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/kcli-ipv6.conf.j2
+-rw-r--r--  2.0 unx     4257 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/kcli_default.yml
+-rw-r--r--  2.0 unx      982 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/keepalived.conf
+-rw-r--r--  2.0 unx       60 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/nonlocalbind.conf
+-rw-r--r--  2.0 unx       59 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/openshift-workload-pinning
+-rw-r--r--  2.0 unx      157 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/relocate-ip-bootstrap.service
+-rw-r--r--  2.0 unx      281 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/relocate-ip-bootstrap.sh
+-rw-r--r--  2.0 unx      690 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/relocate-ip.sh
+-rw-r--r--  2.0 unx      212 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/sno-finish.service
+-rw-r--r--  2.0 unx     2085 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/sno-finish.sh
+-rw-r--r--  2.0 unx      660 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/sno.yml
+-rw-r--r--  2.0 unx     1615 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/workers.yml
+-rw-r--r--  2.0 unx       40 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/cr.sh
+-rw-r--r--  2.0 unx      768 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/install.yml.j2
+-rw-r--r--  2.0 unx      162 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/advanced-cluster-management/99-metal3-provisioning.yaml
+-rw-r--r--  2.0 unx     2754 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sample.yml
+-rwxr-xr-x  2.0 unx     2838 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sh
+-rw-r--r--  2.0 unx      418 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/advanced-cluster-management/cr.yml
+-rw-r--r--  2.0 unx      625 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/advanced-cluster-management/gen_registries.py
+-rw-r--r--  2.0 unx      259 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/advanced-cluster-management/kcli_default.yml
+-rw-r--r--  2.0 unx     1219 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/advanced-cluster-management/post.sh
+-rw-r--r--  2.0 unx      645 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/argocd/configmap.yml
+-rw-r--r--  2.0 unx     2423 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/argocd/install.sh
+-rw-r--r--  2.0 unx       49 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/argocd/kcli_default.yml
+-rw-r--r--  2.0 unx     1093 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/autolabeller/cr.yml
+-rw-r--r--  2.0 unx      142 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/autolabeller/install.sh
+-rw-r--r--  2.0 unx     1093 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/autolabeller/install.yml
+-rw-r--r--  2.0 unx      165 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/autolabeller/kcli_default.yml
+-rw-r--r--  2.0 unx       25 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/autolabeller/uninstall.sh
+-rw-r--r--  2.0 unx      873 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/cluster-logging/cr.yml
+-rw-r--r--  2.0 unx       63 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/cluster-logging/kcli_default.yml
+-rw-r--r--  2.0 unx      265 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/istio/install.sh
+-rw-r--r--  2.0 unx      377 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/istio/istio-cni.yaml
+-rw-r--r--  2.0 unx     1039 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/cr.yml
+-rw-r--r--  2.0 unx      154 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/kcli_default.yml
+-rw-r--r--  2.0 unx      775 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/local-storage-operator/cr.yml
+-rw-r--r--  2.0 unx      227 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/local-storage-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      642 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/local-storage-operator/post.sh
+-rw-r--r--  2.0 unx      349 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/lvms-operator/cr.yml
+-rw-r--r--  2.0 unx      137 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/lvms-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      595 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/lvms-operator/post.sh
+-rw-r--r--  2.0 unx      510 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/metallb-operator/cr.yml
+-rw-r--r--  2.0 unx       94 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/metallb-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      162 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/multicluster-engine/99-metal3-provisioning.yaml
+-rw-r--r--  2.0 unx     2754 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sample.yml
+-rwxr-xr-x  2.0 unx     2845 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sh
+-rw-r--r--  2.0 unx      245 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/multicluster-engine/cr.yml
+-rw-r--r--  2.0 unx      625 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/multicluster-engine/gen_registries.py
+-rw-r--r--  2.0 unx      118 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/multicluster-engine/kcli_default.yml
+-rwxr-xr-x  2.0 unx       55 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/multicluster-engine/post.sh
+-rwxr-xr-x  2.0 unx     2298 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/nfs/install.sh
+-rw-r--r--  2.0 unx      117 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/nfs/kcli_default.yml
+-rw-r--r--  2.0 unx      185 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/nfs/uninstall.sh
+-rw-r--r--  2.0 unx      849 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/odf-operator/cr.yml
+-rw-r--r--  2.0 unx      298 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/odf-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      364 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/odf-operator/nad_cluster.yml
+-rw-r--r--  2.0 unx      362 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/odf-operator/nad_public.yml
+-rw-r--r--  2.0 unx      745 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/odf-operator/post.sh
+-rw-r--r--  2.0 unx      530 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/odf-operator/pre.sh
+-rw-r--r--  2.0 unx      363 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/serverless-operator/cr.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/serverless-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      278 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/serverless-operator/post.sh
+-rw-r--r--  2.0 unx     1227 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/users/install.sh
+-rw-r--r--  2.0 unx       84 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/users/kcli_default.yml
+-rw-r--r--  2.0 unx      258 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/users/oauth.yml
+-rw-r--r--  2.0 unx      249 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/users/oauth_hypershift.yml
+-rw-r--r--  2.0 unx      422 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/apps/users/uninstall.sh
+-rw-r--r--  2.0 unx       60 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/customisation/00-kcli-namespace.yaml
+-rw-r--r--  2.0 unx       91 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/customisation/97-autoapprovercron-sa.yaml
+-rw-r--r--  2.0 unx      264 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/customisation/98-autoapprovercron-binding.yaml
+-rw-r--r--  2.0 unx      912 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/customisation/99-autoapprovercron-cronjob.yaml
+-rw-r--r--  2.0 unx      389 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/customisation/99-ingress-controller.yaml
+-rw-r--r--  2.0 unx      184 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/customisation/99-monitoring.yaml
+-rw-r--r--  2.0 unx      289 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/customisation/99-registry.yaml
+-rw-r--r--  2.0 unx     1685 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/disconnected/haproxy.cfg
+-rw-r--r--  2.0 unx      211 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/disconnected/registry.service
+-rwxr-xr-x  2.0 unx      328 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/disconnected/bin/sync_image.sh
+-rwxr-xr-x  2.0 unx      201 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/disconnected/scripts/01_get_oc.sh
+-rwxr-xr-x  2.0 unx     2484 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/disconnected/scripts/03_mirror.sh
+-rwxr-xr-x  2.0 unx     2046 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/disconnected/scripts/03_registry.sh
+-rwxr-xr-x  2.0 unx      337 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/disconnected/scripts/04_extras.sh
+-rwxr-xr-x  2.0 unx     2390 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/disconnected/scripts/05_olm.sh
+-rwxr-xr-x  2.0 unx      241 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/disconnected/scripts/06_web.sh
+-rwxr-xr-x  2.0 unx      733 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/disconnected/scripts/deploy.sh
+-rw-r--r--  2.0 unx     1768 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/disconnected/scripts/mirror-config.yaml.sample
+-rw-r--r--  2.0 unx     2557 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/staticpods/coredns.yml
+-rw-r--r--  2.0 unx      987 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/staticpods/haproxy.yml
+-rw-r--r--  2.0 unx     2539 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/staticpods/keepalived.yml
+-rw-r--r--  2.0 unx     1721 b- defN 23-Jun-09 17:27 kvirt/cluster/openshift/staticpods/mdns.yml
+-rw-r--r--  2.0 unx      193 b- defN 23-Jun-09 17:27 kvirt/cluster/profiles/sample-kubeadm-default.yml
+-rw-r--r--  2.0 unx      135 b- defN 23-Jun-09 17:27 kvirt/cluster/profiles/sample-openshift-compact.yml
+-rw-r--r--  2.0 unx      210 b- defN 23-Jun-09 17:27 kvirt/cluster/profiles/sample-openshift-contrail.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-Jun-09 17:27 kvirt/cluster/profiles/sample-openshift-ipv6.yml
+-rw-r--r--  2.0 unx       55 b- defN 23-Jun-09 17:27 kvirt/cluster/profiles/sample-openshift-sno-bm.yml
+-rw-r--r--  2.0 unx      148 b- defN 23-Jun-09 17:27 kvirt/cluster/profiles/sample-openshift-sno.yml
+-rw-r--r--  2.0 unx     3377 b- defN 23-Jun-09 17:27 kvirt/common/Jenkinsfile.j2
+-rw-r--r--  2.0 unx    96428 b- defN 23-Jun-09 17:27 kvirt/common/__init__.py
+-rw-r--r--  2.0 unx     1406 b- defN 23-Jun-09 17:27 kvirt/common/autoscale.yaml.j2
+-rw-r--r--  2.0 unx     8945 b- defN 23-Jun-09 17:27 kvirt/common/fake_kubeconfig.json
+-rw-r--r--  2.0 unx      669 b- defN 23-Jun-09 17:27 kvirt/common/ignition.j2
+-rw-r--r--  2.0 unx      125 b- defN 23-Jun-09 17:27 kvirt/common/kubevirt_kcli_conf.j2
+-rw-r--r--  2.0 unx       99 b- defN 23-Jun-09 17:27 kvirt/common/local_kcli_conf.j2
+-rw-r--r--  2.0 unx     3068 b- defN 23-Jun-09 17:27 kvirt/common/pipeline.yml.j2
+-rw-r--r--  2.0 unx     2377 b- defN 23-Jun-09 17:27 kvirt/common/pipeline_kube.yml.j2
+-rw-r--r--  2.0 unx     1381 b- defN 23-Jun-09 17:27 kvirt/common/playbook.j2
+-rw-r--r--  2.0 unx     1557 b- defN 23-Jun-09 17:27 kvirt/common/storage.sh.j2
+-rw-r--r--  2.0 unx     4562 b- defN 23-Jun-09 17:27 kvirt/common/vm.ovf.j2
+-rw-r--r--  2.0 unx     2241 b- defN 23-Jun-09 17:27 kvirt/common/workflow.yml.j2
+-rw-r--r--  2.0 unx     2208 b- defN 23-Jun-09 17:27 kvirt/common/workflow_script.yml.j2
+-rw-r--r--  2.0 unx    15041 b- defN 23-Jun-09 17:27 kvirt/container/__init__.py
+-rw-r--r--  2.0 unx    11716 b- defN 23-Jun-09 17:27 kvirt/expose/__init__.py
+-rw-r--r--  2.0 unx     4319 b- defN 23-Jun-09 17:27 kvirt/expose/swagger.yml
+-rw-r--r--  2.0 unx      408 b- defN 23-Jun-09 17:27 kvirt/expose/static/css/bootstrap-notify.css
+-rw-r--r--  2.0 unx   121125 b- defN 23-Jun-09 17:27 kvirt/expose/static/css/bootstrap.min.css
+-rw-r--r--  2.0 unx      399 b- defN 23-Jun-09 17:27 kvirt/expose/static/css/dataTables.checkboxes.css
+-rw-r--r--  2.0 unx    13587 b- defN 23-Jun-09 17:27 kvirt/expose/static/css/jquery.dataTables.min.css
+-rw-r--r--  2.0 unx      868 b- defN 23-Jun-09 17:27 kvirt/expose/static/css/kcli.css
+-rw-r--r--  2.0 unx      269 b- defN 23-Jun-09 17:27 kvirt/expose/static/css/wheel.css
+-rw-r--r--  2.0 unx     1406 b- defN 23-Jun-09 17:27 kvirt/expose/static/images/favicon.ico
+-rw-r--r--  2.0 unx      160 b- defN 23-Jun-09 17:27 kvirt/expose/static/images/sort_asc.png
+-rw-r--r--  2.0 unx      201 b- defN 23-Jun-09 17:27 kvirt/expose/static/images/sort_both.png
+-rw-r--r--  2.0 unx      158 b- defN 23-Jun-09 17:27 kvirt/expose/static/images/sort_desc.png
+-rw-r--r--  2.0 unx    24772 b- defN 23-Jun-09 17:27 kvirt/expose/static/images/wheel.gif
+-rw-r--r--  2.0 unx    12398 b- defN 23-Jun-09 17:27 kvirt/expose/static/js/dataTables.checkboxes.min.js
+-rw-r--r--  2.0 unx      367 b- defN 23-Jun-09 17:27 kvirt/expose/static/js/exposeactions.js
+-rw-r--r--  2.0 unx    83059 b- defN 23-Jun-09 17:27 kvirt/expose/static/js/jquery.dataTables.min.js
+-rw-r--r--  2.0 unx    89795 b- defN 23-Jun-09 17:27 kvirt/expose/static/js/jquery.min.js
+-rw-r--r--  2.0 unx      263 b- defN 23-Jun-09 17:27 kvirt/expose/static/js/list.js
+-rw-r--r--  2.0 unx     1605 b- defN 23-Jun-09 17:27 kvirt/expose/templates/form.html
+-rw-r--r--  2.0 unx     1035 b- defN 23-Jun-09 17:27 kvirt/expose/templates/head.html
+-rw-r--r--  2.0 unx      406 b- defN 23-Jun-09 17:27 kvirt/expose/templates/index.html
+-rw-r--r--  2.0 unx     1220 b- defN 23-Jun-09 17:27 kvirt/expose/templates/infoplan.html
+-rw-r--r--  2.0 unx      574 b- defN 23-Jun-09 17:27 kvirt/expose/templates/planstable.html
+-rw-r--r--  2.0 unx      550 b- defN 23-Jun-09 17:27 kvirt/expose/templates/result.html
+-rw-r--r--  2.0 unx     1754 b- defN 23-Jun-09 17:27 kvirt/internalplans/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-09 17:27 kvirt/jinjafilters/__init__.py
+-rw-r--r--  2.0 unx     5249 b- defN 23-Jun-09 17:27 kvirt/jinjafilters/jinjafilters.py
+-rw-r--r--  2.0 unx     8477 b- defN 23-Jun-09 17:27 kvirt/kfish/__init__.py
+-rw-r--r--  2.0 unx     9124 b- defN 23-Jun-09 17:27 kvirt/ksushy/__init__.py
+-rw-r--r--  2.0 unx      121 b- defN 23-Jun-09 17:27 kvirt/ksushy/main.py
+-rw-r--r--  2.0 unx     1028 b- defN 23-Jun-09 17:27 kvirt/ksushy/templates/bios.json
+-rw-r--r--  2.0 unx      443 b- defN 23-Jun-09 17:27 kvirt/ksushy/templates/interface.json
+-rw-r--r--  2.0 unx      418 b- defN 23-Jun-09 17:27 kvirt/ksushy/templates/interfaces.json
+-rw-r--r--  2.0 unx     1050 b- defN 23-Jun-09 17:27 kvirt/ksushy/templates/manager.json
+-rw-r--r--  2.0 unx      571 b- defN 23-Jun-09 17:27 kvirt/ksushy/templates/managers.json
+-rw-r--r--  2.0 unx      535 b- defN 23-Jun-09 17:27 kvirt/ksushy/templates/root.json
+-rw-r--r--  2.0 unx     2732 b- defN 23-Jun-09 17:27 kvirt/ksushy/templates/system.json
+-rw-r--r--  2.0 unx      511 b- defN 23-Jun-09 17:27 kvirt/ksushy/templates/systems.json
+-rw-r--r--  2.0 unx     1219 b- defN 23-Jun-09 17:27 kvirt/ksushy/templates/virtualmedia_cd.json
+-rw-r--r--  2.0 unx      705 b- defN 23-Jun-09 17:27 kvirt/ksushy/templates/virtualmedias.json
+-rw-r--r--  2.0 unx     2780 b- defN 23-Jun-09 17:27 kvirt/miniconsole/__init__.py
+-rw-r--r--  2.0 unx     3488 b- defN 23-Jun-09 17:27 kvirt/nameutils/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-09 17:27 kvirt/providers/__init__.py
+-rw-r--r--  2.0 unx     8935 b- defN 23-Jun-09 17:27 kvirt/providers/sampleprovider.py
+-rw-r--r--  2.0 unx    65812 b- defN 23-Jun-09 17:27 kvirt/providers/aws/__init__.py
+-rw-r--r--  2.0 unx      479 b- defN 23-Jun-09 17:27 kvirt/providers/fake/__init__.py
+-rw-r--r--  2.0 unx    67767 b- defN 23-Jun-09 17:27 kvirt/providers/gcp/__init__.py
+-rw-r--r--  2.0 unx      175 b- defN 23-Jun-09 17:27 kvirt/providers/gcp/gcp-hack.service
+-rw-r--r--  2.0 unx      231 b- defN 23-Jun-09 17:27 kvirt/providers/gcp/gcp-hack.sh
+-rw-r--r--  2.0 unx    65048 b- defN 23-Jun-09 17:27 kvirt/providers/ibm/__init__.py
+-rw-r--r--  2.0 unx    80962 b- defN 23-Jun-09 17:27 kvirt/providers/kubevirt/__init__.py
+-rw-r--r--  2.0 unx   184246 b- defN 23-Jun-09 17:27 kvirt/providers/kvm/__init__.py
+-rw-r--r--  2.0 unx     1965 b- defN 23-Jun-09 17:27 kvirt/providers/kvm/helpers.py
+-rw-r--r--  2.0 unx    57076 b- defN 23-Jun-09 17:27 kvirt/providers/openstack/__init__.py
+-rw-r--r--  2.0 unx    62544 b- defN 23-Jun-09 17:27 kvirt/providers/ovirt/__init__.py
+-rw-r--r--  2.0 unx    31112 b- defN 23-Jun-09 17:27 kvirt/providers/packet/__init__.py
+-rw-r--r--  2.0 unx    73099 b- defN 23-Jun-09 17:27 kvirt/providers/vsphere/__init__.py
+-rw-r--r--  2.0 unx    13655 b- defN 23-Jun-09 17:27 kvirt/providers/vsphere/helpers.py
+-rw-r--r--  2.0 unx     4893 b- defN 23-Jun-09 17:27 kvirt/providers/vsphere/tagging.py
+-rw-r--r--  2.0 unx    21286 b- defN 23-Jun-09 17:27 kvirt/providers/web/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-09 17:27 kvirt/version/__init__.py
+-rw-r--r--  2.0 unx       19 b- defN 23-Jun-09 17:32 kvirt/version/git
+-rw-r--r--  2.0 unx    46592 b- defN 23-Jun-09 17:27 kvirt/web/__init__.py
+-rw-r--r--  2.0 unx      261 b- defN 23-Jun-09 17:27 kvirt/web/main.py
+-rw-r--r--  2.0 unx      408 b- defN 23-Jun-09 17:27 kvirt/web/static/css/bootstrap-notify.css
+-rw-r--r--  2.0 unx    23409 b- defN 23-Jun-09 17:27 kvirt/web/static/css/bootstrap-theme.min.css
+-rw-r--r--  2.0 unx   121125 b- defN 23-Jun-09 17:27 kvirt/web/static/css/bootstrap.min.css
+-rw-r--r--  2.0 unx      399 b- defN 23-Jun-09 17:27 kvirt/web/static/css/dataTables.checkboxes.css
+-rw-r--r--  2.0 unx    13587 b- defN 23-Jun-09 17:27 kvirt/web/static/css/jquery.dataTables.min.css
+-rw-r--r--  2.0 unx      816 b- defN 23-Jun-09 17:27 kvirt/web/static/css/kcli.css
+-rw-r--r--  2.0 unx     3033 b- defN 23-Jun-09 17:27 kvirt/web/static/css/navbar.css
+-rw-r--r--  2.0 unx     2908 b- defN 23-Jun-09 17:27 kvirt/web/static/css/spice.css
+-rw-r--r--  2.0 unx      271 b- defN 23-Jun-09 17:27 kvirt/web/static/css/wheel.css
+-rw-r--r--  2.0 unx    18028 b- defN 23-Jun-09 17:27 kvirt/web/static/fonts/glyphicons-halflings-regular.woff2
+-rw-r--r--  2.0 unx      715 b- defN 23-Jun-09 17:27 kvirt/web/static/images/Centos.png
+-rw-r--r--  2.0 unx      294 b- defN 23-Jun-09 17:27 kvirt/web/static/images/Debian.png
+-rw-r--r--  2.0 unx      987 b- defN 23-Jun-09 17:27 kvirt/web/static/images/Fedora.png
+-rw-r--r--  2.0 unx      672 b- defN 23-Jun-09 17:27 kvirt/web/static/images/Redhat.png
+-rw-r--r--  2.0 unx     1278 b- defN 23-Jun-09 17:27 kvirt/web/static/images/Suse.png
+-rw-r--r--  2.0 unx     1782 b- defN 23-Jun-09 17:27 kvirt/web/static/images/Tux.png
+-rw-r--r--  2.0 unx      544 b- defN 23-Jun-09 17:27 kvirt/web/static/images/Ubuntu.png
+-rw-r--r--  2.0 unx     4213 b- defN 23-Jun-09 17:27 kvirt/web/static/images/delete.png
+-rw-r--r--  2.0 unx     1406 b- defN 23-Jun-09 17:27 kvirt/web/static/images/favicon.ico
+-rw-r--r--  2.0 unx    23320 b- defN 23-Jun-09 17:27 kvirt/web/static/images/kcli-small.png
+-rw-r--r--  2.0 unx    27185 b- defN 23-Jun-09 17:27 kvirt/web/static/images/kcli.jpg
+-rw-r--r--  2.0 unx   113928 b- defN 23-Jun-09 17:27 kvirt/web/static/images/kcli.png
+-rw-r--r--  2.0 unx    48809 b- defN 23-Jun-09 17:27 kvirt/web/static/images/logo-header.svg
+-rw-r--r--  2.0 unx    48809 b- defN 23-Jun-09 17:27 kvirt/web/static/images/logo-main.svg
+-rw-r--r--  2.0 unx      160 b- defN 23-Jun-09 17:27 kvirt/web/static/images/sort_asc.png
+-rw-r--r--  2.0 unx      201 b- defN 23-Jun-09 17:27 kvirt/web/static/images/sort_both.png
+-rw-r--r--  2.0 unx      158 b- defN 23-Jun-09 17:27 kvirt/web/static/images/sort_desc.png
+-rw-r--r--  2.0 unx     3927 b- defN 23-Jun-09 17:27 kvirt/web/static/images/start.png
+-rw-r--r--  2.0 unx     3631 b- defN 23-Jun-09 17:27 kvirt/web/static/images/stop.png
+-rw-r--r--  2.0 unx    24772 b- defN 23-Jun-09 17:27 kvirt/web/static/images/wheel.gif
+-rw-r--r--  2.0 unx     2933 b- defN 23-Jun-09 17:27 kvirt/web/static/js/bootstrap-notify.js
+-rw-r--r--  2.0 unx    37045 b- defN 23-Jun-09 17:27 kvirt/web/static/js/bootstrap.min.js
+-rw-r--r--  2.0 unx     2523 b- defN 23-Jun-09 17:27 kvirt/web/static/js/containeraction.js
+-rw-r--r--  2.0 unx    12398 b- defN 23-Jun-09 17:27 kvirt/web/static/js/dataTables.checkboxes.min.js
+-rw-r--r--  2.0 unx     1642 b- defN 23-Jun-09 17:27 kvirt/web/static/js/hostaction.js
+-rw-r--r--  2.0 unx     1187 b- defN 23-Jun-09 17:27 kvirt/web/static/js/imageaction.js
+-rw-r--r--  2.0 unx    83059 b- defN 23-Jun-09 17:27 kvirt/web/static/js/jquery.dataTables.min.js
+-rw-r--r--  2.0 unx    87462 b- defN 23-Jun-09 17:27 kvirt/web/static/js/jquery.min.js
+-rw-r--r--  2.0 unx     2704 b- defN 23-Jun-09 17:27 kvirt/web/static/js/kcli.js
+-rw-r--r--  2.0 unx     1594 b- defN 23-Jun-09 17:27 kvirt/web/static/js/kubeaction.js
+-rw-r--r--  2.0 unx     3907 b- defN 23-Jun-09 17:27 kvirt/web/static/js/list.js
+-rw-r--r--  2.0 unx     1376 b- defN 23-Jun-09 17:27 kvirt/web/static/js/networkaction.js
+-rw-r--r--  2.0 unx     2457 b- defN 23-Jun-09 17:27 kvirt/web/static/js/planaction.js
+-rw-r--r--  2.0 unx     1237 b- defN 23-Jun-09 17:27 kvirt/web/static/js/poolaction.js
+-rw-r--r--  2.0 unx      846 b- defN 23-Jun-09 17:27 kvirt/web/static/js/productaction.js
+-rw-r--r--  2.0 unx      270 b- defN 23-Jun-09 17:27 kvirt/web/static/js/refresh.js
+-rw-r--r--  2.0 unx     1835 b- defN 23-Jun-09 17:27 kvirt/web/static/js/repoaction.js
+-rw-r--r--  2.0 unx     3463 b- defN 23-Jun-09 17:27 kvirt/web/static/js/snapshotaction.js
+-rw-r--r--  2.0 unx     2745 b- defN 23-Jun-09 17:27 kvirt/web/static/js/vmaction.js
+-rw-r--r--  2.0 unx      123 b- defN 23-Jun-09 17:27 kvirt/web/static/js/wheel.js
+-rw-r--r--  2.0 unx     9944 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/atKeynames.js
+-rw-r--r--  2.0 unx     2335 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/bitmap.js
+-rw-r--r--  2.0 unx     4795 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/cursor.js
+-rw-r--r--  2.0 unx    49214 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/display.js
+-rw-r--r--  2.0 unx    13253 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/enums.js
+-rw-r--r--  2.0 unx     2847 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/filexfer.js
+-rw-r--r--  2.0 unx     9535 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/inputs.js
+-rw-r--r--  2.0 unx     6176 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/lz.js
+-rw-r--r--  2.0 unx    18370 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/main.js
+-rw-r--r--  2.0 unx    12677 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/playback.js
+-rw-r--r--  2.0 unx     7036 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/png.js
+-rw-r--r--  2.0 unx     3110 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/port.js
+-rw-r--r--  2.0 unx    44531 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/quic.js
+-rw-r--r--  2.0 unx     3030 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/resize.js
+-rw-r--r--  2.0 unx     7282 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/simulatecursor.js
+-rw-r--r--  2.0 unx     1895 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/spicearraybuffer.js
+-rw-r--r--  2.0 unx    18202 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/spiceconn.js
+-rw-r--r--  2.0 unx     3616 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/spicedataview.js
+-rw-r--r--  2.0 unx    33015 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/spicemsg.js
+-rw-r--r--  2.0 unx    12767 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/spicetype.js
+-rw-r--r--  2.0 unx     6808 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/ticket.js
+-rw-r--r--  2.0 unx    13628 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/utils.js
+-rw-r--r--  2.0 unx    21577 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/webm.js
+-rw-r--r--  2.0 unx     4131 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/wire.js
+-rw-r--r--  2.0 unx    16580 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/thirdparty/jsbn.js
+-rw-r--r--  2.0 unx     2529 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/thirdparty/prng4.js
+-rw-r--r--  2.0 unx     3442 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/thirdparty/rng.js
+-rw-r--r--  2.0 unx     4257 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/thirdparty/rsa.js
+-rw-r--r--  2.0 unx    10671 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/thirdparty/sha1.js
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/.npmignore
+-rw-r--r--  2.0 unx      419 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/README.md
+-rw-r--r--  2.0 unx      359 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/rollup.config.js
+-rw-r--r--  2.0 unx     1113 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/babel-worker.js
+-rw-r--r--  2.0 unx     8601 b- defN 23-Jun-09 17:27 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/browser-es-module-loader.js
+-rw-r--r--  2.0 unx     2176 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/error-handler.js
+-rw-r--r--  2.0 unx     5682 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/localization.js
+-rw-r--r--  2.0 unx    56845 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/ui.js
+-rw-r--r--  2.0 unx     6696 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/webutil.js
+-rw-r--r--  2.0 unx     3553 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/alt.svg
+-rw-r--r--  2.0 unx     3980 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/clipboard.svg
+-rw-r--r--  2.0 unx     3430 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/connect.svg
+-rw-r--r--  2.0 unx     4381 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/ctrl.svg
+-rw-r--r--  2.0 unx     3237 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/ctrlaltdel.svg
+-rw-r--r--  2.0 unx     5062 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/disconnect.svg
+-rw-r--r--  2.0 unx     4684 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/drag.svg
+-rw-r--r--  2.0 unx     3106 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/error.svg
+-rw-r--r--  2.0 unx     4522 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/esc.svg
+-rw-r--r--  2.0 unx     3066 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/expander.svg
+-rw-r--r--  2.0 unx     3139 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/fullscreen.svg
+-rw-r--r--  2.0 unx     2559 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/handle.svg
+-rw-r--r--  2.0 unx     6386 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/handle_bg.svg
+-rw-r--r--  2.0 unx     3204 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/info.svg
+-rw-r--r--  2.0 unx     6404 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/keyboard.svg
+-rw-r--r--  2.0 unx     7000 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/mouse_left.svg
+-rw-r--r--  2.0 unx     7002 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/mouse_middle.svg
+-rw-r--r--  2.0 unx     6993 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/mouse_none.svg
+-rw-r--r--  2.0 unx     7001 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/mouse_right.svg
+-rw-r--r--  2.0 unx     3985 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/power.svg
+-rw-r--r--  2.0 unx     3082 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/settings.svg
+-rw-r--r--  2.0 unx     2953 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/tab.svg
+-rw-r--r--  2.0 unx     4441 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/toggleextrakeys.svg
+-rw-r--r--  2.0 unx     3869 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/warning.svg
+-rw-r--r--  2.0 unx     3178 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/windows.svg
+-rw-r--r--  2.0 unx      871 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/icons/Makefile
+-rw-r--r--  2.0 unx     4028 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/icons/novnc-120x120.png
+-rw-r--r--  2.0 unx     4582 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/icons/novnc-144x144.png
+-rw-r--r--  2.0 unx     5216 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/icons/novnc-152x152.png
+-rw-r--r--  2.0 unx      675 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/icons/novnc-16x16.png
+-rw-r--r--  2.0 unx     5787 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/icons/novnc-192x192.png
+-rw-r--r--  2.0 unx     1000 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/icons/novnc-24x24.png
+-rw-r--r--  2.0 unx     1064 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/icons/novnc-32x32.png
+-rw-r--r--  2.0 unx     1397 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/icons/novnc-48x48.png
+-rw-r--r--  2.0 unx     1932 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/icons/novnc-60x60.png
+-rw-r--r--  2.0 unx     1946 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/icons/novnc-64x64.png
+-rw-r--r--  2.0 unx     2699 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/icons/novnc-72x72.png
+-rw-r--r--  2.0 unx     2874 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/icons/novnc-76x76.png
+-rw-r--r--  2.0 unx     2351 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/icons/novnc-96x96.png
+-rw-r--r--  2.0 unx    11685 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/icons/novnc-icon-sm.svg
+-rw-r--r--  2.0 unx    11549 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/images/icons/novnc-icon.svg
+-rw-r--r--  2.0 unx     2885 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/locale/cs.json
+-rw-r--r--  2.0 unx     2854 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/locale/de.json
+-rw-r--r--  2.0 unx     3906 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/locale/el.json
+-rw-r--r--  2.0 unx     2671 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/locale/es.json
+-rw-r--r--  2.0 unx     3354 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/locale/ja.json
+-rw-r--r--  2.0 unx     2961 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/locale/ko.json
+-rw-r--r--  2.0 unx     3035 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/locale/nl.json
+-rw-r--r--  2.0 unx     2830 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/locale/pl.json
+-rw-r--r--  2.0 unx     3825 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/locale/ru.json
+-rw-r--r--  2.0 unx     2845 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/locale/sv.json
+-rw-r--r--  2.0 unx     2811 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/locale/tr.json
+-rw-r--r--  2.0 unx     2597 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/locale/zh_CN.json
+-rw-r--r--  2.0 unx     2606 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/locale/zh_TW.json
+-rw-r--r--  2.0 unx      157 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/sounds/CREDITS
+-rw-r--r--  2.0 unx     4531 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/sounds/bell.mp3
+-rw-r--r--  2.0 unx     8495 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/sounds/bell.oga
+-rw-r--r--  2.0 unx    38580 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/styles/Orbitron700.ttf
+-rw-r--r--  2.0 unx    17472 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/styles/Orbitron700.woff
+-rw-r--r--  2.0 unx    18450 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/app/styles/base.css
+-rw-r--r--  2.0 unx     4189 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/base64.js
+-rw-r--r--  2.0 unx    11241 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/des.js
+-rw-r--r--  2.0 unx    20381 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/display.js
+-rw-r--r--  2.0 unx     1374 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/encodings.js
+-rw-r--r--  2.0 unx     1170 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/inflator.js
+-rw-r--r--  2.0 unx    74196 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/rfb.js
+-rw-r--r--  2.0 unx     9130 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/websock.js
+-rw-r--r--  2.0 unx      628 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/decoders/copyrect.js
+-rw-r--r--  2.0 unx     4814 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/decoders/hextile.js
+-rw-r--r--  2.0 unx     1739 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/decoders/raw.js
+-rw-r--r--  2.0 unx     1210 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/decoders/rre.js
+-rw-r--r--  2.0 unx     9662 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/decoders/tight.js
+-rw-r--r--  2.0 unx      768 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/decoders/tightpng.js
+-rw-r--r--  2.0 unx    11438 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/input/domkeytable.js
+-rw-r--r--  2.0 unx     3804 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/input/fixedkeys.js
+-rw-r--r--  2.0 unx    13090 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/input/keyboard.js
+-rw-r--r--  2.0 unx    34609 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/input/keysym.js
+-rw-r--r--  2.0 unx    25374 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/input/keysymdef.js
+-rw-r--r--  2.0 unx     9995 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/input/mouse.js
+-rw-r--r--  2.0 unx     5283 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/input/util.js
+-rw-r--r--  2.0 unx     2580 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/input/vkeys.js
+-rw-r--r--  2.0 unx    14256 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/input/xtscancodes.js
+-rw-r--r--  2.0 unx     3155 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/util/browser.js
+-rw-r--r--  2.0 unx     7556 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/util/cursor.js
+-rw-r--r--  2.0 unx     4221 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/util/events.js
+-rw-r--r--  2.0 unx      896 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/util/eventtarget.js
+-rw-r--r--  2.0 unx     1358 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/util/logging.js
+-rw-r--r--  2.0 unx     1866 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/util/polyfill.js
+-rw-r--r--  2.0 unx      301 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/core/util/strings.js
+-rw-r--r--  2.0 unx     7388 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/promise.js
+-rw-r--r--  2.0 unx      419 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/browser-es-module-loader/README.md
+-rw-r--r--  2.0 unx      295 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/browser-es-module-loader/rollup.config.js
+-rw-r--r--  2.0 unx     1113 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/babel-worker.js
+-rw-r--r--  2.0 unx     8498 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/browser-es-module-loader.js
+-rw-r--r--  2.0 unx     1084 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/pako/LICENSE
+-rw-r--r--  2.0 unx      301 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/pako/README.md
+-rw-r--r--  2.0 unx     1062 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/pako/lib/utils/common.js
+-rw-r--r--  2.0 unx      666 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/pako/lib/zlib/adler32.js
+-rw-r--r--  2.0 unx     1334 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/pako/lib/zlib/constants.js
+-rw-r--r--  2.0 unx      764 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/pako/lib/zlib/crc32.js
+-rw-r--r--  2.0 unx    60016 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/pako/lib/zlib/deflate.js
+-rw-r--r--  2.0 unx     1251 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/pako/lib/zlib/gzheader.js
+-rw-r--r--  2.0 unx    11690 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/pako/lib/zlib/inffast.js
+-rw-r--r--  2.0 unx    47128 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/pako/lib/zlib/inflate.js
+-rw-r--r--  2.0 unx    11527 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/pako/lib/zlib/inftrees.js
+-rw-r--r--  2.0 unx      560 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/pako/lib/zlib/messages.js
+-rw-r--r--  2.0 unx    38767 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/pako/lib/zlib/trees.js
+-rw-r--r--  2.0 unx      823 b- defN 23-Jun-09 17:27 kvirt/web/static/vnc/vendor/pako/lib/zlib/zstream.js
+-rw-r--r--  2.0 unx     2509 b- defN 23-Jun-09 17:27 kvirt/web/templates/bootstrap.html
+-rw-r--r--  2.0 unx    14595 b- defN 23-Jun-09 17:27 kvirt/web/templates/console.html
+-rw-r--r--  2.0 unx      717 b- defN 23-Jun-09 17:27 kvirt/web/templates/containercreate.html
+-rw-r--r--  2.0 unx      493 b- defN 23-Jun-09 17:27 kvirt/web/templates/containerprofiles.html
+-rw-r--r--  2.0 unx     1050 b- defN 23-Jun-09 17:27 kvirt/web/templates/containerprofilestable.html
+-rw-r--r--  2.0 unx      490 b- defN 23-Jun-09 17:27 kvirt/web/templates/containers.html
+-rw-r--r--  2.0 unx     1746 b- defN 23-Jun-09 17:27 kvirt/web/templates/containerstable.html
+-rw-r--r--  2.0 unx     2123 b- defN 23-Jun-09 17:27 kvirt/web/templates/head.html
+-rw-r--r--  2.0 unx      473 b- defN 23-Jun-09 17:27 kvirt/web/templates/hosts.html
+-rw-r--r--  2.0 unx     1705 b- defN 23-Jun-09 17:27 kvirt/web/templates/hoststable.html
+-rw-r--r--  2.0 unx     1119 b- defN 23-Jun-09 17:27 kvirt/web/templates/imagecreate.html
+-rw-r--r--  2.0 unx      478 b- defN 23-Jun-09 17:27 kvirt/web/templates/images.html
+-rw-r--r--  2.0 unx      646 b- defN 23-Jun-09 17:27 kvirt/web/templates/imagestable.html
+-rw-r--r--  2.0 unx      472 b- defN 23-Jun-09 17:27 kvirt/web/templates/isos.html
+-rw-r--r--  2.0 unx      261 b- defN 23-Jun-09 17:27 kvirt/web/templates/isostable.html
+-rw-r--r--  2.0 unx      609 b- defN 23-Jun-09 17:27 kvirt/web/templates/kubecreate.html
+-rw-r--r--  2.0 unx      622 b- defN 23-Jun-09 17:27 kvirt/web/templates/kubeinfo.html
+-rw-r--r--  2.0 unx      488 b- defN 23-Jun-09 17:27 kvirt/web/templates/kubeprofiles.html
+-rw-r--r--  2.0 unx      845 b- defN 23-Jun-09 17:27 kvirt/web/templates/kubeprofilestable.html
+-rw-r--r--  2.0 unx      475 b- defN 23-Jun-09 17:27 kvirt/web/templates/kubes.html
+-rw-r--r--  2.0 unx     1850 b- defN 23-Jun-09 17:27 kvirt/web/templates/kubestable.html
+-rw-r--r--  2.0 unx      151 b- defN 23-Jun-09 17:27 kvirt/web/templates/layout.html
+-rw-r--r--  2.0 unx     5517 b- defN 23-Jun-09 17:27 kvirt/web/templates/navbar.html
+-rw-r--r--  2.0 unx      882 b- defN 23-Jun-09 17:27 kvirt/web/templates/networkcreate.html
+-rw-r--r--  2.0 unx      537 b- defN 23-Jun-09 17:27 kvirt/web/templates/networks.html
+-rw-r--r--  2.0 unx      845 b- defN 23-Jun-09 17:27 kvirt/web/templates/networkstable.html
+-rw-r--r--  2.0 unx      750 b- defN 23-Jun-09 17:27 kvirt/web/templates/plancreate.html
+-rw-r--r--  2.0 unx      475 b- defN 23-Jun-09 17:27 kvirt/web/templates/plans.html
+-rw-r--r--  2.0 unx     1525 b- defN 23-Jun-09 17:27 kvirt/web/templates/planstable.html
+-rw-r--r--  2.0 unx      859 b- defN 23-Jun-09 17:27 kvirt/web/templates/poolcreate.html
+-rw-r--r--  2.0 unx      475 b- defN 23-Jun-09 17:27 kvirt/web/templates/pools.html
+-rw-r--r--  2.0 unx      554 b- defN 23-Jun-09 17:27 kvirt/web/templates/poolstable.html
+-rw-r--r--  2.0 unx     1282 b- defN 23-Jun-09 17:27 kvirt/web/templates/productcreate.html
+-rw-r--r--  2.0 unx      484 b- defN 23-Jun-09 17:27 kvirt/web/templates/products.html
+-rw-r--r--  2.0 unx      895 b- defN 23-Jun-09 17:27 kvirt/web/templates/productstable.html
+-rw-r--r--  2.0 unx      699 b- defN 23-Jun-09 17:27 kvirt/web/templates/repocreate.html
+-rw-r--r--  2.0 unx      475 b- defN 23-Jun-09 17:27 kvirt/web/templates/repos.html
+-rw-r--r--  2.0 unx     1203 b- defN 23-Jun-09 17:27 kvirt/web/templates/repostable.html
+-rw-r--r--  2.0 unx      958 b- defN 23-Jun-09 17:27 kvirt/web/templates/vmcreate.html
+-rw-r--r--  2.0 unx      486 b- defN 23-Jun-09 17:27 kvirt/web/templates/vmprofiles.html
+-rw-r--r--  2.0 unx     1420 b- defN 23-Jun-09 17:27 kvirt/web/templates/vmprofilestable.html
+-rw-r--r--  2.0 unx      470 b- defN 23-Jun-09 17:27 kvirt/web/templates/vms.html
+-rw-r--r--  2.0 unx     4894 b- defN 23-Jun-09 17:27 kvirt/web/templates/vmstable.html
+-rw-r--r--  2.0 unx    11358 b- defN 23-Jun-09 17:32 kcli-99.0.202306091732.dist-info/LICENSE
+-rw-r--r--  2.0 unx     3024 b- defN 23-Jun-09 17:32 kcli-99.0.202306091732.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jun-09 17:32 kcli-99.0.202306091732.dist-info/WHEEL
+-rw-r--r--  2.0 unx      209 b- defN 23-Jun-09 17:32 kcli-99.0.202306091732.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        6 b- defN 23-Jun-09 17:32 kcli-99.0.202306091732.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx    59055 b- defN 23-Jun-09 17:32 kcli-99.0.202306091732.dist-info/RECORD
+602 files, 4563876 bytes uncompressed, 1383564 bytes compressed:  69.7%
```

## zipnote {}

```diff
@@ -33,14 +33,29 @@
 
 Filename: kvirt/ansibleutils/__init__.py
 Comment: 
 
 Filename: kvirt/cluster/__init__.py
 Comment: 
 
+Filename: kvirt/cluster/sampleprovider.py
+Comment: 
+
+Filename: kvirt/cluster/gke/__init__.py
+Comment: 
+
+Filename: kvirt/cluster/gke/fake.yml
+Comment: 
+
+Filename: kvirt/cluster/gke/kcli_default.yml
+Comment: 
+
+Filename: kvirt/cluster/gke/kubeconfig.j2
+Comment: 
+
 Filename: kvirt/cluster/hypershift/99-apps.yaml
 Comment: 
 
 Filename: kvirt/cluster/hypershift/99-forcedns
 Comment: 
 
 Filename: kvirt/cluster/hypershift/99-notifications.yaml
@@ -1767,26 +1782,26 @@
 
 Filename: kvirt/web/templates/vms.html
 Comment: 
 
 Filename: kvirt/web/templates/vmstable.html
 Comment: 
 
-Filename: kcli-99.0.202306081954.dist-info/LICENSE
+Filename: kcli-99.0.202306091732.dist-info/LICENSE
 Comment: 
 
-Filename: kcli-99.0.202306081954.dist-info/METADATA
+Filename: kcli-99.0.202306091732.dist-info/METADATA
 Comment: 
 
-Filename: kcli-99.0.202306081954.dist-info/WHEEL
+Filename: kcli-99.0.202306091732.dist-info/WHEEL
 Comment: 
 
-Filename: kcli-99.0.202306081954.dist-info/entry_points.txt
+Filename: kcli-99.0.202306091732.dist-info/entry_points.txt
 Comment: 
 
-Filename: kcli-99.0.202306081954.dist-info/top_level.txt
+Filename: kcli-99.0.202306091732.dist-info/top_level.txt
 Comment: 
 
-Filename: kcli-99.0.202306081954.dist-info/RECORD
+Filename: kcli-99.0.202306091732.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## kvirt/baseconfig.py

```diff
@@ -20,18 +20,18 @@
                             LOCAL_OPENSHIFT_APPS, OPENSHIFT_TAG, ROOTPASSWORD, WAIT, WAITCOMMAND, WAITTIMEOUT, TEMPKEY,
                             BMC_USER, BMC_PASSWORD, BMC_MODEL, KSUSHYSERVICE, WEBSERVICE)
 from ipaddress import ip_address, ip_network
 from random import choice
 from kvirt import common
 from kvirt.common import error, pprint, warning, container_mode, ssh, scp, NoAliasDumper
 from kvirt.jinjafilters import jinjafilters
-from kvirt.cluster import microshift
+from kvirt.cluster import hypershift
 from kvirt.cluster import k3s
 from kvirt.cluster import kubeadm
-from kvirt.cluster import hypershift
+from kvirt.cluster import microshift
 from kvirt.cluster import openshift
 import os
 from shutil import copytree, rmtree, which, copy2
 import yaml
 from jinja2 import Environment, FileSystemLoader
 from jinja2 import StrictUndefined as strictundefined
 from jinja2.runtime import Undefined as defaultundefined
@@ -1308,26 +1308,32 @@
         return workflowfile
 
     def info_kube_generic(self, quiet, web=False):
         plandir = os.path.dirname(kubeadm.create.__code__.co_filename)
         inputfile = f'{plandir}/ctlplanes.yml'
         return self.info_plan(inputfile, quiet=quiet, web=web)
 
-    def info_kube_microshift(self, quiet, web=False):
-        plandir = os.path.dirname(microshift.create.__code__.co_filename)
+    def info_kube_gke(self, quiet, web=False):
+        from kvirt.cluster import gke
+        plandir = os.path.dirname(gke.create.__code__.co_filename)
+        inputfile = f'{plandir}/fake.yml'
+        return self.info_plan(inputfile, quiet=quiet, web=web)
+
+    def info_kube_hypershift(self, quiet, web=False):
+        plandir = os.path.dirname(hypershift.create.__code__.co_filename)
         inputfile = f'{plandir}/kcli_plan.yml'
         return self.info_plan(inputfile, quiet=quiet, web=web)
 
     def info_kube_k3s(self, quiet, web=False):
         plandir = os.path.dirname(k3s.create.__code__.co_filename)
         inputfile = f'{plandir}/ctlplanes.yml'
         return self.info_plan(inputfile, quiet=quiet, web=web)
 
-    def info_kube_hypershift(self, quiet, web=False):
-        plandir = os.path.dirname(hypershift.create.__code__.co_filename)
+    def info_kube_microshift(self, quiet, web=False):
+        plandir = os.path.dirname(microshift.create.__code__.co_filename)
         inputfile = f'{plandir}/kcli_plan.yml'
         return self.info_plan(inputfile, quiet=quiet, web=web)
 
     def info_kube_openshift(self, quiet, web=False):
         plandir = os.path.dirname(openshift.create.__code__.co_filename)
         inputfile = f'{plandir}/ctlplanes.yml'
         return self.info_plan(inputfile, quiet=quiet, web=web)
```

## kvirt/cli.py

```diff
@@ -4,18 +4,18 @@
 
 from copy import deepcopy
 from filecmp import cmp
 from getpass import getuser
 from kvirt.config import Kconfig
 from kvirt.examples import plandatacreate, vmdatacreate, hostcreate, _list, plancreate, planinfo, productinfo, start
 from kvirt.examples import repocreate, isocreate, networkupdate
-from kvirt.examples import kubegenericcreate, kubek3screate, kubeopenshiftcreate, kubemicroshiftcreate
+from kvirt.examples import kubegenericcreate, kubek3screate, kubeopenshiftcreate, kubemicroshiftcreate, kubegkecreate
 from kvirt.examples import dnscreate, diskcreate, diskdelete, vmcreate, vmconsole, vmexport, niccreate, nicdelete
 from kvirt.examples import disconnectedcreate, appopenshiftcreate, plantemplatecreate, kubehypershiftcreate
-from kvirt.examples import workflowcreate, kubegenericscale, kubek3sscale, kubeopenshiftscale
+from kvirt.examples import workflowcreate, kubegenericscale, kubek3sscale, kubeopenshiftscale, kubegkescale
 from kvirt.examples import changelog, starthosts, stophosts, infohosts, ocdownload, openshiftdownload
 from kvirt.examples import networkcreate, securitygroupcreate, profilecreate, vmupdate, vmlist
 from kvirt.baseconfig import Kbaseconfig
 from kvirt.containerconfig import Kcontainerconfig
 from kvirt.defaults import IMAGES, VERSION, LOCAL_OPENSHIFT_APPS, SSH_PUB_LOCATIONS, PLANTYPES
 from prettytable import PrettyTable
 import argcomplete
@@ -1894,14 +1894,20 @@
 
 def create_generic_kube(args):
     """Create Generic kube"""
     args.type = 'generic'
     create_kube(args)
 
 
+def create_gke_kube(args):
+    """Create Gke kube"""
+    args.type = 'gke'
+    create_kube(args)
+
+
 def create_microshift_kube(args):
     """Create Microshift kube"""
     args.type = 'microshift'
     create_kube(args)
 
 
 def create_k3s_kube(args):
@@ -1956,27 +1962,33 @@
 
 def scale_generic_kube(args):
     """Scale generic kube"""
     args.type = 'generic'
     scale_kube(args)
 
 
-def scale_k3s_kube(args):
-    """Scale k3s kube"""
-    args.type = 'k3s'
+def scale_gke_kube(args):
+    """Scale gke kube"""
+    args.type = 'gke'
     scale_kube(args)
 
 
 def scale_hypershift_kube(args):
     """Scale hypershift kube"""
     args.type = 'hypershift'
     args.ctlplanes = 0
     scale_kube(args)
 
 
+def scale_k3s_kube(args):
+    """Scale k3s kube"""
+    args.type = 'k3s'
+    scale_kube(args)
+
+
 def scale_openshift_kube(args):
     """Scale openshift kube"""
     args.type = 'openshift'
     scale_kube(args)
 
 
 def update_generic_kube(args):
@@ -2316,15 +2328,20 @@
         info_web_kube(args)
         return
     kubetype = args.kubetype
     output = args.global_output or args.output
     openshift = kubetype == 'openshift'
     baseconfig = Kbaseconfig(client=args.client, debug=args.debug, offline=True)
     if args.cluster is not None:
-        status = baseconfig.info_specific_kube(args.cluster, openshift)
+        if kubetype == 'gke':
+            config = Kconfig(client=args.client, debug=args.debug, region=args.region, zone=args.zone,
+                             namespace=args.namespace)
+            status = config.info_kube_gke(args.cluster)
+        else:
+            status = baseconfig.info_specific_kube(args.cluster, openshift)
         if status is None or not status:
             return
         elif output is not None:
             _list_output(status, output)
         else:
             pprint(f"Providing information about cluster {args.cluster}")
             kubetable = PrettyTable(["Name", "Status", "Role", "Age", "Version", "Ip"])
@@ -2338,14 +2355,16 @@
             baseconfig.info_kube_openshift(quiet=True)
         elif kubetype == 'hypershift':
             baseconfig.info_kube_hypershift(quiet=True)
         elif kubetype == 'microshift':
             baseconfig.info_kube_microshift(quiet=True)
         elif kubetype == 'k3s':
             baseconfig.info_kube_k3s(quiet=True)
+        elif kubetype == 'gke':
+            baseconfig.info_kube_gke(quiet=True)
         else:
             baseconfig.info_kube_generic(quiet=True)
 
 
 def info_web_kube(args):
     output = args.global_output or args.output
     config = Kconfig(client=args.client, debug=args.debug, region=args.region, zone=args.zone, namespace=args.namespace)
@@ -2365,26 +2384,31 @@
 
 
 def info_generic_kube(args):
     args.kubetype = 'generic'
     info_kube(args)
 
 
-def info_microshift_kube(args):
-    args.kubetype = 'microshift'
+def info_gke_kube(args):
+    args.kubetype = 'gke'
+    info_kube(args)
+
+
+def info_hypershift_kube(args):
+    args.kubetype = 'hypershift'
     info_kube(args)
 
 
 def info_k3s_kube(args):
     args.kubetype = 'k3s'
     info_kube(args)
 
 
-def info_hypershift_kube(args):
-    args.kubetype = 'hypershift'
+def info_microshift_kube(args):
+    args.kubetype = 'microshift'
     info_kube(args)
 
 
 def info_openshift_kube(args):
     args.kubetype = 'openshift'
     info_kube(args)
 
@@ -3699,48 +3723,58 @@
     kubegenericcreate_parser.set_defaults(func=create_generic_kube)
     kubecreate_subparsers.add_parser('generic', parents=[kubegenericcreate_parser],
                                      description=kubegenericcreate_desc,
                                      help=kubegenericcreate_desc,
                                      epilog=kubegenericcreate_epilog,
                                      formatter_class=rawhelp, aliases=['kubeadm'])
 
-    kubemicroshiftcreate_desc = 'Create Microshift Kube'
-    kubemicroshiftcreate_epilog = f"examples:\n{kubemicroshiftcreate}"
-    kubemicroshiftcreate_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
-    kubemicroshiftcreate_parser.add_argument('-f', '--force', action='store_true', help='Delete existing cluster first')
-    kubemicroshiftcreate_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
-    kubemicroshiftcreate_parser.set_defaults(func=create_microshift_kube)
-    kubecreate_subparsers.add_parser('microshift', parents=[kubemicroshiftcreate_parser],
-                                     description=kubemicroshiftcreate_desc,
-                                     help=kubemicroshiftcreate_desc,
-                                     epilog=kubemicroshiftcreate_epilog,
+    kubegkecreate_desc = 'Create Gke Kube'
+    kubegkecreate_epilog = f"examples:\n{kubegkecreate}"
+    kubegkecreate_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
+    kubegkecreate_parser.add_argument('-f', '--force', action='store_true', help='Delete existing cluster first')
+    kubegkecreate_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
+    kubegkecreate_parser.set_defaults(func=create_gke_kube)
+    kubecreate_subparsers.add_parser('gke', parents=[kubegkecreate_parser], description=kubegkecreate_desc,
+                                     help=kubegkecreate_desc, epilog=kubegkecreate_epilog,
+                                     formatter_class=rawhelp)
+
+    kubehypershiftcreate_desc = 'Create Hypershift Kube'
+    kubehypershiftcreate_epilog = f"examples:\n{kubehypershiftcreate}"
+    kubehypershiftcreate_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
+    kubehypershiftcreate_parser.add_argument('-f', '--force', action='store_true', help='Delete existing cluster first')
+    kubehypershiftcreate_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
+    kubehypershiftcreate_parser.set_defaults(func=create_hypershift_kube)
+    kubecreate_subparsers.add_parser('hypershift', parents=[kubehypershiftcreate_parser],
+                                     description=kubehypershiftcreate_desc,
+                                     help=kubehypershiftcreate_desc,
+                                     epilog=kubehypershiftcreate_epilog,
                                      formatter_class=rawhelp)
 
     kubek3screate_desc = 'Create K3s Kube'
     kubek3screate_epilog = f"examples:\n{kubek3screate}"
     kubek3screate_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
     kubek3screate_parser.add_argument('-f', '--force', action='store_true', help='Delete existing cluster first')
     kubek3screate_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
     kubek3screate_parser.set_defaults(func=create_k3s_kube)
     kubecreate_subparsers.add_parser('k3s', parents=[kubek3screate_parser],
                                      description=kubek3screate_desc,
                                      help=kubek3screate_desc,
                                      epilog=kubek3screate_epilog,
                                      formatter_class=rawhelp)
 
-    kubehypershiftcreate_desc = 'Create Hypershift Kube'
-    kubehypershiftcreate_epilog = f"examples:\n{kubehypershiftcreate}"
-    kubehypershiftcreate_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
-    kubehypershiftcreate_parser.add_argument('-f', '--force', action='store_true', help='Delete existing cluster first')
-    kubehypershiftcreate_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
-    kubehypershiftcreate_parser.set_defaults(func=create_hypershift_kube)
-    kubecreate_subparsers.add_parser('hypershift', parents=[kubehypershiftcreate_parser],
-                                     description=kubehypershiftcreate_desc,
-                                     help=kubehypershiftcreate_desc,
-                                     epilog=kubehypershiftcreate_epilog,
+    kubemicroshiftcreate_desc = 'Create Microshift Kube'
+    kubemicroshiftcreate_epilog = f"examples:\n{kubemicroshiftcreate}"
+    kubemicroshiftcreate_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
+    kubemicroshiftcreate_parser.add_argument('-f', '--force', action='store_true', help='Delete existing cluster first')
+    kubemicroshiftcreate_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
+    kubemicroshiftcreate_parser.set_defaults(func=create_microshift_kube)
+    kubecreate_subparsers.add_parser('microshift', parents=[kubemicroshiftcreate_parser],
+                                     description=kubemicroshiftcreate_desc,
+                                     help=kubemicroshiftcreate_desc,
+                                     epilog=kubemicroshiftcreate_epilog,
                                      formatter_class=rawhelp)
 
     kubeopenshiftcreate_desc = 'Create Openshift Kube'
     kubeopenshiftcreate_epilog = f"examples:\n{kubeopenshiftcreate}"
     kubeopenshiftcreate_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
     kubeopenshiftcreate_parser.add_argument('-f', '--force', action='store_true', help='Delete existing cluster first')
     kubeopenshiftcreate_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
@@ -4488,33 +4522,40 @@
     kubegenericinfo_desc = 'Info Generic Kube'
     kubegenericinfo_parser = kubeinfo_subparsers.add_parser('generic', description=kubegenericinfo_desc,
                                                             help=kubegenericinfo_desc, aliases=['kubeadm'],
                                                             parents=[output_parser])
     kubegenericinfo_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
     kubegenericinfo_parser.set_defaults(func=info_generic_kube)
 
-    kubemicroshiftinfo_desc = 'Info Microshift Kube'
-    kubemicroshiftinfo_parser = kubeinfo_subparsers.add_parser('microshift', description=kubemicroshiftinfo_desc,
-                                                               help=kubemicroshiftinfo_desc,
+    kubegkeinfo_desc = 'Info Gke Kube'
+    kubegkeinfo_parser = kubeinfo_subparsers.add_parser('gke', description=kubegkeinfo_desc,
+                                                        help=kubegkeinfo_desc,
+                                                        parents=[output_parser])
+    kubegkeinfo_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
+    kubegkeinfo_parser.set_defaults(func=info_gke_kube)
+
+    kubehypershiftinfo_desc = 'Info Hypershift Kube'
+    kubehypershiftinfo_parser = kubeinfo_subparsers.add_parser('hypershift', description=kubehypershiftinfo_desc,
+                                                               help=kubehypershiftinfo_desc,
                                                                parents=[output_parser])
-    kubemicroshiftinfo_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
-    kubemicroshiftinfo_parser.set_defaults(func=info_microshift_kube)
+    kubehypershiftinfo_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
+    kubehypershiftinfo_parser.set_defaults(func=info_hypershift_kube)
 
     kubek3sinfo_desc = 'Info K3s Kube'
     kubek3sinfo_parser = kubeinfo_subparsers.add_parser('k3s', description=kubek3sinfo_desc, help=kubek3sinfo_desc,
                                                         parents=[output_parser])
     kubek3sinfo_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
     kubek3sinfo_parser.set_defaults(func=info_k3s_kube)
 
-    kubehypershiftinfo_desc = 'Info Hypershift Kube'
-    kubehypershiftinfo_parser = kubeinfo_subparsers.add_parser('hypershift', description=kubehypershiftinfo_desc,
-                                                               help=kubehypershiftinfo_desc,
+    kubemicroshiftinfo_desc = 'Info Microshift Kube'
+    kubemicroshiftinfo_parser = kubeinfo_subparsers.add_parser('microshift', description=kubemicroshiftinfo_desc,
+                                                               help=kubemicroshiftinfo_desc,
                                                                parents=[output_parser])
-    kubehypershiftinfo_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
-    kubehypershiftinfo_parser.set_defaults(func=info_hypershift_kube)
+    kubemicroshiftinfo_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
+    kubemicroshiftinfo_parser.set_defaults(func=info_microshift_kube)
 
     kubeopenshiftinfo_desc = 'Info Openshift Kube'
     kubeopenshiftinfo_parser = kubeinfo_subparsers.add_parser('openshift', description=kubeopenshiftinfo_desc,
                                                               help=kubeopenshiftinfo_desc,
                                                               parents=[output_parser])
     kubeopenshiftinfo_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
     kubeopenshiftinfo_parser.set_defaults(func=info_openshift_kube)
@@ -4835,33 +4876,42 @@
     kubegenericscale_parser.add_argument('-w', '--workers', help='Total number of workers', type=int)
     kubegenericscale_parser.add_argument('cluster', metavar='CLUSTER', type=valid_cluster, default='mykube')
     kubegenericscale_parser.set_defaults(func=scale_generic_kube)
     kubescale_subparsers.add_parser('generic', parents=[kubegenericscale_parser], description=kubegenericscale_desc,
                                     help=kubegenericscale_desc, aliases=['kubeadm'], epilog=kubegenericscale_epilog,
                                     formatter_class=rawhelp)
 
-    kubek3sscale_desc = 'Scale K3s Kube'
-    kubek3sscale_epilog = f"examples:\n{kubek3sscale}"
-    kubek3sscale_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
-    kubek3sscale_parser.add_argument('-c', '--ctlplanes', help='Total number of ctlplanes', type=int)
-    kubek3sscale_parser.add_argument('-w', '--workers', help='Total number of workers', type=int)
-    kubek3sscale_parser.add_argument('cluster', metavar='CLUSTER', type=valid_cluster, default='myk3s')
-    kubek3sscale_parser.set_defaults(func=scale_k3s_kube)
-    kubescale_subparsers.add_parser('k3s', parents=[kubek3sscale_parser], description=kubek3sscale_desc,
-                                    help=kubek3sscale_desc, epilog=kubek3sscale_epilog, formatter_class=rawhelp)
+    kubegkescale_desc = 'Scale Gke Kube'
+    kubegkescale_epilog = f"examples:\n{kubegkescale}"
+    kubegkescale_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
+    kubegkescale_parser.add_argument('-w', '--workers', help='Total number of workers', type=int)
+    kubegkescale_parser.add_argument('cluster', metavar='CLUSTER', type=valid_cluster, default='mykube')
+    kubegkescale_parser.set_defaults(func=scale_gke_kube)
+    kubescale_subparsers.add_parser('gke', parents=[kubegkescale_parser], description=kubegkescale_desc,
+                                    help=kubegkescale_desc, epilog=kubegkescale_epilog, formatter_class=rawhelp)
 
     kubehypershiftscale_desc = 'Scale Hypershift Kube'
     kubehypershiftscale_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
     kubehypershiftscale_parser.add_argument('-w', '--workers', help='Total number of workers', type=int)
     kubehypershiftscale_parser.add_argument('cluster', metavar='CLUSTER', type=valid_cluster, default='myhypershift')
     kubehypershiftscale_parser.set_defaults(func=scale_hypershift_kube)
     kubescale_subparsers.add_parser('hypershift', parents=[kubehypershiftscale_parser],
                                     description=kubehypershiftscale_desc,
                                     help=kubehypershiftscale_desc)
 
+    kubek3sscale_desc = 'Scale K3s Kube'
+    kubek3sscale_epilog = f"examples:\n{kubek3sscale}"
+    kubek3sscale_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
+    kubek3sscale_parser.add_argument('-c', '--ctlplanes', help='Total number of ctlplanes', type=int)
+    kubek3sscale_parser.add_argument('-w', '--workers', help='Total number of workers', type=int)
+    kubek3sscale_parser.add_argument('cluster', metavar='CLUSTER', type=valid_cluster, default='myk3s')
+    kubek3sscale_parser.set_defaults(func=scale_k3s_kube)
+    kubescale_subparsers.add_parser('k3s', parents=[kubek3sscale_parser], description=kubek3sscale_desc,
+                                    help=kubek3sscale_desc, epilog=kubek3sscale_epilog, formatter_class=rawhelp)
+
     kubeopenshiftscale_desc = 'Scale Openshift Kube'
     kubeopenshiftscale_epilog = f"examples:\n{kubeopenshiftscale}"
     kubeopenshiftscale_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
     kubeopenshiftscale_parser.add_argument('-c', '--ctlplanes', help='Total number of ctlplanes', type=int)
     kubeopenshiftscale_parser.add_argument('-w', '--workers', help='Total number of workers', type=int)
     kubeopenshiftscale_parser.add_argument('cluster', metavar='CLUSTER', type=valid_cluster, default='myopenshift')
     kubeopenshiftscale_parser.set_defaults(func=scale_openshift_kube)
```

## kvirt/config.py

```diff
@@ -4532,7105 +4532,7252 @@
 00011b30: 2020 2020 2020 2020 706c 616e 203d 2069          plan = i
 00011b40: 6e73 7461 6c6c 7061 7261 6d2e 6765 7428  nstallparam.get(
 00011b50: 2770 6c61 6e27 2c20 706c 616e 290a 2020  'plan', plan).  
 00011b60: 2020 2020 2020 2020 2020 6b75 6265 735b            kubes[
 00011b70: 6b75 6265 5d20 3d20 7b27 7479 7065 273a  kube] = {'type':
 00011b80: 205f 7479 7065 2c20 2770 6c61 6e27 3a20   _type, 'plan': 
 00011b90: 706c 616e 2c20 2776 6d73 273a 205b 5d7d  plan, 'vms': []}
-00011ba0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00011bb0: 6b75 6265 730a 0a20 2020 2064 6566 2063  kubes..    def c
-00011bc0: 7265 6174 655f 7072 6f64 7563 7428 7365  reate_product(se
-00011bd0: 6c66 2c20 6e61 6d65 2c20 7265 706f 3d4e  lf, name, repo=N
-00011be0: 6f6e 652c 2067 726f 7570 3d4e 6f6e 652c  one, group=None,
-00011bf0: 2070 6c61 6e3d 4e6f 6e65 2c20 6c61 7465   plan=None, late
-00011c00: 7374 3d46 616c 7365 2c20 6f76 6572 7269  st=False, overri
-00011c10: 6465 733d 7b7d 293a 0a20 2020 2020 2020  des={}):.       
-00011c20: 2022 2222 4372 6561 7465 2070 726f 6475   """Create produ
-00011c30: 6374 2222 220a 2020 2020 2020 2020 6966  ct""".        if
-00011c40: 2072 6570 6f20 6973 206e 6f74 204e 6f6e   repo is not Non
-00011c50: 6520 616e 6420 6772 6f75 7020 6973 206e  e and group is n
-00011c60: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00011c70: 2020 2020 2070 726f 6475 6374 7320 3d20       products = 
-00011c80: 5b70 726f 6475 6374 2066 6f72 2070 726f  [product for pro
-00011c90: 6475 6374 2069 6e20 7365 6c66 2e6c 6973  duct in self.lis
-00011ca0: 745f 7072 6f64 7563 7473 2829 0a20 2020  t_products().   
-00011cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011cc0: 2020 2020 2069 6620 7072 6f64 7563 745b       if product[
-00011cd0: 276e 616d 6527 5d20 3d3d 206e 616d 6520  'name'] == name 
-00011ce0: 616e 6420 7072 6f64 7563 745b 2772 6570  and product['rep
-00011cf0: 6f27 5d20 3d3d 2072 6570 6f20 616e 6420  o'] == repo and 
-00011d00: 7072 6f64 7563 745b 2767 726f 7570 275d  product['group']
-00011d10: 203d 3d20 6772 6f75 705d 0a20 2020 2020   == group].     
-00011d20: 2020 2065 6c69 6620 7265 706f 2069 7320     elif repo is 
-00011d30: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00011d40: 2020 2020 2020 7072 6f64 7563 7473 203d        products =
-00011d50: 205b 7072 6f64 7563 7420 666f 7220 7072   [product for pr
-00011d60: 6f64 7563 7420 696e 2073 656c 662e 6c69  oduct in self.li
-00011d70: 7374 5f70 726f 6475 6374 7328 290a 2020  st_products().  
-00011d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d90: 2020 2020 2020 6966 2070 726f 6475 6374        if product
-00011da0: 5b27 6e61 6d65 275d 203d 3d20 6e61 6d65  ['name'] == name
-00011db0: 2061 6e64 2070 726f 6475 6374 5b27 7265   and product['re
-00011dc0: 706f 275d 203d 3d20 7265 706f 5d0a 2020  po'] == repo].  
-00011dd0: 2020 2020 2020 6966 2067 726f 7570 2069        if group i
-00011de0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00011df0: 2020 2020 2020 2020 7072 6f64 7563 7473          products
-00011e00: 203d 205b 7072 6f64 7563 7420 666f 7220   = [product for 
-00011e10: 7072 6f64 7563 7420 696e 2073 656c 662e  product in self.
-00011e20: 6c69 7374 5f70 726f 6475 6374 7328 290a  list_products().
-00011e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e40: 2020 2020 2020 2020 6966 2070 726f 6475          if produ
-00011e50: 6374 5b27 6e61 6d65 275d 203d 3d20 6e61  ct['name'] == na
-00011e60: 6d65 2061 6e64 2070 726f 6475 6374 5b27  me and product['
-00011e70: 6772 6f75 7027 5d20 3d3d 2067 726f 7570  group'] == group
-00011e80: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
-00011e90: 2020 2020 2020 2020 2020 2020 7072 6f64              prod
-00011ea0: 7563 7473 203d 205b 7072 6f64 7563 7420  ucts = [product 
-00011eb0: 666f 7220 7072 6f64 7563 7420 696e 2073  for product in s
-00011ec0: 656c 662e 6c69 7374 5f70 726f 6475 6374  elf.list_product
-00011ed0: 7328 2920 6966 2070 726f 6475 6374 5b27  s() if product['
-00011ee0: 6e61 6d65 275d 203d 3d20 6e61 6d65 5d0a  name'] == name].
-00011ef0: 2020 2020 2020 2020 6966 206c 656e 2870          if len(p
-00011f00: 726f 6475 6374 7329 203d 3d20 303a 0a20  roducts) == 0:. 
-00011f10: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00011f20: 2822 5072 6f64 7563 7420 6e6f 7420 666f  ("Product not fo
-00011f30: 756e 642e 204c 6561 7669 6e67 2e2e 2e22  und. Leaving..."
-00011f40: 290a 2020 2020 2020 2020 2020 2020 7379  ).            sy
-00011f50: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
-00011f60: 2020 656c 6966 206c 656e 2870 726f 6475    elif len(produ
-00011f70: 6374 7329 203e 2031 3a0a 2020 2020 2020  cts) > 1:.      
-00011f80: 2020 2020 2020 6572 726f 7228 2250 726f        error("Pro
-00011f90: 6475 6374 2066 6f75 6e64 2069 6e20 7365  duct found in se
-00011fa0: 7665 7261 6c20 7265 706f 7320 6f72 2067  veral repos or g
-00011fb0: 726f 7570 732e 2053 7065 6369 6679 206f  roups. Specify o
-00011fc0: 6e65 2e2e 2e22 290a 2020 2020 2020 2020  ne...").        
-00011fd0: 2020 2020 666f 7220 7072 6f64 7563 7420      for product 
-00011fe0: 696e 2070 726f 6475 6374 733a 0a20 2020  in products:.   
-00011ff0: 2020 2020 2020 2020 2020 2020 2067 726f               gro
-00012000: 7570 203d 2070 726f 6475 6374 5b27 6772  up = product['gr
-00012010: 6f75 7027 5d0a 2020 2020 2020 2020 2020  oup'].          
-00012020: 2020 2020 2020 7265 706f 203d 2070 726f        repo = pro
-00012030: 6475 6374 5b27 7265 706f 275d 0a20 2020  duct['repo'].   
-00012040: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00012050: 6e74 2866 2272 6570 6f3a 7b72 6570 6f7d  nt(f"repo:{repo}
-00012060: 5c74 6772 6f75 703a 7b67 726f 7570 7d22  \tgroup:{group}"
-00012070: 290a 2020 2020 2020 2020 2020 2020 7379  ).            sy
-00012080: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
-00012090: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000120a0: 2020 2020 7072 6f64 7563 7420 3d20 7072      product = pr
-000120b0: 6f64 7563 7473 5b30 5d0a 2020 2020 2020  oducts[0].      
-000120c0: 2020 2020 2020 706c 616e 203d 206e 616d        plan = nam
-000120d0: 6575 7469 6c73 2e67 6574 5f72 616e 646f  eutils.get_rando
-000120e0: 6d5f 6e61 6d65 2829 2069 6620 706c 616e  m_name() if plan
-000120f0: 2069 7320 4e6f 6e65 2065 6c73 6520 706c   is None else pl
-00012100: 616e 0a20 2020 2020 2020 2020 2020 2072  an.            r
-00012110: 6570 6f20 3d20 7072 6f64 7563 745b 2772  epo = product['r
-00012120: 6570 6f27 5d0a 2020 2020 2020 2020 2020  epo'].          
-00012130: 2020 6966 2027 7265 616c 6469 7227 2069    if 'realdir' i
-00012140: 6e20 7072 6f64 7563 743a 0a20 2020 2020  n product:.     
-00012150: 2020 2020 2020 2020 2020 2072 6570 6f64             repod
-00012160: 6972 203d 2022 2573 2f2e 6b63 6c69 2f70  ir = "%s/.kcli/p
-00012170: 6c61 6e73 2f25 732f 2573 2220 2520 286f  lans/%s/%s" % (o
-00012180: 732e 656e 7669 726f 6e2e 6765 7428 2748  s.environ.get('H
-00012190: 4f4d 4527 292c 2072 6570 6f2c 2070 726f  OME'), repo, pro
-000121a0: 6475 6374 5b27 7265 616c 6469 7227 5d29  duct['realdir'])
-000121b0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000121c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000121d0: 2020 2072 6570 6f64 6972 203d 2022 2573     repodir = "%s
-000121e0: 2f2e 6b63 6c69 2f70 6c61 6e73 2f25 7322  /.kcli/plans/%s"
-000121f0: 2025 2028 6f73 2e65 6e76 6972 6f6e 2e67   % (os.environ.g
-00012200: 6574 2827 484f 4d45 2729 2c20 7265 706f  et('HOME'), repo
-00012210: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00012220: 2027 2f27 2069 6e20 7072 6f64 7563 745b   '/' in product[
-00012230: 2766 696c 6527 5d3a 0a20 2020 2020 2020  'file']:.       
-00012240: 2020 2020 2020 2020 2069 6e70 7574 6669           inputfi
-00012250: 6c65 203d 206f 732e 7061 7468 2e62 6173  le = os.path.bas
-00012260: 656e 616d 6528 7072 6f64 7563 745b 2766  ename(product['f
-00012270: 696c 6527 5d29 0a20 2020 2020 2020 2020  ile']).         
-00012280: 2020 2020 2020 2072 6570 6f64 6972 202b         repodir +
-00012290: 3d20 222f 2573 2220 2520 6f73 2e70 6174  = "/%s" % os.pat
-000122a0: 682e 6469 726e 616d 6528 7072 6f64 7563  h.dirname(produc
-000122b0: 745b 2766 696c 6527 5d29 0a20 2020 2020  t['file']).     
-000122c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000122d0: 2020 2020 2020 2020 2020 2020 2069 6e70               inp
-000122e0: 7574 6669 6c65 203d 2070 726f 6475 6374  utfile = product
-000122f0: 5b27 6669 6c65 275d 0a20 2020 2020 2020  ['file'].       
-00012300: 2020 2020 2069 6d61 6765 203d 2070 726f       image = pro
-00012310: 6475 6374 2e67 6574 2827 696d 6167 6527  duct.get('image'
-00012320: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
-00012330: 7261 6d65 7465 7273 203d 2070 726f 6475  rameters = produ
-00012340: 6374 2e67 6574 2827 7061 7261 6d65 7465  ct.get('paramete
-00012350: 7273 2729 0a20 2020 2020 2020 2020 2020  rs').           
-00012360: 2069 6620 696d 6167 6520 6973 206e 6f74   if image is not
-00012370: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00012380: 2020 2020 2020 2070 7269 6e74 2866 224e         print(f"N
-00012390: 6f74 6520 7468 6174 2074 6869 7320 7072  ote that this pr
-000123a0: 6f64 7563 7420 7573 6573 2069 6d61 6765  oduct uses image
-000123b0: 3a20 7b69 6d61 6765 7d22 290a 2020 2020  : {image}").    
-000123c0: 2020 2020 2020 2020 6966 2070 6172 616d          if param
-000123d0: 6574 6572 7320 6973 206e 6f74 204e 6f6e  eters is not Non
-000123e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000123f0: 2020 2066 6f72 2070 6172 616d 6574 6572     for parameter
-00012400: 2069 6e20 7061 7261 6d65 7465 7273 3a0a   in parameters:.
-00012410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012420: 2020 2020 6170 706c 6965 645f 7061 7261      applied_para
-00012430: 6d65 7465 7220 3d20 6f76 6572 7269 6465  meter = override
-00012440: 735b 7061 7261 6d65 7465 725d 2069 6620  s[parameter] if 
-00012450: 7061 7261 6d65 7465 7220 696e 206f 7665  parameter in ove
-00012460: 7272 6964 6573 2065 6c73 6520 7061 7261  rrides else para
-00012470: 6d65 7465 7273 5b70 6172 616d 6574 6572  meters[parameter
-00012480: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00012490: 2020 2020 2020 7072 696e 7428 6622 5573        print(f"Us
-000124a0: 696e 6720 7061 7261 6d65 7465 7220 7b70  ing parameter {p
-000124b0: 6172 616d 6574 6572 7d3a 207b 6170 706c  arameter}: {appl
-000124c0: 6965 645f 7061 7261 6d65 7465 727d 2229  ied_parameter}")
-000124d0: 0a20 2020 2020 2020 2020 2020 2065 7874  .            ext
-000124e0: 7261 7061 7261 6d65 7465 7273 203d 206c  raparameters = l
-000124f0: 6973 7428 7365 7428 6f76 6572 7269 6465  ist(set(override
-00012500: 7329 202d 2073 6574 2870 6172 616d 6574  s) - set(paramet
-00012510: 6572 7329 2920 6966 2070 6172 616d 6574  ers)) if paramet
-00012520: 6572 7320 6973 206e 6f74 204e 6f6e 6520  ers is not None 
-00012530: 656c 7365 206f 7665 7272 6964 6573 0a20  else overrides. 
-00012540: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
-00012550: 6172 616d 6574 6572 2069 6e20 6578 7472  arameter in extr
-00012560: 6170 6172 616d 6574 6572 733a 0a20 2020  aparameters:.   
-00012570: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00012580: 6e74 2822 5573 696e 6720 7061 7261 6d65  nt("Using parame
-00012590: 7465 7220 2573 3a20 2573 2220 2520 2870  ter %s: %s" % (p
-000125a0: 6172 616d 6574 6572 2c20 6f76 6572 7269  arameter, overri
-000125b0: 6465 735b 7061 7261 6d65 7465 725d 2929  des[parameter]))
-000125c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000125d0: 6e6f 7420 6c61 7465 7374 3a0a 2020 2020  not latest:.    
-000125e0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-000125f0: 6e74 2866 2255 7369 6e67 2064 6972 6563  nt(f"Using direc
-00012600: 746f 7279 207b 7265 706f 6469 727d 2229  tory {repodir}")
-00012610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012620: 2073 656c 662e 706c 616e 2870 6c61 6e2c   self.plan(plan,
-00012630: 2070 6174 683d 7265 706f 6469 722c 2069   path=repodir, i
-00012640: 6e70 7574 6669 6c65 3d69 6e70 7574 6669  nputfile=inputfi
-00012650: 6c65 2c20 6f76 6572 7269 6465 733d 6f76  le, overrides=ov
-00012660: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
-00012670: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00012680: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00012690: 7570 6461 7465 5f72 6570 6f28 7265 706f  update_repo(repo
-000126a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000126b0: 2020 7365 6c66 2e70 6c61 6e28 706c 616e    self.plan(plan
-000126c0: 2c20 7061 7468 3d72 6570 6f64 6972 2c20  , path=repodir, 
-000126d0: 696e 7075 7466 696c 653d 696e 7075 7466  inputfile=inputf
-000126e0: 696c 652c 206f 7665 7272 6964 6573 3d6f  ile, overrides=o
-000126f0: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
-00012700: 2020 2020 2020 7070 7269 6e74 2866 2250        pprint(f"P
-00012710: 726f 6475 6374 2063 616e 2062 6520 6465  roduct can be de
-00012720: 6c65 7465 6420 7769 7468 3a20 6b63 6c69  leted with: kcli
-00012730: 2064 656c 6574 6520 706c 616e 202d 2d79   delete plan --y
-00012740: 6573 207b 706c 616e 7d22 290a 2020 2020  es {plan}").    
-00012750: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
-00012760: 756c 7427 3a20 2773 7563 6365 7373 272c  ult': 'success',
-00012770: 2027 706c 616e 273a 2070 6c61 6e7d 0a0a   'plan': plan}..
-00012780: 2020 2020 6465 6620 7374 6172 745f 706c      def start_pl
-00012790: 616e 2873 656c 662c 2070 6c61 6e2c 2063  an(self, plan, c
-000127a0: 6f6e 7461 696e 6572 3d46 616c 7365 293a  ontainer=False):
-000127b0: 0a20 2020 2020 2020 206b 203d 2073 656c  .        k = sel
-000127c0: 662e 6b0a 2020 2020 2020 2020 7374 6172  f.k.        star
-000127d0: 7466 6f75 6e64 203d 2046 616c 7365 0a20  tfound = False. 
-000127e0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-000127f0: 5374 6172 7469 6e67 2076 6d73 2066 726f  Starting vms fro
-00012800: 6d20 706c 616e 207b 706c 616e 7d22 290a  m plan {plan}").
-00012810: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00012820: 656c 662e 6578 7472 6163 6c69 656e 7473  elf.extraclients
-00012830: 3a0a 2020 2020 2020 2020 2020 2020 7374  :.            st
-00012840: 6172 7463 6c69 656e 7473 203d 207b 7365  artclients = {se
-00012850: 6c66 2e63 6c69 656e 743a 206b 7d0a 2020  lf.client: k}.  
-00012860: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00012870: 2020 2020 2020 2020 7374 6172 7463 6c69          startcli
-00012880: 656e 7473 203d 2073 656c 662e 6578 7472  ents = self.extr
-00012890: 6163 6c69 656e 7473 0a20 2020 2020 2020  aclients.       
-000128a0: 2020 2020 2073 7461 7274 636c 6965 6e74       startclient
-000128b0: 732e 7570 6461 7465 287b 7365 6c66 2e63  s.update({self.c
-000128c0: 6c69 656e 743a 206b 7d29 0a20 2020 2020  lient: k}).     
-000128d0: 2020 2066 6f72 2068 7970 6572 7669 736f     for hyperviso
-000128e0: 7220 696e 2073 7461 7274 636c 6965 6e74  r in startclient
-000128f0: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
-00012900: 203d 2073 7461 7274 636c 6965 6e74 735b   = startclients[
-00012910: 6879 7065 7276 6973 6f72 5d0a 2020 2020  hypervisor].    
-00012920: 2020 2020 2020 2020 666f 7220 766d 2069          for vm i
-00012930: 6e20 736f 7274 6564 2863 2e6c 6973 7428  n sorted(c.list(
-00012940: 292c 206b 6579 3d6c 616d 6264 6120 783a  ), key=lambda x:
-00012950: 2078 5b27 6e61 6d65 275d 293a 0a20 2020   x['name']):.   
-00012960: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-00012970: 6520 3d20 766d 5b27 6e61 6d65 275d 0a20  e = vm['name']. 
-00012980: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00012990: 6573 6372 6970 7469 6f6e 203d 2076 6d2e  escription = vm.
-000129a0: 6765 7428 2770 6c61 6e27 290a 2020 2020  get('plan').    
-000129b0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-000129c0: 6573 6372 6970 7469 6f6e 203d 3d20 706c  escription == pl
-000129d0: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
-000129e0: 2020 2020 2020 2020 7374 6172 7466 6f75          startfou
-000129f0: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
-00012a00: 2020 2020 2020 2020 2020 2020 2020 632e                c.
-00012a10: 7374 6172 7428 6e61 6d65 290a 2020 2020  start(name).    
-00012a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a30: 7375 6363 6573 7328 6622 7b6e 616d 657d  success(f"{name}
-00012a40: 2073 7461 7274 6564 206f 6e20 7b68 7970   started on {hyp
-00012a50: 6572 7669 736f 727d 2122 290a 2020 2020  ervisor}!").    
-00012a60: 2020 2020 6966 2063 6f6e 7461 696e 6572      if container
-00012a70: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-00012a80: 6e74 203d 204b 636f 6e74 6169 6e65 7263  nt = Kcontainerc
-00012a90: 6f6e 6669 6728 7365 6c66 2c20 636c 6965  onfig(self, clie
-00012aa0: 6e74 3d73 656c 662e 636f 6e74 6169 6e65  nt=self.containe
-00012ab0: 7263 6c69 656e 7429 2e63 6f6e 740a 2020  rclient).cont.  
-00012ac0: 2020 2020 2020 2020 2020 666f 7220 636f            for co
-00012ad0: 6e74 6120 696e 2073 6f72 7465 6428 636f  nta in sorted(co
-00012ae0: 6e74 2e6c 6973 745f 636f 6e74 6169 6e65  nt.list_containe
-00012af0: 7273 286b 2929 3a0a 2020 2020 2020 2020  rs(k)):.        
-00012b00: 2020 2020 2020 2020 6e61 6d65 203d 2063          name = c
-00012b10: 6f6e 7461 5b30 5d0a 2020 2020 2020 2020  onta[0].        
-00012b20: 2020 2020 2020 2020 636f 6e74 6169 6e65          containe
-00012b30: 7270 6c61 6e20 3d20 636f 6e74 615b 335d  rplan = conta[3]
-00012b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012b50: 2069 6620 636f 6e74 6169 6e65 7270 6c61   if containerpla
-00012b60: 6e20 3d3d 2070 6c61 6e3a 0a20 2020 2020  n == plan:.     
-00012b70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00012b80: 7461 7274 666f 756e 6420 3d20 5472 7565  tartfound = True
-00012b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012ba0: 2020 2020 2063 6f6e 742e 7374 6172 745f       cont.start_
-00012bb0: 636f 6e74 6169 6e65 7228 6e61 6d65 290a  container(name).
-00012bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012bd0: 2020 2020 7375 6363 6573 7328 6622 436f      success(f"Co
-00012be0: 6e74 6169 6e65 7220 7b6e 616d 657d 2073  ntainer {name} s
-00012bf0: 7461 7274 6564 2122 290a 2020 2020 2020  tarted!").      
-00012c00: 2020 6966 2073 7461 7274 666f 756e 643a    if startfound:
-00012c10: 0a20 2020 2020 2020 2020 2020 2073 7563  .            suc
-00012c20: 6365 7373 2866 2250 6c61 6e20 7b70 6c61  cess(f"Plan {pla
-00012c30: 6e7d 2073 7461 7274 6564 2122 290a 2020  n} started!").  
-00012c40: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00012c50: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-00012c60: 224e 6f20 6d61 7463 6869 6e67 206f 626a  "No matching obj
-00012c70: 6563 7473 2066 6f75 6e64 2229 0a20 2020  ects found").   
-00012c80: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
-00012c90: 7375 6c74 273a 2027 7375 6363 6573 7327  sult': 'success'
-00012ca0: 7d0a 0a20 2020 2064 6566 2073 746f 705f  }..    def stop_
-00012cb0: 706c 616e 2873 656c 662c 2070 6c61 6e2c  plan(self, plan,
-00012cc0: 2073 6f66 743d 4661 6c73 652c 2063 6f6e   soft=False, con
-00012cd0: 7461 696e 6572 3d46 616c 7365 293a 0a20  tainer=False):. 
-00012ce0: 2020 2020 2020 206b 203d 2073 656c 662e         k = self.
-00012cf0: 6b0a 2020 2020 2020 2020 7374 6f70 666f  k.        stopfo
-00012d00: 756e 6420 3d20 5472 7565 0a20 2020 2020  und = True.     
-00012d10: 2020 2070 7072 696e 7428 6622 5374 6f70     pprint(f"Stop
-00012d20: 7069 6e67 2076 6d73 2066 726f 6d20 706c  ping vms from pl
-00012d30: 616e 207b 706c 616e 7d22 290a 2020 2020  an {plan}").    
-00012d40: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-00012d50: 6578 7472 6163 6c69 656e 7473 3a0a 2020  extraclients:.  
-00012d60: 2020 2020 2020 2020 2020 7374 6f70 636c            stopcl
-00012d70: 6965 6e74 7320 3d20 7b73 656c 662e 636c  ients = {self.cl
-00012d80: 6965 6e74 3a20 6b7d 0a20 2020 2020 2020  ient: k}.       
-00012d90: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00012da0: 2020 2073 746f 7063 6c69 656e 7473 203d     stopclients =
-00012db0: 2073 656c 662e 6578 7472 6163 6c69 656e   self.extraclien
-00012dc0: 7473 0a20 2020 2020 2020 2020 2020 2073  ts.            s
-00012dd0: 746f 7063 6c69 656e 7473 2e75 7064 6174  topclients.updat
-00012de0: 6528 7b73 656c 662e 636c 6965 6e74 3a20  e({self.client: 
-00012df0: 6b7d 290a 2020 2020 2020 2020 666f 7220  k}).        for 
-00012e00: 6879 7065 7276 6973 6f72 2069 6e20 7374  hypervisor in st
-00012e10: 6f70 636c 6965 6e74 733a 0a20 2020 2020  opclients:.     
-00012e20: 2020 2020 2020 2063 203d 2073 746f 7063         c = stopc
-00012e30: 6c69 656e 7473 5b68 7970 6572 7669 736f  lients[hyperviso
-00012e40: 725d 0a20 2020 2020 2020 2020 2020 2066  r].            f
-00012e50: 6f72 2076 6d20 696e 2073 6f72 7465 6428  or vm in sorted(
-00012e60: 632e 6c69 7374 2829 2c20 6b65 793d 6c61  c.list(), key=la
-00012e70: 6d62 6461 2078 3a20 785b 276e 616d 6527  mbda x: x['name'
-00012e80: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-00012e90: 2020 2020 6e61 6d65 203d 2076 6d5b 276e      name = vm['n
-00012ea0: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
-00012eb0: 2020 2020 2020 6465 7363 7269 7074 696f        descriptio
-00012ec0: 6e20 3d20 766d 2e67 6574 2827 706c 616e  n = vm.get('plan
-00012ed0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00012ee0: 2020 2069 6620 6465 7363 7269 7074 696f     if descriptio
-00012ef0: 6e20 3d3d 2070 6c61 6e3a 0a20 2020 2020  n == plan:.     
-00012f00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00012f10: 746f 7066 6f75 6e64 203d 2054 7275 650a  topfound = True.
-00012f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f30: 2020 2020 632e 7374 6f70 286e 616d 652c      c.stop(name,
-00012f40: 2073 6f66 743d 736f 6674 290a 2020 2020   soft=soft).    
-00012f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f60: 7375 6363 6573 7328 6622 7b6e 616d 657d  success(f"{name}
-00012f70: 2073 746f 7070 6564 206f 6e20 7b68 7970   stopped on {hyp
-00012f80: 6572 7669 736f 727d 2122 290a 2020 2020  ervisor}!").    
-00012f90: 2020 2020 6966 2063 6f6e 7461 696e 6572      if container
-00012fa0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-00012fb0: 6e74 203d 204b 636f 6e74 6169 6e65 7263  nt = Kcontainerc
-00012fc0: 6f6e 6669 6728 7365 6c66 2c20 636c 6965  onfig(self, clie
-00012fd0: 6e74 3d73 656c 662e 636f 6e74 6169 6e65  nt=self.containe
-00012fe0: 7263 6c69 656e 7429 2e63 6f6e 740a 2020  rclient).cont.  
-00012ff0: 2020 2020 2020 2020 2020 666f 7220 636f            for co
-00013000: 6e74 6120 696e 2073 6f72 7465 6428 636f  nta in sorted(co
-00013010: 6e74 2e6c 6973 745f 636f 6e74 6169 6e65  nt.list_containe
-00013020: 7273 2829 293a 0a20 2020 2020 2020 2020  rs()):.         
-00013030: 2020 2020 2020 206e 616d 6520 3d20 636f         name = co
-00013040: 6e74 615b 305d 0a20 2020 2020 2020 2020  nta[0].         
-00013050: 2020 2020 2020 2063 6f6e 7461 696e 6572         container
-00013060: 706c 616e 203d 2063 6f6e 7461 5b33 5d0a  plan = conta[3].
-00013070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013080: 6966 2063 6f6e 7461 696e 6572 706c 616e  if containerplan
-00013090: 203d 3d20 706c 616e 3a0a 2020 2020 2020   == plan:.      
-000130a0: 2020 2020 2020 2020 2020 2020 2020 7374                st
-000130b0: 6f70 666f 756e 6420 3d20 5472 7565 0a20  opfound = True. 
-000130c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000130d0: 2020 2063 6f6e 742e 7374 6f70 5f63 6f6e     cont.stop_con
-000130e0: 7461 696e 6572 286e 616d 6529 0a20 2020  tainer(name).   
-000130f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013100: 2073 7563 6365 7373 2866 2243 6f6e 7461   success(f"Conta
-00013110: 696e 6572 207b 6e61 6d65 7d20 7374 6f70  iner {name} stop
-00013120: 7065 6421 2229 0a20 2020 2020 2020 2069  ped!").        i
-00013130: 6620 7374 6f70 666f 756e 643a 0a20 2020  f stopfound:.   
-00013140: 2020 2020 2020 2020 2073 7563 6365 7373           success
-00013150: 2866 2250 6c61 6e20 7b70 6c61 6e7d 2073  (f"Plan {plan} s
-00013160: 746f 7070 6564 2122 290a 2020 2020 2020  topped!").      
-00013170: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00013180: 2020 2020 7761 726e 696e 6728 224e 6f20      warning("No 
-00013190: 6d61 7463 6869 6e67 206f 626a 6563 7473  matching objects
-000131a0: 2066 6f75 6e64 2229 0a20 2020 2020 2020   found").       
-000131b0: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-000131c0: 273a 2027 7375 6363 6573 7327 7d0a 0a20  ': 'success'}.. 
-000131d0: 2020 2064 6566 2061 7574 6f73 7461 7274     def autostart
-000131e0: 5f70 6c61 6e28 7365 6c66 2c20 706c 616e  _plan(self, plan
-000131f0: 293a 0a20 2020 2020 2020 206b 203d 2073  ):.        k = s
-00013200: 656c 662e 6b0a 2020 2020 2020 2020 7070  elf.k.        pp
-00013210: 7269 6e74 2866 2253 6574 2076 6d73 2066  rint(f"Set vms f
-00013220: 726f 6d20 706c 616e 207b 706c 616e 7d20  rom plan {plan} 
-00013230: 746f 2061 7574 6f73 7461 7274 2229 0a20  to autostart"). 
-00013240: 2020 2020 2020 2066 6f72 2076 6d20 696e         for vm in
-00013250: 2073 6f72 7465 6428 6b2e 6c69 7374 2829   sorted(k.list()
-00013260: 2c20 6b65 793d 6c61 6d62 6461 2078 3a20  , key=lambda x: 
-00013270: 785b 276e 616d 6527 5d29 3a0a 2020 2020  x['name']):.    
-00013280: 2020 2020 2020 2020 6e61 6d65 203d 2076          name = v
-00013290: 6d5b 276e 616d 6527 5d0a 2020 2020 2020  m['name'].      
-000132a0: 2020 2020 2020 6465 7363 7269 7074 696f        descriptio
-000132b0: 6e20 3d20 766d 5b27 706c 616e 275d 0a20  n = vm['plan']. 
-000132c0: 2020 2020 2020 2020 2020 2069 6620 6465             if de
-000132d0: 7363 7269 7074 696f 6e20 3d3d 2070 6c61  scription == pla
-000132e0: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-000132f0: 2020 206b 2e75 7064 6174 655f 7374 6172     k.update_star
-00013300: 7428 6e61 6d65 2c20 7374 6172 743d 5472  t(name, start=Tr
-00013310: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00013320: 2020 2020 7375 6363 6573 7328 6622 7b6e      success(f"{n
-00013330: 616d 657d 2073 6574 2074 6f20 6175 746f  ame} set to auto
-00013340: 7374 6172 7421 2229 0a20 2020 2020 2020  start!").       
-00013350: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-00013360: 273a 2027 7375 6363 6573 7327 7d0a 0a20  ': 'success'}.. 
-00013370: 2020 2064 6566 206e 6f61 7574 6f73 7461     def noautosta
-00013380: 7274 5f70 6c61 6e28 7365 6c66 2c20 706c  rt_plan(self, pl
-00013390: 616e 293a 0a20 2020 2020 2020 206b 203d  an):.        k =
-000133a0: 2073 656c 662e 6b0a 2020 2020 2020 2020   self.k.        
-000133b0: 7070 7269 6e74 2866 2250 7265 7665 6e74  pprint(f"Prevent
-000133c0: 696e 6720 766d 7320 6672 6f6d 2070 6c61  ing vms from pla
-000133d0: 6e20 7b70 6c61 6e7d 2074 6f20 6175 746f  n {plan} to auto
-000133e0: 7374 6172 7422 290a 2020 2020 2020 2020  start").        
-000133f0: 666f 7220 766d 2069 6e20 736f 7274 6564  for vm in sorted
-00013400: 286b 2e6c 6973 7428 292c 206b 6579 3d6c  (k.list(), key=l
-00013410: 616d 6264 6120 783a 2078 5b27 6e61 6d65  ambda x: x['name
-00013420: 275d 293a 0a20 2020 2020 2020 2020 2020  ']):.           
-00013430: 206e 616d 6520 3d20 766d 5b27 6e61 6d65   name = vm['name
-00013440: 275d 0a20 2020 2020 2020 2020 2020 2064  '].            d
-00013450: 6573 6372 6970 7469 6f6e 203d 2076 6d5b  escription = vm[
-00013460: 2770 6c61 6e27 5d0a 2020 2020 2020 2020  'plan'].        
-00013470: 2020 2020 6966 2064 6573 6372 6970 7469      if descripti
-00013480: 6f6e 203d 3d20 706c 616e 3a0a 2020 2020  on == plan:.    
-00013490: 2020 2020 2020 2020 2020 2020 6b2e 7570              k.up
-000134a0: 6461 7465 5f73 7461 7274 286e 616d 652c  date_start(name,
-000134b0: 2073 7461 7274 3d46 616c 7365 290a 2020   start=False).  
-000134c0: 2020 2020 2020 2020 2020 2020 2020 7375                su
-000134d0: 6363 6573 7328 6622 7b6e 616d 657d 2070  ccess(f"{name} p
-000134e0: 7265 7665 6e74 6564 2074 6f20 6175 746f  revented to auto
-000134f0: 7374 6172 7421 2229 0a20 2020 2020 2020  start!").       
-00013500: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-00013510: 273a 2027 7375 6363 6573 7327 7d0a 0a20  ': 'success'}.. 
-00013520: 2020 2064 6566 2064 656c 6574 655f 706c     def delete_pl
-00013530: 616e 2873 656c 662c 2070 6c61 6e2c 2063  an(self, plan, c
-00013540: 6f6e 7461 696e 6572 3d46 616c 7365 2c20  ontainer=False, 
-00013550: 756e 7265 6769 7374 6572 3d46 616c 7365  unregister=False
-00013560: 293a 0a20 2020 2020 2020 206b 203d 2073  ):.        k = s
-00013570: 656c 662e 6b0a 2020 2020 2020 2020 6465  elf.k.        de
-00013580: 6c65 7465 6476 6d73 203d 205b 5d0a 2020  letedvms = [].  
-00013590: 2020 2020 2020 6465 6c65 7465 646c 6273        deletedlbs
-000135a0: 203d 205b 5d0a 2020 2020 2020 2020 646e   = [].        dn
-000135b0: 7363 6c69 656e 7473 203d 205b 5d0a 2020  sclients = [].  
-000135c0: 2020 2020 2020 6e65 7477 6f72 6b73 203d        networks =
-000135d0: 205b 5d0a 2020 2020 2020 2020 6966 2070   [].        if p
-000135e0: 6c61 6e20 3d3d 2027 273a 0a20 2020 2020  lan == '':.     
-000135f0: 2020 2020 2020 2065 7272 6f72 2822 5468         error("Th
-00013600: 6174 2077 6f75 6c64 2064 656c 6574 6520  at would delete 
-00013610: 6576 6572 7920 766d 2e2e 2e4e 6f74 2064  every vm...Not d
-00013620: 6f69 6e67 2074 6861 7422 290a 2020 2020  oing that").    
-00013630: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
-00013640: 2831 290a 2020 2020 2020 2020 666f 756e  (1).        foun
-00013650: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
-00013660: 2020 6465 6c65 7465 636c 6965 6e74 7320    deleteclients 
-00013670: 3d20 7b73 656c 662e 636c 6965 6e74 3a20  = {self.client: 
-00013680: 6b7d 0a20 2020 2020 2020 2076 6d63 6c69  k}.        vmcli
-00013690: 656e 7473 203d 205b 5d0a 2020 2020 2020  ents = [].      
-000136a0: 2020 766d 636c 6965 6e74 735f 6669 6c65    vmclients_file
-000136b0: 203d 206f 732e 7061 7468 2e65 7870 616e   = os.path.expan
-000136c0: 6475 7365 7228 6627 7e2f 2e6b 636c 692f  duser(f'~/.kcli/
-000136d0: 766d 636c 6965 6e74 735f 7b70 6c61 6e7d  vmclients_{plan}
-000136e0: 2729 0a20 2020 2020 2020 2069 6620 6f73  ').        if os
-000136f0: 2e70 6174 682e 6578 6973 7473 2876 6d63  .path.exists(vmc
-00013700: 6c69 656e 7473 5f66 696c 6529 3a0a 2020  lients_file):.  
-00013710: 2020 2020 2020 2020 2020 766d 636c 6965            vmclie
-00013720: 6e74 7320 3d20 7961 6d6c 2e73 6166 655f  nts = yaml.safe_
-00013730: 6c6f 6164 286f 7065 6e28 766d 636c 6965  load(open(vmclie
-00013740: 6e74 735f 6669 6c65 2929 0a20 2020 2020  nts_file)).     
-00013750: 2020 2020 2020 206f 732e 7265 6d6f 7665         os.remove
-00013760: 2876 6d63 6c69 656e 7473 5f66 696c 6529  (vmclients_file)
-00013770: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00013780: 2e65 7874 7261 636c 6965 6e74 733a 0a20  .extraclients:. 
-00013790: 2020 2020 2020 2020 2020 2064 656c 6574             delet
-000137a0: 6563 6c69 656e 7473 2e75 7064 6174 6528  eclients.update(
-000137b0: 7365 6c66 2e65 7874 7261 636c 6965 6e74  self.extraclient
-000137c0: 7329 0a20 2020 2020 2020 2065 6c69 6620  s).        elif 
-000137d0: 766d 636c 6965 6e74 733a 0a20 2020 2020  vmclients:.     
-000137e0: 2020 2020 2020 2064 656c 6574 6563 6c69         deletecli
-000137f0: 656e 7473 2e75 7064 6174 6528 7b63 6c69  ents.update({cli
-00013800: 3a20 4b63 6f6e 6669 6728 636c 6965 6e74  : Kconfig(client
-00013810: 3d63 6c69 292e 6b20 666f 7220 636c 6920  =cli).k for cli 
-00013820: 696e 2076 6d63 6c69 656e 7473 2069 6620  in vmclients if 
-00013830: 636c 6920 213d 2073 656c 662e 636c 6965  cli != self.clie
-00013840: 6e74 7d29 0a20 2020 2020 2020 2068 7970  nt}).        hyp
-00013850: 6572 7368 6966 7420 3d20 4661 6c73 650a  ershift = False.
-00013860: 2020 2020 2020 2020 6173 7369 7374 6564          assisted
-00013870: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00013880: 2066 6f72 2068 7970 6572 7669 736f 7220   for hypervisor 
-00013890: 696e 2064 656c 6574 6563 6c69 656e 7473  in deleteclients
-000138a0: 3a0a 2020 2020 2020 2020 2020 2020 6320  :.            c 
-000138b0: 3d20 6465 6c65 7465 636c 6965 6e74 735b  = deleteclients[
-000138c0: 6879 7065 7276 6973 6f72 5d0a 2020 2020  hypervisor].    
-000138d0: 2020 2020 2020 2020 666f 7220 766d 2069          for vm i
-000138e0: 6e20 736f 7274 6564 2863 2e6c 6973 7428  n sorted(c.list(
-000138f0: 292c 206b 6579 3d6c 616d 6264 6120 783a  ), key=lambda x:
-00013900: 2078 5b27 6e61 6d65 275d 293a 0a20 2020   x['name']):.   
-00013910: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-00013920: 6520 3d20 766d 5b27 6e61 6d65 275d 0a20  e = vm['name']. 
-00013930: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00013940: 6573 6372 6970 7469 6f6e 203d 2076 6d2e  escription = vm.
-00013950: 6765 7428 2770 6c61 6e27 290a 2020 2020  get('plan').    
-00013960: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00013970: 6573 6372 6970 7469 6f6e 203d 3d20 706c  escription == pl
-00013980: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
-00013990: 2020 2020 2020 2020 6966 2027 6c6f 6164          if 'load
-000139a0: 6261 6c61 6e63 6572 2720 696e 2076 6d3a  balancer' in vm:
-000139b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000139c0: 2020 2020 2020 2020 206c 6273 203d 2076           lbs = v
-000139d0: 6d5b 276c 6f61 6462 616c 616e 6365 7227  m['loadbalancer'
-000139e0: 5d2e 7370 6c69 7428 272c 2729 0a20 2020  ].split(',').   
-000139f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a00: 2020 2020 2066 6f72 206c 6220 696e 206c       for lb in l
-00013a10: 6273 3a0a 2020 2020 2020 2020 2020 2020  bs:.            
-00013a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a30: 6966 206c 6220 6e6f 7420 696e 2064 656c  if lb not in del
-00013a40: 6574 6564 6c62 733a 0a20 2020 2020 2020  etedlbs:.       
-00013a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a60: 2020 2020 2020 2020 2064 656c 6574 6564           deleted
-00013a70: 6c62 732e 6170 7065 6e64 286c 6229 0a20  lbs.append(lb). 
-00013a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a90: 2020 2076 6d6e 6574 776f 726b 7320 3d20     vmnetworks = 
-00013aa0: 632e 766d 5f70 6f72 7473 286e 616d 6529  c.vm_ports(name)
-00013ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013ac0: 2020 2020 2066 6f72 206e 6574 776f 726b       for network
-00013ad0: 2069 6e20 766d 6e65 7477 6f72 6b73 3a0a   in vmnetworks:.
-00013ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013af0: 2020 2020 2020 2020 6966 206e 6574 776f          if netwo
-00013b00: 726b 2021 3d20 2764 6566 6175 6c74 2720  rk != 'default' 
-00013b10: 616e 6420 6e65 7477 6f72 6b20 6e6f 7420  and network not 
-00013b20: 696e 206e 6574 776f 726b 733a 0a20 2020  in networks:.   
-00013b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b40: 2020 2020 2020 2020 206e 6574 776f 726b           network
-00013b50: 732e 6170 7065 6e64 286e 6574 776f 726b  s.append(network
-00013b60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00013b70: 2020 2020 2020 646e 7363 6c69 656e 742c        dnsclient,
-00013b80: 2064 6f6d 6169 6e20 3d20 632e 646e 7369   domain = c.dnsi
-00013b90: 6e66 6f28 6e61 6d65 290a 2020 2020 2020  nfo(name).      
-00013ba0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00013bb0: 2075 6e72 6567 6973 7465 723a 0a20 2020   unregister:.   
-00013bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013bd0: 2020 2020 2069 6d61 6765 203d 206b 2e69       image = k.i
-00013be0: 6e66 6f28 6e61 6d65 292e 6765 7428 2769  nfo(name).get('i
-00013bf0: 6d61 6765 2729 0a20 2020 2020 2020 2020  mage').         
-00013c00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00013c10: 6620 2772 6865 6c27 2069 6e20 696d 6167  f 'rhel' in imag
-00013c20: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00013c30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00013c40: 7072 696e 7428 6622 5265 6d6f 7669 6e67  print(f"Removing
-00013c50: 2072 6865 6c20 7375 6273 6372 6970 7469   rhel subscripti
-00013c60: 6f6e 2066 6f72 207b 6e61 6d65 7d22 290a  on for {name}").
-00013c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c80: 2020 2020 2020 2020 2020 2020 6970 2c20              ip, 
-00013c90: 766d 706f 7274 203d 205f 7373 685f 6372  vmport = _ssh_cr
-00013ca0: 6564 656e 7469 616c 7328 6b2c 206e 616d  edentials(k, nam
-00013cb0: 6529 5b31 3a5d 0a20 2020 2020 2020 2020  e)[1:].         
-00013cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013cd0: 2020 2063 6d64 203d 2022 7375 6273 6372     cmd = "subscr
-00013ce0: 6970 7469 6f6e 2d6d 616e 6167 6572 2075  iption-manager u
-00013cf0: 6e72 6567 6973 7465 7222 0a20 2020 2020  nregister".     
+00011ba0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00011bb0: 2e74 7970 6520 3d3d 2027 6763 7027 3a0a  .type == 'gcp':.
+00011bc0: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
+00011bd0: 206b 7669 7274 2e63 6c75 7374 6572 2069   kvirt.cluster i
+00011be0: 6d70 6f72 7420 676b 650a 2020 2020 2020  mport gke.      
+00011bf0: 2020 2020 2020 6b75 6265 732e 7570 6461        kubes.upda
+00011c00: 7465 2867 6b65 2e6c 6973 7428 7365 6c66  te(gke.list(self
+00011c10: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
+00011c20: 6e20 6b75 6265 730a 0a20 2020 2064 6566  n kubes..    def
+00011c30: 2063 7265 6174 655f 7072 6f64 7563 7428   create_product(
+00011c40: 7365 6c66 2c20 6e61 6d65 2c20 7265 706f  self, name, repo
+00011c50: 3d4e 6f6e 652c 2067 726f 7570 3d4e 6f6e  =None, group=Non
+00011c60: 652c 2070 6c61 6e3d 4e6f 6e65 2c20 6c61  e, plan=None, la
+00011c70: 7465 7374 3d46 616c 7365 2c20 6f76 6572  test=False, over
+00011c80: 7269 6465 733d 7b7d 293a 0a20 2020 2020  rides={}):.     
+00011c90: 2020 2022 2222 4372 6561 7465 2070 726f     """Create pro
+00011ca0: 6475 6374 2222 220a 2020 2020 2020 2020  duct""".        
+00011cb0: 6966 2072 6570 6f20 6973 206e 6f74 204e  if repo is not N
+00011cc0: 6f6e 6520 616e 6420 6772 6f75 7020 6973  one and group is
+00011cd0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00011ce0: 2020 2020 2020 2070 726f 6475 6374 7320         products 
+00011cf0: 3d20 5b70 726f 6475 6374 2066 6f72 2070  = [product for p
+00011d00: 726f 6475 6374 2069 6e20 7365 6c66 2e6c  roduct in self.l
+00011d10: 6973 745f 7072 6f64 7563 7473 2829 0a20  ist_products(). 
+00011d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d30: 2020 2020 2020 2069 6620 7072 6f64 7563         if produc
+00011d40: 745b 276e 616d 6527 5d20 3d3d 206e 616d  t['name'] == nam
+00011d50: 6520 616e 6420 7072 6f64 7563 745b 2772  e and product['r
+00011d60: 6570 6f27 5d20 3d3d 2072 6570 6f20 616e  epo'] == repo an
+00011d70: 6420 7072 6f64 7563 745b 2767 726f 7570  d product['group
+00011d80: 275d 203d 3d20 6772 6f75 705d 0a20 2020  '] == group].   
+00011d90: 2020 2020 2065 6c69 6620 7265 706f 2069       elif repo i
+00011da0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00011db0: 2020 2020 2020 2020 7072 6f64 7563 7473          products
+00011dc0: 203d 205b 7072 6f64 7563 7420 666f 7220   = [product for 
+00011dd0: 7072 6f64 7563 7420 696e 2073 656c 662e  product in self.
+00011de0: 6c69 7374 5f70 726f 6475 6374 7328 290a  list_products().
+00011df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e00: 2020 2020 2020 2020 6966 2070 726f 6475          if produ
+00011e10: 6374 5b27 6e61 6d65 275d 203d 3d20 6e61  ct['name'] == na
+00011e20: 6d65 2061 6e64 2070 726f 6475 6374 5b27  me and product['
+00011e30: 7265 706f 275d 203d 3d20 7265 706f 5d0a  repo'] == repo].
+00011e40: 2020 2020 2020 2020 6966 2067 726f 7570          if group
+00011e50: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00011e60: 2020 2020 2020 2020 2020 7072 6f64 7563            produc
+00011e70: 7473 203d 205b 7072 6f64 7563 7420 666f  ts = [product fo
+00011e80: 7220 7072 6f64 7563 7420 696e 2073 656c  r product in sel
+00011e90: 662e 6c69 7374 5f70 726f 6475 6374 7328  f.list_products(
+00011ea0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00011eb0: 2020 2020 2020 2020 2020 6966 2070 726f            if pro
+00011ec0: 6475 6374 5b27 6e61 6d65 275d 203d 3d20  duct['name'] == 
+00011ed0: 6e61 6d65 2061 6e64 2070 726f 6475 6374  name and product
+00011ee0: 5b27 6772 6f75 7027 5d20 3d3d 2067 726f  ['group'] == gro
+00011ef0: 7570 5d0a 2020 2020 2020 2020 656c 7365  up].        else
+00011f00: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00011f10: 6f64 7563 7473 203d 205b 7072 6f64 7563  oducts = [produc
+00011f20: 7420 666f 7220 7072 6f64 7563 7420 696e  t for product in
+00011f30: 2073 656c 662e 6c69 7374 5f70 726f 6475   self.list_produ
+00011f40: 6374 7328 2920 6966 2070 726f 6475 6374  cts() if product
+00011f50: 5b27 6e61 6d65 275d 203d 3d20 6e61 6d65  ['name'] == name
+00011f60: 5d0a 2020 2020 2020 2020 6966 206c 656e  ].        if len
+00011f70: 2870 726f 6475 6374 7329 203d 3d20 303a  (products) == 0:
+00011f80: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
+00011f90: 6f72 2822 5072 6f64 7563 7420 6e6f 7420  or("Product not 
+00011fa0: 666f 756e 642e 204c 6561 7669 6e67 2e2e  found. Leaving..
+00011fb0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00011fc0: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
+00011fd0: 2020 2020 656c 6966 206c 656e 2870 726f      elif len(pro
+00011fe0: 6475 6374 7329 203e 2031 3a0a 2020 2020  ducts) > 1:.    
+00011ff0: 2020 2020 2020 2020 6572 726f 7228 2250          error("P
+00012000: 726f 6475 6374 2066 6f75 6e64 2069 6e20  roduct found in 
+00012010: 7365 7665 7261 6c20 7265 706f 7320 6f72  several repos or
+00012020: 2067 726f 7570 732e 2053 7065 6369 6679   groups. Specify
+00012030: 206f 6e65 2e2e 2e22 290a 2020 2020 2020   one...").      
+00012040: 2020 2020 2020 666f 7220 7072 6f64 7563        for produc
+00012050: 7420 696e 2070 726f 6475 6374 733a 0a20  t in products:. 
+00012060: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00012070: 726f 7570 203d 2070 726f 6475 6374 5b27  roup = product['
+00012080: 6772 6f75 7027 5d0a 2020 2020 2020 2020  group'].        
+00012090: 2020 2020 2020 2020 7265 706f 203d 2070          repo = p
+000120a0: 726f 6475 6374 5b27 7265 706f 275d 0a20  roduct['repo']. 
+000120b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000120c0: 7269 6e74 2866 2272 6570 6f3a 7b72 6570  rint(f"repo:{rep
+000120d0: 6f7d 5c74 6772 6f75 703a 7b67 726f 7570  o}\tgroup:{group
+000120e0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+000120f0: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
+00012100: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00012110: 2020 2020 2020 7072 6f64 7563 7420 3d20        product = 
+00012120: 7072 6f64 7563 7473 5b30 5d0a 2020 2020  products[0].    
+00012130: 2020 2020 2020 2020 706c 616e 203d 206e          plan = n
+00012140: 616d 6575 7469 6c73 2e67 6574 5f72 616e  ameutils.get_ran
+00012150: 646f 6d5f 6e61 6d65 2829 2069 6620 706c  dom_name() if pl
+00012160: 616e 2069 7320 4e6f 6e65 2065 6c73 6520  an is None else 
+00012170: 706c 616e 0a20 2020 2020 2020 2020 2020  plan.           
+00012180: 2072 6570 6f20 3d20 7072 6f64 7563 745b   repo = product[
+00012190: 2772 6570 6f27 5d0a 2020 2020 2020 2020  'repo'].        
+000121a0: 2020 2020 6966 2027 7265 616c 6469 7227      if 'realdir'
+000121b0: 2069 6e20 7072 6f64 7563 743a 0a20 2020   in product:.   
+000121c0: 2020 2020 2020 2020 2020 2020 2072 6570               rep
+000121d0: 6f64 6972 203d 2022 2573 2f2e 6b63 6c69  odir = "%s/.kcli
+000121e0: 2f70 6c61 6e73 2f25 732f 2573 2220 2520  /plans/%s/%s" % 
+000121f0: 286f 732e 656e 7669 726f 6e2e 6765 7428  (os.environ.get(
+00012200: 2748 4f4d 4527 292c 2072 6570 6f2c 2070  'HOME'), repo, p
+00012210: 726f 6475 6374 5b27 7265 616c 6469 7227  roduct['realdir'
+00012220: 5d29 0a20 2020 2020 2020 2020 2020 2065  ]).            e
+00012230: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00012240: 2020 2020 2072 6570 6f64 6972 203d 2022       repodir = "
+00012250: 2573 2f2e 6b63 6c69 2f70 6c61 6e73 2f25  %s/.kcli/plans/%
+00012260: 7322 2025 2028 6f73 2e65 6e76 6972 6f6e  s" % (os.environ
+00012270: 2e67 6574 2827 484f 4d45 2729 2c20 7265  .get('HOME'), re
+00012280: 706f 290a 2020 2020 2020 2020 2020 2020  po).            
+00012290: 6966 2027 2f27 2069 6e20 7072 6f64 7563  if '/' in produc
+000122a0: 745b 2766 696c 6527 5d3a 0a20 2020 2020  t['file']:.     
+000122b0: 2020 2020 2020 2020 2020 2069 6e70 7574             input
+000122c0: 6669 6c65 203d 206f 732e 7061 7468 2e62  file = os.path.b
+000122d0: 6173 656e 616d 6528 7072 6f64 7563 745b  asename(product[
+000122e0: 2766 696c 6527 5d29 0a20 2020 2020 2020  'file']).       
+000122f0: 2020 2020 2020 2020 2072 6570 6f64 6972           repodir
+00012300: 202b 3d20 222f 2573 2220 2520 6f73 2e70   += "/%s" % os.p
+00012310: 6174 682e 6469 726e 616d 6528 7072 6f64  ath.dirname(prod
+00012320: 7563 745b 2766 696c 6527 5d29 0a20 2020  uct['file']).   
+00012330: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00012340: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00012350: 6e70 7574 6669 6c65 203d 2070 726f 6475  nputfile = produ
+00012360: 6374 5b27 6669 6c65 275d 0a20 2020 2020  ct['file'].     
+00012370: 2020 2020 2020 2069 6d61 6765 203d 2070         image = p
+00012380: 726f 6475 6374 2e67 6574 2827 696d 6167  roduct.get('imag
+00012390: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
+000123a0: 7061 7261 6d65 7465 7273 203d 2070 726f  parameters = pro
+000123b0: 6475 6374 2e67 6574 2827 7061 7261 6d65  duct.get('parame
+000123c0: 7465 7273 2729 0a20 2020 2020 2020 2020  ters').         
+000123d0: 2020 2069 6620 696d 6167 6520 6973 206e     if image is n
+000123e0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000123f0: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+00012400: 224e 6f74 6520 7468 6174 2074 6869 7320  "Note that this 
+00012410: 7072 6f64 7563 7420 7573 6573 2069 6d61  product uses ima
+00012420: 6765 3a20 7b69 6d61 6765 7d22 290a 2020  ge: {image}").  
+00012430: 2020 2020 2020 2020 2020 6966 2070 6172            if par
+00012440: 616d 6574 6572 7320 6973 206e 6f74 204e  ameters is not N
+00012450: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00012460: 2020 2020 2066 6f72 2070 6172 616d 6574       for paramet
+00012470: 6572 2069 6e20 7061 7261 6d65 7465 7273  er in parameters
+00012480: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00012490: 2020 2020 2020 6170 706c 6965 645f 7061        applied_pa
+000124a0: 7261 6d65 7465 7220 3d20 6f76 6572 7269  rameter = overri
+000124b0: 6465 735b 7061 7261 6d65 7465 725d 2069  des[parameter] i
+000124c0: 6620 7061 7261 6d65 7465 7220 696e 206f  f parameter in o
+000124d0: 7665 7272 6964 6573 2065 6c73 6520 7061  verrides else pa
+000124e0: 7261 6d65 7465 7273 5b70 6172 616d 6574  rameters[paramet
+000124f0: 6572 5d0a 2020 2020 2020 2020 2020 2020  er].            
+00012500: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+00012510: 5573 696e 6720 7061 7261 6d65 7465 7220  Using parameter 
+00012520: 7b70 6172 616d 6574 6572 7d3a 207b 6170  {parameter}: {ap
+00012530: 706c 6965 645f 7061 7261 6d65 7465 727d  plied_parameter}
+00012540: 2229 0a20 2020 2020 2020 2020 2020 2065  ").            e
+00012550: 7874 7261 7061 7261 6d65 7465 7273 203d  xtraparameters =
+00012560: 206c 6973 7428 7365 7428 6f76 6572 7269   list(set(overri
+00012570: 6465 7329 202d 2073 6574 2870 6172 616d  des) - set(param
+00012580: 6574 6572 7329 2920 6966 2070 6172 616d  eters)) if param
+00012590: 6574 6572 7320 6973 206e 6f74 204e 6f6e  eters is not Non
+000125a0: 6520 656c 7365 206f 7665 7272 6964 6573  e else overrides
+000125b0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000125c0: 2070 6172 616d 6574 6572 2069 6e20 6578   parameter in ex
+000125d0: 7472 6170 6172 616d 6574 6572 733a 0a20  traparameters:. 
+000125e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000125f0: 7269 6e74 2822 5573 696e 6720 7061 7261  rint("Using para
+00012600: 6d65 7465 7220 2573 3a20 2573 2220 2520  meter %s: %s" % 
+00012610: 2870 6172 616d 6574 6572 2c20 6f76 6572  (parameter, over
+00012620: 7269 6465 735b 7061 7261 6d65 7465 725d  rides[parameter]
+00012630: 2929 0a20 2020 2020 2020 2020 2020 2069  )).            i
+00012640: 6620 6e6f 7420 6c61 7465 7374 3a0a 2020  f not latest:.  
+00012650: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+00012660: 7269 6e74 2866 2255 7369 6e67 2064 6972  rint(f"Using dir
+00012670: 6563 746f 7279 207b 7265 706f 6469 727d  ectory {repodir}
+00012680: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00012690: 2020 2073 656c 662e 706c 616e 2870 6c61     self.plan(pla
+000126a0: 6e2c 2070 6174 683d 7265 706f 6469 722c  n, path=repodir,
+000126b0: 2069 6e70 7574 6669 6c65 3d69 6e70 7574   inputfile=input
+000126c0: 6669 6c65 2c20 6f76 6572 7269 6465 733d  file, overrides=
+000126d0: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
+000126e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000126f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00012700: 662e 7570 6461 7465 5f72 6570 6f28 7265  f.update_repo(re
+00012710: 706f 290a 2020 2020 2020 2020 2020 2020  po).            
+00012720: 2020 2020 7365 6c66 2e70 6c61 6e28 706c      self.plan(pl
+00012730: 616e 2c20 7061 7468 3d72 6570 6f64 6972  an, path=repodir
+00012740: 2c20 696e 7075 7466 696c 653d 696e 7075  , inputfile=inpu
+00012750: 7466 696c 652c 206f 7665 7272 6964 6573  tfile, overrides
+00012760: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
+00012770: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+00012780: 2250 726f 6475 6374 2063 616e 2062 6520  "Product can be 
+00012790: 6465 6c65 7465 6420 7769 7468 3a20 6b63  deleted with: kc
+000127a0: 6c69 2064 656c 6574 6520 706c 616e 202d  li delete plan -
+000127b0: 2d79 6573 207b 706c 616e 7d22 290a 2020  -yes {plan}").  
+000127c0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
+000127d0: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
+000127e0: 272c 2027 706c 616e 273a 2070 6c61 6e7d  ', 'plan': plan}
+000127f0: 0a0a 2020 2020 6465 6620 7374 6172 745f  ..    def start_
+00012800: 706c 616e 2873 656c 662c 2070 6c61 6e2c  plan(self, plan,
+00012810: 2063 6f6e 7461 696e 6572 3d46 616c 7365   container=False
+00012820: 293a 0a20 2020 2020 2020 206b 203d 2073  ):.        k = s
+00012830: 656c 662e 6b0a 2020 2020 2020 2020 7374  elf.k.        st
+00012840: 6172 7466 6f75 6e64 203d 2046 616c 7365  artfound = False
+00012850: 0a20 2020 2020 2020 2070 7072 696e 7428  .        pprint(
+00012860: 6622 5374 6172 7469 6e67 2076 6d73 2066  f"Starting vms f
+00012870: 726f 6d20 706c 616e 207b 706c 616e 7d22  rom plan {plan}"
+00012880: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+00012890: 2073 656c 662e 6578 7472 6163 6c69 656e   self.extraclien
+000128a0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+000128b0: 7374 6172 7463 6c69 656e 7473 203d 207b  startclients = {
+000128c0: 7365 6c66 2e63 6c69 656e 743a 206b 7d0a  self.client: k}.
+000128d0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000128e0: 2020 2020 2020 2020 2020 7374 6172 7463            startc
+000128f0: 6c69 656e 7473 203d 2073 656c 662e 6578  lients = self.ex
+00012900: 7472 6163 6c69 656e 7473 0a20 2020 2020  traclients.     
+00012910: 2020 2020 2020 2073 7461 7274 636c 6965         startclie
+00012920: 6e74 732e 7570 6461 7465 287b 7365 6c66  nts.update({self
+00012930: 2e63 6c69 656e 743a 206b 7d29 0a20 2020  .client: k}).   
+00012940: 2020 2020 2066 6f72 2068 7970 6572 7669       for hypervi
+00012950: 736f 7220 696e 2073 7461 7274 636c 6965  sor in startclie
+00012960: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
+00012970: 2063 203d 2073 7461 7274 636c 6965 6e74   c = startclient
+00012980: 735b 6879 7065 7276 6973 6f72 5d0a 2020  s[hypervisor].  
+00012990: 2020 2020 2020 2020 2020 666f 7220 766d            for vm
+000129a0: 2069 6e20 736f 7274 6564 2863 2e6c 6973   in sorted(c.lis
+000129b0: 7428 292c 206b 6579 3d6c 616d 6264 6120  t(), key=lambda 
+000129c0: 783a 2078 5b27 6e61 6d65 275d 293a 0a20  x: x['name']):. 
+000129d0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000129e0: 616d 6520 3d20 766d 5b27 6e61 6d65 275d  ame = vm['name']
+000129f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012a00: 2064 6573 6372 6970 7469 6f6e 203d 2076   description = v
+00012a10: 6d2e 6765 7428 2770 6c61 6e27 290a 2020  m.get('plan').  
+00012a20: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00012a30: 2064 6573 6372 6970 7469 6f6e 203d 3d20   description == 
+00012a40: 706c 616e 3a0a 2020 2020 2020 2020 2020  plan:.          
+00012a50: 2020 2020 2020 2020 2020 7374 6172 7466            startf
+00012a60: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
+00012a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a80: 632e 7374 6172 7428 6e61 6d65 290a 2020  c.start(name).  
+00012a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012aa0: 2020 7375 6363 6573 7328 6622 7b6e 616d    success(f"{nam
+00012ab0: 657d 2073 7461 7274 6564 206f 6e20 7b68  e} started on {h
+00012ac0: 7970 6572 7669 736f 727d 2122 290a 2020  ypervisor}!").  
+00012ad0: 2020 2020 2020 6966 2063 6f6e 7461 696e        if contain
+00012ae0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+00012af0: 636f 6e74 203d 204b 636f 6e74 6169 6e65  cont = Kcontaine
+00012b00: 7263 6f6e 6669 6728 7365 6c66 2c20 636c  rconfig(self, cl
+00012b10: 6965 6e74 3d73 656c 662e 636f 6e74 6169  ient=self.contai
+00012b20: 6e65 7263 6c69 656e 7429 2e63 6f6e 740a  nerclient).cont.
+00012b30: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00012b40: 636f 6e74 6120 696e 2073 6f72 7465 6428  conta in sorted(
+00012b50: 636f 6e74 2e6c 6973 745f 636f 6e74 6169  cont.list_contai
+00012b60: 6e65 7273 286b 2929 3a0a 2020 2020 2020  ners(k)):.      
+00012b70: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
+00012b80: 2063 6f6e 7461 5b30 5d0a 2020 2020 2020   conta[0].      
+00012b90: 2020 2020 2020 2020 2020 636f 6e74 6169            contai
+00012ba0: 6e65 7270 6c61 6e20 3d20 636f 6e74 615b  nerplan = conta[
+00012bb0: 335d 0a20 2020 2020 2020 2020 2020 2020  3].             
+00012bc0: 2020 2069 6620 636f 6e74 6169 6e65 7270     if containerp
+00012bd0: 6c61 6e20 3d3d 2070 6c61 6e3a 0a20 2020  lan == plan:.   
+00012be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012bf0: 2073 7461 7274 666f 756e 6420 3d20 5472   startfound = Tr
+00012c00: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00012c10: 2020 2020 2020 2063 6f6e 742e 7374 6172         cont.star
+00012c20: 745f 636f 6e74 6169 6e65 7228 6e61 6d65  t_container(name
+00012c30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00012c40: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
+00012c50: 436f 6e74 6169 6e65 7220 7b6e 616d 657d  Container {name}
+00012c60: 2073 7461 7274 6564 2122 290a 2020 2020   started!").    
+00012c70: 2020 2020 6966 2073 7461 7274 666f 756e      if startfoun
+00012c80: 643a 0a20 2020 2020 2020 2020 2020 2073  d:.            s
+00012c90: 7563 6365 7373 2866 2250 6c61 6e20 7b70  uccess(f"Plan {p
+00012ca0: 6c61 6e7d 2073 7461 7274 6564 2122 290a  lan} started!").
+00012cb0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00012cc0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+00012cd0: 6728 224e 6f20 6d61 7463 6869 6e67 206f  g("No matching o
+00012ce0: 626a 6563 7473 2066 6f75 6e64 2229 0a20  bjects found"). 
+00012cf0: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
+00012d00: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
+00012d10: 7327 7d0a 0a20 2020 2064 6566 2073 746f  s'}..    def sto
+00012d20: 705f 706c 616e 2873 656c 662c 2070 6c61  p_plan(self, pla
+00012d30: 6e2c 2073 6f66 743d 4661 6c73 652c 2063  n, soft=False, c
+00012d40: 6f6e 7461 696e 6572 3d46 616c 7365 293a  ontainer=False):
+00012d50: 0a20 2020 2020 2020 206b 203d 2073 656c  .        k = sel
+00012d60: 662e 6b0a 2020 2020 2020 2020 7374 6f70  f.k.        stop
+00012d70: 666f 756e 6420 3d20 5472 7565 0a20 2020  found = True.   
+00012d80: 2020 2020 2070 7072 696e 7428 6622 5374       pprint(f"St
+00012d90: 6f70 7069 6e67 2076 6d73 2066 726f 6d20  opping vms from 
+00012da0: 706c 616e 207b 706c 616e 7d22 290a 2020  plan {plan}").  
+00012db0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00012dc0: 662e 6578 7472 6163 6c69 656e 7473 3a0a  f.extraclients:.
+00012dd0: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
+00012de0: 636c 6965 6e74 7320 3d20 7b73 656c 662e  clients = {self.
+00012df0: 636c 6965 6e74 3a20 6b7d 0a20 2020 2020  client: k}.     
+00012e00: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00012e10: 2020 2020 2073 746f 7063 6c69 656e 7473       stopclients
+00012e20: 203d 2073 656c 662e 6578 7472 6163 6c69   = self.extracli
+00012e30: 656e 7473 0a20 2020 2020 2020 2020 2020  ents.           
+00012e40: 2073 746f 7063 6c69 656e 7473 2e75 7064   stopclients.upd
+00012e50: 6174 6528 7b73 656c 662e 636c 6965 6e74  ate({self.client
+00012e60: 3a20 6b7d 290a 2020 2020 2020 2020 666f  : k}).        fo
+00012e70: 7220 6879 7065 7276 6973 6f72 2069 6e20  r hypervisor in 
+00012e80: 7374 6f70 636c 6965 6e74 733a 0a20 2020  stopclients:.   
+00012e90: 2020 2020 2020 2020 2063 203d 2073 746f           c = sto
+00012ea0: 7063 6c69 656e 7473 5b68 7970 6572 7669  pclients[hypervi
+00012eb0: 736f 725d 0a20 2020 2020 2020 2020 2020  sor].           
+00012ec0: 2066 6f72 2076 6d20 696e 2073 6f72 7465   for vm in sorte
+00012ed0: 6428 632e 6c69 7374 2829 2c20 6b65 793d  d(c.list(), key=
+00012ee0: 6c61 6d62 6461 2078 3a20 785b 276e 616d  lambda x: x['nam
+00012ef0: 6527 5d29 3a0a 2020 2020 2020 2020 2020  e']):.          
+00012f00: 2020 2020 2020 6e61 6d65 203d 2076 6d5b        name = vm[
+00012f10: 276e 616d 6527 5d0a 2020 2020 2020 2020  'name'].        
+00012f20: 2020 2020 2020 2020 6465 7363 7269 7074          descript
+00012f30: 696f 6e20 3d20 766d 2e67 6574 2827 706c  ion = vm.get('pl
+00012f40: 616e 2729 0a20 2020 2020 2020 2020 2020  an').           
+00012f50: 2020 2020 2069 6620 6465 7363 7269 7074       if descript
+00012f60: 696f 6e20 3d3d 2070 6c61 6e3a 0a20 2020  ion == plan:.   
+00012f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f80: 2073 746f 7066 6f75 6e64 203d 2054 7275   stopfound = Tru
+00012f90: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00012fa0: 2020 2020 2020 632e 7374 6f70 286e 616d        c.stop(nam
+00012fb0: 652c 2073 6f66 743d 736f 6674 290a 2020  e, soft=soft).  
+00012fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fd0: 2020 7375 6363 6573 7328 6622 7b6e 616d    success(f"{nam
+00012fe0: 657d 2073 746f 7070 6564 206f 6e20 7b68  e} stopped on {h
+00012ff0: 7970 6572 7669 736f 727d 2122 290a 2020  ypervisor}!").  
+00013000: 2020 2020 2020 6966 2063 6f6e 7461 696e        if contain
+00013010: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+00013020: 636f 6e74 203d 204b 636f 6e74 6169 6e65  cont = Kcontaine
+00013030: 7263 6f6e 6669 6728 7365 6c66 2c20 636c  rconfig(self, cl
+00013040: 6965 6e74 3d73 656c 662e 636f 6e74 6169  ient=self.contai
+00013050: 6e65 7263 6c69 656e 7429 2e63 6f6e 740a  nerclient).cont.
+00013060: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00013070: 636f 6e74 6120 696e 2073 6f72 7465 6428  conta in sorted(
+00013080: 636f 6e74 2e6c 6973 745f 636f 6e74 6169  cont.list_contai
+00013090: 6e65 7273 2829 293a 0a20 2020 2020 2020  ners()):.       
+000130a0: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
+000130b0: 636f 6e74 615b 305d 0a20 2020 2020 2020  conta[0].       
+000130c0: 2020 2020 2020 2020 2063 6f6e 7461 696e           contain
+000130d0: 6572 706c 616e 203d 2063 6f6e 7461 5b33  erplan = conta[3
+000130e0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000130f0: 2020 6966 2063 6f6e 7461 696e 6572 706c    if containerpl
+00013100: 616e 203d 3d20 706c 616e 3a0a 2020 2020  an == plan:.    
+00013110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013120: 7374 6f70 666f 756e 6420 3d20 5472 7565  stopfound = True
+00013130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013140: 2020 2020 2063 6f6e 742e 7374 6f70 5f63       cont.stop_c
+00013150: 6f6e 7461 696e 6572 286e 616d 6529 0a20  ontainer(name). 
+00013160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013170: 2020 2073 7563 6365 7373 2866 2243 6f6e     success(f"Con
+00013180: 7461 696e 6572 207b 6e61 6d65 7d20 7374  tainer {name} st
+00013190: 6f70 7065 6421 2229 0a20 2020 2020 2020  opped!").       
+000131a0: 2069 6620 7374 6f70 666f 756e 643a 0a20   if stopfound:. 
+000131b0: 2020 2020 2020 2020 2020 2073 7563 6365             succe
+000131c0: 7373 2866 2250 6c61 6e20 7b70 6c61 6e7d  ss(f"Plan {plan}
+000131d0: 2073 746f 7070 6564 2122 290a 2020 2020   stopped!").    
+000131e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000131f0: 2020 2020 2020 7761 726e 696e 6728 224e        warning("N
+00013200: 6f20 6d61 7463 6869 6e67 206f 626a 6563  o matching objec
+00013210: 7473 2066 6f75 6e64 2229 0a20 2020 2020  ts found").     
+00013220: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+00013230: 6c74 273a 2027 7375 6363 6573 7327 7d0a  lt': 'success'}.
+00013240: 0a20 2020 2064 6566 2061 7574 6f73 7461  .    def autosta
+00013250: 7274 5f70 6c61 6e28 7365 6c66 2c20 706c  rt_plan(self, pl
+00013260: 616e 293a 0a20 2020 2020 2020 206b 203d  an):.        k =
+00013270: 2073 656c 662e 6b0a 2020 2020 2020 2020   self.k.        
+00013280: 7070 7269 6e74 2866 2253 6574 2076 6d73  pprint(f"Set vms
+00013290: 2066 726f 6d20 706c 616e 207b 706c 616e   from plan {plan
+000132a0: 7d20 746f 2061 7574 6f73 7461 7274 2229  } to autostart")
+000132b0: 0a20 2020 2020 2020 2066 6f72 2076 6d20  .        for vm 
+000132c0: 696e 2073 6f72 7465 6428 6b2e 6c69 7374  in sorted(k.list
+000132d0: 2829 2c20 6b65 793d 6c61 6d62 6461 2078  (), key=lambda x
+000132e0: 3a20 785b 276e 616d 6527 5d29 3a0a 2020  : x['name']):.  
+000132f0: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
+00013300: 2076 6d5b 276e 616d 6527 5d0a 2020 2020   vm['name'].    
+00013310: 2020 2020 2020 2020 6465 7363 7269 7074          descript
+00013320: 696f 6e20 3d20 766d 5b27 706c 616e 275d  ion = vm['plan']
+00013330: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00013340: 6465 7363 7269 7074 696f 6e20 3d3d 2070  description == p
+00013350: 6c61 6e3a 0a20 2020 2020 2020 2020 2020  lan:.           
+00013360: 2020 2020 206b 2e75 7064 6174 655f 7374       k.update_st
+00013370: 6172 7428 6e61 6d65 2c20 7374 6172 743d  art(name, start=
+00013380: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00013390: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
+000133a0: 7b6e 616d 657d 2073 6574 2074 6f20 6175  {name} set to au
+000133b0: 746f 7374 6172 7421 2229 0a20 2020 2020  tostart!").     
+000133c0: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+000133d0: 6c74 273a 2027 7375 6363 6573 7327 7d0a  lt': 'success'}.
+000133e0: 0a20 2020 2064 6566 206e 6f61 7574 6f73  .    def noautos
+000133f0: 7461 7274 5f70 6c61 6e28 7365 6c66 2c20  tart_plan(self, 
+00013400: 706c 616e 293a 0a20 2020 2020 2020 206b  plan):.        k
+00013410: 203d 2073 656c 662e 6b0a 2020 2020 2020   = self.k.      
+00013420: 2020 7070 7269 6e74 2866 2250 7265 7665    pprint(f"Preve
+00013430: 6e74 696e 6720 766d 7320 6672 6f6d 2070  nting vms from p
+00013440: 6c61 6e20 7b70 6c61 6e7d 2074 6f20 6175  lan {plan} to au
+00013450: 746f 7374 6172 7422 290a 2020 2020 2020  tostart").      
+00013460: 2020 666f 7220 766d 2069 6e20 736f 7274    for vm in sort
+00013470: 6564 286b 2e6c 6973 7428 292c 206b 6579  ed(k.list(), key
+00013480: 3d6c 616d 6264 6120 783a 2078 5b27 6e61  =lambda x: x['na
+00013490: 6d65 275d 293a 0a20 2020 2020 2020 2020  me']):.         
+000134a0: 2020 206e 616d 6520 3d20 766d 5b27 6e61     name = vm['na
+000134b0: 6d65 275d 0a20 2020 2020 2020 2020 2020  me'].           
+000134c0: 2064 6573 6372 6970 7469 6f6e 203d 2076   description = v
+000134d0: 6d5b 2770 6c61 6e27 5d0a 2020 2020 2020  m['plan'].      
+000134e0: 2020 2020 2020 6966 2064 6573 6372 6970        if descrip
+000134f0: 7469 6f6e 203d 3d20 706c 616e 3a0a 2020  tion == plan:.  
+00013500: 2020 2020 2020 2020 2020 2020 2020 6b2e                k.
+00013510: 7570 6461 7465 5f73 7461 7274 286e 616d  update_start(nam
+00013520: 652c 2073 7461 7274 3d46 616c 7365 290a  e, start=False).
+00013530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013540: 7375 6363 6573 7328 6622 7b6e 616d 657d  success(f"{name}
+00013550: 2070 7265 7665 6e74 6564 2074 6f20 6175   prevented to au
+00013560: 746f 7374 6172 7421 2229 0a20 2020 2020  tostart!").     
+00013570: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+00013580: 6c74 273a 2027 7375 6363 6573 7327 7d0a  lt': 'success'}.
+00013590: 0a20 2020 2064 6566 2064 656c 6574 655f  .    def delete_
+000135a0: 706c 616e 2873 656c 662c 2070 6c61 6e2c  plan(self, plan,
+000135b0: 2063 6f6e 7461 696e 6572 3d46 616c 7365   container=False
+000135c0: 2c20 756e 7265 6769 7374 6572 3d46 616c  , unregister=Fal
+000135d0: 7365 293a 0a20 2020 2020 2020 206b 203d  se):.        k =
+000135e0: 2073 656c 662e 6b0a 2020 2020 2020 2020   self.k.        
+000135f0: 6465 6c65 7465 6476 6d73 203d 205b 5d0a  deletedvms = [].
+00013600: 2020 2020 2020 2020 6465 6c65 7465 646c          deletedl
+00013610: 6273 203d 205b 5d0a 2020 2020 2020 2020  bs = [].        
+00013620: 646e 7363 6c69 656e 7473 203d 205b 5d0a  dnsclients = [].
+00013630: 2020 2020 2020 2020 6e65 7477 6f72 6b73          networks
+00013640: 203d 205b 5d0a 2020 2020 2020 2020 6966   = [].        if
+00013650: 2070 6c61 6e20 3d3d 2027 273a 0a20 2020   plan == '':.   
+00013660: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
+00013670: 5468 6174 2077 6f75 6c64 2064 656c 6574  That would delet
+00013680: 6520 6576 6572 7920 766d 2e2e 2e4e 6f74  e every vm...Not
+00013690: 2064 6f69 6e67 2074 6861 7422 290a 2020   doing that").  
+000136a0: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+000136b0: 6974 2831 290a 2020 2020 2020 2020 666f  it(1).        fo
+000136c0: 756e 6420 3d20 4661 6c73 650a 2020 2020  und = False.    
+000136d0: 2020 2020 6465 6c65 7465 636c 6965 6e74      deleteclient
+000136e0: 7320 3d20 7b73 656c 662e 636c 6965 6e74  s = {self.client
+000136f0: 3a20 6b7d 0a20 2020 2020 2020 2076 6d63  : k}.        vmc
+00013700: 6c69 656e 7473 203d 205b 5d0a 2020 2020  lients = [].    
+00013710: 2020 2020 766d 636c 6965 6e74 735f 6669      vmclients_fi
+00013720: 6c65 203d 206f 732e 7061 7468 2e65 7870  le = os.path.exp
+00013730: 616e 6475 7365 7228 6627 7e2f 2e6b 636c  anduser(f'~/.kcl
+00013740: 692f 766d 636c 6965 6e74 735f 7b70 6c61  i/vmclients_{pla
+00013750: 6e7d 2729 0a20 2020 2020 2020 2069 6620  n}').        if 
+00013760: 6f73 2e70 6174 682e 6578 6973 7473 2876  os.path.exists(v
+00013770: 6d63 6c69 656e 7473 5f66 696c 6529 3a0a  mclients_file):.
+00013780: 2020 2020 2020 2020 2020 2020 766d 636c              vmcl
+00013790: 6965 6e74 7320 3d20 7961 6d6c 2e73 6166  ients = yaml.saf
+000137a0: 655f 6c6f 6164 286f 7065 6e28 766d 636c  e_load(open(vmcl
+000137b0: 6965 6e74 735f 6669 6c65 2929 0a20 2020  ients_file)).   
+000137c0: 2020 2020 2020 2020 206f 732e 7265 6d6f           os.remo
+000137d0: 7665 2876 6d63 6c69 656e 7473 5f66 696c  ve(vmclients_fil
+000137e0: 6529 0a20 2020 2020 2020 2069 6620 7365  e).        if se
+000137f0: 6c66 2e65 7874 7261 636c 6965 6e74 733a  lf.extraclients:
+00013800: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
+00013810: 6574 6563 6c69 656e 7473 2e75 7064 6174  eteclients.updat
+00013820: 6528 7365 6c66 2e65 7874 7261 636c 6965  e(self.extraclie
+00013830: 6e74 7329 0a20 2020 2020 2020 2065 6c69  nts).        eli
+00013840: 6620 766d 636c 6965 6e74 733a 0a20 2020  f vmclients:.   
+00013850: 2020 2020 2020 2020 2064 656c 6574 6563           deletec
+00013860: 6c69 656e 7473 2e75 7064 6174 6528 7b63  lients.update({c
+00013870: 6c69 3a20 4b63 6f6e 6669 6728 636c 6965  li: Kconfig(clie
+00013880: 6e74 3d63 6c69 292e 6b20 666f 7220 636c  nt=cli).k for cl
+00013890: 6920 696e 2076 6d63 6c69 656e 7473 2069  i in vmclients i
+000138a0: 6620 636c 6920 213d 2073 656c 662e 636c  f cli != self.cl
+000138b0: 6965 6e74 7d29 0a20 2020 2020 2020 2067  ient}).        g
+000138c0: 6b65 203d 2046 616c 7365 0a20 2020 2020  ke = False.     
+000138d0: 2020 2068 7970 6572 7368 6966 7420 3d20     hypershift = 
+000138e0: 4661 6c73 650a 2020 2020 2020 2020 6173  False.        as
+000138f0: 7369 7374 6564 203d 2046 616c 7365 0a20  sisted = False. 
+00013900: 2020 2020 2020 2063 6c75 7374 6572 6469         clusterdi
+00013910: 7220 3d20 222f 6661 6b65 2f78 7878 220a  r = "/fake/xxx".
+00013920: 2020 2020 2020 2020 666f 7220 6879 7065          for hype
+00013930: 7276 6973 6f72 2069 6e20 6465 6c65 7465  rvisor in delete
+00013940: 636c 6965 6e74 733a 0a20 2020 2020 2020  clients:.       
+00013950: 2020 2020 2063 203d 2064 656c 6574 6563       c = deletec
+00013960: 6c69 656e 7473 5b68 7970 6572 7669 736f  lients[hyperviso
+00013970: 725d 0a20 2020 2020 2020 2020 2020 2066  r].            f
+00013980: 6f72 2076 6d20 696e 2073 6f72 7465 6428  or vm in sorted(
+00013990: 632e 6c69 7374 2829 2c20 6b65 793d 6c61  c.list(), key=la
+000139a0: 6d62 6461 2078 3a20 785b 276e 616d 6527  mbda x: x['name'
+000139b0: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
+000139c0: 2020 2020 6e61 6d65 203d 2076 6d5b 276e      name = vm['n
+000139d0: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
+000139e0: 2020 2020 2020 6465 7363 7269 7074 696f        descriptio
+000139f0: 6e20 3d20 766d 2e67 6574 2827 706c 616e  n = vm.get('plan
+00013a00: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00013a10: 2020 2069 6620 6465 7363 7269 7074 696f     if descriptio
+00013a20: 6e20 3d3d 2070 6c61 6e3a 0a20 2020 2020  n == plan:.     
+00013a30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00013a40: 6620 766d 2e67 6574 2827 6b75 6265 7479  f vm.get('kubety
+00013a50: 7065 272c 2027 6765 6e65 7269 6327 2920  pe', 'generic') 
+00013a60: 3d3d 2027 676b 6527 3a0a 2020 2020 2020  == 'gke':.      
+00013a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a80: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+00013a90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00013aa0: 6620 276c 6f61 6462 616c 616e 6365 7227  f 'loadbalancer'
+00013ab0: 2069 6e20 766d 3a0a 2020 2020 2020 2020   in vm:.        
+00013ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ad0: 6c62 7320 3d20 766d 5b27 6c6f 6164 6261  lbs = vm['loadba
+00013ae0: 6c61 6e63 6572 275d 2e73 706c 6974 2827  lancer'].split('
+00013af0: 2c27 290a 2020 2020 2020 2020 2020 2020  ,').            
+00013b00: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00013b10: 6c62 2069 6e20 6c62 733a 0a20 2020 2020  lb in lbs:.     
+00013b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b30: 2020 2020 2020 2069 6620 6c62 206e 6f74         if lb not
+00013b40: 2069 6e20 6465 6c65 7465 646c 6273 3a0a   in deletedlbs:.
+00013b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b70: 6465 6c65 7465 646c 6273 2e61 7070 656e  deletedlbs.appen
+00013b80: 6428 6c62 290a 2020 2020 2020 2020 2020  d(lb).          
+00013b90: 2020 2020 2020 2020 2020 766d 6e65 7477            vmnetw
+00013ba0: 6f72 6b73 203d 2063 2e76 6d5f 706f 7274  orks = c.vm_port
+00013bb0: 7328 6e61 6d65 290a 2020 2020 2020 2020  s(name).        
+00013bc0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00013bd0: 6e65 7477 6f72 6b20 696e 2076 6d6e 6574  network in vmnet
+00013be0: 776f 726b 733a 0a20 2020 2020 2020 2020  works:.         
+00013bf0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00013c00: 6620 6e65 7477 6f72 6b20 213d 2027 6465  f network != 'de
+00013c10: 6661 756c 7427 2061 6e64 206e 6574 776f  fault' and netwo
+00013c20: 726b 206e 6f74 2069 6e20 6e65 7477 6f72  rk not in networ
+00013c30: 6b73 3a0a 2020 2020 2020 2020 2020 2020  ks:.            
+00013c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c50: 6e65 7477 6f72 6b73 2e61 7070 656e 6428  networks.append(
+00013c60: 6e65 7477 6f72 6b29 0a20 2020 2020 2020  network).       
+00013c70: 2020 2020 2020 2020 2020 2020 2064 6e73               dns
+00013c80: 636c 6965 6e74 2c20 646f 6d61 696e 203d  client, domain =
+00013c90: 2063 2e64 6e73 696e 666f 286e 616d 6529   c.dnsinfo(name)
+00013ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013cb0: 2020 2020 2069 6620 756e 7265 6769 7374       if unregist
+00013cc0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+00013cd0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+00013ce0: 6520 3d20 6b2e 696e 666f 286e 616d 6529  e = k.info(name)
+00013cf0: 2e67 6574 2827 696d 6167 6527 290a 2020  .get('image').  
 00013d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d10: 2020 2020 2020 2073 7368 636d 6420 3d20         sshcmd = 
-00013d20: 7373 6828 6e61 6d65 2c20 6970 3d69 702c  ssh(name, ip=ip,
-00013d30: 2075 7365 723d 2772 6f6f 7427 2c20 7475   user='root', tu
-00013d40: 6e6e 656c 3d73 656c 662e 7475 6e6e 656c  nnel=self.tunnel
-00013d50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00013d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d70: 2020 2020 2020 2020 2020 2074 756e 6e65             tunne
-00013d80: 6c68 6f73 743d 7365 6c66 2e74 756e 6e65  lhost=self.tunne
-00013d90: 6c68 6f73 742c 2074 756e 6e65 6c70 6f72  lhost, tunnelpor
-00013da0: 743d 7365 6c66 2e74 756e 6e65 6c70 6f72  t=self.tunnelpor
-00013db0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+00013d10: 2020 2020 2020 6966 2027 7268 656c 2720        if 'rhel' 
+00013d20: 696e 2069 6d61 6765 3a0a 2020 2020 2020  in image:.      
+00013d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d40: 2020 2020 2020 7070 7269 6e74 2866 2252        pprint(f"R
+00013d50: 656d 6f76 696e 6720 7268 656c 2073 7562  emoving rhel sub
+00013d60: 7363 7269 7074 696f 6e20 666f 7220 7b6e  scription for {n
+00013d70: 616d 657d 2229 0a20 2020 2020 2020 2020  ame}").         
+00013d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d90: 2020 2069 702c 2076 6d70 6f72 7420 3d20     ip, vmport = 
+00013da0: 5f73 7368 5f63 7265 6465 6e74 6961 6c73  _ssh_credentials
+00013db0: 286b 2c20 6e61 6d65 295b 313a 5d0a 2020  (k, name)[1:].  
 00013dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013dd0: 2020 2020 2020 2020 2020 2020 7475 6e6e              tunn
-00013de0: 656c 7573 6572 3d73 656c 662e 7475 6e6e  eluser=self.tunn
-00013df0: 656c 7573 6572 2c20 696e 7365 6375 7265  eluser, insecure
-00013e00: 3d54 7275 652c 2063 6d64 3d63 6d64 2c20  =True, cmd=cmd, 
-00013e10: 766d 706f 7274 3d76 6d70 6f72 7429 0a20  vmport=vmport). 
-00013e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e30: 2020 2020 2020 2020 2020 206f 732e 7379             os.sy
-00013e40: 7374 656d 2873 7368 636d 6429 0a20 2020  stem(sshcmd).   
-00013e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e60: 2063 2e64 656c 6574 6528 6e61 6d65 2c20   c.delete(name, 
-00013e70: 736e 6170 7368 6f74 733d 5472 7565 290a  snapshots=True).
-00013e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e90: 2020 2020 6966 2064 6e73 636c 6965 6e74      if dnsclient
-00013ea0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00013eb0: 2064 6f6d 6169 6e20 6973 206e 6f74 204e   domain is not N
-00013ec0: 6f6e 6520 616e 6420 646e 7363 6c69 656e  one and dnsclien
-00013ed0: 7420 696e 2073 656c 662e 636c 6965 6e74  t in self.client
-00013ee0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00013ef0: 2020 2020 2020 2020 2020 2069 6620 646e             if dn
-00013f00: 7363 6c69 656e 7420 696e 2064 6e73 636c  sclient in dnscl
-00013f10: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
-00013f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f30: 2020 207a 203d 2064 6e73 636c 6965 6e74     z = dnsclient
-00013f40: 735b 646e 7363 6c69 656e 745d 0a20 2020  s[dnsclient].   
-00013f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f60: 2020 2020 2065 6c69 6620 646e 7363 6c69       elif dnscli
-00013f70: 656e 7420 696e 2073 656c 662e 636c 6965  ent in self.clie
-00013f80: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
-00013f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013fa0: 207a 203d 204b 636f 6e66 6967 2863 6c69   z = Kconfig(cli
-00013fb0: 656e 743d 646e 7363 6c69 656e 7429 2e6b  ent=dnsclient).k
-00013fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013fd0: 2020 2020 2020 2020 2020 2020 2064 6e73               dns
-00013fe0: 636c 6965 6e74 735b 646e 7363 6c69 656e  clients[dnsclien
-00013ff0: 745d 203d 207a 0a20 2020 2020 2020 2020  t] = z.         
-00014000: 2020 2020 2020 2020 2020 2020 2020 207a                 z
-00014010: 2e64 656c 6574 655f 646e 7328 646e 7363  .delete_dns(dnsc
-00014020: 6c69 656e 742c 2064 6f6d 6169 6e29 0a20  lient, domain). 
-00014030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014040: 2020 2063 6f6d 6d6f 6e2e 6465 6c65 7465     common.delete
-00014050: 5f6c 6173 7476 6d28 6e61 6d65 2c20 7365  _lastvm(name, se
-00014060: 6c66 2e63 6c69 656e 7429 0a20 2020 2020  lf.client).     
-00014070: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00014080: 7563 6365 7373 2866 227b 6e61 6d65 7d20  uccess(f"{name} 
-00014090: 6465 6c65 7465 6420 6f6e 207b 6879 7065  deleted on {hype
-000140a0: 7276 6973 6f72 7d21 2229 0a20 2020 2020  rvisor}!").     
-000140b0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-000140c0: 656c 6574 6564 766d 732e 6170 7065 6e64  eletedvms.append
-000140d0: 286e 616d 6529 0a20 2020 2020 2020 2020  (name).         
-000140e0: 2020 2020 2020 2020 2020 2066 6f75 6e64             found
-000140f0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00014100: 2020 2020 2020 2020 2020 2020 636c 7573              clus
-00014110: 7465 7220 3d20 766d 2e67 6574 2827 6b75  ter = vm.get('ku
-00014120: 6265 2729 0a20 2020 2020 2020 2020 2020  be').           
-00014130: 2020 2020 2020 2020 2069 6620 636c 7573           if clus
-00014140: 7465 7220 6973 206e 6f74 204e 6f6e 6520  ter is not None 
-00014150: 616e 6420 636c 7573 7465 7220 213d 2027  and cluster != '
-00014160: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00014170: 2020 2020 2020 2020 2020 2063 6c75 7374             clust
-00014180: 6572 6469 7220 3d20 6f73 2e70 6174 682e  erdir = os.path.
-00014190: 6578 7061 6e64 7573 6572 2866 227e 2f2e  expanduser(f"~/.
-000141a0: 6b63 6c69 2f63 6c75 7374 6572 732f 7b63  kcli/clusters/{c
-000141b0: 6c75 7374 6572 7d22 290a 2020 2020 2020  luster}").      
-000141c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141d0: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-000141e0: 7374 7328 636c 7573 7465 7264 6972 293a  sts(clusterdir):
-000141f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014200: 2020 2020 2020 2020 2020 2020 2070 6172               par
-00014210: 616d 6574 6572 7366 696c 6520 3d20 6622  ametersfile = f"
-00014220: 7b63 6c75 7374 6572 6469 727d 2f6b 636c  {clusterdir}/kcl
-00014230: 695f 7061 7261 6d65 7465 7273 2e79 6d6c  i_parameters.yml
-00014240: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00014250: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00014260: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-00014270: 7061 7261 6d65 7465 7273 6669 6c65 293a  parametersfile):
-00014280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142a0: 2077 6974 6820 6f70 656e 2870 6172 616d   with open(param
-000142b0: 6574 6572 7366 696c 6529 2061 7320 663a  etersfile) as f:
+00013dd0: 2020 2020 2020 2020 2020 636d 6420 3d20            cmd = 
+00013de0: 2273 7562 7363 7269 7074 696f 6e2d 6d61  "subscription-ma
+00013df0: 6e61 6765 7220 756e 7265 6769 7374 6572  nager unregister
+00013e00: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00013e10: 2020 2020 2020 2020 2020 2020 2020 7373                ss
+00013e20: 6863 6d64 203d 2073 7368 286e 616d 652c  hcmd = ssh(name,
+00013e30: 2069 703d 6970 2c20 7573 6572 3d27 726f   ip=ip, user='ro
+00013e40: 6f74 272c 2074 756e 6e65 6c3d 7365 6c66  ot', tunnel=self
+00013e50: 2e74 756e 6e65 6c2c 0a20 2020 2020 2020  .tunnel,.       
+00013e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e80: 2020 7475 6e6e 656c 686f 7374 3d73 656c    tunnelhost=sel
+00013e90: 662e 7475 6e6e 656c 686f 7374 2c20 7475  f.tunnelhost, tu
+00013ea0: 6e6e 656c 706f 7274 3d73 656c 662e 7475  nnelport=self.tu
+00013eb0: 6e6e 656c 706f 7274 2c0a 2020 2020 2020  nnelport,.      
+00013ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ee0: 2020 2074 756e 6e65 6c75 7365 723d 7365     tunneluser=se
+00013ef0: 6c66 2e74 756e 6e65 6c75 7365 722c 2069  lf.tunneluser, i
+00013f00: 6e73 6563 7572 653d 5472 7565 2c20 636d  nsecure=True, cm
+00013f10: 643d 636d 642c 2076 6d70 6f72 743d 766d  d=cmd, vmport=vm
+00013f20: 706f 7274 290a 2020 2020 2020 2020 2020  port).          
+00013f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f40: 2020 6f73 2e73 7973 7465 6d28 7373 6863    os.system(sshc
+00013f50: 6d64 290a 2020 2020 2020 2020 2020 2020  md).            
+00013f60: 2020 2020 2020 2020 632e 6465 6c65 7465          c.delete
+00013f70: 286e 616d 652c 2073 6e61 7073 686f 7473  (name, snapshots
+00013f80: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00013f90: 2020 2020 2020 2020 2020 2069 6620 646e             if dn
+00013fa0: 7363 6c69 656e 7420 6973 206e 6f74 204e  sclient is not N
+00013fb0: 6f6e 6520 616e 6420 646f 6d61 696e 2069  one and domain i
+00013fc0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2064  s not None and d
+00013fd0: 6e73 636c 6965 6e74 2069 6e20 7365 6c66  nsclient in self
+00013fe0: 2e63 6c69 656e 7473 3a0a 2020 2020 2020  .clients:.      
+00013ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014000: 2020 6966 2064 6e73 636c 6965 6e74 2069    if dnsclient i
+00014010: 6e20 646e 7363 6c69 656e 7473 3a0a 2020  n dnsclients:.  
+00014020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014030: 2020 2020 2020 2020 2020 7a20 3d20 646e            z = dn
+00014040: 7363 6c69 656e 7473 5b64 6e73 636c 6965  sclients[dnsclie
+00014050: 6e74 5d0a 2020 2020 2020 2020 2020 2020  nt].            
+00014060: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00014070: 2064 6e73 636c 6965 6e74 2069 6e20 7365   dnsclient in se
+00014080: 6c66 2e63 6c69 656e 7473 3a0a 2020 2020  lf.clients:.    
+00014090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000140a0: 2020 2020 2020 2020 7a20 3d20 4b63 6f6e          z = Kcon
+000140b0: 6669 6728 636c 6965 6e74 3d64 6e73 636c  fig(client=dnscl
+000140c0: 6965 6e74 292e 6b0a 2020 2020 2020 2020  ient).k.        
+000140d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000140e0: 2020 2020 646e 7363 6c69 656e 7473 5b64      dnsclients[d
+000140f0: 6e73 636c 6965 6e74 5d20 3d20 7a0a 2020  nsclient] = z.  
+00014100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014110: 2020 2020 2020 7a2e 6465 6c65 7465 5f64        z.delete_d
+00014120: 6e73 2864 6e73 636c 6965 6e74 2c20 646f  ns(dnsclient, do
+00014130: 6d61 696e 290a 2020 2020 2020 2020 2020  main).          
+00014140: 2020 2020 2020 2020 2020 636f 6d6d 6f6e            common
+00014150: 2e64 656c 6574 655f 6c61 7374 766d 286e  .delete_lastvm(n
+00014160: 616d 652c 2073 656c 662e 636c 6965 6e74  ame, self.client
+00014170: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014180: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
+00014190: 7b6e 616d 657d 2064 656c 6574 6564 206f  {name} deleted o
+000141a0: 6e20 7b68 7970 6572 7669 736f 727d 2122  n {hypervisor}!"
+000141b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000141c0: 2020 2020 2020 6465 6c65 7465 6476 6d73        deletedvms
+000141d0: 2e61 7070 656e 6428 6e61 6d65 290a 2020  .append(name).  
+000141e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141f0: 2020 666f 756e 6420 3d20 5472 7565 0a20    found = True. 
+00014200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014210: 2020 2063 6c75 7374 6572 203d 2076 6d2e     cluster = vm.
+00014220: 6765 7428 276b 7562 6527 290a 2020 2020  get('kube').    
+00014230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014240: 6966 2063 6c75 7374 6572 2069 7320 6e6f  if cluster is no
+00014250: 7420 4e6f 6e65 2061 6e64 2063 6c75 7374  t None and clust
+00014260: 6572 2021 3d20 2727 3a0a 2020 2020 2020  er != '':.      
+00014270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014280: 2020 636c 7573 7465 7264 6972 203d 206f    clusterdir = o
+00014290: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
+000142a0: 7228 6622 7e2f 2e6b 636c 692f 636c 7573  r(f"~/.kcli/clus
+000142b0: 7465 7273 2f7b 636c 7573 7465 727d 2229  ters/{cluster}")
 000142c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000142d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142e0: 2020 2020 2063 6c75 7374 6572 6461 7461       clusterdata
-000142f0: 203d 2079 616d 6c2e 7361 6665 5f6c 6f61   = yaml.safe_loa
-00014300: 6428 6629 0a20 2020 2020 2020 2020 2020  d(f).           
-00014310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014320: 2020 2020 2020 2020 206b 7562 6574 7970           kubetyp
-00014330: 6520 3d20 636c 7573 7465 7264 6174 612e  e = clusterdata.
-00014340: 6765 7428 276b 7562 6574 7970 6527 2c20  get('kubetype', 
-00014350: 2767 656e 6572 6963 2729 0a20 2020 2020  'generic').     
-00014360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014370: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00014380: 6620 6b75 6265 7479 7065 203d 3d20 2768  f kubetype == 'h
-00014390: 7970 6572 7368 6966 7427 3a0a 2020 2020  ypershift':.    
-000143a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143c0: 2020 2020 6879 7065 7273 6869 6674 203d      hypershift =
-000143d0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-000143e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143f0: 2020 2020 2020 2020 2020 2020 2020 6173                as
-00014400: 7369 7374 6564 203d 2063 6c75 7374 6572  sisted = cluster
-00014410: 6461 7461 2e67 6574 2861 7373 6973 7465  data.get(assiste
-00014420: 642c 2046 616c 7365 290a 2020 2020 2020  d, False).      
-00014430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014440: 2020 2020 2020 2020 2020 2020 2020 646f                do
-00014450: 6d61 696e 203d 2063 6c75 7374 6572 6461  main = clusterda
-00014460: 7461 2e67 6574 2827 646f 6d61 696e 272c  ta.get('domain',
-00014470: 2064 6f6d 6169 6e29 0a20 2020 2020 2020   domain).       
-00014480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014490: 2020 2020 2020 2020 2020 2020 2064 6e73               dns
-000144a0: 636c 6965 6e74 203d 2063 6c75 7374 6572  client = cluster
-000144b0: 6461 7461 2e67 6574 2827 646e 7363 6c69  data.get('dnscli
-000144c0: 656e 7427 290a 2020 2020 2020 2020 2020  ent').          
-000144d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144e0: 2020 6966 206e 6f74 2068 7970 6572 7368    if not hypersh
-000144f0: 6966 743a 0a20 2020 2020 2020 2020 2020  ift:.           
-00014500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014510: 2020 2020 2070 7072 696e 7428 6622 4465       pprint(f"De
-00014520: 6c65 7469 6e67 2064 6972 6563 746f 7279  leting directory
-00014530: 207b 636c 7573 7465 7264 6972 7d22 290a   {clusterdir}").
+000142d0: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
+000142e0: 6174 682e 6578 6973 7473 2863 6c75 7374  ath.exists(clust
+000142f0: 6572 6469 7229 3a0a 2020 2020 2020 2020  erdir):.        
+00014300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014310: 2020 2020 7061 7261 6d65 7465 7273 6669      parametersfi
+00014320: 6c65 203d 2066 227b 636c 7573 7465 7264  le = f"{clusterd
+00014330: 6972 7d2f 6b63 6c69 5f70 6172 616d 6574  ir}/kcli_paramet
+00014340: 6572 732e 796d 6c22 0a20 2020 2020 2020  ers.yml".       
+00014350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014360: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00014370: 6578 6973 7473 2870 6172 616d 6574 6572  exists(parameter
+00014380: 7366 696c 6529 3a0a 2020 2020 2020 2020  sfile):.        
+00014390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000143a0: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
+000143b0: 6e28 7061 7261 6d65 7465 7273 6669 6c65  n(parametersfile
+000143c0: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
+000143d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000143e0: 2020 2020 2020 2020 2020 2020 636c 7573              clus
+000143f0: 7465 7264 6174 6120 3d20 7961 6d6c 2e73  terdata = yaml.s
+00014400: 6166 655f 6c6f 6164 2866 290a 2020 2020  afe_load(f).    
+00014410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014430: 6b75 6265 7479 7065 203d 2063 6c75 7374  kubetype = clust
+00014440: 6572 6461 7461 2e67 6574 2827 6b75 6265  erdata.get('kube
+00014450: 7479 7065 272c 2027 6765 6e65 7269 6327  type', 'generic'
+00014460: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014480: 2020 2020 2020 6966 206b 7562 6574 7970        if kubetyp
+00014490: 6520 3d3d 2027 6879 7065 7273 6869 6674  e == 'hypershift
+000144a0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+000144b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144c0: 2020 2020 2020 2020 2020 2068 7970 6572             hyper
+000144d0: 7368 6966 7420 3d20 5472 7565 0a20 2020  shift = True.   
+000144e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014500: 2020 2020 2061 7373 6973 7465 6420 3d20       assisted = 
+00014510: 636c 7573 7465 7264 6174 612e 6765 7428  clusterdata.get(
+00014520: 6173 7369 7374 6564 2c20 4661 6c73 6529  assisted, False)
+00014530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00014540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014560: 726d 7472 6565 2863 6c75 7374 6572 6469  rmtree(clusterdi
-00014570: 722c 2069 676e 6f72 655f 6572 726f 7273  r, ignore_errors
-00014580: 3d54 7275 6529 0a20 2020 2020 2020 2069  =True).        i
-00014590: 6620 6879 7065 7273 6869 6674 3a0a 2020  f hypershift:.  
-000145a0: 2020 2020 2020 2020 2020 6b75 6265 636f            kubeco
-000145b0: 6e66 6967 6d67 6d74 203d 2066 227b 636c  nfigmgmt = f"{cl
-000145c0: 7573 7465 7264 6972 7d2f 6b75 6265 636f  usterdir}/kubeco
-000145d0: 6e66 6967 2e6d 676d 7422 0a20 2020 2020  nfig.mgmt".     
-000145e0: 2020 2020 2020 2063 616c 6c28 6627 4b55         call(f'KU
-000145f0: 4245 434f 4e46 4947 3d7b 6b75 6265 636f  BECONFIG={kubeco
-00014600: 6e66 6967 6d67 6d74 7d20 6f63 2064 656c  nfigmgmt} oc del
-00014610: 6574 6520 2d66 207b 636c 7573 7465 7264  ete -f {clusterd
-00014620: 6972 7d2f 6175 746f 6170 7072 6f76 6572  ir}/autoapprover
-00014630: 6372 6f6e 2e79 6d6c 272c 2073 6865 6c6c  cron.yml', shell
-00014640: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-00014650: 2020 2063 616c 6c28 6627 4b55 4245 434f     call(f'KUBECO
-00014660: 4e46 4947 3d7b 6b75 6265 636f 6e66 6967  NFIG={kubeconfig
-00014670: 6d67 6d74 7d20 6f63 2064 656c 6574 6520  mgmt} oc delete 
-00014680: 2d66 207b 636c 7573 7465 7264 6972 7d2f  -f {clusterdir}/
-00014690: 6e6f 6465 706f 6f6c 2e79 616d 6c27 2c20  nodepool.yaml', 
-000146a0: 7368 656c 6c3d 5472 7565 290a 2020 2020  shell=True).    
-000146b0: 2020 2020 2020 2020 6361 6c6c 2866 274b          call(f'K
-000146c0: 5542 4543 4f4e 4649 473d 7b6b 7562 6563  UBECONFIG={kubec
-000146d0: 6f6e 6669 676d 676d 747d 206f 6320 6465  onfigmgmt} oc de
-000146e0: 6c65 7465 202d 6620 7b63 6c75 7374 6572  lete -f {cluster
-000146f0: 6469 727d 2f68 6f73 7465 6463 6c75 7374  dir}/hostedclust
-00014700: 6572 2e79 616d 6c27 2c20 7368 656c 6c3d  er.yaml', shell=
-00014710: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-00014720: 2020 6966 206e 6f74 2061 7373 6973 7465    if not assiste
-00014730: 6420 616e 6420 2827 6261 7265 6d65 7461  d and ('baremeta
-00014740: 6c5f 6973 6f27 2069 6e20 636c 7573 7465  l_iso' in cluste
-00014750: 7264 6174 6120 6f72 2027 6261 7265 6d65  rdata or 'bareme
-00014760: 7461 6c5f 686f 7374 7327 2069 6e20 636c  tal_hosts' in cl
-00014770: 7573 7465 7264 6174 6129 3a0a 2020 2020  usterdata):.    
-00014780: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
-00014790: 2827 4b55 4245 434f 4e46 4947 3d7b 6b75  ('KUBECONFIG={ku
-000147a0: 6265 636f 6e66 6967 6d67 6d74 7d20 6f63  beconfigmgmt} oc
-000147b0: 202d 6e20 6465 6661 756c 7420 6465 6c65   -n default dele
-000147c0: 7465 2061 6c6c 202d 6c20 6170 703d 6874  te all -l app=ht
-000147d0: 7470 642d 6b63 6c69 272c 2073 6865 6c6c  tpd-kcli', shell
-000147e0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-000147f0: 2020 2020 2020 2063 616c 6c28 274b 5542         call('KUB
-00014800: 4543 4f4e 4649 473d 7b6b 7562 6563 6f6e  ECONFIG={kubecon
-00014810: 6669 676d 676d 747d 206f 6320 2d6e 2064  figmgmt} oc -n d
-00014820: 6566 6175 6c74 2064 656c 6574 6520 7376  efault delete sv
-00014830: 6320 6874 7470 642d 6b63 6c69 2d73 7663  c httpd-kcli-svc
-00014840: 272c 2073 6865 6c6c 3d54 7275 6529 0a20  ', shell=True). 
-00014850: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00014860: 616c 6c28 274b 5542 4543 4f4e 4649 473d  all('KUBECONFIG=
-00014870: 7b6b 7562 6563 6f6e 6669 676d 676d 747d  {kubeconfigmgmt}
-00014880: 206f 6320 2d6e 2064 6566 6175 6c74 2064   oc -n default d
-00014890: 656c 6574 6520 7076 6320 6874 7470 642d  elete pvc httpd-
-000148a0: 6b63 6c69 2d70 7663 272c 2073 6865 6c6c  kcli-pvc', shell
-000148b0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-000148c0: 2020 2070 7072 696e 7428 6622 4465 6c65     pprint(f"Dele
-000148d0: 7469 6e67 2064 6972 6563 746f 7279 207b  ting directory {
-000148e0: 636c 7573 7465 7264 6972 7d22 290a 2020  clusterdir}").  
-000148f0: 2020 2020 2020 2020 2020 726d 7472 6565            rmtree
-00014900: 2863 6c75 7374 6572 6469 722c 2069 676e  (clusterdir, ign
-00014910: 6f72 655f 6572 726f 7273 3d54 7275 6529  ore_errors=True)
-00014920: 0a20 2020 2020 2020 2069 6620 636f 6e74  .        if cont
-00014930: 6169 6e65 723a 0a20 2020 2020 2020 2020  ainer:.         
-00014940: 2020 2063 6f6e 7420 3d20 4b63 6f6e 7461     cont = Kconta
-00014950: 696e 6572 636f 6e66 6967 2873 656c 662c  inerconfig(self,
-00014960: 2063 6c69 656e 743d 7365 6c66 2e63 6f6e   client=self.con
-00014970: 7461 696e 6572 636c 6965 6e74 292e 636f  tainerclient).co
-00014980: 6e74 0a20 2020 2020 2020 2020 2020 2066  nt.            f
-00014990: 6f72 2063 6f6e 7461 2069 6e20 736f 7274  or conta in sort
-000149a0: 6564 2863 6f6e 742e 6c69 7374 5f63 6f6e  ed(cont.list_con
-000149b0: 7461 696e 6572 7328 6b29 293a 0a20 2020  tainers(k)):.   
-000149c0: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-000149d0: 6520 3d20 636f 6e74 615b 305d 0a20 2020  e = conta[0].   
-000149e0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-000149f0: 7461 696e 6572 5f70 6c61 6e20 3d20 636f  tainer_plan = co
-00014a00: 6e74 615b 335d 0a20 2020 2020 2020 2020  nta[3].         
-00014a10: 2020 2020 2020 2069 6620 636f 6e74 6169         if contai
-00014a20: 6e65 725f 706c 616e 203d 3d20 706c 616e  ner_plan == plan
-00014a30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014a40: 2020 2020 2020 636f 6e74 2e64 656c 6574        cont.delet
-00014a50: 655f 636f 6e74 6169 6e65 7228 6e61 6d65  e_container(name
-00014a60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014a70: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
-00014a80: 436f 6e74 6169 6e65 7220 7b6e 616d 657d  Container {name}
-00014a90: 2064 656c 6574 6564 2122 290a 2020 2020   deleted!").    
-00014aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ab0: 666f 756e 6420 3d20 5472 7565 0a20 2020  found = True.   
-00014ac0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00014ad0: 2e6b 6565 705f 6e65 7477 6f72 6b73 3a0a  .keep_networks:.
-00014ae0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00014af0: 656c 662e 7479 7065 203d 3d20 276b 766d  elf.type == 'kvm
-00014b00: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00014b10: 2020 206e 6574 776f 726b 7320 3d20 6b2e     networks = k.
-00014b20: 6c69 7374 5f6e 6574 776f 726b 7328 290a  list_networks().
-00014b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b40: 666f 7220 6e65 7477 6f72 6b20 696e 206b  for network in k
-00014b50: 2e6c 6973 745f 6e65 7477 6f72 6b73 2829  .list_networks()
-00014b60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014b70: 2020 2020 2020 6966 2027 706c 616e 2720        if 'plan' 
-00014b80: 696e 206e 6574 776f 726b 735b 6e65 7477  in networks[netw
-00014b90: 6f72 6b5d 2061 6e64 206e 6574 776f 726b  ork] and network
-00014ba0: 735b 6e65 7477 6f72 6b5d 5b27 706c 616e  s[network]['plan
-00014bb0: 275d 203d 3d20 706c 616e 3a0a 2020 2020  '] == plan:.    
-00014bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014bd0: 2020 2020 6e65 7477 6f72 6b72 6573 756c      networkresul
-00014be0: 7420 3d20 6b2e 6465 6c65 7465 5f6e 6574  t = k.delete_net
-00014bf0: 776f 726b 286e 6574 776f 726b 290a 2020  work(network).  
-00014c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c10: 2020 2020 2020 6966 206e 6574 776f 726b        if network
-00014c20: 7265 7375 6c74 5b27 7265 7375 6c74 275d  result['result']
-00014c30: 203d 3d20 2773 7563 6365 7373 273a 0a20   == 'success':. 
-00014c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c50: 2020 2020 2020 2020 2020 2073 7563 6365             succe
-00014c60: 7373 2866 226e 6574 776f 726b 207b 6e65  ss(f"network {ne
-00014c70: 7477 6f72 6b7d 2064 656c 6574 6564 2122  twork} deleted!"
-00014c80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014c90: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00014ca0: 756e 6420 3d20 5472 7565 0a20 2020 2020  und = True.     
-00014cb0: 2020 2020 2020 2065 6c69 6620 6e65 7477         elif netw
-00014cc0: 6f72 6b73 3a0a 2020 2020 2020 2020 2020  orks:.          
-00014cd0: 2020 2020 2020 666f 756e 6420 3d20 5472        found = Tr
-00014ce0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00014cf0: 2020 2066 6f72 206e 6574 776f 726b 2069     for network i
-00014d00: 6e20 6e65 7477 6f72 6b73 3a0a 2020 2020  n networks:.    
-00014d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d20: 6e65 7477 6f72 6b72 6573 756c 7420 3d20  networkresult = 
-00014d30: 6b2e 6465 6c65 7465 5f6e 6574 776f 726b  k.delete_network
-00014d40: 286e 6574 776f 726b 290a 2020 2020 2020  (network).      
-00014d50: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00014d60: 206e 6574 776f 726b 7265 7375 6c74 5b27   networkresult['
-00014d70: 7265 7375 6c74 275d 203d 3d20 2773 7563  result'] == 'suc
-00014d80: 6365 7373 273a 0a20 2020 2020 2020 2020  cess':.         
-00014d90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00014da0: 7563 6365 7373 2866 2255 6e75 7365 6420  uccess(f"Unused 
-00014db0: 6e65 7477 6f72 6b20 7b6e 6574 776f 726b  network {network
-00014dc0: 7d20 6465 6c65 7465 6421 2229 0a20 2020  } deleted!").   
-00014dd0: 2020 2020 2066 6f72 206b 6579 6669 6c65       for keyfile
-00014de0: 2069 6e20 676c 6f62 2e67 6c6f 6228 2225   in glob.glob("%
-00014df0: 732e 6b65 792a 2220 2520 706c 616e 293a  s.key*" % plan):
-00014e00: 0a20 2020 2020 2020 2020 2020 2073 7563  .            suc
-00014e10: 6365 7373 2866 2266 696c 6520 7b6b 6579  cess(f"file {key
-00014e20: 6669 6c65 7d20 6672 6f6d 207b 706c 616e  file} from {plan
-00014e30: 7d20 6465 6c65 7465 6421 2229 0a20 2020  } deleted!").   
-00014e40: 2020 2020 2020 2020 206f 732e 7265 6d6f           os.remo
-00014e50: 7665 286b 6579 6669 6c65 290a 2020 2020  ve(keyfile).    
-00014e60: 2020 2020 666f 7220 616e 7369 626c 6566      for ansiblef
-00014e70: 696c 6520 696e 2067 6c6f 622e 676c 6f62  ile in glob.glob
-00014e80: 2822 2f74 6d70 2f25 732a 696e 762a 2220  ("/tmp/%s*inv*" 
-00014e90: 2520 706c 616e 293a 0a20 2020 2020 2020  % plan):.       
-00014ea0: 2020 2020 2073 7563 6365 7373 2866 2266       success(f"f
-00014eb0: 696c 6520 7b61 6e73 6962 6c65 6669 6c65  ile {ansiblefile
-00014ec0: 7d20 6672 6f6d 207b 706c 616e 7d20 6465  } from {plan} de
-00014ed0: 6c65 7465 6421 2229 0a20 2020 2020 2020  leted!").       
-00014ee0: 2020 2020 206f 732e 7265 6d6f 7665 2861       os.remove(a
-00014ef0: 6e73 6962 6c65 6669 6c65 290a 2020 2020  nsiblefile).    
-00014f00: 2020 2020 6966 2064 656c 6574 6564 6c62      if deletedlb
-00014f10: 7320 616e 6420 7365 6c66 2e74 7970 6520  s and self.type 
-00014f20: 696e 205b 2761 7773 272c 2027 6763 7027  in ['aws', 'gcp'
-00014f30: 5d3a 0a20 2020 2020 2020 2020 2020 2066  ]:.            f
-00014f40: 6f72 206c 6220 696e 2064 656c 6574 6564  or lb in deleted
-00014f50: 6c62 733a 0a20 2020 2020 2020 2020 2020  lbs:.           
-00014f60: 2020 2020 2073 656c 662e 6465 6c65 7465       self.delete
-00014f70: 5f6c 6f61 6462 616c 616e 6365 7228 6c62  _loadbalancer(lb
-00014f80: 290a 2020 2020 2020 2020 6966 2066 6f75  ).        if fou
-00014f90: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
-00014fa0: 7375 6363 6573 7328 6622 506c 616e 207b  success(f"Plan {
-00014fb0: 706c 616e 7d20 6465 6c65 7465 6421 2229  plan} deleted!")
-00014fc0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00014fd0: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
-00014fe0: 7375 6363 6573 7327 2c20 2764 656c 6574  success', 'delet
-00014ff0: 6564 766d 273a 2064 656c 6574 6564 766d  edvm': deletedvm
-00015000: 737d 0a20 2020 2020 2020 2065 6c73 653a  s}.        else:
-00015010: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
-00015020: 6f72 2866 224e 6f20 6f62 6a65 6374 7320  or(f"No objects 
-00015030: 666f 756e 6420 6475 7269 6e67 2064 656c  found during del
-00015040: 6574 696f 6e20 6f66 2070 6c61 6e20 7b70  etion of plan {p
-00015050: 6c61 6e7d 2229 0a20 2020 2020 2020 2020  lan}").         
-00015060: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
-00015070: 6c74 273a 2027 6661 696c 7572 6527 7d0a  lt': 'failure'}.
-00015080: 0a20 2020 2064 6566 2073 6e61 7073 686f  .    def snapsho
-00015090: 745f 706c 616e 2873 656c 662c 2070 6c61  t_plan(self, pla
-000150a0: 6e2c 2073 6e61 7073 686f 746e 616d 653d  n, snapshotname=
-000150b0: 4e6f 6e65 293a 0a20 2020 2020 2020 206b  None):.        k
-000150c0: 203d 2073 656c 662e 6b0a 2020 2020 2020   = self.k.      
-000150d0: 2020 736e 6170 7368 6f74 666f 756e 6420    snapshotfound 
-000150e0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-000150f0: 7070 7269 6e74 2866 2253 6e61 7073 686f  pprint(f"Snapsho
-00015100: 7474 696e 6720 766d 7320 6672 6f6d 2070  tting vms from p
-00015110: 6c61 6e20 7b70 6c61 6e7d 2229 0a20 2020  lan {plan}").   
-00015120: 2020 2020 2069 6620 736e 6170 7368 6f74       if snapshot
-00015130: 6e61 6d65 2069 7320 4e6f 6e65 3a0a 2020  name is None:.  
-00015140: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-00015150: 6728 6622 5573 696e 6720 7b70 6c61 6e7d  g(f"Using {plan}
-00015160: 2061 7320 736e 6170 7368 6f74 206e 616d   as snapshot nam
-00015170: 6520 6173 204e 6f6e 6520 7761 7320 7072  e as None was pr
-00015180: 6f76 6964 6564 2229 0a20 2020 2020 2020  ovided").       
-00015190: 2020 2020 2073 6e61 7073 686f 746e 616d       snapshotnam
-000151a0: 6520 3d20 706c 616e 0a20 2020 2020 2020  e = plan.       
-000151b0: 2066 6f72 2076 6d20 696e 2073 6f72 7465   for vm in sorte
-000151c0: 6428 6b2e 6c69 7374 2829 2c20 6b65 793d  d(k.list(), key=
-000151d0: 6c61 6d62 6461 2078 3a20 785b 276e 616d  lambda x: x['nam
-000151e0: 6527 5d29 3a0a 2020 2020 2020 2020 2020  e']):.          
-000151f0: 2020 6e61 6d65 203d 2076 6d5b 276e 616d    name = vm['nam
-00015200: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
-00015210: 6465 7363 7269 7074 696f 6e20 3d20 766d  description = vm
-00015220: 5b27 706c 616e 275d 0a20 2020 2020 2020  ['plan'].       
-00015230: 2020 2020 2069 6620 6465 7363 7269 7074       if descript
-00015240: 696f 6e20 3d3d 2070 6c61 6e3a 0a20 2020  ion == plan:.   
-00015250: 2020 2020 2020 2020 2020 2020 2073 6e61               sna
-00015260: 7073 686f 7466 6f75 6e64 203d 2054 7275  pshotfound = Tru
-00015270: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00015280: 2020 6b2e 6372 6561 7465 5f73 6e61 7073    k.create_snaps
-00015290: 686f 7428 736e 6170 7368 6f74 6e61 6d65  hot(snapshotname
-000152a0: 2c20 6e61 6d65 290a 2020 2020 2020 2020  , name).        
-000152b0: 2020 2020 2020 2020 7375 6363 6573 7328          success(
-000152c0: 6622 7b6e 616d 657d 2073 6e61 7073 686f  f"{name} snapsho
-000152d0: 7474 6564 2122 290a 2020 2020 2020 2020  tted!").        
-000152e0: 6966 2073 6e61 7073 686f 7466 6f75 6e64  if snapshotfound
-000152f0: 3a0a 2020 2020 2020 2020 2020 2020 7375  :.            su
-00015300: 6363 6573 7328 6622 506c 616e 207b 706c  ccess(f"Plan {pl
-00015310: 616e 7d20 736e 6170 7368 6f74 7465 6421  an} snapshotted!
-00015320: 2229 0a20 2020 2020 2020 2065 6c73 653a  ").        else:
-00015330: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
-00015340: 6e69 6e67 2822 4e6f 206d 6174 6368 696e  ning("No matchin
-00015350: 6720 766d 7320 666f 756e 6422 290a 2020  g vms found").  
-00015360: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
-00015370: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
-00015380: 277d 0a0a 2020 2020 6465 6620 7265 7665  '}..    def reve
-00015390: 7274 5f70 6c61 6e28 7365 6c66 2c20 706c  rt_plan(self, pl
-000153a0: 616e 2c20 736e 6170 7368 6f74 6e61 6d65  an, snapshotname
-000153b0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-000153c0: 6b20 3d20 7365 6c66 2e6b 0a20 2020 2020  k = self.k.     
-000153d0: 2020 2072 6576 6572 7466 6f75 6e64 203d     revertfound =
-000153e0: 2046 616c 7365 0a20 2020 2020 2020 2070   False.        p
-000153f0: 7072 696e 7428 6622 5265 7665 7274 696e  print(f"Revertin
-00015400: 6720 736e 6170 7368 6f74 7320 6f66 2076  g snapshots of v
-00015410: 6d73 2066 726f 6d20 706c 616e 207b 706c  ms from plan {pl
-00015420: 616e 7d22 290a 2020 2020 2020 2020 6966  an}").        if
-00015430: 2073 6e61 7073 686f 746e 616d 6520 6973   snapshotname is
-00015440: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00015450: 2020 2077 6172 6e69 6e67 2866 2255 7369     warning(f"Usi
-00015460: 6e67 207b 706c 616e 7dc2 a061 7320 736e  ng {plan}..as sn
-00015470: 6170 7368 6f74 206e 616d 6520 6173 204e  apshot name as N
-00015480: 6f6e 6520 7761 7320 7072 6f76 6964 6564  one was provided
-00015490: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
-000154a0: 6e61 7073 686f 746e 616d 6520 3d20 706c  napshotname = pl
-000154b0: 616e 0a20 2020 2020 2020 2066 6f72 2076  an.        for v
-000154c0: 6d20 696e 2073 6f72 7465 6428 6b2e 6c69  m in sorted(k.li
-000154d0: 7374 2829 2c20 6b65 793d 6c61 6d62 6461  st(), key=lambda
-000154e0: 2078 3a20 785b 276e 616d 6527 5d29 3a0a   x: x['name']):.
-000154f0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00015500: 203d 2076 6d5b 276e 616d 6527 5d0a 2020   = vm['name'].  
-00015510: 2020 2020 2020 2020 2020 6465 7363 7269            descri
-00015520: 7074 696f 6e20 3d20 766d 5b27 706c 616e  ption = vm['plan
-00015530: 275d 0a20 2020 2020 2020 2020 2020 2069  '].            i
-00015540: 6620 6465 7363 7269 7074 696f 6e20 3d3d  f description ==
-00015550: 2070 6c61 6e3a 0a20 2020 2020 2020 2020   plan:.         
-00015560: 2020 2020 2020 2072 6576 6572 7466 6f75         revertfou
-00015570: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
-00015580: 2020 2020 2020 2020 2020 6b2e 7265 7665            k.reve
-00015590: 7274 5f73 6e61 7073 686f 7428 736e 6170  rt_snapshot(snap
-000155a0: 7368 6f74 6e61 6d65 2c20 6e61 6d65 290a  shotname, name).
-000155b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155c0: 7375 6363 6573 7328 6622 736e 6170 7368  success(f"snapsh
-000155d0: 6f74 206f 6620 7b6e 616d 657d 2072 6576  ot of {name} rev
-000155e0: 6572 7465 6421 2229 0a20 2020 2020 2020  erted!").       
-000155f0: 2069 6620 7265 7665 7274 666f 756e 643a   if revertfound:
-00015600: 0a20 2020 2020 2020 2020 2020 2073 7563  .            suc
-00015610: 6365 7373 2866 2250 6c61 6e20 7b70 6c61  cess(f"Plan {pla
-00015620: 6e7d 2072 6576 6572 7465 6420 7769 7468  n} reverted with
-00015630: 2073 6e61 7073 686f 7420 7b73 6e61 7073   snapshot {snaps
-00015640: 686f 746e 616d 657d 2122 290a 2020 2020  hotname}!").    
-00015650: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00015660: 2020 2020 2020 7761 726e 696e 6728 224e        warning("N
-00015670: 6f20 6d61 7463 6869 6e67 2076 6d73 2066  o matching vms f
-00015680: 6f75 6e64 2229 0a20 2020 2020 2020 2072  ound").        r
-00015690: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-000156a0: 2027 7375 6363 6573 7327 7d0a 0a20 2020   'success'}..   
-000156b0: 2064 6566 2070 6c61 6e28 7365 6c66 2c20   def plan(self, 
-000156c0: 706c 616e 2c20 616e 7369 626c 653d 4661  plan, ansible=Fa
-000156d0: 6c73 652c 2075 726c 3d4e 6f6e 652c 2070  lse, url=None, p
-000156e0: 6174 683d 4e6f 6e65 2c20 636f 6e74 6169  ath=None, contai
-000156f0: 6e65 723d 4661 6c73 652c 2069 6e70 7574  ner=False, input
-00015700: 6669 6c65 3d4e 6f6e 652c 2069 6e70 7574  file=None, input
-00015710: 7374 7269 6e67 3d4e 6f6e 652c 0a20 2020  string=None,.   
-00015720: 2020 2020 2020 2020 2020 6f76 6572 7269            overri
-00015730: 6465 733d 7b7d 2c20 696e 666f 3d46 616c  des={}, info=Fal
-00015740: 7365 2c20 7570 6461 7465 3d46 616c 7365  se, update=False
-00015750: 2c20 656d 6265 6464 6564 3d46 616c 7365  , embedded=False
-00015760: 2c20 646f 776e 6c6f 6164 3d46 616c 7365  , download=False
-00015770: 2c20 7175 6965 743d 4661 6c73 652c 2064  , quiet=False, d
-00015780: 6f63 3d46 616c 7365 2c0a 2020 2020 2020  oc=False,.      
-00015790: 2020 2020 2020 206f 6e6c 7961 7373 6574         onlyasset
-000157a0: 733d 4661 6c73 652c 2070 7265 3d54 7275  s=False, pre=Tru
-000157b0: 652c 2070 6f73 743d 5472 7565 2c20 6578  e, post=True, ex
-000157c0: 636c 7564 6576 6d73 3d5b 5d2c 2062 6173  cludevms=[], bas
-000157d0: 656d 6f64 653d 4661 6c73 652c 2074 6872  emode=False, thr
-000157e0: 6561 6465 643d 4661 6c73 6529 3a0a 2020  eaded=False):.  
-000157f0: 2020 2020 2020 2222 224d 616e 6167 6520        """Manage 
-00015800: 706c 616e 2066 696c 6522 2222 0a20 2020  plan file""".   
-00015810: 2020 2020 206b 203d 2073 656c 662e 6b0a       k = self.k.
-00015820: 2020 2020 2020 2020 6e6f 5f6f 7665 7272          no_overr
-00015830: 6964 6573 203d 206e 6f74 206f 7665 7272  ides = not overr
-00015840: 6964 6573 0a20 2020 2020 2020 2074 6872  ides.        thr
-00015850: 6561 6473 203d 205b 5d0a 2020 2020 2020  eads = [].      
-00015860: 2020 6e65 7776 6d73 203d 205b 5d0a 2020    newvms = [].  
-00015870: 2020 2020 2020 6e65 7761 7373 6574 7320        newassets 
-00015880: 3d20 5b5d 0a20 2020 2020 2020 2066 6169  = [].        fai
-00015890: 6c65 6476 6d73 203d 205b 5d0a 2020 2020  ledvms = [].    
-000158a0: 2020 2020 6578 6973 7469 6e67 766d 7320      existingvms 
-000158b0: 3d20 5b5d 0a20 2020 2020 2020 2061 7379  = [].        asy
-000158c0: 6e63 7761 6974 766d 7320 3d20 5b5d 0a20  ncwaitvms = []. 
-000158d0: 2020 2020 2020 206f 6e66 6c79 203d 204e         onfly = N
-000158e0: 6f6e 650a 2020 2020 2020 2020 746f 636c  one.        tocl
-000158f0: 6561 6e20 3d20 4661 6c73 650a 2020 2020  ean = False.    
-00015900: 2020 2020 6765 7462 6163 6b20 3d20 4661      getback = Fa
-00015910: 6c73 650a 2020 2020 2020 2020 766d 7072  lse.        vmpr
-00015920: 6f66 696c 6573 203d 207b 6b65 793a 2076  ofiles = {key: v
-00015930: 616c 7565 2066 6f72 206b 6579 2c20 7661  alue for key, va
-00015940: 6c75 6520 696e 2073 656c 662e 7072 6f66  lue in self.prof
-00015950: 696c 6573 2e69 7465 6d73 2829 0a20 2020  iles.items().   
-00015960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015970: 2020 2069 6620 2774 7970 6527 206e 6f74     if 'type' not
-00015980: 2069 6e20 7661 6c75 6520 6f72 2076 616c   in value or val
-00015990: 7565 5b27 7479 7065 275d 203d 3d20 2776  ue['type'] == 'v
-000159a0: 6d27 7d0a 2020 2020 2020 2020 636f 6e74  m'}.        cont
-000159b0: 6169 6e65 7270 726f 6669 6c65 7320 3d20  ainerprofiles = 
-000159c0: 7b6b 6579 3a20 7661 6c75 6520 666f 7220  {key: value for 
-000159d0: 6b65 792c 2076 616c 7565 2069 6e20 7365  key, value in se
-000159e0: 6c66 2e70 726f 6669 6c65 732e 6974 656d  lf.profiles.item
-000159f0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-00015a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a10: 2069 6620 2774 7970 6527 2069 6e20 7661   if 'type' in va
-00015a20: 6c75 6520 616e 6420 7661 6c75 655b 2774  lue and value['t
-00015a30: 7970 6527 5d20 3d3d 2027 636f 6e74 6169  ype'] == 'contai
-00015a40: 6e65 7227 7d0a 2020 2020 2020 2020 6966  ner'}.        if
-00015a50: 2070 6c61 6e20 6973 204e 6f6e 653a 0a20   plan is None:. 
-00015a60: 2020 2020 2020 2020 2020 2070 6c61 6e20             plan 
-00015a70: 3d20 6e61 6d65 7574 696c 732e 6765 745f  = nameutils.get_
-00015a80: 7261 6e64 6f6d 5f6e 616d 6528 290a 2020  random_name().  
-00015a90: 2020 2020 2020 6966 2075 726c 2069 7320        if url is 
-00015aa0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00015ab0: 2020 2020 2020 6966 2075 726c 2e73 7461        if url.sta
-00015ac0: 7274 7377 6974 6828 272f 2729 3a0a 2020  rtswith('/'):.  
-00015ad0: 2020 2020 2020 2020 2020 2020 2020 7572                ur
-00015ae0: 6c20 3d20 6622 6669 6c65 3a2f 2f7b 7572  l = f"file://{ur
-00015af0: 6c7d 220a 2020 2020 2020 2020 2020 2020  l}".            
-00015b00: 6966 206e 6f74 2075 726c 2e65 6e64 7377  if not url.endsw
-00015b10: 6974 6828 272e 796d 6c27 293a 0a20 2020  ith('.yml'):.   
-00015b20: 2020 2020 2020 2020 2020 2020 2075 726c               url
-00015b30: 203d 2066 227b 7572 6c7d 2f6b 636c 695f   = f"{url}/kcli_
-00015b40: 706c 616e 2e79 6d6c 220a 2020 2020 2020  plan.yml".      
-00015b50: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-00015b60: 2866 2254 7279 696e 6720 746f 2072 6574  (f"Trying to ret
-00015b70: 7269 6576 6520 7b75 726c 7d22 290a 2020  rieve {url}").  
-00015b80: 2020 2020 2020 2020 2020 696e 7075 7466            inputf
-00015b90: 696c 6520 3d20 6f73 2e70 6174 682e 6261  ile = os.path.ba
-00015ba0: 7365 6e61 6d65 2875 726c 290a 2020 2020  sename(url).    
-00015bb0: 2020 2020 2020 2020 6f6e 666c 7920 3d20          onfly = 
-00015bc0: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
-00015bd0: 7572 6c29 0a20 2020 2020 2020 2020 2020  url).           
-00015be0: 2070 6174 6820 3d20 706c 616e 2069 6620   path = plan if 
-00015bf0: 7061 7468 2069 7320 4e6f 6e65 2065 6c73  path is None els
-00015c00: 6520 7061 7468 0a20 2020 2020 2020 2020  e path.         
-00015c10: 2020 2069 6620 6e6f 7420 7175 6965 743a     if not quiet:
-00015c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015c30: 2070 7072 696e 7428 6622 5265 7472 6965   pprint(f"Retrie
-00015c40: 7669 6e67 2073 7065 6369 6669 6564 2070  ving specified p
-00015c50: 6c61 6e20 6672 6f6d 207b 7572 6c7d 2074  lan from {url} t
-00015c60: 6f20 7b70 6174 687d 2229 0a20 2020 2020  o {path}").     
-00015c70: 2020 2020 2020 2069 6620 636f 6e74 6169         if contai
-00015c80: 6e65 725f 6d6f 6465 2829 3a0a 2020 2020  ner_mode():.    
-00015c90: 2020 2020 2020 2020 2020 2020 7061 7468              path
-00015ca0: 203d 2066 222f 776f 726b 6469 722f 7b70   = f"/workdir/{p
-00015cb0: 6174 687d 220a 2020 2020 2020 2020 2020  ath}".          
-00015cc0: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
-00015cd0: 2e65 7869 7374 7328 7061 7468 293a 0a20  .exists(path):. 
-00015ce0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00015cf0: 6f63 6c65 616e 203d 2054 7275 650a 2020  oclean = True.  
-00015d00: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00015d10: 6d6d 6f6e 2e66 6574 6368 2875 726c 2c20  mmon.fetch(url, 
-00015d20: 7061 7468 290a 2020 2020 2020 2020 2020  path).          
-00015d30: 2020 2020 2020 666f 7220 6465 6661 756c        for defaul
-00015d40: 745f 7061 7261 6d65 7465 725f 6669 6c65  t_parameter_file
-00015d50: 2069 6e20 5b27 2f6b 636c 695f 6465 6661   in ['/kcli_defa
-00015d60: 756c 742e 796d 6c27 2c20 6627 2f7b 706c  ult.yml', f'/{pl
-00015d70: 616e 7d5f 6465 6661 756c 742e 796d 6c27  an}_default.yml'
-00015d80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00015d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015db0: 2022 2f25 735f 6465 6661 756c 7425 7322   "/%s_default%s"
-00015dc0: 2025 206f 732e 7061 7468 2e73 706c 6974   % os.path.split
-00015dd0: 6578 7428 6f73 2e70 6174 682e 6261 7365  ext(os.path.base
-00015de0: 6e61 6d65 2875 726c 2929 5d3a 0a20 2020  name(url))]:.   
-00015df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e00: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00015e10: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00015e20: 6d6d 6f6e 2e66 6574 6368 286f 732e 7061  mmon.fetch(os.pa
-00015e30: 7468 2e64 6972 6e61 6d65 2875 726c 2920  th.dirname(url) 
-00015e40: 2b20 6465 6661 756c 745f 7061 7261 6d65  + default_parame
-00015e50: 7465 725f 6669 6c65 2c20 7061 7468 290a  ter_file, path).
-00015e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e70: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
-00015e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e90: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-00015ea0: 2020 2020 2065 6c69 6620 646f 776e 6c6f       elif downlo
-00015eb0: 6164 3a0a 2020 2020 2020 2020 2020 2020  ad:.            
-00015ec0: 2020 2020 6d73 6720 3d20 6622 7461 7267      msg = f"targ
-00015ed0: 6574 2064 6972 6563 746f 7279 207b 7061  et directory {pa
-00015ee0: 7468 7d20 616c 7265 6164 7920 7468 6572  th} already ther
-00015ef0: 6522 0a20 2020 2020 2020 2020 2020 2020  e".             
-00015f00: 2020 2065 7272 6f72 286d 7367 290a 2020     error(msg).  
-00015f10: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00015f20: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
-00015f30: 2766 6169 6c75 7265 272c 2027 7265 6173  'failure', 'reas
-00015f40: 6f6e 273a 206d 7367 7d0a 2020 2020 2020  on': msg}.      
-00015f50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00015f60: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-00015f70: 6e74 2866 2255 7369 6e67 2065 7869 7374  nt(f"Using exist
-00015f80: 696e 6720 6469 7265 6374 6f72 7920 7b70  ing directory {p
-00015f90: 6174 687d 2229 0a20 2020 2020 2020 2020  ath}").         
-00015fa0: 2020 2069 6620 646f 776e 6c6f 6164 3a0a     if download:.
-00015fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015fc0: 696e 7075 7466 696c 6520 3d20 6622 7b70  inputfile = f"{p
-00015fd0: 6174 687d 2f7b 696e 7075 7466 696c 657d  ath}/{inputfile}
-00015fe0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00015ff0: 2020 656e 7472 6965 732c 206f 7665 7272    entries, overr
-00016000: 6964 6573 2c20 6261 7365 6669 6c65 2c20  ides, basefile, 
-00016010: 6261 7365 6469 7220 3d20 7365 6c66 2e70  basedir = self.p
-00016020: 726f 6365 7373 5f69 6e70 7574 6669 6c65  rocess_inputfile
-00016030: 2870 6c61 6e2c 2069 6e70 7574 6669 6c65  (plan, inputfile
-00016040: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
-00016050: 7269 6465 732c 0a20 2020 2020 2020 2020  rides,.         
-00016060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014550: 2020 2020 2064 6f6d 6169 6e20 3d20 636c       domain = cl
+00014560: 7573 7465 7264 6174 612e 6765 7428 2764  usterdata.get('d
+00014570: 6f6d 6169 6e27 2c20 646f 6d61 696e 290a  omain', domain).
+00014580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145a0: 2020 2020 646e 7363 6c69 656e 7420 3d20      dnsclient = 
+000145b0: 636c 7573 7465 7264 6174 612e 6765 7428  clusterdata.get(
+000145c0: 2764 6e73 636c 6965 6e74 2729 0a20 2020  'dnsclient').   
+000145d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145f0: 2067 6b65 203d 206b 7562 6574 7970 6520   gke = kubetype 
+00014600: 3d3d 2027 676b 6527 0a20 2020 2020 2020  == 'gke'.       
+00014610: 2069 6620 6879 7065 7273 6869 6674 3a0a   if hypershift:.
+00014620: 2020 2020 2020 2020 2020 2020 6b75 6265              kube
+00014630: 636f 6e66 6967 6d67 6d74 203d 2066 227b  configmgmt = f"{
+00014640: 636c 7573 7465 7264 6972 7d2f 6b75 6265  clusterdir}/kube
+00014650: 636f 6e66 6967 2e6d 676d 7422 0a20 2020  config.mgmt".   
+00014660: 2020 2020 2020 2020 2063 616c 6c28 6627           call(f'
+00014670: 4b55 4245 434f 4e46 4947 3d7b 6b75 6265  KUBECONFIG={kube
+00014680: 636f 6e66 6967 6d67 6d74 7d20 6f63 2064  configmgmt} oc d
+00014690: 656c 6574 6520 2d66 207b 636c 7573 7465  elete -f {cluste
+000146a0: 7264 6972 7d2f 6175 746f 6170 7072 6f76  rdir}/autoapprov
+000146b0: 6572 6372 6f6e 2e79 6d6c 272c 2073 6865  ercron.yml', she
+000146c0: 6c6c 3d54 7275 6529 0a20 2020 2020 2020  ll=True).       
+000146d0: 2020 2020 2063 616c 6c28 6627 4b55 4245       call(f'KUBE
+000146e0: 434f 4e46 4947 3d7b 6b75 6265 636f 6e66  CONFIG={kubeconf
+000146f0: 6967 6d67 6d74 7d20 6f63 2064 656c 6574  igmgmt} oc delet
+00014700: 6520 2d66 207b 636c 7573 7465 7264 6972  e -f {clusterdir
+00014710: 7d2f 6e6f 6465 706f 6f6c 2e79 616d 6c27  }/nodepool.yaml'
+00014720: 2c20 7368 656c 6c3d 5472 7565 290a 2020  , shell=True).  
+00014730: 2020 2020 2020 2020 2020 6361 6c6c 2866            call(f
+00014740: 274b 5542 4543 4f4e 4649 473d 7b6b 7562  'KUBECONFIG={kub
+00014750: 6563 6f6e 6669 676d 676d 747d 206f 6320  econfigmgmt} oc 
+00014760: 6465 6c65 7465 202d 6620 7b63 6c75 7374  delete -f {clust
+00014770: 6572 6469 727d 2f68 6f73 7465 6463 6c75  erdir}/hostedclu
+00014780: 7374 6572 2e79 616d 6c27 2c20 7368 656c  ster.yaml', shel
+00014790: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
+000147a0: 2020 2020 6966 206e 6f74 2061 7373 6973      if not assis
+000147b0: 7465 6420 616e 6420 2827 6261 7265 6d65  ted and ('bareme
+000147c0: 7461 6c5f 6973 6f27 2069 6e20 636c 7573  tal_iso' in clus
+000147d0: 7465 7264 6174 6120 6f72 2027 6261 7265  terdata or 'bare
+000147e0: 6d65 7461 6c5f 686f 7374 7327 2069 6e20  metal_hosts' in 
+000147f0: 636c 7573 7465 7264 6174 6129 3a0a 2020  clusterdata):.  
+00014800: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+00014810: 6c6c 2827 4b55 4245 434f 4e46 4947 3d7b  ll('KUBECONFIG={
+00014820: 6b75 6265 636f 6e66 6967 6d67 6d74 7d20  kubeconfigmgmt} 
+00014830: 6f63 202d 6e20 6465 6661 756c 7420 6465  oc -n default de
+00014840: 6c65 7465 2061 6c6c 202d 6c20 6170 703d  lete all -l app=
+00014850: 6874 7470 642d 6b63 6c69 272c 2073 6865  httpd-kcli', she
+00014860: 6c6c 3d54 7275 6529 0a20 2020 2020 2020  ll=True).       
+00014870: 2020 2020 2020 2020 2063 616c 6c28 274b           call('K
+00014880: 5542 4543 4f4e 4649 473d 7b6b 7562 6563  UBECONFIG={kubec
+00014890: 6f6e 6669 676d 676d 747d 206f 6320 2d6e  onfigmgmt} oc -n
+000148a0: 2064 6566 6175 6c74 2064 656c 6574 6520   default delete 
+000148b0: 7376 6320 6874 7470 642d 6b63 6c69 2d73  svc httpd-kcli-s
+000148c0: 7663 272c 2073 6865 6c6c 3d54 7275 6529  vc', shell=True)
+000148d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000148e0: 2063 616c 6c28 274b 5542 4543 4f4e 4649   call('KUBECONFI
+000148f0: 473d 7b6b 7562 6563 6f6e 6669 676d 676d  G={kubeconfigmgm
+00014900: 747d 206f 6320 2d6e 2064 6566 6175 6c74  t} oc -n default
+00014910: 2064 656c 6574 6520 7076 6320 6874 7470   delete pvc http
+00014920: 642d 6b63 6c69 2d70 7663 272c 2073 6865  d-kcli-pvc', she
+00014930: 6c6c 3d54 7275 6529 0a20 2020 2020 2020  ll=True).       
+00014940: 2069 6620 676b 653a 0a20 2020 2020 2020   if gke:.       
+00014950: 2020 2020 2067 6370 636c 6965 6e74 203d       gcpclient =
+00014960: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+00014970: 2020 6966 2027 636c 6965 6e74 2720 696e    if 'client' in
+00014980: 2063 6c75 7374 6572 6461 7461 3a0a 2020   clusterdata:.  
+00014990: 2020 2020 2020 2020 2020 2020 2020 6763                gc
+000149a0: 7063 6c69 656e 7420 3d20 636c 7573 7465  pclient = cluste
+000149b0: 7264 6174 615b 2763 6c69 656e 7427 5d0a  rdata['client'].
+000149c0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000149d0: 2073 656c 662e 7479 7065 203d 3d20 2767   self.type == 'g
+000149e0: 6b65 273a 0a20 2020 2020 2020 2020 2020  ke':.           
+000149f0: 2020 2020 2067 6370 636c 6965 6e74 203d       gcpclient =
+00014a00: 2073 656c 662e 636c 6965 6e74 0a20 2020   self.client.   
+00014a10: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00014a20: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00014a30: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+00014a40: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
+00014a50: 736f 6e27 3a20 2244 656c 6574 696e 6720  son': "Deleting 
+00014a60: 676b 6520 636c 7573 7465 7220 7265 7175  gke cluster requ
+00014a70: 6972 6573 2074 6f20 696e 7374 616e 7469  ires to instanti
+00014a80: 6174 6520 6763 7020 7072 6f76 6964 6572  ate gcp provider
+00014a90: 227d 0a20 2020 2020 2020 2020 2020 2066  "}.            f
+00014aa0: 726f 6d20 6b76 6972 742e 636c 7573 7465  rom kvirt.cluste
+00014ab0: 7220 696d 706f 7274 2067 6b65 0a20 2020  r import gke.   
+00014ac0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00014ad0: 636f 6e66 6967 203d 204b 636f 6e66 6967  config = Kconfig
+00014ae0: 2863 6c69 656e 743d 6763 7063 6c69 656e  (client=gcpclien
+00014af0: 7429 2e6b 2069 6620 6763 7063 6c69 656e  t).k if gcpclien
+00014b00: 7420 213d 2073 656c 662e 636c 6965 6e74  t != self.client
+00014b10: 2065 6c73 6520 7365 6c66 0a20 2020 2020   else self.     
+00014b20: 2020 2020 2020 207a 6f6e 616c 203d 2063         zonal = c
+00014b30: 6c75 7374 6572 6461 7461 2e67 6574 2827  lusterdata.get('
+00014b40: 7a6f 6e61 6c27 2c20 5472 7565 290a 2020  zonal', True).  
+00014b50: 2020 2020 2020 2020 2020 676b 652e 6465            gke.de
+00014b60: 6c65 7465 2863 7572 7265 6e74 636f 6e66  lete(currentconf
+00014b70: 6967 2c20 636c 7573 7465 722c 207a 6f6e  ig, cluster, zon
+00014b80: 616c 290a 2020 2020 2020 2020 6966 206f  al).        if o
+00014b90: 732e 7061 7468 2e65 7869 7374 7328 636c  s.path.exists(cl
+00014ba0: 7573 7465 7264 6972 293a 0a20 2020 2020  usterdir):.     
+00014bb0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+00014bc0: 4465 6c65 7469 6e67 2064 6972 6563 746f  Deleting directo
+00014bd0: 7279 207b 636c 7573 7465 7264 6972 7d22  ry {clusterdir}"
+00014be0: 290a 2020 2020 2020 2020 2020 2020 726d  ).            rm
+00014bf0: 7472 6565 2863 6c75 7374 6572 6469 722c  tree(clusterdir,
+00014c00: 2069 676e 6f72 655f 6572 726f 7273 3d54   ignore_errors=T
+00014c10: 7275 6529 0a20 2020 2020 2020 2069 6620  rue).        if 
+00014c20: 636f 6e74 6169 6e65 723a 0a20 2020 2020  container:.     
+00014c30: 2020 2020 2020 2063 6f6e 7420 3d20 4b63         cont = Kc
+00014c40: 6f6e 7461 696e 6572 636f 6e66 6967 2873  ontainerconfig(s
+00014c50: 656c 662c 2063 6c69 656e 743d 7365 6c66  elf, client=self
+00014c60: 2e63 6f6e 7461 696e 6572 636c 6965 6e74  .containerclient
+00014c70: 292e 636f 6e74 0a20 2020 2020 2020 2020  ).cont.         
+00014c80: 2020 2066 6f72 2063 6f6e 7461 2069 6e20     for conta in 
+00014c90: 736f 7274 6564 2863 6f6e 742e 6c69 7374  sorted(cont.list
+00014ca0: 5f63 6f6e 7461 696e 6572 7328 6b29 293a  _containers(k)):
+00014cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014cc0: 206e 616d 6520 3d20 636f 6e74 615b 305d   name = conta[0]
+00014cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014ce0: 2063 6f6e 7461 696e 6572 5f70 6c61 6e20   container_plan 
+00014cf0: 3d20 636f 6e74 615b 335d 0a20 2020 2020  = conta[3].     
+00014d00: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+00014d10: 6e74 6169 6e65 725f 706c 616e 203d 3d20  ntainer_plan == 
+00014d20: 706c 616e 3a0a 2020 2020 2020 2020 2020  plan:.          
+00014d30: 2020 2020 2020 2020 2020 636f 6e74 2e64            cont.d
+00014d40: 656c 6574 655f 636f 6e74 6169 6e65 7228  elete_container(
+00014d50: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+00014d60: 2020 2020 2020 2020 2020 7375 6363 6573            succes
+00014d70: 7328 6622 436f 6e74 6169 6e65 7220 7b6e  s(f"Container {n
+00014d80: 616d 657d 2064 656c 6574 6564 2122 290a  ame} deleted!").
+00014d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014da0: 2020 2020 666f 756e 6420 3d20 5472 7565      found = True
+00014db0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00014dc0: 7365 6c66 2e6b 6565 705f 6e65 7477 6f72  self.keep_networ
+00014dd0: 6b73 3a0a 2020 2020 2020 2020 2020 2020  ks:.            
+00014de0: 6966 2073 656c 662e 7479 7065 203d 3d20  if self.type == 
+00014df0: 276b 766d 273a 0a20 2020 2020 2020 2020  'kvm':.         
+00014e00: 2020 2020 2020 206e 6574 776f 726b 7320         networks 
+00014e10: 3d20 6b2e 6c69 7374 5f6e 6574 776f 726b  = k.list_network
+00014e20: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+00014e30: 2020 2020 666f 7220 6e65 7477 6f72 6b20      for network 
+00014e40: 696e 206b 2e6c 6973 745f 6e65 7477 6f72  in k.list_networ
+00014e50: 6b73 2829 3a0a 2020 2020 2020 2020 2020  ks():.          
+00014e60: 2020 2020 2020 2020 2020 6966 2027 706c            if 'pl
+00014e70: 616e 2720 696e 206e 6574 776f 726b 735b  an' in networks[
+00014e80: 6e65 7477 6f72 6b5d 2061 6e64 206e 6574  network] and net
+00014e90: 776f 726b 735b 6e65 7477 6f72 6b5d 5b27  works[network]['
+00014ea0: 706c 616e 275d 203d 3d20 706c 616e 3a0a  plan'] == plan:.
+00014eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ec0: 2020 2020 2020 2020 6e65 7477 6f72 6b72          networkr
+00014ed0: 6573 756c 7420 3d20 6b2e 6465 6c65 7465  esult = k.delete
+00014ee0: 5f6e 6574 776f 726b 286e 6574 776f 726b  _network(network
+00014ef0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014f00: 2020 2020 2020 2020 2020 6966 206e 6574            if net
+00014f10: 776f 726b 7265 7375 6c74 5b27 7265 7375  workresult['resu
+00014f20: 6c74 275d 203d 3d20 2773 7563 6365 7373  lt'] == 'success
+00014f30: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+00014f40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00014f50: 7563 6365 7373 2866 226e 6574 776f 726b  uccess(f"network
+00014f60: 207b 6e65 7477 6f72 6b7d 2064 656c 6574   {network} delet
+00014f70: 6564 2122 290a 2020 2020 2020 2020 2020  ed!").          
+00014f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f90: 2020 666f 756e 6420 3d20 5472 7565 0a20    found = True. 
+00014fa0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00014fb0: 6e65 7477 6f72 6b73 3a0a 2020 2020 2020  networks:.      
+00014fc0: 2020 2020 2020 2020 2020 666f 756e 6420            found 
+00014fd0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00014fe0: 2020 2020 2020 2066 6f72 206e 6574 776f         for netwo
+00014ff0: 726b 2069 6e20 6e65 7477 6f72 6b73 3a0a  rk in networks:.
+00015000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015010: 2020 2020 6e65 7477 6f72 6b72 6573 756c      networkresul
+00015020: 7420 3d20 6b2e 6465 6c65 7465 5f6e 6574  t = k.delete_net
+00015030: 776f 726b 286e 6574 776f 726b 290a 2020  work(network).  
+00015040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015050: 2020 6966 206e 6574 776f 726b 7265 7375    if networkresu
+00015060: 6c74 5b27 7265 7375 6c74 275d 203d 3d20  lt['result'] == 
+00015070: 2773 7563 6365 7373 273a 0a20 2020 2020  'success':.     
+00015080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015090: 2020 2073 7563 6365 7373 2866 2255 6e75     success(f"Unu
+000150a0: 7365 6420 6e65 7477 6f72 6b20 7b6e 6574  sed network {net
+000150b0: 776f 726b 7d20 6465 6c65 7465 6421 2229  work} deleted!")
+000150c0: 0a20 2020 2020 2020 2066 6f72 206b 6579  .        for key
+000150d0: 6669 6c65 2069 6e20 676c 6f62 2e67 6c6f  file in glob.glo
+000150e0: 6228 2225 732e 6b65 792a 2220 2520 706c  b("%s.key*" % pl
+000150f0: 616e 293a 0a20 2020 2020 2020 2020 2020  an):.           
+00015100: 2073 7563 6365 7373 2866 2266 696c 6520   success(f"file 
+00015110: 7b6b 6579 6669 6c65 7d20 6672 6f6d 207b  {keyfile} from {
+00015120: 706c 616e 7d20 6465 6c65 7465 6421 2229  plan} deleted!")
+00015130: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
+00015140: 7265 6d6f 7665 286b 6579 6669 6c65 290a  remove(keyfile).
+00015150: 2020 2020 2020 2020 666f 7220 616e 7369          for ansi
+00015160: 626c 6566 696c 6520 696e 2067 6c6f 622e  blefile in glob.
+00015170: 676c 6f62 2822 2f74 6d70 2f25 732a 696e  glob("/tmp/%s*in
+00015180: 762a 2220 2520 706c 616e 293a 0a20 2020  v*" % plan):.   
+00015190: 2020 2020 2020 2020 2073 7563 6365 7373           success
+000151a0: 2866 2266 696c 6520 7b61 6e73 6962 6c65  (f"file {ansible
+000151b0: 6669 6c65 7d20 6672 6f6d 207b 706c 616e  file} from {plan
+000151c0: 7d20 6465 6c65 7465 6421 2229 0a20 2020  } deleted!").   
+000151d0: 2020 2020 2020 2020 206f 732e 7265 6d6f           os.remo
+000151e0: 7665 2861 6e73 6962 6c65 6669 6c65 290a  ve(ansiblefile).
+000151f0: 2020 2020 2020 2020 6966 2064 656c 6574          if delet
+00015200: 6564 6c62 7320 616e 6420 7365 6c66 2e74  edlbs and self.t
+00015210: 7970 6520 696e 205b 2761 7773 272c 2027  ype in ['aws', '
+00015220: 6763 7027 5d3a 0a20 2020 2020 2020 2020  gcp']:.         
+00015230: 2020 2066 6f72 206c 6220 696e 2064 656c     for lb in del
+00015240: 6574 6564 6c62 733a 0a20 2020 2020 2020  etedlbs:.       
+00015250: 2020 2020 2020 2020 2073 656c 662e 6465           self.de
+00015260: 6c65 7465 5f6c 6f61 6462 616c 616e 6365  lete_loadbalance
+00015270: 7228 6c62 290a 2020 2020 2020 2020 6966  r(lb).        if
+00015280: 2066 6f75 6e64 3a0a 2020 2020 2020 2020   found:.        
+00015290: 2020 2020 7375 6363 6573 7328 6622 506c      success(f"Pl
+000152a0: 616e 207b 706c 616e 7d20 6465 6c65 7465  an {plan} delete
+000152b0: 6421 2229 0a20 2020 2020 2020 2020 2020  d!").           
+000152c0: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
+000152d0: 273a 2027 7375 6363 6573 7327 2c20 2764  ': 'success', 'd
+000152e0: 656c 6574 6564 766d 273a 2064 656c 6574  eletedvm': delet
+000152f0: 6564 766d 737d 0a20 2020 2020 2020 2065  edvms}.        e
+00015300: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00015310: 2065 7272 6f72 2866 224e 6f20 6f62 6a65   error(f"No obje
+00015320: 6374 7320 666f 756e 6420 6475 7269 6e67  cts found during
+00015330: 2064 656c 6574 696f 6e20 6f66 2070 6c61   deletion of pla
+00015340: 6e20 7b70 6c61 6e7d 2229 0a20 2020 2020  n {plan}").     
+00015350: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
+00015360: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
+00015370: 6527 7d0a 0a20 2020 2064 6566 2073 6e61  e'}..    def sna
+00015380: 7073 686f 745f 706c 616e 2873 656c 662c  pshot_plan(self,
+00015390: 2070 6c61 6e2c 2073 6e61 7073 686f 746e   plan, snapshotn
+000153a0: 616d 653d 4e6f 6e65 293a 0a20 2020 2020  ame=None):.     
+000153b0: 2020 206b 203d 2073 656c 662e 6b0a 2020     k = self.k.  
+000153c0: 2020 2020 2020 736e 6170 7368 6f74 666f        snapshotfo
+000153d0: 756e 6420 3d20 4661 6c73 650a 2020 2020  und = False.    
+000153e0: 2020 2020 7070 7269 6e74 2866 2253 6e61      pprint(f"Sna
+000153f0: 7073 686f 7474 696e 6720 766d 7320 6672  pshotting vms fr
+00015400: 6f6d 2070 6c61 6e20 7b70 6c61 6e7d 2229  om plan {plan}")
+00015410: 0a20 2020 2020 2020 2069 6620 736e 6170  .        if snap
+00015420: 7368 6f74 6e61 6d65 2069 7320 4e6f 6e65  shotname is None
+00015430: 3a0a 2020 2020 2020 2020 2020 2020 7761  :.            wa
+00015440: 726e 696e 6728 6622 5573 696e 6720 7b70  rning(f"Using {p
+00015450: 6c61 6e7d 2061 7320 736e 6170 7368 6f74  lan} as snapshot
+00015460: 206e 616d 6520 6173 204e 6f6e 6520 7761   name as None wa
+00015470: 7320 7072 6f76 6964 6564 2229 0a20 2020  s provided").   
+00015480: 2020 2020 2020 2020 2073 6e61 7073 686f           snapsho
+00015490: 746e 616d 6520 3d20 706c 616e 0a20 2020  tname = plan.   
+000154a0: 2020 2020 2066 6f72 2076 6d20 696e 2073       for vm in s
+000154b0: 6f72 7465 6428 6b2e 6c69 7374 2829 2c20  orted(k.list(), 
+000154c0: 6b65 793d 6c61 6d62 6461 2078 3a20 785b  key=lambda x: x[
+000154d0: 276e 616d 6527 5d29 3a0a 2020 2020 2020  'name']):.      
+000154e0: 2020 2020 2020 6e61 6d65 203d 2076 6d5b        name = vm[
+000154f0: 276e 616d 6527 5d0a 2020 2020 2020 2020  'name'].        
+00015500: 2020 2020 6465 7363 7269 7074 696f 6e20      description 
+00015510: 3d20 766d 5b27 706c 616e 275d 0a20 2020  = vm['plan'].   
+00015520: 2020 2020 2020 2020 2069 6620 6465 7363           if desc
+00015530: 7269 7074 696f 6e20 3d3d 2070 6c61 6e3a  ription == plan:
+00015540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015550: 2073 6e61 7073 686f 7466 6f75 6e64 203d   snapshotfound =
+00015560: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+00015570: 2020 2020 2020 6b2e 6372 6561 7465 5f73        k.create_s
+00015580: 6e61 7073 686f 7428 736e 6170 7368 6f74  napshot(snapshot
+00015590: 6e61 6d65 2c20 6e61 6d65 290a 2020 2020  name, name).    
+000155a0: 2020 2020 2020 2020 2020 2020 7375 6363              succ
+000155b0: 6573 7328 6622 7b6e 616d 657d 2073 6e61  ess(f"{name} sna
+000155c0: 7073 686f 7474 6564 2122 290a 2020 2020  pshotted!").    
+000155d0: 2020 2020 6966 2073 6e61 7073 686f 7466      if snapshotf
+000155e0: 6f75 6e64 3a0a 2020 2020 2020 2020 2020  ound:.          
+000155f0: 2020 7375 6363 6573 7328 6622 506c 616e    success(f"Plan
+00015600: 207b 706c 616e 7d20 736e 6170 7368 6f74   {plan} snapshot
+00015610: 7465 6421 2229 0a20 2020 2020 2020 2065  ted!").        e
+00015620: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00015630: 2077 6172 6e69 6e67 2822 4e6f 206d 6174   warning("No mat
+00015640: 6368 696e 6720 766d 7320 666f 756e 6422  ching vms found"
+00015650: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00015660: 207b 2772 6573 756c 7427 3a20 2773 7563   {'result': 'suc
+00015670: 6365 7373 277d 0a0a 2020 2020 6465 6620  cess'}..    def 
+00015680: 7265 7665 7274 5f70 6c61 6e28 7365 6c66  revert_plan(self
+00015690: 2c20 706c 616e 2c20 736e 6170 7368 6f74  , plan, snapshot
+000156a0: 6e61 6d65 3d4e 6f6e 6529 3a0a 2020 2020  name=None):.    
+000156b0: 2020 2020 6b20 3d20 7365 6c66 2e6b 0a20      k = self.k. 
+000156c0: 2020 2020 2020 2072 6576 6572 7466 6f75         revertfou
+000156d0: 6e64 203d 2046 616c 7365 0a20 2020 2020  nd = False.     
+000156e0: 2020 2070 7072 696e 7428 6622 5265 7665     pprint(f"Reve
+000156f0: 7274 696e 6720 736e 6170 7368 6f74 7320  rting snapshots 
+00015700: 6f66 2076 6d73 2066 726f 6d20 706c 616e  of vms from plan
+00015710: 207b 706c 616e 7d22 290a 2020 2020 2020   {plan}").      
+00015720: 2020 6966 2073 6e61 7073 686f 746e 616d    if snapshotnam
+00015730: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+00015740: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
+00015750: 2255 7369 6e67 207b 706c 616e 7dc2 a061  "Using {plan}..a
+00015760: 7320 736e 6170 7368 6f74 206e 616d 6520  s snapshot name 
+00015770: 6173 204e 6f6e 6520 7761 7320 7072 6f76  as None was prov
+00015780: 6964 6564 2229 0a20 2020 2020 2020 2020  ided").         
+00015790: 2020 2073 6e61 7073 686f 746e 616d 6520     snapshotname 
+000157a0: 3d20 706c 616e 0a20 2020 2020 2020 2066  = plan.        f
+000157b0: 6f72 2076 6d20 696e 2073 6f72 7465 6428  or vm in sorted(
+000157c0: 6b2e 6c69 7374 2829 2c20 6b65 793d 6c61  k.list(), key=la
+000157d0: 6d62 6461 2078 3a20 785b 276e 616d 6527  mbda x: x['name'
+000157e0: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
+000157f0: 6e61 6d65 203d 2076 6d5b 276e 616d 6527  name = vm['name'
+00015800: 5d0a 2020 2020 2020 2020 2020 2020 6465  ].            de
+00015810: 7363 7269 7074 696f 6e20 3d20 766d 5b27  scription = vm['
+00015820: 706c 616e 275d 0a20 2020 2020 2020 2020  plan'].         
+00015830: 2020 2069 6620 6465 7363 7269 7074 696f     if descriptio
+00015840: 6e20 3d3d 2070 6c61 6e3a 0a20 2020 2020  n == plan:.     
+00015850: 2020 2020 2020 2020 2020 2072 6576 6572             rever
+00015860: 7466 6f75 6e64 203d 2054 7275 650a 2020  tfound = True.  
+00015870: 2020 2020 2020 2020 2020 2020 2020 6b2e                k.
+00015880: 7265 7665 7274 5f73 6e61 7073 686f 7428  revert_snapshot(
+00015890: 736e 6170 7368 6f74 6e61 6d65 2c20 6e61  snapshotname, na
+000158a0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+000158b0: 2020 2020 7375 6363 6573 7328 6622 736e      success(f"sn
+000158c0: 6170 7368 6f74 206f 6620 7b6e 616d 657d  apshot of {name}
+000158d0: 2072 6576 6572 7465 6421 2229 0a20 2020   reverted!").   
+000158e0: 2020 2020 2069 6620 7265 7665 7274 666f       if revertfo
+000158f0: 756e 643a 0a20 2020 2020 2020 2020 2020  und:.           
+00015900: 2073 7563 6365 7373 2866 2250 6c61 6e20   success(f"Plan 
+00015910: 7b70 6c61 6e7d 2072 6576 6572 7465 6420  {plan} reverted 
+00015920: 7769 7468 2073 6e61 7073 686f 7420 7b73  with snapshot {s
+00015930: 6e61 7073 686f 746e 616d 657d 2122 290a  napshotname}!").
+00015940: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00015950: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+00015960: 6728 224e 6f20 6d61 7463 6869 6e67 2076  g("No matching v
+00015970: 6d73 2066 6f75 6e64 2229 0a20 2020 2020  ms found").     
+00015980: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+00015990: 6c74 273a 2027 7375 6363 6573 7327 7d0a  lt': 'success'}.
+000159a0: 0a20 2020 2064 6566 2070 6c61 6e28 7365  .    def plan(se
+000159b0: 6c66 2c20 706c 616e 2c20 616e 7369 626c  lf, plan, ansibl
+000159c0: 653d 4661 6c73 652c 2075 726c 3d4e 6f6e  e=False, url=Non
+000159d0: 652c 2070 6174 683d 4e6f 6e65 2c20 636f  e, path=None, co
+000159e0: 6e74 6169 6e65 723d 4661 6c73 652c 2069  ntainer=False, i
+000159f0: 6e70 7574 6669 6c65 3d4e 6f6e 652c 2069  nputfile=None, i
+00015a00: 6e70 7574 7374 7269 6e67 3d4e 6f6e 652c  nputstring=None,
+00015a10: 0a20 2020 2020 2020 2020 2020 2020 6f76  .             ov
+00015a20: 6572 7269 6465 733d 7b7d 2c20 696e 666f  errides={}, info
+00015a30: 3d46 616c 7365 2c20 7570 6461 7465 3d46  =False, update=F
+00015a40: 616c 7365 2c20 656d 6265 6464 6564 3d46  alse, embedded=F
+00015a50: 616c 7365 2c20 646f 776e 6c6f 6164 3d46  alse, download=F
+00015a60: 616c 7365 2c20 7175 6965 743d 4661 6c73  alse, quiet=Fals
+00015a70: 652c 2064 6f63 3d46 616c 7365 2c0a 2020  e, doc=False,.  
+00015a80: 2020 2020 2020 2020 2020 206f 6e6c 7961             onlya
+00015a90: 7373 6574 733d 4661 6c73 652c 2070 7265  ssets=False, pre
+00015aa0: 3d54 7275 652c 2070 6f73 743d 5472 7565  =True, post=True
+00015ab0: 2c20 6578 636c 7564 6576 6d73 3d5b 5d2c  , excludevms=[],
+00015ac0: 2062 6173 656d 6f64 653d 4661 6c73 652c   basemode=False,
+00015ad0: 2074 6872 6561 6465 643d 4661 6c73 6529   threaded=False)
+00015ae0: 3a0a 2020 2020 2020 2020 2222 224d 616e  :.        """Man
+00015af0: 6167 6520 706c 616e 2066 696c 6522 2222  age plan file"""
+00015b00: 0a20 2020 2020 2020 206b 203d 2073 656c  .        k = sel
+00015b10: 662e 6b0a 2020 2020 2020 2020 6e6f 5f6f  f.k.        no_o
+00015b20: 7665 7272 6964 6573 203d 206e 6f74 206f  verrides = not o
+00015b30: 7665 7272 6964 6573 0a20 2020 2020 2020  verrides.       
+00015b40: 2074 6872 6561 6473 203d 205b 5d0a 2020   threads = [].  
+00015b50: 2020 2020 2020 6e65 7776 6d73 203d 205b        newvms = [
+00015b60: 5d0a 2020 2020 2020 2020 6e65 7761 7373  ].        newass
+00015b70: 6574 7320 3d20 5b5d 0a20 2020 2020 2020  ets = [].       
+00015b80: 2066 6169 6c65 6476 6d73 203d 205b 5d0a   failedvms = [].
+00015b90: 2020 2020 2020 2020 6578 6973 7469 6e67          existing
+00015ba0: 766d 7320 3d20 5b5d 0a20 2020 2020 2020  vms = [].       
+00015bb0: 2061 7379 6e63 7761 6974 766d 7320 3d20   asyncwaitvms = 
+00015bc0: 5b5d 0a20 2020 2020 2020 206f 6e66 6c79  [].        onfly
+00015bd0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00015be0: 746f 636c 6561 6e20 3d20 4661 6c73 650a  toclean = False.
+00015bf0: 2020 2020 2020 2020 6765 7462 6163 6b20          getback 
+00015c00: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00015c10: 766d 7072 6f66 696c 6573 203d 207b 6b65  vmprofiles = {ke
+00015c20: 793a 2076 616c 7565 2066 6f72 206b 6579  y: value for key
+00015c30: 2c20 7661 6c75 6520 696e 2073 656c 662e  , value in self.
+00015c40: 7072 6f66 696c 6573 2e69 7465 6d73 2829  profiles.items()
+00015c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015c60: 2020 2020 2020 2069 6620 2774 7970 6527         if 'type'
+00015c70: 206e 6f74 2069 6e20 7661 6c75 6520 6f72   not in value or
+00015c80: 2076 616c 7565 5b27 7479 7065 275d 203d   value['type'] =
+00015c90: 3d20 2776 6d27 7d0a 2020 2020 2020 2020  = 'vm'}.        
+00015ca0: 636f 6e74 6169 6e65 7270 726f 6669 6c65  containerprofile
+00015cb0: 7320 3d20 7b6b 6579 3a20 7661 6c75 6520  s = {key: value 
+00015cc0: 666f 7220 6b65 792c 2076 616c 7565 2069  for key, value i
+00015cd0: 6e20 7365 6c66 2e70 726f 6669 6c65 732e  n self.profiles.
+00015ce0: 6974 656d 7328 290a 2020 2020 2020 2020  items().        
+00015cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d00: 2020 2020 2069 6620 2774 7970 6527 2069       if 'type' i
+00015d10: 6e20 7661 6c75 6520 616e 6420 7661 6c75  n value and valu
+00015d20: 655b 2774 7970 6527 5d20 3d3d 2027 636f  e['type'] == 'co
+00015d30: 6e74 6169 6e65 7227 7d0a 2020 2020 2020  ntainer'}.      
+00015d40: 2020 6966 2070 6c61 6e20 6973 204e 6f6e    if plan is Non
+00015d50: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+00015d60: 6c61 6e20 3d20 6e61 6d65 7574 696c 732e  lan = nameutils.
+00015d70: 6765 745f 7261 6e64 6f6d 5f6e 616d 6528  get_random_name(
+00015d80: 290a 2020 2020 2020 2020 6966 2075 726c  ).        if url
+00015d90: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00015da0: 2020 2020 2020 2020 2020 6966 2075 726c            if url
+00015db0: 2e73 7461 7274 7377 6974 6828 272f 2729  .startswith('/')
+00015dc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015dd0: 2020 7572 6c20 3d20 6622 6669 6c65 3a2f    url = f"file:/
+00015de0: 2f7b 7572 6c7d 220a 2020 2020 2020 2020  /{url}".        
+00015df0: 2020 2020 6966 206e 6f74 2075 726c 2e65      if not url.e
+00015e00: 6e64 7377 6974 6828 272e 796d 6c27 293a  ndswith('.yml'):
+00015e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015e20: 2075 726c 203d 2066 227b 7572 6c7d 2f6b   url = f"{url}/k
+00015e30: 636c 695f 706c 616e 2e79 6d6c 220a 2020  cli_plan.yml".  
+00015e40: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+00015e50: 7269 6e74 2866 2254 7279 696e 6720 746f  rint(f"Trying to
+00015e60: 2072 6574 7269 6576 6520 7b75 726c 7d22   retrieve {url}"
+00015e70: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
+00015e80: 7075 7466 696c 6520 3d20 6f73 2e70 6174  putfile = os.pat
+00015e90: 682e 6261 7365 6e61 6d65 2875 726c 290a  h.basename(url).
+00015ea0: 2020 2020 2020 2020 2020 2020 6f6e 666c              onfl
+00015eb0: 7920 3d20 6f73 2e70 6174 682e 6469 726e  y = os.path.dirn
+00015ec0: 616d 6528 7572 6c29 0a20 2020 2020 2020  ame(url).       
+00015ed0: 2020 2020 2070 6174 6820 3d20 706c 616e       path = plan
+00015ee0: 2069 6620 7061 7468 2069 7320 4e6f 6e65   if path is None
+00015ef0: 2065 6c73 6520 7061 7468 0a20 2020 2020   else path.     
+00015f00: 2020 2020 2020 2069 6620 6e6f 7420 7175         if not qu
+00015f10: 6965 743a 0a20 2020 2020 2020 2020 2020  iet:.           
+00015f20: 2020 2020 2070 7072 696e 7428 6622 5265       pprint(f"Re
+00015f30: 7472 6965 7669 6e67 2073 7065 6369 6669  trieving specifi
+00015f40: 6564 2070 6c61 6e20 6672 6f6d 207b 7572  ed plan from {ur
+00015f50: 6c7d 2074 6f20 7b70 6174 687d 2229 0a20  l} to {path}"). 
+00015f60: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+00015f70: 6e74 6169 6e65 725f 6d6f 6465 2829 3a0a  ntainer_mode():.
+00015f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f90: 7061 7468 203d 2066 222f 776f 726b 6469  path = f"/workdi
+00015fa0: 722f 7b70 6174 687d 220a 2020 2020 2020  r/{path}".      
+00015fb0: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
+00015fc0: 7061 7468 2e65 7869 7374 7328 7061 7468  path.exists(path
+00015fd0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00015fe0: 2020 2074 6f63 6c65 616e 203d 2054 7275     toclean = Tru
+00015ff0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00016000: 2020 636f 6d6d 6f6e 2e66 6574 6368 2875    common.fetch(u
+00016010: 726c 2c20 7061 7468 290a 2020 2020 2020  rl, path).      
+00016020: 2020 2020 2020 2020 2020 666f 7220 6465            for de
+00016030: 6661 756c 745f 7061 7261 6d65 7465 725f  fault_parameter_
+00016040: 6669 6c65 2069 6e20 5b27 2f6b 636c 695f  file in ['/kcli_
+00016050: 6465 6661 756c 742e 796d 6c27 2c20 6627  default.yml', f'
+00016060: 2f7b 706c 616e 7d5f 6465 6661 756c 742e  /{plan}_default.
+00016070: 796d 6c27 2c0a 2020 2020 2020 2020 2020  yml',.          
 00016080: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00016090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000160a0: 2020 2020 2020 6f6e 666c 793d 6f6e 666c        onfly=onfl
-000160b0: 792c 2066 756c 6c3d 5472 7565 2c0a 2020  y, full=True,.  
-000160c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000160d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000160e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000160f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016100: 2020 2020 2020 2020 2020 2020 2064 6f77               dow
-00016110: 6e6c 6f61 645f 6d6f 6465 3d54 7275 6529  nload_mode=True)
-00016120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016130: 206f 732e 6368 6469 7228 7061 7468 290a   os.chdir(path).
-00016140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016150: 666f 7220 656e 7472 7920 696e 2065 6e74  for entry in ent
-00016160: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
-00016170: 2020 2020 2020 2020 2020 6966 2027 7479            if 'ty
-00016180: 7065 2720 696e 2065 6e74 7269 6573 5b65  pe' in entries[e
-00016190: 6e74 7279 5d20 616e 6420 656e 7472 6965  ntry] and entrie
-000161a0: 735b 656e 7472 795d 5b27 7479 7065 275d  s[entry]['type']
-000161b0: 2021 3d20 2776 6d27 3a0a 2020 2020 2020   != 'vm':.      
-000161c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161d0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-000161e0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000161f0: 6d65 6e74 7279 203d 2065 6e74 7269 6573  mentry = entries
-00016200: 5b65 6e74 7279 5d0a 2020 2020 2020 2020  [entry].        
-00016210: 2020 2020 2020 2020 2020 2020 766d 6669              vmfi
-00016220: 6c65 7320 3d20 766d 656e 7472 792e 6765  les = vmentry.ge
-00016230: 7428 2766 696c 6573 272c 205b 5d29 0a20  t('files', []). 
-00016240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016250: 2020 2073 6372 6970 7466 696c 6573 203d     scriptfiles =
-00016260: 2076 6d65 6e74 7279 2e67 6574 2827 7363   vmentry.get('sc
-00016270: 7269 7074 7327 2c20 5b5d 290a 2020 2020  ripts', []).    
-00016280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016290: 666f 7220 6669 6c20 696e 2076 6d66 696c  for fil in vmfil
-000162a0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-000162b0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-000162c0: 7369 6e73 7461 6e63 6528 6669 6c2c 2073  sinstance(fil, s
-000162d0: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
-000162e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162f0: 206f 7269 6769 6e20 3d20 6669 6c0a 2020   origin = fil.  
-00016300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016310: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-00016320: 7461 6e63 6528 6669 6c2c 2064 6963 7429  tance(fil, dict)
-00016330: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016340: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-00016350: 6967 696e 203d 2066 696c 2e67 6574 2827  igin = fil.get('
-00016360: 6f72 6967 696e 2729 0a20 2020 2020 2020  origin').       
+000160a0: 2020 2020 2022 2f25 735f 6465 6661 756c       "/%s_defaul
+000160b0: 7425 7322 2025 206f 732e 7061 7468 2e73  t%s" % os.path.s
+000160c0: 706c 6974 6578 7428 6f73 2e70 6174 682e  plitext(os.path.
+000160d0: 6261 7365 6e61 6d65 2875 726c 2929 5d3a  basename(url))]:
+000160e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000160f0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00016100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016110: 2020 636f 6d6d 6f6e 2e66 6574 6368 286f    common.fetch(o
+00016120: 732e 7061 7468 2e64 6972 6e61 6d65 2875  s.path.dirname(u
+00016130: 726c 2920 2b20 6465 6661 756c 745f 7061  rl) + default_pa
+00016140: 7261 6d65 7465 725f 6669 6c65 2c20 7061  rameter_file, pa
+00016150: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
+00016160: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
+00016170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016180: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00016190: 2020 2020 2020 2020 2065 6c69 6620 646f           elif do
+000161a0: 776e 6c6f 6164 3a0a 2020 2020 2020 2020  wnload:.        
+000161b0: 2020 2020 2020 2020 6d73 6720 3d20 6622          msg = f"
+000161c0: 7461 7267 6574 2064 6972 6563 746f 7279  target directory
+000161d0: 207b 7061 7468 7d20 616c 7265 6164 7920   {path} already 
+000161e0: 7468 6572 6522 0a20 2020 2020 2020 2020  there".         
+000161f0: 2020 2020 2020 2065 7272 6f72 286d 7367         error(msg
+00016200: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00016210: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
+00016220: 7427 3a20 2766 6169 6c75 7265 272c 2027  t': 'failure', '
+00016230: 7265 6173 6f6e 273a 206d 7367 7d0a 2020  reason': msg}.  
+00016240: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00016250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016260: 7070 7269 6e74 2866 2255 7369 6e67 2065  pprint(f"Using e
+00016270: 7869 7374 696e 6720 6469 7265 6374 6f72  xisting director
+00016280: 7920 7b70 6174 687d 2229 0a20 2020 2020  y {path}").     
+00016290: 2020 2020 2020 2069 6620 646f 776e 6c6f         if downlo
+000162a0: 6164 3a0a 2020 2020 2020 2020 2020 2020  ad:.            
+000162b0: 2020 2020 696e 7075 7466 696c 6520 3d20      inputfile = 
+000162c0: 6622 7b70 6174 687d 2f7b 696e 7075 7466  f"{path}/{inputf
+000162d0: 696c 657d 220a 2020 2020 2020 2020 2020  ile}".          
+000162e0: 2020 2020 2020 656e 7472 6965 732c 206f        entries, o
+000162f0: 7665 7272 6964 6573 2c20 6261 7365 6669  verrides, basefi
+00016300: 6c65 2c20 6261 7365 6469 7220 3d20 7365  le, basedir = se
+00016310: 6c66 2e70 726f 6365 7373 5f69 6e70 7574  lf.process_input
+00016320: 6669 6c65 2870 6c61 6e2c 2069 6e70 7574  file(plan, input
+00016330: 6669 6c65 2c20 6f76 6572 7269 6465 733d  file, overrides=
+00016340: 6f76 6572 7269 6465 732c 0a20 2020 2020  overrides,.     
+00016350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016360: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00016370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016380: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00016390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000163a0: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
-000163b0: 6c74 273a 2027 6661 696c 7572 6527 2c20  lt': 'failure', 
-000163c0: 2772 6561 736f 6e27 3a20 2249 6e63 6f72  'reason': "Incor
-000163d0: 7265 6374 2066 696c 6520 656e 7472 7922  rect file entry"
-000163e0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-000163f0: 2020 2020 2020 2020 2020 6966 2027 7e27            if '~'
-00016400: 206e 6f74 2069 6e20 6f72 6967 696e 3a0a   not in origin:.
-00016410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016420: 2020 2020 2020 2020 2020 2020 6465 7374              dest
-00016430: 6469 7220 3d20 222e 220a 2020 2020 2020  dir = ".".      
-00016440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016450: 2020 2020 2020 6966 2027 2f27 2069 6e20        if '/' in 
-00016460: 6f72 6967 696e 3a0a 2020 2020 2020 2020  origin:.        
-00016470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016480: 2020 2020 2020 2020 6465 7374 6469 7220          destdir 
-00016490: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
-000164a0: 6528 6f72 6967 696e 290a 2020 2020 2020  e(origin).      
+00016380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016390: 2020 2020 2020 2020 2020 6f6e 666c 793d            onfly=
+000163a0: 6f6e 666c 792c 2066 756c 6c3d 5472 7565  onfly, full=True
+000163b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000163c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016400: 2064 6f77 6e6c 6f61 645f 6d6f 6465 3d54   download_mode=T
+00016410: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+00016420: 2020 2020 206f 732e 6368 6469 7228 7061       os.chdir(pa
+00016430: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
+00016440: 2020 2020 666f 7220 656e 7472 7920 696e      for entry in
+00016450: 2065 6e74 7269 6573 3a0a 2020 2020 2020   entries:.      
+00016460: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00016470: 2027 7479 7065 2720 696e 2065 6e74 7269   'type' in entri
+00016480: 6573 5b65 6e74 7279 5d20 616e 6420 656e  es[entry] and en
+00016490: 7472 6965 735b 656e 7472 795d 5b27 7479  tries[entry]['ty
+000164a0: 7065 275d 2021 3d20 2776 6d27 3a0a 2020  pe'] != 'vm':.  
 000164b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000164c0: 2020 2020 2020 2020 2020 6f73 2e6d 616b            os.mak
-000164d0: 6564 6972 7328 6465 7374 6469 722c 2065  edirs(destdir, e
-000164e0: 7869 7374 5f6f 6b3d 5472 7565 290a 2020  xist_ok=True).  
-000164f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016500: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-00016510: 2866 2252 6574 7269 6576 696e 6720 6669  (f"Retrieving fi
-00016520: 6c65 207b 6f6e 666c 797d 2f7b 6f72 6967  le {onfly}/{orig
-00016530: 696e 7d22 290a 2020 2020 2020 2020 2020  in}").          
-00016540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016550: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00016560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016570: 2020 2020 2020 2063 6f6d 6d6f 6e2e 6665         common.fe
-00016580: 7463 6828 6622 7b6f 6e66 6c79 7d2f 7b6f  tch(f"{onfly}/{o
-00016590: 7269 6769 6e7d 222c 2064 6573 7464 6972  rigin}", destdir
-000165a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000165b0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-000165c0: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
+000164c0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+000164d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000164e0: 2020 2076 6d65 6e74 7279 203d 2065 6e74     vmentry = ent
+000164f0: 7269 6573 5b65 6e74 7279 5d0a 2020 2020  ries[entry].    
+00016500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016510: 766d 6669 6c65 7320 3d20 766d 656e 7472  vmfiles = vmentr
+00016520: 792e 6765 7428 2766 696c 6573 272c 205b  y.get('files', [
+00016530: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00016540: 2020 2020 2020 2073 6372 6970 7466 696c         scriptfil
+00016550: 6573 203d 2076 6d65 6e74 7279 2e67 6574  es = vmentry.get
+00016560: 2827 7363 7269 7074 7327 2c20 5b5d 290a  ('scripts', []).
+00016570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016580: 2020 2020 666f 7220 6669 6c20 696e 2076      for fil in v
+00016590: 6d66 696c 6573 3a0a 2020 2020 2020 2020  mfiles:.        
+000165a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000165b0: 6966 2069 7369 6e73 7461 6e63 6528 6669  if isinstance(fi
+000165c0: 6c2c 2073 7472 293a 0a20 2020 2020 2020  l, str):.       
 000165d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000165e0: 2020 2020 2020 6966 2063 6f6d 6d6f 6e2e        if common.
-000165f0: 7572 6c5f 6578 6973 7473 2866 227b 6f6e  url_exists(f"{on
-00016600: 666c 797d 2f7b 6f72 6967 696e 7d2f 5245  fly}/{origin}/RE
-00016610: 4144 4d45 2e6d 6422 293a 0a20 2020 2020  ADME.md"):.     
-00016620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016630: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00016640: 732e 6d61 6b65 6469 7273 286f 7269 6769  s.makedirs(origi
-00016650: 6e2c 2065 7869 7374 5f6f 6b3d 5472 7565  n, exist_ok=True
-00016660: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00016670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016680: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00016690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000166a0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-000166b0: 6e74 2866 2266 696c 6520 7b6f 6e66 6c79  nt(f"file {onfly
-000166c0: 7d2f 7b6f 7269 6769 6e7d 2073 6b69 7070  }/{origin} skipp
-000166d0: 6564 2229 0a20 2020 2020 2020 2020 2020  ed").           
-000166e0: 2020 2020 2020 2020 2066 6f72 2073 6372           for scr
-000166f0: 6970 7420 696e 2073 6372 6970 7466 696c  ipt in scriptfil
-00016700: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00016710: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-00016720: 7e27 206e 6f74 2069 6e20 7363 7269 7074  ~' not in script
-00016730: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016740: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00016750: 7374 6469 7220 3d20 222e 220a 2020 2020  stdir = ".".    
+000165e0: 2020 2020 206f 7269 6769 6e20 3d20 6669       origin = fi
+000165f0: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
+00016600: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
+00016610: 7369 6e73 7461 6e63 6528 6669 6c2c 2064  sinstance(fil, d
+00016620: 6963 7429 3a0a 2020 2020 2020 2020 2020  ict):.          
+00016630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016640: 2020 6f72 6967 696e 203d 2066 696c 2e67    origin = fil.g
+00016650: 6574 2827 6f72 6967 696e 2729 0a20 2020  et('origin').   
+00016660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016670: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00016680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016690: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
+000166a0: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
+000166b0: 6527 2c20 2772 6561 736f 6e27 3a20 2249  e', 'reason': "I
+000166c0: 6e63 6f72 7265 6374 2066 696c 6520 656e  ncorrect file en
+000166d0: 7472 7922 7d0a 2020 2020 2020 2020 2020  try"}.          
+000166e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000166f0: 2027 7e27 206e 6f74 2069 6e20 6f72 6967   '~' not in orig
+00016700: 696e 3a0a 2020 2020 2020 2020 2020 2020  in:.            
+00016710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016720: 6465 7374 6469 7220 3d20 222e 220a 2020  destdir = ".".  
+00016730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016740: 2020 2020 2020 2020 2020 6966 2027 2f27            if '/'
+00016750: 2069 6e20 6f72 6967 696e 3a0a 2020 2020   in origin:.    
 00016760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016770: 2020 2020 2020 2020 6966 2027 2f27 2069          if '/' i
-00016780: 6e20 7363 7269 7074 3a0a 2020 2020 2020  n script:.      
-00016790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000167a0: 2020 2020 2020 2020 2020 6465 7374 6469            destdi
-000167b0: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
-000167c0: 616d 6528 7363 7269 7074 290a 2020 2020  ame(script).    
-000167d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000167e0: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
-000167f0: 616b 6564 6972 7328 6465 7374 6469 722c  akedirs(destdir,
-00016800: 2065 7869 7374 5f6f 6b3d 5472 7565 290a   exist_ok=True).
-00016810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016820: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-00016830: 6e74 2866 2252 6574 7269 6576 696e 6720  nt(f"Retrieving 
-00016840: 7363 7269 7074 207b 6f6e 666c 797d 2f7b  script {onfly}/{
-00016850: 7363 7269 7074 7d22 290a 2020 2020 2020  script}").      
-00016860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016870: 2020 2020 2020 636f 6d6d 6f6e 2e66 6574        common.fet
-00016880: 6368 2866 227b 6f6e 666c 797d 2f7b 7363  ch(f"{onfly}/{sc
-00016890: 7269 7074 7d22 2c20 6465 7374 6469 7229  ript}", destdir)
-000168a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000168b0: 206f 732e 6368 6469 7228 272e 2e27 290a   os.chdir('..').
+00016770: 2020 2020 2020 2020 2020 2020 6465 7374              dest
+00016780: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
+00016790: 726e 616d 6528 6f72 6967 696e 290a 2020  rname(origin).  
+000167a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000167b0: 2020 2020 2020 2020 2020 2020 2020 6f73                os
+000167c0: 2e6d 616b 6564 6972 7328 6465 7374 6469  .makedirs(destdi
+000167d0: 722c 2065 7869 7374 5f6f 6b3d 5472 7565  r, exist_ok=True
+000167e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000167f0: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+00016800: 7269 6e74 2866 2252 6574 7269 6576 696e  rint(f"Retrievin
+00016810: 6720 6669 6c65 207b 6f6e 666c 797d 2f7b  g file {onfly}/{
+00016820: 6f72 6967 696e 7d22 290a 2020 2020 2020  origin}").      
+00016830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016840: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00016850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016860: 2020 2020 2020 2020 2020 2063 6f6d 6d6f             commo
+00016870: 6e2e 6665 7463 6828 6622 7b6f 6e66 6c79  n.fetch(f"{onfly
+00016880: 7d2f 7b6f 7269 6769 6e7d 222c 2064 6573  }/{origin}", des
+00016890: 7464 6972 290a 2020 2020 2020 2020 2020  tdir).          
+000168a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000168b0: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
 000168c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000168d0: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
-000168e0: 3a20 2773 7563 6365 7373 277d 0a20 2020  : 'success'}.   
-000168f0: 2020 2020 2069 6620 696e 7075 7473 7472       if inputstr
-00016900: 696e 6720 6973 206e 6f74 204e 6f6e 653a  ing is not None:
-00016910: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
-00016920: 7574 6669 6c65 203d 2066 2274 656d 705f  utfile = f"temp_
-00016930: 706c 616e 5f7b 706c 616e 7d2e 796d 6c22  plan_{plan}.yml"
-00016940: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-00016950: 6820 6f70 656e 2869 6e70 7574 6669 6c65  h open(inputfile
-00016960: 2c20 2277 2229 2061 7320 663a 0a20 2020  , "w") as f:.   
-00016970: 2020 2020 2020 2020 2020 2020 2066 2e77               f.w
-00016980: 7269 7465 2869 6e70 7574 7374 7269 6e67  rite(inputstring
-00016990: 290a 2020 2020 2020 2020 6966 2069 6e70  ).        if inp
-000169a0: 7574 6669 6c65 2069 7320 4e6f 6e65 3a0a  utfile is None:.
-000169b0: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
-000169c0: 7466 696c 6520 3d20 276b 636c 695f 706c  tfile = 'kcli_pl
-000169d0: 616e 2e79 6d6c 270a 2020 2020 2020 2020  an.yml'.        
-000169e0: 2020 2020 7070 7269 6e74 2822 7573 696e      pprint("usin
-000169f0: 6720 6465 6661 756c 7420 696e 7075 7420  g default input 
-00016a00: 6669 6c65 206b 636c 695f 706c 616e 2e79  file kcli_plan.y
-00016a10: 6d6c 2229 0a20 2020 2020 2020 2069 6620  ml").        if 
-00016a20: 7061 7468 2069 7320 6e6f 7420 4e6f 6e65  path is not None
-00016a30: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
-00016a40: 2e63 6864 6972 2870 6174 6829 0a20 2020  .chdir(path).   
-00016a50: 2020 2020 2020 2020 2067 6574 6261 636b           getback
-00016a60: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00016a70: 696e 7075 7466 696c 6520 3d20 6f73 2e70  inputfile = os.p
-00016a80: 6174 682e 6578 7061 6e64 7573 6572 2869  ath.expanduser(i
-00016a90: 6e70 7574 6669 6c65 290a 2020 2020 2020  nputfile).      
-00016aa0: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
-00016ab0: 2e65 7869 7374 7328 696e 7075 7466 696c  .exists(inputfil
-00016ac0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00016ad0: 6572 726f 7228 6622 496e 7075 7420 6669  error(f"Input fi
-00016ae0: 6c65 207b 696e 7075 7466 696c 657d 206e  le {inputfile} n
-00016af0: 6f74 2066 6f75 6e64 2e4c 6561 7669 6e67  ot found.Leaving
-00016b00: 2e2e 2e2e 2229 0a20 2020 2020 2020 2020  ....").         
-00016b10: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-00016b20: 2020 2020 2020 2065 6c69 6620 6f73 2e70         elif os.p
-00016b30: 6174 682e 6973 6469 7228 696e 7075 7466  ath.isdir(inputf
-00016b40: 696c 6529 3a0a 2020 2020 2020 2020 2020  ile):.          
-00016b50: 2020 696e 7075 7466 696c 6520 3d20 6622    inputfile = f"
-00016b60: 7b69 6e70 7574 6669 6c65 7d2f 6b63 6c69  {inputfile}/kcli
-00016b70: 5f70 6c61 6e2e 796d 6c22 0a20 2020 2020  _plan.yml".     
-00016b80: 2020 2069 6620 696e 666f 3a0a 2020 2020     if info:.    
-00016b90: 2020 2020 2020 2020 7365 6c66 2e69 6e66          self.inf
-00016ba0: 6f5f 706c 616e 2869 6e70 7574 6669 6c65  o_plan(inputfile
-00016bb0: 2c20 6f6e 666c 793d 6f6e 666c 792c 2071  , onfly=onfly, q
-00016bc0: 7569 6574 3d71 7569 6574 2c20 646f 633d  uiet=quiet, doc=
-00016bd0: 646f 6329 0a20 2020 2020 2020 2020 2020  doc).           
-00016be0: 2069 6620 746f 636c 6561 6e3a 0a20 2020   if toclean:.   
-00016bf0: 2020 2020 2020 2020 2020 2020 206f 732e               os.
-00016c00: 6368 6469 7228 272e 2e27 290a 2020 2020  chdir('..').    
-00016c10: 2020 2020 2020 2020 2020 2020 726d 7472              rmtr
-00016c20: 6565 2870 6174 6829 0a20 2020 2020 2020  ee(path).       
-00016c30: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
-00016c40: 7375 6c74 273a 2027 7375 6363 6573 7327  sult': 'success'
-00016c50: 7d0a 2020 2020 2020 2020 6261 7365 656e  }.        baseen
-00016c60: 7472 6965 7320 3d20 7b7d 0a20 2020 2020  tries = {}.     
-00016c70: 2020 2065 6e74 7269 6573 2c20 6f76 6572     entries, over
-00016c80: 7269 6465 732c 2062 6173 6566 696c 652c  rides, basefile,
-00016c90: 2062 6173 6564 6972 203d 2073 656c 662e   basedir = self.
-00016ca0: 7072 6f63 6573 735f 696e 7075 7466 696c  process_inputfil
-00016cb0: 6528 706c 616e 2c20 696e 7075 7466 696c  e(plan, inputfil
-00016cc0: 652c 206f 7665 7272 6964 6573 3d6f 7665  e, overrides=ove
-00016cd0: 7272 6964 6573 2c0a 2020 2020 2020 2020  rrides,.        
-00016ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d10: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00016d20: 6e66 6c79 3d6f 6e66 6c79 2c20 6675 6c6c  nfly=onfly, full
-00016d30: 3d54 7275 6529 0a20 2020 2020 2020 2069  =True).        i
-00016d40: 6620 6261 7365 6669 6c65 2069 7320 6e6f  f basefile is no
-00016d50: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00016d60: 2020 2020 6261 7365 696e 666f 203d 2073      baseinfo = s
-00016d70: 656c 662e 7072 6f63 6573 735f 696e 7075  elf.process_inpu
-00016d80: 7466 696c 6528 706c 616e 2c20 6622 7b62  tfile(plan, f"{b
-00016d90: 6173 6564 6972 7d2f 7b62 6173 6566 696c  asedir}/{basefil
-00016da0: 657d 222c 206f 7665 7272 6964 6573 3d6f  e}", overrides=o
-00016db0: 7665 7272 6964 6573 2c20 6675 6c6c 3d54  verrides, full=T
-00016dc0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00016dd0: 2062 6173 6565 6e74 7269 6573 2c20 6261   baseentries, ba
-00016de0: 7365 6f76 6572 7269 6465 7320 3d20 6261  seoverrides = ba
-00016df0: 7365 696e 666f 5b30 5d2c 2062 6173 6569  seinfo[0], basei
-00016e00: 6e66 6f5b 315d 0a20 2020 2020 2020 2020  nfo[1].         
-00016e10: 2020 2069 6620 6261 7365 6f76 6572 7269     if baseoverri
-00016e20: 6465 733a 0a20 2020 2020 2020 2020 2020  des:.           
-00016e30: 2020 2020 206f 7665 7272 6964 6573 2e75       overrides.u
-00016e40: 7064 6174 6528 7b6b 6579 3a20 6261 7365  pdate({key: base
-00016e50: 6f76 6572 7269 6465 735b 6b65 795d 2066  overrides[key] f
-00016e60: 6f72 206b 6579 2069 6e20 6261 7365 6f76  or key in baseov
-00016e70: 6572 7269 6465 7320 6966 206b 6579 206e  errides if key n
-00016e80: 6f74 2069 6e20 6f76 6572 7269 6465 737d  ot in overrides}
-00016e90: 290a 2020 2020 2020 2020 6966 2065 6e74  ).        if ent
-00016ea0: 7269 6573 2069 7320 4e6f 6e65 3a0a 2020  ries is None:.  
-00016eb0: 2020 2020 2020 2020 2020 656e 7472 6965            entrie
-00016ec0: 7320 3d20 7b7d 0a20 2020 2020 2020 2069  s = {}.        i
-00016ed0: 6620 7365 6c66 2e64 6562 7567 3a0a 2020  f self.debug:.  
-00016ee0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00016ef0: 7961 6d6c 2e64 756d 7028 656e 7472 6965  yaml.dump(entrie
-00016f00: 7329 290a 2020 2020 2020 2020 7061 7261  s)).        para
-00016f10: 6d65 7465 7273 203d 2065 6e74 7269 6573  meters = entries
-00016f20: 2e67 6574 2827 7061 7261 6d65 7465 7273  .get('parameters
-00016f30: 2729 0a20 2020 2020 2020 2069 6620 7061  ').        if pa
-00016f40: 7261 6d65 7465 7273 2069 7320 6e6f 7420  rameters is not 
-00016f50: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00016f60: 2020 6465 6c20 656e 7472 6965 735b 2770    del entries['p
-00016f70: 6172 616d 6574 6572 7327 5d0a 2020 2020  arameters'].    
-00016f80: 2020 2020 6469 6374 5f74 7970 6573 203d      dict_types =
-00016f90: 205b 656e 7472 7920 666f 7220 656e 7472   [entry for entr
-00016fa0: 7920 696e 2065 6e74 7269 6573 2069 6620  y in entries if 
-00016fb0: 6973 696e 7374 616e 6365 2865 6e74 7269  isinstance(entri
-00016fc0: 6573 5b65 6e74 7279 5d2c 2064 6963 7429  es[entry], dict)
-00016fd0: 5d0a 2020 2020 2020 2020 6966 206e 6f74  ].        if not
-00016fe0: 2064 6963 745f 7479 7065 733a 0a20 2020   dict_types:.   
-00016ff0: 2020 2020 2020 2020 2069 6620 6261 7365           if base
-00017000: 6d6f 6465 3a0a 2020 2020 2020 2020 2020  mode:.          
-00017010: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
-00017020: 7b69 6e70 7574 6669 6c65 7d20 646f 6573  {inputfile} does
-00017030: 6e27 7420 6c6f 6f6b 206c 696b 6520 6120  n't look like a 
-00017040: 7661 6c69 6420 706c 616e 2e53 6b69 7070  valid plan.Skipp
-00017050: 696e 672e 2e2e 2e22 290a 2020 2020 2020  ing....").      
-00017060: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00017070: 207b 2272 6573 756c 7422 3a20 2273 7563   {"result": "suc
-00017080: 6365 7373 227d 0a20 2020 2020 2020 2020  cess"}.         
-00017090: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000170a0: 2020 2020 2020 2020 206d 7367 203d 2066           msg = f
-000170b0: 227b 696e 7075 7466 696c 657d 2064 6f65  "{inputfile} doe
-000170c0: 736e 2774 206c 6f6f 6b20 6c69 6b65 2061  sn't look like a
-000170d0: 2076 616c 6964 2070 6c61 6e20 6669 6c65   valid plan file
-000170e0: 2e20 4d61 7962 6520 796f 7520 7072 6f76  . Maybe you prov
-000170f0: 6964 6564 2061 2070 6172 616d 6574 6572  ided a parameter
-00017100: 2066 696c 6520 3f22 0a20 2020 2020 2020   file ?".       
-00017110: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00017120: 7b27 7265 7375 6c74 273a 2027 6661 696c  {'result': 'fail
-00017130: 7572 6527 2c20 2772 6561 736f 6e27 3a20  ure', 'reason': 
-00017140: 6d73 677d 0a20 2020 2020 2020 2069 6e70  msg}.        inp
-00017150: 7574 6469 7220 3d20 6f73 2e70 6174 682e  utdir = os.path.
-00017160: 6469 726e 616d 6528 696e 7075 7466 696c  dirname(inputfil
-00017170: 6529 2069 6620 6f73 2e70 6174 682e 6469  e) if os.path.di
-00017180: 726e 616d 6528 696e 7075 7466 696c 6529  rname(inputfile)
-00017190: 2021 3d20 2727 2061 6e64 206f 732e 7061   != '' and os.pa
-000171a0: 7468 2e69 7361 6273 2869 6e70 7574 6669  th.isabs(inputfi
-000171b0: 6c65 2920 656c 7365 2027 2e27 0a20 2020  le) else '.'.   
-000171c0: 2020 2020 2070 7265 5f62 6173 6520 3d20       pre_base = 
-000171d0: 6f73 2e70 6174 682e 7370 6c69 7465 7874  os.path.splitext
-000171e0: 286f 732e 7061 7468 2e62 6173 656e 616d  (os.path.basenam
-000171f0: 6528 696e 7075 7466 696c 6529 295b 305d  e(inputfile))[0]
-00017200: 0a20 2020 2020 2020 2070 7265 5f73 6372  .        pre_scr
-00017210: 6970 7420 3d20 6627 7b69 6e70 7574 6469  ipt = f'{inputdi
-00017220: 727d 2f6b 636c 695f 7072 652e 7368 2720  r}/kcli_pre.sh' 
-00017230: 6966 2070 7265 5f62 6173 6520 3d3d 2027  if pre_base == '
-00017240: 6b63 6c69 5f70 6c61 6e27 2065 6c73 6520  kcli_plan' else 
-00017250: 6622 7b69 6e70 7574 6469 727d 2f7b 7072  f"{inputdir}/{pr
-00017260: 655f 6261 7365 7d5f 7072 652e 7368 220a  e_base}_pre.sh".
-00017270: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-00017280: 7468 2e65 7869 7374 7328 7072 655f 7363  th.exists(pre_sc
-00017290: 7269 7074 293a 0a20 2020 2020 2020 2020  ript):.         
-000172a0: 2020 2070 7265 5f73 6372 6970 745f 7368     pre_script_sh
-000172b0: 6f72 7420 3d20 6f73 2e70 6174 682e 6261  ort = os.path.ba
-000172c0: 7365 6e61 6d65 2870 7265 5f73 6372 6970  sename(pre_scrip
-000172d0: 7429 0a20 2020 2020 2020 2020 2020 2069  t).            i
-000172e0: 6620 7072 653a 0a20 2020 2020 2020 2020  f pre:.         
-000172f0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-00017300: 5275 6e6e 696e 6720 7b70 7265 5f73 6372  Running {pre_scr
-00017310: 6970 745f 7368 6f72 747d 2229 0a20 2020  ipt_short}").   
-00017320: 2020 2020 2020 2020 2020 2020 2077 6974               wit
-00017330: 6820 5465 6d70 6f72 6172 7944 6972 6563  h TemporaryDirec
-00017340: 746f 7279 2829 2061 7320 746d 7064 6972  tory() as tmpdir
-00017350: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017360: 2020 2020 2020 7072 655f 7363 7269 7074        pre_script
-00017370: 203d 2073 656c 662e 7072 6f63 6573 735f   = self.process_
-00017380: 696e 7075 7466 696c 6528 2778 7878 272c  inputfile('xxx',
-00017390: 2070 7265 5f73 6372 6970 742c 206f 7665   pre_script, ove
-000173a0: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
-000173b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000173c0: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-000173d0: 6622 7b74 6d70 6469 727d 2f70 7265 2e73  f"{tmpdir}/pre.s
-000173e0: 6822 2c20 2777 2729 2061 7320 663a 0a20  h", 'w') as f:. 
-000173f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017400: 2020 2020 2020 2066 2e77 7269 7465 2870         f.write(p
-00017410: 7265 5f73 6372 6970 7429 0a20 2020 2020  re_script).     
-00017420: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00017430: 7265 5f72 756e 203d 2072 756e 2866 2762  re_run = run(f'b
-00017440: 6173 6820 7b74 6d70 6469 727d 2f70 7265  ash {tmpdir}/pre
-00017450: 2e73 6827 2c20 7368 656c 6c3d 5472 7565  .sh', shell=True
-00017460: 2c20 7374 646f 7574 3d50 4950 452c 2073  , stdout=PIPE, s
-00017470: 7464 6572 723d 5354 444f 5554 2c0a 2020  tderr=STDOUT,.  
-00017480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174a0: 756e 6976 6572 7361 6c5f 6e65 776c 696e  universal_newlin
-000174b0: 6573 3d54 7275 6529 0a20 2020 2020 2020  es=True).       
-000174c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000174d0: 7072 655f 7275 6e2e 7265 7475 726e 636f  pre_run.returnco
-000174e0: 6465 2021 3d20 303a 0a20 2020 2020 2020  de != 0:.       
-000174f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017500: 206d 7367 203d 2066 2249 7373 7565 2077   msg = f"Issue w
-00017510: 6865 6e20 7275 6e6e 696e 6720 7b70 7265  hen running {pre
-00017520: 5f73 6372 6970 745f 7368 6f72 747d 203a  _script_short} :
-00017530: 5c6e 7b70 7265 5f72 756e 2e73 7464 6f75  \n{pre_run.stdou
-00017540: 747d 220a 2020 2020 2020 2020 2020 2020  t}".            
-00017550: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00017560: 7228 6d73 6729 0a20 2020 2020 2020 2020  r(msg).         
-00017570: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00017580: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-00017590: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
-000175a0: 736f 6e27 3a20 6d73 677d 0a20 2020 2020  son': msg}.     
-000175b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000175c0: 2020 2020 2020 2020 2020 2020 2077 6172               war
-000175d0: 6e69 6e67 2866 2253 6b69 7070 696e 6720  ning(f"Skipping 
-000175e0: 7b70 7265 5f73 6372 6970 745f 7368 6f72  {pre_script_shor
-000175f0: 747d 2061 7320 7265 7175 6573 7465 6422  t} as requested"
-00017600: 290a 2020 2020 2020 2020 6b65 7977 6f72  ).        keywor
-00017610: 6473 203d 2073 656c 662e 6c69 7374 5f6b  ds = self.list_k
-00017620: 6579 776f 7264 7328 290a 2020 2020 2020  eywords().      
-00017630: 2020 666f 7220 6b65 7920 696e 2073 6f72    for key in sor
-00017640: 7465 6428 6f76 6572 7269 6465 7329 3a0a  ted(overrides):.
-00017650: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-00017660: 6579 2069 6e20 6b65 7977 6f72 6473 3a0a  ey in keywords:.
-00017670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017680: 6b65 795f 7661 6c75 6520 3d20 6765 7461  key_value = geta
-00017690: 7474 7228 7365 6c66 2c20 6b65 7929 0a20  ttr(self, key). 
-000176a0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-000176b0: 6579 5f74 7970 6520 3d20 7479 7065 286b  ey_type = type(k
-000176c0: 6579 5f76 616c 7565 290a 2020 2020 2020  ey_value).      
-000176d0: 2020 2020 2020 2020 2020 6f76 6572 7269            overri
-000176e0: 6465 5f6b 6579 5f74 7970 6520 3d20 7479  de_key_type = ty
-000176f0: 7065 286f 7665 7272 6964 6573 5b6b 6579  pe(overrides[key
-00017700: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00017710: 2020 2069 6620 6b65 795f 7661 6c75 6520     if key_value 
-00017720: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-00017730: 6f76 6572 7269 6465 735b 6b65 795d 2069  overrides[key] i
-00017740: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206b  s not None and k
-00017750: 6579 5f74 7970 6520 213d 206f 7665 7272  ey_type != overr
-00017760: 6964 655f 6b65 795f 7479 7065 3a0a 2020  ide_key_type:.  
-00017770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017780: 2020 6572 726f 7228 6622 5468 6520 7072    error(f"The pr
-00017790: 6f76 6964 6564 2070 6172 616d 6574 6572  ovided parameter
-000177a0: 207b 6b65 797d 2068 6173 2061 2077 726f   {key} has a wro
-000177b0: 6e67 2074 7970 6520 7b6f 7665 7272 6964  ng type {overrid
-000177c0: 655f 6b65 795f 7479 7065 7d2c 2069 7420  e_key_type}, it 
-000177d0: 7368 6f75 6c64 2062 6520 7b6b 6579 5f74  should be {key_t
-000177e0: 7970 657d 2229 0a20 2020 2020 2020 2020  ype}").         
-000177f0: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-00017800: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
-00017810: 2020 2020 2020 2065 6c69 6620 6f76 6572         elif over
-00017820: 7269 6465 735b 6b65 795d 2069 7320 6e6f  rides[key] is no
-00017830: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00017840: 2020 2020 2020 2020 2020 2020 7365 7461              seta
-00017850: 7474 7228 7365 6c66 2c20 6b65 792c 206f  ttr(self, key, o
-00017860: 7665 7272 6964 6573 5b6b 6579 5d29 0a20  verrides[key]). 
-00017870: 2020 2020 2020 2076 6d65 6e74 7269 6573         vmentries
-00017880: 203d 205b 656e 7472 7920 666f 7220 656e   = [entry for en
-00017890: 7472 7920 696e 2065 6e74 7269 6573 2069  try in entries i
-000178a0: 6620 2774 7970 6527 206e 6f74 2069 6e20  f 'type' not in 
-000178b0: 656e 7472 6965 735b 656e 7472 795d 206f  entries[entry] o
-000178c0: 7220 656e 7472 6965 735b 656e 7472 795d  r entries[entry]
-000178d0: 5b27 7479 7065 275d 203d 3d20 2776 6d27  ['type'] == 'vm'
-000178e0: 5d0a 2020 2020 2020 2020 6469 736b 656e  ].        disken
-000178f0: 7472 6965 7320 3d20 5b65 6e74 7279 2066  tries = [entry f
-00017900: 6f72 2065 6e74 7279 2069 6e20 656e 7472  or entry in entr
-00017910: 6965 7320 6966 2027 7479 7065 2720 696e  ies if 'type' in
-00017920: 2065 6e74 7269 6573 5b65 6e74 7279 5d20   entries[entry] 
-00017930: 616e 6420 656e 7472 6965 735b 656e 7472  and entries[entr
-00017940: 795d 5b27 7479 7065 275d 203d 3d20 2764  y]['type'] == 'd
-00017950: 6973 6b27 5d0a 2020 2020 2020 2020 6e65  isk'].        ne
-00017960: 7477 6f72 6b65 6e74 7269 6573 203d 205b  tworkentries = [
-00017970: 656e 7472 7920 666f 7220 656e 7472 7920  entry for entry 
-00017980: 696e 2065 6e74 7269 6573 0a20 2020 2020  in entries.     
-00017990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000179a0: 2020 2020 2069 6620 2774 7970 6527 2069       if 'type' i
-000179b0: 6e20 656e 7472 6965 735b 656e 7472 795d  n entries[entry]
-000179c0: 2061 6e64 2065 6e74 7269 6573 5b65 6e74   and entries[ent
-000179d0: 7279 5d5b 2774 7970 6527 5d20 3d3d 2027  ry]['type'] == '
-000179e0: 6e65 7477 6f72 6b27 5d0a 2020 2020 2020  network'].      
-000179f0: 2020 636f 6e74 6169 6e65 7265 6e74 7269    containerentri
-00017a00: 6573 203d 205b 656e 7472 7920 666f 7220  es = [entry for 
-00017a10: 656e 7472 7920 696e 2065 6e74 7269 6573  entry in entries
-00017a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017a30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00017a40: 2774 7970 6527 2069 6e20 656e 7472 6965  'type' in entrie
-00017a50: 735b 656e 7472 795d 2061 6e64 2065 6e74  s[entry] and ent
-00017a60: 7269 6573 5b65 6e74 7279 5d5b 2774 7970  ries[entry]['typ
-00017a70: 6527 5d20 3d3d 2027 636f 6e74 6169 6e65  e'] == 'containe
-00017a80: 7227 5d0a 2020 2020 2020 2020 616e 7369  r'].        ansi
-00017a90: 626c 6565 6e74 7269 6573 203d 205b 656e  bleentries = [en
-00017aa0: 7472 7920 666f 7220 656e 7472 7920 696e  try for entry in
-00017ab0: 2065 6e74 7269 6573 0a20 2020 2020 2020   entries.       
-00017ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ad0: 2020 2069 6620 2774 7970 6527 2069 6e20     if 'type' in 
-00017ae0: 656e 7472 6965 735b 656e 7472 795d 2061  entries[entry] a
-00017af0: 6e64 2065 6e74 7269 6573 5b65 6e74 7279  nd entries[entry
-00017b00: 5d5b 2774 7970 6527 5d20 3d3d 2027 616e  ]['type'] == 'an
-00017b10: 7369 626c 6527 5d0a 2020 2020 2020 2020  sible'].        
-00017b20: 7072 6f66 696c 6565 6e74 7269 6573 203d  profileentries =
-00017b30: 205b 656e 7472 7920 666f 7220 656e 7472   [entry for entr
-00017b40: 7920 696e 2065 6e74 7269 6573 0a20 2020  y in entries.   
-00017b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b60: 2020 2020 2020 2069 6620 2774 7970 6527         if 'type'
-00017b70: 2069 6e20 656e 7472 6965 735b 656e 7472   in entries[entr
-00017b80: 795d 2061 6e64 2065 6e74 7269 6573 5b65  y] and entries[e
-00017b90: 6e74 7279 5d5b 2774 7970 6527 5d20 3d3d  ntry]['type'] ==
-00017ba0: 2027 7072 6f66 696c 6527 5d0a 2020 2020   'profile'].    
-00017bb0: 2020 2020 696d 6167 6565 6e74 7269 6573      imageentries
-00017bc0: 203d 205b 656e 7472 7920 666f 7220 656e   = [entry for en
-00017bd0: 7472 7920 696e 2065 6e74 7269 6573 2069  try in entries i
-00017be0: 6620 2774 7970 6527 2069 6e0a 2020 2020  f 'type' in.    
-00017bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c00: 2020 2020 656e 7472 6965 735b 656e 7472      entries[entr
-00017c10: 795d 2061 6e64 2028 656e 7472 6965 735b  y] and (entries[
-00017c20: 656e 7472 795d 5b27 7479 7065 275d 203d  entry]['type'] =
-00017c30: 3d20 2769 6d61 6765 2720 6f72 2065 6e74  = 'image' or ent
-00017c40: 7269 6573 5b65 6e74 7279 5d5b 2774 7970  ries[entry]['typ
-00017c50: 6527 5d20 3d3d 2027 7465 6d70 6c61 7465  e'] == 'template
-00017c60: 2729 5d0a 2020 2020 2020 2020 706f 6f6c  ')].        pool
-00017c70: 656e 7472 6965 7320 3d20 5b65 6e74 7279  entries = [entry
-00017c80: 2066 6f72 2065 6e74 7279 2069 6e20 656e   for entry in en
-00017c90: 7472 6965 7320 6966 2027 7479 7065 2720  tries if 'type' 
-00017ca0: 696e 2065 6e74 7269 6573 5b65 6e74 7279  in entries[entry
-00017cb0: 5d20 616e 6420 656e 7472 6965 735b 656e  ] and entries[en
-00017cc0: 7472 795d 5b27 7479 7065 275d 203d 3d20  try]['type'] == 
-00017cd0: 2770 6f6f 6c27 5d0a 2020 2020 2020 2020  'pool'].        
-00017ce0: 706c 616e 656e 7472 6965 7320 3d20 5b65  planentries = [e
-00017cf0: 6e74 7279 2066 6f72 2065 6e74 7279 2069  ntry for entry i
-00017d00: 6e20 656e 7472 6965 7320 6966 2027 7479  n entries if 'ty
-00017d10: 7065 2720 696e 2065 6e74 7269 6573 5b65  pe' in entries[e
-00017d20: 6e74 7279 5d20 616e 6420 656e 7472 6965  ntry] and entrie
-00017d30: 735b 656e 7472 795d 5b27 7479 7065 275d  s[entry]['type']
-00017d40: 203d 3d20 2770 6c61 6e27 5d0a 2020 2020   == 'plan'].    
-00017d50: 2020 2020 646e 7365 6e74 7269 6573 203d      dnsentries =
-00017d60: 205b 656e 7472 7920 666f 7220 656e 7472   [entry for entr
-00017d70: 7920 696e 2065 6e74 7269 6573 2069 6620  y in entries if 
-00017d80: 2774 7970 6527 2069 6e20 656e 7472 6965  'type' in entrie
-00017d90: 735b 656e 7472 795d 2061 6e64 2065 6e74  s[entry] and ent
-00017da0: 7269 6573 5b65 6e74 7279 5d5b 2774 7970  ries[entry]['typ
-00017db0: 6527 5d20 3d3d 2027 646e 7327 5d0a 2020  e'] == 'dns'].  
-00017dc0: 2020 2020 2020 6b75 6265 7320 3d20 5b27        kubes = ['
-00017dd0: 6b75 6265 272c 2027 636c 7573 7465 7227  kube', 'cluster'
-00017de0: 5d0a 2020 2020 2020 2020 6b75 6265 656e  ].        kubeen
-00017df0: 7472 6965 7320 3d20 5b65 6e74 7279 2066  tries = [entry f
-00017e00: 6f72 2065 6e74 7279 2069 6e20 656e 7472  or entry in entr
-00017e10: 6965 7320 6966 2027 7479 7065 2720 696e  ies if 'type' in
-00017e20: 2065 6e74 7269 6573 5b65 6e74 7279 5d20   entries[entry] 
-00017e30: 616e 6420 656e 7472 6965 735b 656e 7472  and entries[entr
-00017e40: 795d 5b27 7479 7065 275d 2069 6e20 6b75  y]['type'] in ku
-00017e50: 6265 735d 0a20 2020 2020 2020 206c 6273  bes].        lbs
-00017e60: 203d 205b 656e 7472 7920 666f 7220 656e   = [entry for en
-00017e70: 7472 7920 696e 2065 6e74 7269 6573 2069  try in entries i
-00017e80: 6620 2774 7970 6527 2069 6e20 656e 7472  f 'type' in entr
-00017e90: 6965 735b 656e 7472 795d 2061 6e64 2065  ies[entry] and e
-00017ea0: 6e74 7269 6573 5b65 6e74 7279 5d5b 2774  ntries[entry]['t
-00017eb0: 7970 6527 5d20 3d3d 2027 6c6f 6164 6261  ype'] == 'loadba
-00017ec0: 6c61 6e63 6572 275d 0a20 2020 2020 2020  lancer'].       
-00017ed0: 2073 6773 203d 205b 656e 7472 7920 666f   sgs = [entry fo
-00017ee0: 7220 656e 7472 7920 696e 2065 6e74 7269  r entry in entri
-00017ef0: 6573 2069 6620 2774 7970 6527 2069 6e20  es if 'type' in 
-00017f00: 656e 7472 6965 735b 656e 7472 795d 2061  entries[entry] a
-00017f10: 6e64 2065 6e74 7269 6573 5b65 6e74 7279  nd entries[entry
-00017f20: 5d5b 2774 7970 6527 5d20 3d3d 2027 7365  ]['type'] == 'se
-00017f30: 6375 7269 7479 6772 6f75 7027 5d0a 2020  curitygroup'].  
-00017f40: 2020 2020 2020 6275 636b 6574 656e 7472        bucketentr
-00017f50: 6965 7320 3d20 5b65 6e74 7279 2066 6f72  ies = [entry for
-00017f60: 2065 6e74 7279 2069 6e20 656e 7472 6965   entry in entrie
-00017f70: 7320 6966 2027 7479 7065 2720 696e 2065  s if 'type' in e
-00017f80: 6e74 7269 6573 5b65 6e74 7279 5d20 616e  ntries[entry] an
-00017f90: 6420 656e 7472 6965 735b 656e 7472 795d  d entries[entry]
-00017fa0: 5b27 7479 7065 275d 203d 3d20 2762 7563  ['type'] == 'buc
-00017fb0: 6b65 7427 5d0a 2020 2020 2020 2020 776f  ket'].        wo
-00017fc0: 726b 666c 6f77 656e 7472 6965 7320 3d20  rkflowentries = 
-00017fd0: 5b65 6e74 7279 2066 6f72 2065 6e74 7279  [entry for entry
-00017fe0: 2069 6e20 656e 7472 6965 730a 2020 2020   in entries.    
-00017ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018000: 2020 2020 2020 2069 6620 2774 7970 6527         if 'type'
-00018010: 2069 6e20 656e 7472 6965 735b 656e 7472   in entries[entr
-00018020: 795d 2061 6e64 2065 6e74 7269 6573 5b65  y] and entries[e
-00018030: 6e74 7279 5d5b 2774 7970 6527 5d20 3d3d  ntry]['type'] ==
-00018040: 2027 776f 726b 666c 6f77 275d 0a20 2020   'workflow'].   
-00018050: 2020 2020 2066 6f72 2070 2069 6e20 7072       for p in pr
-00018060: 6f66 696c 6565 6e74 7269 6573 3a0a 2020  ofileentries:.  
-00018070: 2020 2020 2020 2020 2020 766d 7072 6f66            vmprof
-00018080: 696c 6573 5b70 5d20 3d20 656e 7472 6965  iles[p] = entrie
-00018090: 735b 705d 0a20 2020 2020 2020 2069 6620  s[p].        if 
-000180a0: 6e65 7477 6f72 6b65 6e74 7269 6573 2061  networkentries a
-000180b0: 6e64 206e 6f74 206f 6e6c 7961 7373 6574  nd not onlyasset
-000180c0: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-000180d0: 7072 696e 7428 2244 6570 6c6f 7969 6e67  print("Deploying
-000180e0: 204e 6574 776f 726b 732e 2e2e 2229 0a20   Networks..."). 
-000180f0: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
-00018100: 6574 2069 6e20 6e65 7477 6f72 6b65 6e74  et in networkent
-00018110: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
-00018120: 2020 2020 2020 6e65 7470 726f 6669 6c65        netprofile
-00018130: 203d 2065 6e74 7269 6573 5b6e 6574 5d0a   = entries[net].
-00018140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018150: 6966 206b 2e6e 6574 5f65 7869 7374 7328  if k.net_exists(
-00018160: 6e65 7429 3a0a 2020 2020 2020 2020 2020  net):.          
-00018170: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-00018180: 2866 224e 6574 776f 726b 207b 6e65 747d  (f"Network {net}
-00018190: 2073 6b69 7070 6564 2122 290a 2020 2020   skipped!").    
-000181a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000181b0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-000181c0: 2020 2020 2020 2020 2063 6964 7220 3d20           cidr = 
-000181d0: 6e65 7470 726f 6669 6c65 2e67 6574 2827  netprofile.get('
-000181e0: 6369 6472 2729 0a20 2020 2020 2020 2020  cidr').         
-000181f0: 2020 2020 2020 206e 6174 203d 2062 6f6f         nat = boo
-00018200: 6c28 6e65 7470 726f 6669 6c65 2e67 6574  l(netprofile.get
-00018210: 2827 6e61 7427 2c20 5472 7565 2929 0a20  ('nat', True)). 
-00018220: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00018230: 6620 6369 6472 2069 7320 4e6f 6e65 3a0a  f cidr is None:.
-00018240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018250: 2020 2020 7761 726e 696e 6728 6622 4d69      warning(f"Mi
-00018260: 7373 696e 6720 4369 6472 2066 6f72 206e  ssing Cidr for n
-00018270: 6574 776f 726b 207b 6e65 747d 2e20 4e6f  etwork {net}. No
-00018280: 7420 6372 6561 7469 6e67 2069 742e 2e2e  t creating it...
-00018290: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-000182a0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-000182b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000182c0: 6468 6370 203d 206e 6574 7072 6f66 696c  dhcp = netprofil
-000182d0: 652e 6765 7428 2764 6863 7027 2c20 5472  e.get('dhcp', Tr
-000182e0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-000182f0: 2020 2020 646f 6d61 696e 203d 206e 6574      domain = net
-00018300: 7072 6f66 696c 652e 6765 7428 2764 6f6d  profile.get('dom
-00018310: 6169 6e27 290a 2020 2020 2020 2020 2020  ain').          
-00018320: 2020 2020 2020 7265 7375 6c74 203d 206b        result = k
-00018330: 2e63 7265 6174 655f 6e65 7477 6f72 6b28  .create_network(
-00018340: 6e61 6d65 3d6e 6574 2c20 6369 6472 3d63  name=net, cidr=c
-00018350: 6964 722c 2064 6863 703d 6468 6370 2c20  idr, dhcp=dhcp, 
-00018360: 6e61 743d 6e61 742c 2064 6f6d 6169 6e3d  nat=nat, domain=
-00018370: 646f 6d61 696e 2c20 706c 616e 3d70 6c61  domain, plan=pla
-00018380: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-00018390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000183a0: 2020 2020 2020 2020 2020 2020 206f 7665               ove
-000183b0: 7272 6964 6573 3d6e 6574 7072 6f66 696c  rrides=netprofil
-000183c0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-000183d0: 2020 2063 6f6d 6d6f 6e2e 6861 6e64 6c65     common.handle
-000183e0: 5f72 6573 706f 6e73 6528 7265 7375 6c74  _response(result
-000183f0: 2c20 6e65 742c 2065 6c65 6d65 6e74 3d27  , net, element='
-00018400: 4e65 7477 6f72 6b20 2729 0a20 2020 2020  Network ').     
-00018410: 2020 2069 6620 706f 6f6c 656e 7472 6965     if poolentrie
-00018420: 7320 616e 6420 6e6f 7420 6f6e 6c79 6173  s and not onlyas
-00018430: 7365 7473 3a0a 2020 2020 2020 2020 2020  sets:.          
-00018440: 2020 7070 7269 6e74 2822 4465 706c 6f79    pprint("Deploy
-00018450: 696e 6720 506f 6f6c 732e 2e2e 2229 0a20  ing Pools..."). 
-00018460: 2020 2020 2020 2020 2020 2070 6f6f 6c73             pools
-00018470: 203d 206b 2e6c 6973 745f 706f 6f6c 7328   = k.list_pools(
-00018480: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-00018490: 7220 706f 6f6c 2069 6e20 706f 6f6c 656e  r pool in poolen
-000184a0: 7472 6965 733a 0a20 2020 2020 2020 2020  tries:.         
-000184b0: 2020 2020 2020 2069 6620 706f 6f6c 2069         if pool i
-000184c0: 6e20 706f 6f6c 733a 0a20 2020 2020 2020  n pools:.       
-000184d0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-000184e0: 696e 7428 6622 506f 6f6c 207b 706f 6f6c  int(f"Pool {pool
-000184f0: 7d20 736b 6970 7065 6421 2229 0a20 2020  } skipped!").   
-00018500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018510: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-00018520: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00018530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018540: 2020 2020 706f 6f6c 7072 6f66 696c 6520      poolprofile 
-00018550: 3d20 656e 7472 6965 735b 706f 6f6c 5d0a  = entries[pool].
-00018560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018570: 2020 2020 706f 6f6c 7061 7468 203d 2070      poolpath = p
-00018580: 6f6f 6c70 726f 6669 6c65 2e67 6574 2827  oolprofile.get('
-00018590: 7061 7468 2729 0a20 2020 2020 2020 2020  path').         
-000185a0: 2020 2020 2020 2020 2020 2069 6620 706f             if po
-000185b0: 6f6c 7061 7468 2069 7320 4e6f 6e65 3a0a  olpath is None:.
-000185c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000185d0: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-000185e0: 6622 506f 6f6c 207b 706f 6f6c 7d20 736b  f"Pool {pool} sk
-000185f0: 6970 7065 6420 6173 2070 6174 6820 6973  ipped as path is
-00018600: 206d 6973 7369 6e67 2122 290a 2020 2020   missing!").    
-00018610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018620: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
-00018630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018640: 206b 2e63 7265 6174 655f 706f 6f6c 2870   k.create_pool(p
-00018650: 6f6f 6c2c 2070 6f6f 6c70 6174 6829 0a20  ool, poolpath). 
-00018660: 2020 2020 2020 2069 6620 696d 6167 6565         if imagee
-00018670: 6e74 7269 6573 2061 6e64 206e 6f74 206f  ntries and not o
-00018680: 6e6c 7961 7373 6574 733a 0a20 2020 2020  nlyassets:.     
-00018690: 2020 2020 2020 2070 7072 696e 7428 2244         pprint("D
-000186a0: 6570 6c6f 7969 6e67 2049 6d61 6765 732e  eploying Images.
-000186b0: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
-000186c0: 2069 6d61 6765 7320 3d20 5b6f 732e 7061   images = [os.pa
-000186d0: 7468 2e62 6173 656e 616d 6528 7429 2066  th.basename(t) f
-000186e0: 6f72 2074 2069 6e20 6b2e 766f 6c75 6d65  or t in k.volume
-000186f0: 7328 295d 0a20 2020 2020 2020 2020 2020  s()].           
-00018700: 2066 6f72 2069 6d61 6765 2069 6e20 696d   for image in im
-00018710: 6167 6565 6e74 7269 6573 3a0a 2020 2020  ageentries:.    
-00018720: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-00018730: 6570 726f 6669 6c65 203d 2065 6e74 7269  eprofile = entri
-00018740: 6573 5b69 6d61 6765 5d0a 2020 2020 2020  es[image].      
-00018750: 2020 2020 2020 2020 2020 706f 6f6c 203d            pool =
-00018760: 2069 6d61 6765 7072 6f66 696c 652e 6765   imageprofile.ge
-00018770: 7428 2770 6f6f 6c27 2c20 7365 6c66 2e70  t('pool', self.p
-00018780: 6f6f 6c29 0a20 2020 2020 2020 2020 2020  ool).           
-00018790: 2020 2020 2069 6d61 6765 7369 7a65 203d       imagesize =
-000187a0: 2069 6d61 6765 7072 6f66 696c 652e 6765   imageprofile.ge
-000187b0: 7428 2773 697a 6527 290a 2020 2020 2020  t('size').      
-000187c0: 2020 2020 2020 2020 2020 696d 6167 6575            imageu
-000187d0: 726c 203d 2069 6d61 6765 7072 6f66 696c  rl = imageprofil
-000187e0: 652e 6765 7428 2775 726c 2729 0a20 2020  e.get('url').   
-000187f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00018800: 696d 6167 6520 696e 2069 6d61 6765 733a  image in images:
-00018810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018820: 2020 2020 2070 7072 696e 7428 6622 496d       pprint(f"Im
-00018830: 6167 6520 7b69 6d61 6765 7d20 736b 6970  age {image} skip
-00018840: 7065 6421 2229 0a20 2020 2020 2020 2020  ped!").         
-00018850: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00018860: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-00018870: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00018880: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00018890: 2069 7369 6e73 7461 6e63 6528 696d 6167   isinstance(imag
-000188a0: 6575 726c 2c20 7374 7229 2061 6e64 2069  eurl, str) and i
-000188b0: 6d61 6765 7572 6c20 3d3d 2022 4e6f 6e65  mageurl == "None
-000188c0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-000188d0: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-000188e0: 7572 6c20 3d20 4e6f 6e65 0a20 2020 2020  url = None.     
-000188f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00018900: 6d64 203d 2069 6d61 6765 7072 6f66 696c  md = imageprofil
-00018910: 652e 6765 7428 2763 6d64 2729 0a20 2020  e.get('cmd').   
-00018920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018930: 2073 656c 662e 6861 6e64 6c65 5f68 6f73   self.handle_hos
-00018940: 7428 706f 6f6c 3d70 6f6f 6c2c 2069 6d61  t(pool=pool, ima
-00018950: 6765 3d69 6d61 6765 2c20 646f 776e 6c6f  ge=image, downlo
-00018960: 6164 3d54 7275 652c 2063 6d64 3d63 6d64  ad=True, cmd=cmd
-00018970: 2c20 7572 6c3d 696d 6167 6575 726c 2c20  , url=imageurl, 
-00018980: 7369 7a65 3d69 6d61 6765 7369 7a65 290a  size=imagesize).
-00018990: 2020 2020 2020 2020 6966 2062 7563 6b65          if bucke
-000189a0: 7465 6e74 7269 6573 2061 6e64 206e 6f74  tentries and not
-000189b0: 206f 6e6c 7961 7373 6574 7320 616e 6420   onlyassets and 
-000189c0: 7365 6c66 2e74 7970 6520 696e 205b 2761  self.type in ['a
-000189d0: 7773 272c 2027 6763 7027 2c20 276f 7065  ws', 'gcp', 'ope
-000189e0: 6e73 7461 636b 275d 3a0a 2020 2020 2020  nstack']:.      
-000189f0: 2020 2020 2020 7070 7269 6e74 2822 4465        pprint("De
-00018a00: 706c 6f79 696e 6720 4275 636b 6574 2045  ploying Bucket E
-00018a10: 6e74 7269 6573 2e2e 2e22 290a 2020 2020  ntries...").    
-00018a20: 2020 2020 2020 2020 666f 7220 6275 636b          for buck
-00018a30: 6574 656e 7472 7920 696e 2062 7563 6b65  etentry in bucke
-00018a40: 7465 6e74 7269 6573 3a0a 2020 2020 2020  tentries:.      
-00018a50: 2020 2020 2020 2020 2020 6275 636b 6574            bucket
-00018a60: 7072 6f66 696c 6520 3d20 656e 7472 6965  profile = entrie
-00018a70: 735b 6275 636b 6574 656e 7472 795d 0a20  s[bucketentry]. 
-00018a80: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-00018a90: 6669 6c65 7320 3d20 6275 636b 6574 7072  files = bucketpr
-00018aa0: 6f66 696c 652e 6765 7428 2766 696c 6573  ofile.get('files
-00018ab0: 272c 205b 5d29 0a20 2020 2020 2020 2020  ', []).         
-00018ac0: 2020 2020 2020 2073 656c 662e 6b2e 6372         self.k.cr
-00018ad0: 6561 7465 5f62 7563 6b65 7428 6275 636b  eate_bucket(buck
-00018ae0: 6574 656e 7472 7929 0a20 2020 2020 2020  etentry).       
-00018af0: 2020 2020 2020 2020 2066 6f72 205f 6669           for _fi
-00018b00: 6c20 696e 205f 6669 6c65 733a 0a20 2020  l in _files:.   
-00018b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b20: 2073 656c 662e 6b2e 7570 6c6f 6164 5f74   self.k.upload_t
-00018b30: 6f5f 6275 636b 6574 2862 7563 6b65 7465  o_bucket(buckete
-00018b40: 6e74 7279 2c20 5f66 696c 290a 2020 2020  ntry, _fil).    
-00018b50: 2020 2020 7465 6d70 6b65 7920 3d20 6f76      tempkey = ov
-00018b60: 6572 7269 6465 732e 6765 7428 2774 656d  errides.get('tem
-00018b70: 706b 6579 272c 2046 616c 7365 2920 6f72  pkey', False) or
-00018b80: 2073 656c 662e 7465 6d70 6b65 790a 2020   self.tempkey.  
-00018b90: 2020 2020 2020 6966 2074 656d 706b 6579        if tempkey
-00018ba0: 3a0a 2020 2020 2020 2020 2020 2020 7465  :.            te
-00018bb0: 6d70 6b65 7964 6972 203d 2054 656d 706f  mpkeydir = Tempo
-00018bc0: 7261 7279 4469 7265 6374 6f72 7928 290a  raryDirectory().
-00018bd0: 2020 2020 2020 2020 2020 2020 6f76 6572              over
-00018be0: 7269 6465 735b 2774 656d 706b 6579 6469  rides['tempkeydi
-00018bf0: 7227 5d20 3d20 7465 6d70 6b65 7964 6972  r'] = tempkeydir
-00018c00: 0a20 2020 2020 2020 2020 2020 206f 7665  .            ove
-00018c10: 7272 6964 6573 5b27 7465 6d70 6b65 7964  rrides['tempkeyd
-00018c20: 6972 6b65 6570 275d 203d 2054 7275 650a  irkeep'] = True.
-00018c30: 2020 2020 2020 2020 6966 2070 6c61 6e65          if plane
-00018c40: 6e74 7269 6573 3a0a 2020 2020 2020 2020  ntries:.        
-00018c50: 2020 2020 7070 7269 6e74 2822 4465 706c      pprint("Depl
-00018c60: 6f79 696e 6720 506c 616e 732e 2e2e 2229  oying Plans...")
-00018c70: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00018c80: 2070 6c61 6e65 6e74 7279 2069 6e20 706c   planentry in pl
-00018c90: 616e 656e 7472 6965 733a 0a20 2020 2020  anentries:.     
-00018ca0: 2020 2020 2020 2020 2020 2064 6574 6169             detai
-00018cb0: 6c73 203d 2065 6e74 7269 6573 5b70 6c61  ls = entries[pla
-00018cc0: 6e65 6e74 7279 5d0a 2020 2020 2020 2020  nentry].        
-00018cd0: 2020 2020 2020 2020 706c 616e 7572 6c20          planurl 
-00018ce0: 3d20 6465 7461 696c 732e 6765 7428 2775  = details.get('u
-00018cf0: 726c 2729 0a20 2020 2020 2020 2020 2020  rl').           
-00018d00: 2020 2020 2070 6c61 6e66 696c 6520 3d20       planfile = 
-00018d10: 6465 7461 696c 732e 6765 7428 2766 696c  details.get('fil
-00018d20: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
-00018d30: 2020 2020 6966 2070 6c61 6e75 726c 2069      if planurl i
-00018d40: 7320 4e6f 6e65 2061 6e64 2070 6c61 6e66  s None and planf
-00018d50: 696c 6520 6973 204e 6f6e 653a 0a20 2020  ile is None:.   
-00018d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d70: 2077 6172 6e69 6e67 2866 224d 6973 7369   warning(f"Missi
-00018d80: 6e67 2055 726c 2f46 696c 6520 666f 7220  ng Url/File for 
-00018d90: 706c 616e 207b 706c 616e 656e 7472 797d  plan {planentry}
-00018da0: 2e20 4e6f 7420 6372 6561 7469 6e67 2069  . Not creating i
-00018db0: 742e 2e2e 2229 0a20 2020 2020 2020 2020  t...").         
-00018dc0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00018dd0: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-00018de0: 2020 2020 656c 6966 2070 6c61 6e75 726c      elif planurl
-00018df0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00018e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e10: 2020 7061 7468 203d 2070 6c61 6e65 6e74    path = planent
-00018e20: 7279 0a20 2020 2020 2020 2020 2020 2020  ry.             
-00018e30: 2020 2020 2020 2069 6620 6e6f 7420 706c         if not pl
-00018e40: 616e 7572 6c2e 656e 6473 7769 7468 2827  anurl.endswith('
-00018e50: 796d 6c27 293a 0a20 2020 2020 2020 2020  yml'):.         
-00018e60: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00018e70: 6c61 6e75 726c 203d 2066 227b 706c 616e  lanurl = f"{plan
-00018e80: 7572 6c7d 2f6b 636c 695f 706c 616e 2e79  url}/kcli_plan.y
-00018e90: 6d6c 220a 2020 2020 2020 2020 2020 2020  ml".            
-00018ea0: 2020 2020 656c 6966 2027 2f27 2069 6e20      elif '/' in 
-00018eb0: 706c 616e 6669 6c65 3a0a 2020 2020 2020  planfile:.      
-00018ec0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00018ed0: 7468 203d 206f 732e 7061 7468 2e64 6972  th = os.path.dir
-00018ee0: 6e61 6d65 2870 6c61 6e66 696c 6529 0a20  name(planfile). 
-00018ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f00: 2020 2069 6e70 7574 6669 6c65 203d 206f     inputfile = o
-00018f10: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-00018f20: 706c 616e 6669 6c65 290a 2020 2020 2020  planfile).      
-00018f30: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00018f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f50: 2020 2020 7061 7468 203d 2027 2e27 0a20      path = '.'. 
-00018f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f70: 2020 2069 6e70 7574 6669 6c65 203d 2070     inputfile = p
-00018f80: 6c61 6e65 6e74 7279 0a20 2020 2020 2020  lanentry.       
-00018f90: 2020 2020 2020 2020 2069 6620 6e6f 5f6f           if no_o
-00018fa0: 7665 7272 6964 6573 2061 6e64 2070 6172  verrides and par
-00018fb0: 616d 6574 6572 733a 0a20 2020 2020 2020  ameters:.       
-00018fc0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-00018fd0: 696e 7428 2255 7369 6e67 2070 6172 616d  int("Using param
-00018fe0: 6574 6572 7320 6672 6f6d 2066 6174 6865  eters from fathe
-00018ff0: 7220 706c 616e 2069 6e20 6368 696c 6420  r plan in child 
-00019000: 6f6e 6573 2229 0a20 2020 2020 2020 2020  ones").         
-00019010: 2020 2020 2020 2020 2020 2066 6f72 206f             for o
-00019020: 7665 7272 6964 6520 696e 206f 7665 7272  verride in overr
-00019030: 6964 6573 3a0a 2020 2020 2020 2020 2020  ides:.          
-00019040: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00019050: 696e 7428 2255 7369 6e67 2070 6172 616d  int("Using param
-00019060: 6574 6572 2025 733a 2025 7322 2025 2028  eter %s: %s" % (
-00019070: 6f76 6572 7269 6465 2c20 6f76 6572 7269  override, overri
-00019080: 6465 735b 6f76 6572 7269 6465 5d29 290a  des[override])).
-00019090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190a0: 7365 6c66 2e70 6c61 6e28 706c 616e 2c20  self.plan(plan, 
-000190b0: 616e 7369 626c 653d 4661 6c73 652c 2075  ansible=False, u
-000190c0: 726c 3d70 6c61 6e75 726c 2c20 7061 7468  rl=planurl, path
-000190d0: 3d70 6174 682c 2063 6f6e 7461 696e 6572  =path, container
-000190e0: 3d46 616c 7365 2c20 696e 7075 7466 696c  =False, inputfil
-000190f0: 653d 696e 7075 7466 696c 652c 0a20 2020  e=inputfile,.   
-00019100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019110: 2020 2020 2020 206f 7665 7272 6964 6573         overrides
-00019120: 3d6f 7665 7272 6964 6573 2c20 656d 6265  =overrides, embe
-00019130: 6464 6564 3d65 6d62 6564 6465 642c 2064  dded=embedded, d
-00019140: 6f77 6e6c 6f61 643d 646f 776e 6c6f 6164  ownload=download
-00019150: 290a 2020 2020 2020 2020 6966 206b 7562  ).        if kub
-00019160: 6565 6e74 7269 6573 2061 6e64 206e 6f74  eentries and not
-00019170: 206f 6e6c 7961 7373 6574 733a 0a20 2020   onlyassets:.   
-00019180: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-00019190: 2244 6570 6c6f 7969 6e67 204b 7562 6520  "Deploying Kube 
-000191a0: 456e 7472 6965 732e 2e2e 2229 0a20 2020  Entries...").   
-000191b0: 2020 2020 2020 2020 2064 6e73 636c 6965           dnsclie
-000191c0: 6e74 7320 3d20 7b7d 0a20 2020 2020 2020  nts = {}.       
-000191d0: 2020 2020 206b 7562 6574 6872 6561 6465       kubethreade
-000191e0: 6420 3d20 5472 7565 2069 6620 6c65 6e28  d = True if len(
-000191f0: 6b75 6265 656e 7472 6965 7329 203e 2031  kubeentries) > 1
-00019200: 2065 6c73 6520 4661 6c73 650a 2020 2020   else False.    
-00019210: 2020 2020 2020 2020 6966 206b 7562 6574          if kubet
-00019220: 6872 6561 6465 643a 0a20 2020 2020 2020  hreaded:.       
-00019230: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-00019240: 2822 4c61 756e 6368 696e 6720 6561 6368  ("Launching each
-00019250: 2063 6c75 7374 6572 2069 6e20 6120 7468   cluster in a th
-00019260: 7265 6164 2061 7320 7468 6572 6520 6973  read as there is
-00019270: 206d 6f72 6520 7468 616e 206f 6e65 2065   more than one e
-00019280: 6e74 7279 2e2e 2e22 290a 2020 2020 2020  ntry...").      
-00019290: 2020 2020 2020 666f 7220 636c 7573 7465        for cluste
-000192a0: 7220 696e 206b 7562 6565 6e74 7269 6573  r in kubeentries
-000192b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000192c0: 2020 7070 7269 6e74 2866 2244 6570 6c6f    pprint(f"Deplo
-000192d0: 7969 6e67 2043 6c75 7374 6572 207b 636c  ying Cluster {cl
-000192e0: 7573 7465 727d 2e2e 2e22 290a 2020 2020  uster}...").    
-000192f0: 2020 2020 2020 2020 2020 2020 6b75 6265              kube
-00019300: 7072 6f66 696c 6520 3d20 656e 7472 6965  profile = entrie
-00019310: 735b 636c 7573 7465 725d 0a20 2020 2020  s[cluster].     
-00019320: 2020 2020 2020 2020 2020 206b 7562 6563             kubec
-00019330: 6c69 656e 7420 3d20 6b75 6265 7072 6f66  lient = kubeprof
-00019340: 696c 652e 6765 7428 2763 6c69 656e 7427  ile.get('client'
-00019350: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00019360: 2020 6966 206b 7562 6563 6c69 656e 7420    if kubeclient 
-00019370: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00019380: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-00019390: 7265 6e74 636f 6e66 6967 203d 2073 656c  rentconfig = sel
-000193a0: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
-000193b0: 2020 656c 6966 206b 7562 6563 6c69 656e    elif kubeclien
-000193c0: 7420 696e 2073 656c 662e 636c 6965 6e74  t in self.client
-000193d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000193e0: 2020 2020 2020 2063 7572 7265 6e74 636f         currentco
-000193f0: 6e66 6967 203d 204b 636f 6e66 6967 2863  nfig = Kconfig(c
-00019400: 6c69 656e 743d 6b75 6265 636c 6965 6e74  lient=kubeclient
-00019410: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00019420: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00019430: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00019440: 7228 6622 436c 6965 6e74 207b 6b75 6265  r(f"Client {kube
-00019450: 636c 6965 6e74 7d20 6e6f 7420 666f 756e  client} not foun
-00019460: 642e 2073 6b69 7070 6564 2229 0a20 2020  d. skipped").   
-00019470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019480: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-00019490: 2020 2020 2020 2020 2020 6b75 6265 7479            kubety
-000194a0: 7065 203d 206b 7562 6570 726f 6669 6c65  pe = kubeprofile
-000194b0: 2e67 6574 2827 6b75 6265 7479 7065 2729  .get('kubetype')
-000194c0: 206f 7220 6b75 6265 7072 6f66 696c 652e   or kubeprofile.
-000194d0: 6765 7428 2763 6c75 7374 6572 7479 7065  get('clustertype
-000194e0: 272c 2027 6765 6e65 7269 6327 290a 2020  ', 'generic').  
-000194f0: 2020 2020 2020 2020 2020 2020 2020 6b75                ku
-00019500: 6265 5f6f 7665 7272 6964 6573 203d 206f  be_overrides = o
-00019510: 7665 7272 6964 6573 2e63 6f70 7928 290a  verrides.copy().
-00019520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019530: 6b75 6265 5f6f 7665 7272 6964 6573 2e75  kube_overrides.u
-00019540: 7064 6174 6528 6b75 6265 7072 6f66 696c  pdate(kubeprofil
-00019550: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00019560: 2020 206b 7562 655f 6f76 6572 7269 6465     kube_override
-00019570: 735b 2763 6c75 7374 6572 275d 203d 2063  s['cluster'] = c
-00019580: 6c75 7374 6572 0a20 2020 2020 2020 2020  luster.         
-00019590: 2020 2020 2020 2065 7869 7374 696e 675f         existing_
-000195a0: 6374 6c70 6c61 6e65 7320 3d20 5b76 2066  ctlplanes = [v f
-000195b0: 6f72 2076 2069 6e20 6375 7272 656e 7463  or v in currentc
-000195c0: 6f6e 6669 672e 6b2e 6c69 7374 2829 2069  onfig.k.list() i
-000195d0: 6620 6627 7b63 6c75 7374 6572 7d2d 6374  f f'{cluster}-ct
-000195e0: 6c70 6c61 6e65 2720 696e 2076 5b27 6e61  lplane' in v['na
-000195f0: 6d65 275d 5d0a 2020 2020 2020 2020 2020  me']].          
-00019600: 2020 2020 2020 6966 2065 7869 7374 696e        if existin
-00019610: 675f 6374 6c70 6c61 6e65 733a 0a20 2020  g_ctlplanes:.   
-00019620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019630: 2070 7072 696e 7428 6622 436c 7573 7465   pprint(f"Cluste
-00019640: 7220 7b63 6c75 7374 6572 7d20 666f 756e  r {cluster} foun
-00019650: 642e 2073 6b69 7070 6564 2122 290a 2020  d. skipped!").  
-00019660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019670: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-00019680: 2020 2020 2020 2020 2020 2069 6620 6b75             if ku
-00019690: 6265 7479 7065 206e 6f74 2069 6e20 5b27  betype not in ['
-000196a0: 6765 6e65 7269 6327 2c20 276f 7065 6e73  generic', 'opens
-000196b0: 6869 6674 272c 2027 6879 7065 7273 6869  hift', 'hypershi
-000196c0: 6674 272c 2027 6d69 6372 6f73 6869 6674  ft', 'microshift
-000196d0: 272c 2027 6b33 7327 5d3a 0a20 2020 2020  ', 'k3s']:.     
-000196e0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-000196f0: 6172 6e69 6e67 2866 2249 6e63 6f72 7265  arning(f"Incorre
-00019700: 6374 206b 7562 6574 7970 6520 7b6b 7562  ct kubetype {kub
-00019710: 6574 7970 657d 2073 7065 6369 6669 6564  etype} specified
-00019720: 2e20 736b 6970 7065 6421 2229 0a20 2020  . skipped!").   
-00019730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019740: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-00019750: 2020 2020 2020 2020 2020 6966 206b 7562            if kub
-00019760: 6574 6872 6561 6465 643a 0a20 2020 2020  ethreaded:.     
-00019770: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00019780: 7562 655f 6f76 6572 7269 6465 735b 2775  ube_overrides['u
-00019790: 7365 5f65 7869 7374 696e 675f 6f70 656e  se_existing_open
-000197a0: 7368 6966 7427 5d20 3d20 5472 7565 0a20  shift'] = True. 
-000197b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197c0: 2020 206e 6577 5f61 7267 7320 3d20 2870     new_args = (p
-000197d0: 6c61 6e2c 206b 7562 6574 7970 652c 206b  lan, kubetype, k
-000197e0: 7562 655f 6f76 6572 7269 6465 7329 0a20  ube_overrides). 
-000197f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019800: 2020 2074 203d 2074 6872 6561 6469 6e67     t = threading
-00019810: 2e54 6872 6561 6428 7461 7267 6574 3d73  .Thread(target=s
-00019820: 656c 662e 7468 7265 6164 6564 5f63 7265  elf.threaded_cre
-00019830: 6174 655f 6b75 6265 2c20 6172 6773 3d6e  ate_kube, args=n
-00019840: 6577 5f61 7267 7329 0a20 2020 2020 2020  ew_args).       
-00019850: 2020 2020 2020 2020 2020 2020 2074 6872               thr
-00019860: 6561 6473 2e61 7070 656e 6428 7429 0a20  eads.append(t). 
-00019870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019880: 2020 2074 2e73 7461 7274 2829 0a20 2020     t.start().   
-00019890: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-000198a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000198b0: 2020 2020 2020 2063 7572 7265 6e74 636f         currentco
-000198c0: 6e66 6967 2e63 7265 6174 655f 6b75 6265  nfig.create_kube
-000198d0: 2870 6c61 6e2c 206b 7562 6574 7970 652c  (plan, kubetype,
-000198e0: 206f 7665 7272 6964 6573 3d6b 7562 655f   overrides=kube_
-000198f0: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
-00019900: 2020 2076 6d63 6c69 656e 7473 203d 205b     vmclients = [
-00019910: 5d0a 2020 2020 2020 2020 6966 2076 6d65  ].        if vme
-00019920: 6e74 7269 6573 3a0a 2020 2020 2020 2020  ntries:.        
-00019930: 2020 2020 6966 206e 6f74 206f 6e6c 7961      if not onlya
-00019940: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
-00019950: 2020 2020 2020 2070 7072 696e 7428 2244         pprint("D
-00019960: 6570 6c6f 7969 6e67 2056 6d73 2e2e 2e22  eploying Vms..."
-00019970: 290a 2020 2020 2020 2020 2020 2020 766d  ).            vm
-00019980: 636f 756e 7465 7220 3d20 300a 2020 2020  counter = 0.    
-00019990: 2020 2020 2020 2020 686f 7374 7320 3d20          hosts = 
-000199a0: 7b7d 0a20 2020 2020 2020 2020 2020 2076  {}.            v
-000199b0: 6d73 5f74 6f5f 686f 7374 203d 207b 7d0a  ms_to_host = {}.
-000199c0: 2020 2020 2020 2020 2020 2020 6261 7365              base
-000199d0: 706c 616e 7320 3d20 5b5d 0a20 2020 2020  plans = [].     
-000199e0: 2020 2020 2020 2076 6d6e 616d 6573 203d         vmnames =
-000199f0: 205b 6e61 6d65 2066 6f72 206e 616d 6520   [name for name 
-00019a00: 696e 2076 6d65 6e74 7269 6573 5d0a 2020  in vmentries].  
-00019a10: 2020 2020 2020 2020 2020 6966 2062 6173            if bas
-00019a20: 6566 696c 6520 6973 206e 6f74 204e 6f6e  efile is not Non
-00019a30: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00019a40: 2020 2062 6173 6564 6972 203d 206f 732e     basedir = os.
-00019a50: 7061 7468 2e64 6972 6e61 6d65 2869 6e70  path.dirname(inp
-00019a60: 7574 6669 6c65 2920 6966 206f 732e 7061  utfile) if os.pa
-00019a70: 7468 2e69 7361 6273 2869 6e70 7574 6669  th.isabs(inputfi
-00019a80: 6c65 2920 656c 7365 2027 2e27 0a20 2020  le) else '.'.   
-00019a90: 2020 2020 2020 2020 2020 2020 2062 6173               bas
-00019aa0: 6569 6e70 7574 6669 6c65 203d 2066 227b  einputfile = f"{
-00019ab0: 6261 7365 6469 727d 2f7b 6261 7365 6669  basedir}/{basefi
-00019ac0: 6c65 7d22 0a20 2020 2020 2020 2020 2020  le}".           
-00019ad0: 2020 2020 2069 6620 636f 6e74 6169 6e65       if containe
-00019ae0: 725f 6d6f 6465 2829 2061 6e64 206e 6f74  r_mode() and not
-00019af0: 206f 732e 7061 7468 2e69 7361 6273 2862   os.path.isabs(b
-00019b00: 6173 6566 696c 6529 2061 6e64 2027 2f77  asefile) and '/w
-00019b10: 6f72 6b64 6972 2720 6e6f 7420 696e 2062  orkdir' not in b
-00019b20: 6173 6564 6972 3a0a 2020 2020 2020 2020  asedir:.        
-00019b30: 2020 2020 2020 2020 2020 2020 6261 7365              base
-00019b40: 696e 7075 7466 696c 6520 3d20 6622 2f77  inputfile = f"/w
-00019b50: 6f72 6b64 6972 2f7b 6261 7365 6469 727d  orkdir/{basedir}
-00019b60: 2f7b 6261 7365 6669 6c65 7d22 0a20 2020  /{basefile}".   
-00019b70: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00019b80: 756c 7420 3d20 7365 6c66 2e70 6c61 6e28  ult = self.plan(
-00019b90: 706c 616e 2c20 696e 7075 7466 696c 653d  plan, inputfile=
-00019ba0: 6261 7365 696e 7075 7466 696c 652c 206f  baseinputfile, o
-00019bb0: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
-00019bc0: 6573 2c20 6578 636c 7564 6576 6d73 3d76  es, excludevms=v
-00019bd0: 6d6e 616d 6573 2c0a 2020 2020 2020 2020  mnames,.        
-00019be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019bf0: 2020 2020 2020 2020 2020 2062 6173 656d             basem
-00019c00: 6f64 653d 5472 7565 2c20 6f6e 6c79 6173  ode=True, onlyas
-00019c10: 7365 7473 3d6f 6e6c 7961 7373 6574 7329  sets=onlyassets)
-00019c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019c30: 2069 6620 7265 7375 6c74 5b27 7265 7375   if result['resu
-00019c40: 6c74 275d 2021 3d20 2773 7563 6365 7373  lt'] != 'success
-00019c50: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00019c60: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-00019c70: 7375 6c74 0a20 2020 2020 2020 2020 2020  sult.           
-00019c80: 2020 2020 2062 6173 6570 6c61 6e73 2e61       baseplans.a
-00019c90: 7070 656e 6428 6261 7365 6669 6c65 290a  ppend(basefile).
-00019ca0: 2020 2020 2020 2020 2020 2020 766d 7275              vmru
-00019cb0: 6c65 735f 7374 7269 6374 203d 206f 7665  les_strict = ove
-00019cc0: 7272 6964 6573 2e67 6574 2827 766d 7275  rrides.get('vmru
-00019cd0: 6c65 735f 7374 7269 6374 272c 2073 656c  les_strict', sel
-00019ce0: 662e 766d 7275 6c65 735f 7374 7269 6374  f.vmrules_strict
-00019cf0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-00019d00: 7220 6e61 6d65 2069 6e20 766d 656e 7472  r name in vmentr
-00019d10: 6965 733a 0a20 2020 2020 2020 2020 2020  ies:.           
-00019d20: 2020 2020 2069 6620 6e61 6d65 2069 6e20       if name in 
-00019d30: 6578 636c 7564 6576 6d73 3a0a 2020 2020  excludevms:.    
-00019d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d50: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-00019d60: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-00019d70: 706c 616e 6469 7220 3d20 6261 7365 6469  plandir = basedi
-00019d80: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-00019d90: 2020 6966 206c 656e 2876 6d65 6e74 7269    if len(vmentri
-00019da0: 6573 2920 3d3d 2031 2061 6e64 2027 6e61  es) == 1 and 'na
-00019db0: 6d65 2720 696e 206f 7665 7272 6964 6573  me' in overrides
-00019dc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019dd0: 2020 2020 2020 6e65 776e 616d 6520 3d20        newname = 
-00019de0: 6f76 6572 7269 6465 735b 276e 616d 6527  overrides['name'
-00019df0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00019e00: 2020 2020 2020 7072 6f66 696c 6520 3d20        profile = 
-00019e10: 656e 7472 6965 735b 6e61 6d65 5d0a 2020  entries[name].  
-00019e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e30: 2020 6e61 6d65 203d 206e 6577 6e61 6d65    name = newname
-00019e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019e50: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00019e60: 2020 2020 2020 2020 2020 2070 726f 6669             profi
-00019e70: 6c65 203d 2065 6e74 7269 6573 5b6e 616d  le = entries[nam
-00019e80: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
-00019e90: 2020 2069 6620 276e 616d 6527 2069 6e20     if 'name' in 
-00019ea0: 7072 6f66 696c 653a 0a20 2020 2020 2020  profile:.       
-00019eb0: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-00019ec0: 6520 3d20 7072 6f66 696c 655b 276e 616d  e = profile['nam
-00019ed0: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
-00019ee0: 2020 2020 6966 2027 6261 7365 766d 2720      if 'basevm' 
-00019ef0: 696e 2070 726f 6669 6c65 206f 7220 2762  in profile or 'b
-00019f00: 6173 6570 6c61 6e27 2069 6e20 7072 6f66  aseplan' in prof
-00019f10: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-00019f20: 2020 2020 2020 2020 2062 6173 6570 726f           basepro
-00019f30: 6669 6c65 203d 207b 7d0a 2020 2020 2020  file = {}.      
-00019f40: 2020 2020 2020 2020 2020 2020 2020 6170                ap
-00019f50: 7065 6e64 6b65 7973 203d 205b 2764 6973  pendkeys = ['dis
-00019f60: 6b73 272c 2027 6e65 7473 272c 2027 6669  ks', 'nets', 'fi
-00019f70: 6c65 7327 2c20 2773 6372 6970 7473 272c  les', 'scripts',
-00019f80: 2027 636d 6473 275d 0a20 2020 2020 2020   'cmds'].       
-00019f90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00019fa0: 2762 6173 6570 6c61 6e27 2069 6e20 7072  'baseplan' in pr
-00019fb0: 6f66 696c 653a 0a20 2020 2020 2020 2020  ofile:.         
-00019fc0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00019fd0: 6173 6570 6c61 6e20 3d20 7072 6f66 696c  aseplan = profil
-00019fe0: 655b 2762 6173 6570 6c61 6e27 5d0a 2020  e['baseplan'].  
-00019ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a000: 2020 2020 2020 6261 7365 6469 7220 3d20        basedir = 
-0001a010: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
-0001a020: 696e 7075 7466 696c 6529 2069 6620 272f  inputfile) if '/
-0001a030: 2720 696e 2069 6e70 7574 6669 6c65 2065  ' in inputfile e
-0001a040: 6c73 6520 272e 270a 2020 2020 2020 2020  lse '.'.        
-0001a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a060: 6261 7365 696e 7075 7466 696c 6520 3d20  baseinputfile = 
-0001a070: 6622 7b62 6173 6564 6972 7d2f 7b62 6173  f"{basedir}/{bas
-0001a080: 6570 6c61 6e7d 220a 2020 2020 2020 2020  eplan}".        
-0001a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a0a0: 6966 2063 6f6e 7461 696e 6572 5f6d 6f64  if container_mod
-0001a0b0: 6528 2920 616e 6420 6e6f 7420 6f73 2e70  e() and not os.p
-0001a0c0: 6174 682e 6973 6162 7328 6261 7365 706c  ath.isabs(basepl
-0001a0d0: 616e 2920 616e 6420 272f 776f 726b 6469  an) and '/workdi
-0001a0e0: 7227 206e 6f74 2069 6e20 6261 7365 6469  r' not in basedi
-0001a0f0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-0001a100: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001a110: 6173 6569 6e70 7574 6669 6c65 203d 2066  aseinputfile = f
-0001a120: 222f 776f 726b 6469 722f 7b62 6173 6564  "/workdir/{based
-0001a130: 6972 7d2f 7b62 6173 6570 6c61 6e7d 220a  ir}/{baseplan}".
-0001a140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a150: 2020 2020 2020 2020 6261 7365 766d 203d          basevm =
-0001a160: 2070 726f 6669 6c65 5b27 6261 7365 766d   profile['basevm
-0001a170: 275d 2069 6620 2762 6173 6576 6d27 2069  '] if 'basevm' i
-0001a180: 6e20 7072 6f66 696c 6520 656c 7365 206e  n profile else n
-0001a190: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-0001a1a0: 2020 2020 2020 2020 2020 2020 6966 2062              if b
-0001a1b0: 6173 6570 6c61 6e20 6e6f 7420 696e 2062  aseplan not in b
-0001a1c0: 6173 6570 6c61 6e73 3a0a 2020 2020 2020  aseplans:.      
-0001a1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a1e0: 2020 2020 2020 7365 6c66 2e70 6c61 6e28        self.plan(
-0001a1f0: 706c 616e 2c20 696e 7075 7466 696c 653d  plan, inputfile=
-0001a200: 6261 7365 696e 7075 7466 696c 652c 206f  baseinputfile, o
-0001a210: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
-0001a220: 6573 2c20 6578 636c 7564 6576 6d73 3d76  es, excludevms=v
-0001a230: 6d6e 616d 6573 2c0a 2020 2020 2020 2020  mnames,.        
-0001a240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a250: 2020 2020 2020 2020 2020 2020 2020 6261                ba
-0001a260: 7365 6d6f 6465 3d54 7275 652c 206f 6e6c  semode=True, onl
-0001a270: 7961 7373 6574 733d 6f6e 6c79 6173 7365  yassets=onlyasse
-0001a280: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
-0001a290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a2a0: 6261 7365 706c 616e 732e 6170 7065 6e64  baseplans.append
-0001a2b0: 2862 6173 6570 6c61 6e29 0a20 2020 2020  (baseplan).     
-0001a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a2d0: 2020 2062 6173 6569 6e66 6f20 3d20 7365     baseinfo = se
-0001a2e0: 6c66 2e70 726f 6365 7373 5f69 6e70 7574  lf.process_input
-0001a2f0: 6669 6c65 2870 6c61 6e2c 2062 6173 6569  file(plan, basei
-0001a300: 6e70 7574 6669 6c65 2c20 6f76 6572 7269  nputfile, overri
-0001a310: 6465 733d 6f76 6572 7269 6465 732c 2066  des=overrides, f
-0001a320: 756c 6c3d 5472 7565 290a 2020 2020 2020  ull=True).      
-0001a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a340: 2020 6261 7365 7072 6f66 696c 6520 3d20    baseprofile = 
-0001a350: 6261 7365 696e 666f 5b30 5d5b 6261 7365  baseinfo[0][base
-0001a360: 766d 5d20 6966 2062 6173 6576 6d20 696e  vm] if basevm in
-0001a370: 2062 6173 6569 6e66 6f5b 305d 2065 6c73   baseinfo[0] els
-0001a380: 6520 7b7d 0a20 2020 2020 2020 2020 2020  e {}.           
-0001a390: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-0001a3a0: 7265 6e74 706c 616e 6469 7220 3d20 6261  rentplandir = ba
-0001a3b0: 7365 696e 666f 5b33 5d20 6966 206f 732e  seinfo[3] if os.
-0001a3c0: 7061 7468 2e69 7361 6273 2862 6173 6569  path.isabs(basei
-0001a3d0: 6e66 6f5b 335d 2920 656c 7365 2027 2e27  nfo[3]) else '.'
-0001a3e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a3f0: 2020 2020 2065 6c69 6620 2762 6173 6576       elif 'basev
-0001a400: 6d27 2069 6e20 7072 6f66 696c 6520 616e  m' in profile an
-0001a410: 6420 7072 6f66 696c 655b 2762 6173 6576  d profile['basev
-0001a420: 6d27 5d20 696e 2062 6173 6565 6e74 7269  m'] in baseentri
-0001a430: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0001a440: 2020 2020 2020 2020 2020 2020 6261 7365              base
-0001a450: 7072 6f66 696c 6520 3d20 6261 7365 656e  profile = baseen
-0001a460: 7472 6965 735b 7072 6f66 696c 655b 2762  tries[profile['b
-0001a470: 6173 6576 6d27 5d5d 0a20 2020 2020 2020  asevm']].       
-0001a480: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0001a490: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001a4a0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-0001a4b0: 6e67 2866 2249 6e63 6f72 7265 6374 2062  ng(f"Incorrect b
-0001a4c0: 6173 6520 656e 7472 7920 666f 7220 7b6e  ase entry for {n
-0001a4d0: 616d 657d 2e20 536b 6970 7069 6e67 2e2e  ame}. Skipping..
-0001a4e0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-0001a4f0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0001a500: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-0001a510: 2020 2020 2020 2020 2066 6f72 206b 6579           for key
-0001a520: 2069 6e20 6261 7365 7072 6f66 696c 653a   in baseprofile:
-0001a530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a540: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
-0001a550: 6e6f 7420 696e 2070 726f 6669 6c65 3a0a  not in profile:.
-0001a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a570: 2020 2020 2020 2020 2020 2020 7072 6f66              prof
-0001a580: 696c 655b 6b65 795d 203d 2062 6173 6570  ile[key] = basep
-0001a590: 726f 6669 6c65 5b6b 6579 5d0a 2020 2020  rofile[key].    
-0001a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5b0: 2020 2020 656c 6966 206b 6579 2069 6e20      elif key in 
-0001a5c0: 6261 7365 7072 6f66 696c 6520 616e 6420  baseprofile and 
-0001a5d0: 6b65 7920 696e 2070 726f 6669 6c65 2061  key in profile a
-0001a5e0: 6e64 206b 6579 2069 6e20 6170 7065 6e64  nd key in append
-0001a5f0: 6b65 7973 3a0a 2020 2020 2020 2020 2020  keys:.          
-0001a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a610: 2020 7072 6f66 696c 655b 6b65 795d 203d    profile[key] =
-0001a620: 2062 6173 6570 726f 6669 6c65 5b6b 6579   baseprofile[key
-0001a630: 5d20 2b20 7072 6f66 696c 655b 6b65 795d  ] + profile[key]
-0001a640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a650: 2072 756c 6566 6f75 6e64 203d 2046 616c   rulefound = Fal
-0001a660: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
-0001a670: 2020 2066 6f72 2065 6e74 7279 2069 6e20     for entry in 
-0001a680: 6f76 6572 7269 6465 732e 6765 7428 2776  overrides.get('v
-0001a690: 6d72 756c 6573 272c 2073 656c 662e 766d  mrules', self.vm
-0001a6a0: 7275 6c65 7329 3a0a 2020 2020 2020 2020  rules):.        
-0001a6b0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0001a6c0: 656e 2865 6e74 7279 2920 213d 2031 3a0a  en(entry) != 1:.
-0001a6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6e0: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
-0001a6f0: 5772 6f6e 6720 766d 2072 756c 6520 7b65  Wrong vm rule {e
-0001a700: 6e74 7279 7d22 290a 2020 2020 2020 2020  ntry}").        
-0001a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a720: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
+000168d0: 2020 2020 2020 2020 2020 6966 2063 6f6d            if com
+000168e0: 6d6f 6e2e 7572 6c5f 6578 6973 7473 2866  mon.url_exists(f
+000168f0: 227b 6f6e 666c 797d 2f7b 6f72 6967 696e  "{onfly}/{origin
+00016900: 7d2f 5245 4144 4d45 2e6d 6422 293a 0a20  }/README.md"):. 
+00016910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016930: 2020 206f 732e 6d61 6b65 6469 7273 286f     os.makedirs(o
+00016940: 7269 6769 6e2c 2065 7869 7374 5f6f 6b3d  rigin, exist_ok=
+00016950: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00016960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016970: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00016980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000169a0: 7070 7269 6e74 2866 2266 696c 6520 7b6f  pprint(f"file {o
+000169b0: 6e66 6c79 7d2f 7b6f 7269 6769 6e7d 2073  nfly}/{origin} s
+000169c0: 6b69 7070 6564 2229 0a20 2020 2020 2020  kipped").       
+000169d0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000169e0: 2073 6372 6970 7420 696e 2073 6372 6970   script in scrip
+000169f0: 7466 696c 6573 3a0a 2020 2020 2020 2020  tfiles:.        
+00016a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a10: 6966 2027 7e27 206e 6f74 2069 6e20 7363  if '~' not in sc
+00016a20: 7269 7074 3a0a 2020 2020 2020 2020 2020  ript:.          
+00016a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a40: 2020 6465 7374 6469 7220 3d20 222e 220a    destdir = ".".
+00016a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a60: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00016a70: 2f27 2069 6e20 7363 7269 7074 3a0a 2020  /' in script:.  
+00016a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a90: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00016aa0: 7374 6469 7220 3d20 6f73 2e70 6174 682e  stdir = os.path.
+00016ab0: 6469 726e 616d 6528 7363 7269 7074 290a  dirname(script).
+00016ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ae0: 6f73 2e6d 616b 6564 6972 7328 6465 7374  os.makedirs(dest
+00016af0: 6469 722c 2065 7869 7374 5f6f 6b3d 5472  dir, exist_ok=Tr
+00016b00: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00016b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b20: 7070 7269 6e74 2866 2252 6574 7269 6576  pprint(f"Retriev
+00016b30: 696e 6720 7363 7269 7074 207b 6f6e 666c  ing script {onfl
+00016b40: 797d 2f7b 7363 7269 7074 7d22 290a 2020  y}/{script}").  
+00016b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b60: 2020 2020 2020 2020 2020 636f 6d6d 6f6e            common
+00016b70: 2e66 6574 6368 2866 227b 6f6e 666c 797d  .fetch(f"{onfly}
+00016b80: 2f7b 7363 7269 7074 7d22 2c20 6465 7374  /{script}", dest
+00016b90: 6469 7229 0a20 2020 2020 2020 2020 2020  dir).           
+00016ba0: 2020 2020 206f 732e 6368 6469 7228 272e       os.chdir('.
+00016bb0: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
+00016bc0: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
+00016bd0: 756c 7427 3a20 2773 7563 6365 7373 277d  ult': 'success'}
+00016be0: 0a20 2020 2020 2020 2069 6620 696e 7075  .        if inpu
+00016bf0: 7473 7472 696e 6720 6973 206e 6f74 204e  tstring is not N
+00016c00: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00016c10: 2069 6e70 7574 6669 6c65 203d 2066 2274   inputfile = f"t
+00016c20: 656d 705f 706c 616e 5f7b 706c 616e 7d2e  emp_plan_{plan}.
+00016c30: 796d 6c22 0a20 2020 2020 2020 2020 2020  yml".           
+00016c40: 2077 6974 6820 6f70 656e 2869 6e70 7574   with open(input
+00016c50: 6669 6c65 2c20 2277 2229 2061 7320 663a  file, "w") as f:
+00016c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016c70: 2066 2e77 7269 7465 2869 6e70 7574 7374   f.write(inputst
+00016c80: 7269 6e67 290a 2020 2020 2020 2020 6966  ring).        if
+00016c90: 2069 6e70 7574 6669 6c65 2069 7320 4e6f   inputfile is No
+00016ca0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00016cb0: 696e 7075 7466 696c 6520 3d20 276b 636c  inputfile = 'kcl
+00016cc0: 695f 706c 616e 2e79 6d6c 270a 2020 2020  i_plan.yml'.    
+00016cd0: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
+00016ce0: 7573 696e 6720 6465 6661 756c 7420 696e  using default in
+00016cf0: 7075 7420 6669 6c65 206b 636c 695f 706c  put file kcli_pl
+00016d00: 616e 2e79 6d6c 2229 0a20 2020 2020 2020  an.yml").       
+00016d10: 2069 6620 7061 7468 2069 7320 6e6f 7420   if path is not 
+00016d20: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00016d30: 2020 6f73 2e63 6864 6972 2870 6174 6829    os.chdir(path)
+00016d40: 0a20 2020 2020 2020 2020 2020 2067 6574  .            get
+00016d50: 6261 636b 203d 2054 7275 650a 2020 2020  back = True.    
+00016d60: 2020 2020 696e 7075 7466 696c 6520 3d20      inputfile = 
+00016d70: 6f73 2e70 6174 682e 6578 7061 6e64 7573  os.path.expandus
+00016d80: 6572 2869 6e70 7574 6669 6c65 290a 2020  er(inputfile).  
+00016d90: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
+00016da0: 7061 7468 2e65 7869 7374 7328 696e 7075  path.exists(inpu
+00016db0: 7466 696c 6529 3a0a 2020 2020 2020 2020  tfile):.        
+00016dc0: 2020 2020 6572 726f 7228 6622 496e 7075      error(f"Inpu
+00016dd0: 7420 6669 6c65 207b 696e 7075 7466 696c  t file {inputfil
+00016de0: 657d 206e 6f74 2066 6f75 6e64 2e4c 6561  e} not found.Lea
+00016df0: 7669 6e67 2e2e 2e2e 2229 0a20 2020 2020  ving....").     
+00016e00: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+00016e10: 3129 0a20 2020 2020 2020 2065 6c69 6620  1).        elif 
+00016e20: 6f73 2e70 6174 682e 6973 6469 7228 696e  os.path.isdir(in
+00016e30: 7075 7466 696c 6529 3a0a 2020 2020 2020  putfile):.      
+00016e40: 2020 2020 2020 696e 7075 7466 696c 6520        inputfile 
+00016e50: 3d20 6622 7b69 6e70 7574 6669 6c65 7d2f  = f"{inputfile}/
+00016e60: 6b63 6c69 5f70 6c61 6e2e 796d 6c22 0a20  kcli_plan.yml". 
+00016e70: 2020 2020 2020 2069 6620 696e 666f 3a0a         if info:.
+00016e80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00016e90: 2e69 6e66 6f5f 706c 616e 2869 6e70 7574  .info_plan(input
+00016ea0: 6669 6c65 2c20 6f6e 666c 793d 6f6e 666c  file, onfly=onfl
+00016eb0: 792c 2071 7569 6574 3d71 7569 6574 2c20  y, quiet=quiet, 
+00016ec0: 646f 633d 646f 6329 0a20 2020 2020 2020  doc=doc).       
+00016ed0: 2020 2020 2069 6620 746f 636c 6561 6e3a       if toclean:
+00016ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016ef0: 206f 732e 6368 6469 7228 272e 2e27 290a   os.chdir('..').
+00016f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f10: 726d 7472 6565 2870 6174 6829 0a20 2020  rmtree(path).   
+00016f20: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00016f30: 7b27 7265 7375 6c74 273a 2027 7375 6363  {'result': 'succ
+00016f40: 6573 7327 7d0a 2020 2020 2020 2020 6261  ess'}.        ba
+00016f50: 7365 656e 7472 6965 7320 3d20 7b7d 0a20  seentries = {}. 
+00016f60: 2020 2020 2020 2065 6e74 7269 6573 2c20         entries, 
+00016f70: 6f76 6572 7269 6465 732c 2062 6173 6566  overrides, basef
+00016f80: 696c 652c 2062 6173 6564 6972 203d 2073  ile, basedir = s
+00016f90: 656c 662e 7072 6f63 6573 735f 696e 7075  elf.process_inpu
+00016fa0: 7466 696c 6528 706c 616e 2c20 696e 7075  tfile(plan, inpu
+00016fb0: 7466 696c 652c 206f 7665 7272 6964 6573  tfile, overrides
+00016fc0: 3d6f 7665 7272 6964 6573 2c0a 2020 2020  =overrides,.    
+00016fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017010: 2020 206f 6e66 6c79 3d6f 6e66 6c79 2c20     onfly=onfly, 
+00017020: 6675 6c6c 3d54 7275 6529 0a20 2020 2020  full=True).     
+00017030: 2020 2069 6620 6261 7365 6669 6c65 2069     if basefile i
+00017040: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00017050: 2020 2020 2020 2020 6261 7365 696e 666f          baseinfo
+00017060: 203d 2073 656c 662e 7072 6f63 6573 735f   = self.process_
+00017070: 696e 7075 7466 696c 6528 706c 616e 2c20  inputfile(plan, 
+00017080: 6622 7b62 6173 6564 6972 7d2f 7b62 6173  f"{basedir}/{bas
+00017090: 6566 696c 657d 222c 206f 7665 7272 6964  efile}", overrid
+000170a0: 6573 3d6f 7665 7272 6964 6573 2c20 6675  es=overrides, fu
+000170b0: 6c6c 3d54 7275 6529 0a20 2020 2020 2020  ll=True).       
+000170c0: 2020 2020 2062 6173 6565 6e74 7269 6573       baseentries
+000170d0: 2c20 6261 7365 6f76 6572 7269 6465 7320  , baseoverrides 
+000170e0: 3d20 6261 7365 696e 666f 5b30 5d2c 2062  = baseinfo[0], b
+000170f0: 6173 6569 6e66 6f5b 315d 0a20 2020 2020  aseinfo[1].     
+00017100: 2020 2020 2020 2069 6620 6261 7365 6f76         if baseov
+00017110: 6572 7269 6465 733a 0a20 2020 2020 2020  errides:.       
+00017120: 2020 2020 2020 2020 206f 7665 7272 6964           overrid
+00017130: 6573 2e75 7064 6174 6528 7b6b 6579 3a20  es.update({key: 
+00017140: 6261 7365 6f76 6572 7269 6465 735b 6b65  baseoverrides[ke
+00017150: 795d 2066 6f72 206b 6579 2069 6e20 6261  y] for key in ba
+00017160: 7365 6f76 6572 7269 6465 7320 6966 206b  seoverrides if k
+00017170: 6579 206e 6f74 2069 6e20 6f76 6572 7269  ey not in overri
+00017180: 6465 737d 290a 2020 2020 2020 2020 6966  des}).        if
+00017190: 2065 6e74 7269 6573 2069 7320 4e6f 6e65   entries is None
+000171a0: 3a0a 2020 2020 2020 2020 2020 2020 656e  :.            en
+000171b0: 7472 6965 7320 3d20 7b7d 0a20 2020 2020  tries = {}.     
+000171c0: 2020 2069 6620 7365 6c66 2e64 6562 7567     if self.debug
+000171d0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+000171e0: 696e 7428 7961 6d6c 2e64 756d 7028 656e  int(yaml.dump(en
+000171f0: 7472 6965 7329 290a 2020 2020 2020 2020  tries)).        
+00017200: 7061 7261 6d65 7465 7273 203d 2065 6e74  parameters = ent
+00017210: 7269 6573 2e67 6574 2827 7061 7261 6d65  ries.get('parame
+00017220: 7465 7273 2729 0a20 2020 2020 2020 2069  ters').        i
+00017230: 6620 7061 7261 6d65 7465 7273 2069 7320  f parameters is 
+00017240: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00017250: 2020 2020 2020 6465 6c20 656e 7472 6965        del entrie
+00017260: 735b 2770 6172 616d 6574 6572 7327 5d0a  s['parameters'].
+00017270: 2020 2020 2020 2020 6469 6374 5f74 7970          dict_typ
+00017280: 6573 203d 205b 656e 7472 7920 666f 7220  es = [entry for 
+00017290: 656e 7472 7920 696e 2065 6e74 7269 6573  entry in entries
+000172a0: 2069 6620 6973 696e 7374 616e 6365 2865   if isinstance(e
+000172b0: 6e74 7269 6573 5b65 6e74 7279 5d2c 2064  ntries[entry], d
+000172c0: 6963 7429 5d0a 2020 2020 2020 2020 6966  ict)].        if
+000172d0: 206e 6f74 2064 6963 745f 7479 7065 733a   not dict_types:
+000172e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000172f0: 6261 7365 6d6f 6465 3a0a 2020 2020 2020  basemode:.      
+00017300: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+00017310: 6728 6622 7b69 6e70 7574 6669 6c65 7d20  g(f"{inputfile} 
+00017320: 646f 6573 6e27 7420 6c6f 6f6b 206c 696b  doesn't look lik
+00017330: 6520 6120 7661 6c69 6420 706c 616e 2e53  e a valid plan.S
+00017340: 6b69 7070 696e 672e 2e2e 2e22 290a 2020  kipping....").  
+00017350: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00017360: 7475 726e 207b 2272 6573 756c 7422 3a20  turn {"result": 
+00017370: 2273 7563 6365 7373 227d 0a20 2020 2020  "success"}.     
+00017380: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00017390: 2020 2020 2020 2020 2020 2020 206d 7367               msg
+000173a0: 203d 2066 227b 696e 7075 7466 696c 657d   = f"{inputfile}
+000173b0: 2064 6f65 736e 2774 206c 6f6f 6b20 6c69   doesn't look li
+000173c0: 6b65 2061 2076 616c 6964 2070 6c61 6e20  ke a valid plan 
+000173d0: 6669 6c65 2e20 4d61 7962 6520 796f 7520  file. Maybe you 
+000173e0: 7072 6f76 6964 6564 2061 2070 6172 616d  provided a param
+000173f0: 6574 6572 2066 696c 6520 3f22 0a20 2020  eter file ?".   
+00017400: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00017410: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
+00017420: 6661 696c 7572 6527 2c20 2772 6561 736f  failure', 'reaso
+00017430: 6e27 3a20 6d73 677d 0a20 2020 2020 2020  n': msg}.       
+00017440: 2069 6e70 7574 6469 7220 3d20 6f73 2e70   inputdir = os.p
+00017450: 6174 682e 6469 726e 616d 6528 696e 7075  ath.dirname(inpu
+00017460: 7466 696c 6529 2069 6620 6f73 2e70 6174  tfile) if os.pat
+00017470: 682e 6469 726e 616d 6528 696e 7075 7466  h.dirname(inputf
+00017480: 696c 6529 2021 3d20 2727 2061 6e64 206f  ile) != '' and o
+00017490: 732e 7061 7468 2e69 7361 6273 2869 6e70  s.path.isabs(inp
+000174a0: 7574 6669 6c65 2920 656c 7365 2027 2e27  utfile) else '.'
+000174b0: 0a20 2020 2020 2020 2070 7265 5f62 6173  .        pre_bas
+000174c0: 6520 3d20 6f73 2e70 6174 682e 7370 6c69  e = os.path.spli
+000174d0: 7465 7874 286f 732e 7061 7468 2e62 6173  text(os.path.bas
+000174e0: 656e 616d 6528 696e 7075 7466 696c 6529  ename(inputfile)
+000174f0: 295b 305d 0a20 2020 2020 2020 2070 7265  )[0].        pre
+00017500: 5f73 6372 6970 7420 3d20 6627 7b69 6e70  _script = f'{inp
+00017510: 7574 6469 727d 2f6b 636c 695f 7072 652e  utdir}/kcli_pre.
+00017520: 7368 2720 6966 2070 7265 5f62 6173 6520  sh' if pre_base 
+00017530: 3d3d 2027 6b63 6c69 5f70 6c61 6e27 2065  == 'kcli_plan' e
+00017540: 6c73 6520 6622 7b69 6e70 7574 6469 727d  lse f"{inputdir}
+00017550: 2f7b 7072 655f 6261 7365 7d5f 7072 652e  /{pre_base}_pre.
+00017560: 7368 220a 2020 2020 2020 2020 6966 206f  sh".        if o
+00017570: 732e 7061 7468 2e65 7869 7374 7328 7072  s.path.exists(pr
+00017580: 655f 7363 7269 7074 293a 0a20 2020 2020  e_script):.     
+00017590: 2020 2020 2020 2070 7265 5f73 6372 6970         pre_scrip
+000175a0: 745f 7368 6f72 7420 3d20 6f73 2e70 6174  t_short = os.pat
+000175b0: 682e 6261 7365 6e61 6d65 2870 7265 5f73  h.basename(pre_s
+000175c0: 6372 6970 7429 0a20 2020 2020 2020 2020  cript).         
+000175d0: 2020 2069 6620 7072 653a 0a20 2020 2020     if pre:.     
+000175e0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+000175f0: 7428 6622 5275 6e6e 696e 6720 7b70 7265  t(f"Running {pre
+00017600: 5f73 6372 6970 745f 7368 6f72 747d 2229  _script_short}")
+00017610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017620: 2077 6974 6820 5465 6d70 6f72 6172 7944   with TemporaryD
+00017630: 6972 6563 746f 7279 2829 2061 7320 746d  irectory() as tm
+00017640: 7064 6972 3a0a 2020 2020 2020 2020 2020  pdir:.          
+00017650: 2020 2020 2020 2020 2020 7072 655f 7363            pre_sc
+00017660: 7269 7074 203d 2073 656c 662e 7072 6f63  ript = self.proc
+00017670: 6573 735f 696e 7075 7466 696c 6528 2778  ess_inputfile('x
+00017680: 7878 272c 2070 7265 5f73 6372 6970 742c  xx', pre_script,
+00017690: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
+000176a0: 6964 6573 290a 2020 2020 2020 2020 2020  ides).          
+000176b0: 2020 2020 2020 2020 2020 7769 7468 206f            with o
+000176c0: 7065 6e28 6622 7b74 6d70 6469 727d 2f70  pen(f"{tmpdir}/p
+000176d0: 7265 2e73 6822 2c20 2777 2729 2061 7320  re.sh", 'w') as 
+000176e0: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
+000176f0: 2020 2020 2020 2020 2020 2066 2e77 7269             f.wri
+00017700: 7465 2870 7265 5f73 6372 6970 7429 0a20  te(pre_script). 
+00017710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017720: 2020 2070 7265 5f72 756e 203d 2072 756e     pre_run = run
+00017730: 2866 2762 6173 6820 7b74 6d70 6469 727d  (f'bash {tmpdir}
+00017740: 2f70 7265 2e73 6827 2c20 7368 656c 6c3d  /pre.sh', shell=
+00017750: 5472 7565 2c20 7374 646f 7574 3d50 4950  True, stdout=PIP
+00017760: 452c 2073 7464 6572 723d 5354 444f 5554  E, stderr=STDOUT
+00017770: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00017780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017790: 2020 2020 756e 6976 6572 7361 6c5f 6e65      universal_ne
+000177a0: 776c 696e 6573 3d54 7275 6529 0a20 2020  wlines=True).   
+000177b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177c0: 2069 6620 7072 655f 7275 6e2e 7265 7475   if pre_run.retu
+000177d0: 726e 636f 6465 2021 3d20 303a 0a20 2020  rncode != 0:.   
+000177e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177f0: 2020 2020 206d 7367 203d 2066 2249 7373       msg = f"Iss
+00017800: 7565 2077 6865 6e20 7275 6e6e 696e 6720  ue when running 
+00017810: 7b70 7265 5f73 6372 6970 745f 7368 6f72  {pre_script_shor
+00017820: 747d 203a 5c6e 7b70 7265 5f72 756e 2e73  t} :\n{pre_run.s
+00017830: 7464 6f75 747d 220a 2020 2020 2020 2020  tdout}".        
+00017840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017850: 6572 726f 7228 6d73 6729 0a20 2020 2020  error(msg).     
+00017860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017870: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+00017880: 6c74 273a 2027 6661 696c 7572 6527 2c20  lt': 'failure', 
+00017890: 2772 6561 736f 6e27 3a20 6d73 677d 0a20  'reason': msg}. 
+000178a0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000178b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000178c0: 2077 6172 6e69 6e67 2866 2253 6b69 7070   warning(f"Skipp
+000178d0: 696e 6720 7b70 7265 5f73 6372 6970 745f  ing {pre_script_
+000178e0: 7368 6f72 747d 2061 7320 7265 7175 6573  short} as reques
+000178f0: 7465 6422 290a 2020 2020 2020 2020 6b65  ted").        ke
+00017900: 7977 6f72 6473 203d 2073 656c 662e 6c69  ywords = self.li
+00017910: 7374 5f6b 6579 776f 7264 7328 290a 2020  st_keywords().  
+00017920: 2020 2020 2020 666f 7220 6b65 7920 696e        for key in
+00017930: 2073 6f72 7465 6428 6f76 6572 7269 6465   sorted(override
+00017940: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00017950: 6966 206b 6579 2069 6e20 6b65 7977 6f72  if key in keywor
+00017960: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
+00017970: 2020 2020 6b65 795f 7661 6c75 6520 3d20      key_value = 
+00017980: 6765 7461 7474 7228 7365 6c66 2c20 6b65  getattr(self, ke
+00017990: 7929 0a20 2020 2020 2020 2020 2020 2020  y).             
+000179a0: 2020 206b 6579 5f74 7970 6520 3d20 7479     key_type = ty
+000179b0: 7065 286b 6579 5f76 616c 7565 290a 2020  pe(key_value).  
+000179c0: 2020 2020 2020 2020 2020 2020 2020 6f76                ov
+000179d0: 6572 7269 6465 5f6b 6579 5f74 7970 6520  erride_key_type 
+000179e0: 3d20 7479 7065 286f 7665 7272 6964 6573  = type(overrides
+000179f0: 5b6b 6579 5d29 0a20 2020 2020 2020 2020  [key]).         
+00017a00: 2020 2020 2020 2069 6620 6b65 795f 7661         if key_va
+00017a10: 6c75 6520 6973 206e 6f74 204e 6f6e 6520  lue is not None 
+00017a20: 616e 6420 6f76 6572 7269 6465 735b 6b65  and overrides[ke
+00017a30: 795d 2069 7320 6e6f 7420 4e6f 6e65 2061  y] is not None a
+00017a40: 6e64 206b 6579 5f74 7970 6520 213d 206f  nd key_type != o
+00017a50: 7665 7272 6964 655f 6b65 795f 7479 7065  verride_key_type
+00017a60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017a70: 2020 2020 2020 6572 726f 7228 6622 5468        error(f"Th
+00017a80: 6520 7072 6f76 6964 6564 2070 6172 616d  e provided param
+00017a90: 6574 6572 207b 6b65 797d 2068 6173 2061  eter {key} has a
+00017aa0: 2077 726f 6e67 2074 7970 6520 7b6f 7665   wrong type {ove
+00017ab0: 7272 6964 655f 6b65 795f 7479 7065 7d2c  rride_key_type},
+00017ac0: 2069 7420 7368 6f75 6c64 2062 6520 7b6b   it should be {k
+00017ad0: 6579 5f74 7970 657d 2229 0a20 2020 2020  ey_type}").     
+00017ae0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00017af0: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
+00017b00: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00017b10: 6f76 6572 7269 6465 735b 6b65 795d 2069  overrides[key] i
+00017b20: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00017b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b40: 7365 7461 7474 7228 7365 6c66 2c20 6b65  setattr(self, ke
+00017b50: 792c 206f 7665 7272 6964 6573 5b6b 6579  y, overrides[key
+00017b60: 5d29 0a20 2020 2020 2020 2076 6d65 6e74  ]).        vment
+00017b70: 7269 6573 203d 205b 656e 7472 7920 666f  ries = [entry fo
+00017b80: 7220 656e 7472 7920 696e 2065 6e74 7269  r entry in entri
+00017b90: 6573 2069 6620 2774 7970 6527 206e 6f74  es if 'type' not
+00017ba0: 2069 6e20 656e 7472 6965 735b 656e 7472   in entries[entr
+00017bb0: 795d 206f 7220 656e 7472 6965 735b 656e  y] or entries[en
+00017bc0: 7472 795d 5b27 7479 7065 275d 203d 3d20  try]['type'] == 
+00017bd0: 2776 6d27 5d0a 2020 2020 2020 2020 6469  'vm'].        di
+00017be0: 736b 656e 7472 6965 7320 3d20 5b65 6e74  skentries = [ent
+00017bf0: 7279 2066 6f72 2065 6e74 7279 2069 6e20  ry for entry in 
+00017c00: 656e 7472 6965 7320 6966 2027 7479 7065  entries if 'type
+00017c10: 2720 696e 2065 6e74 7269 6573 5b65 6e74  ' in entries[ent
+00017c20: 7279 5d20 616e 6420 656e 7472 6965 735b  ry] and entries[
+00017c30: 656e 7472 795d 5b27 7479 7065 275d 203d  entry]['type'] =
+00017c40: 3d20 2764 6973 6b27 5d0a 2020 2020 2020  = 'disk'].      
+00017c50: 2020 6e65 7477 6f72 6b65 6e74 7269 6573    networkentries
+00017c60: 203d 205b 656e 7472 7920 666f 7220 656e   = [entry for en
+00017c70: 7472 7920 696e 2065 6e74 7269 6573 0a20  try in entries. 
+00017c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c90: 2020 2020 2020 2020 2069 6620 2774 7970           if 'typ
+00017ca0: 6527 2069 6e20 656e 7472 6965 735b 656e  e' in entries[en
+00017cb0: 7472 795d 2061 6e64 2065 6e74 7269 6573  try] and entries
+00017cc0: 5b65 6e74 7279 5d5b 2774 7970 6527 5d20  [entry]['type'] 
+00017cd0: 3d3d 2027 6e65 7477 6f72 6b27 5d0a 2020  == 'network'].  
+00017ce0: 2020 2020 2020 636f 6e74 6169 6e65 7265        containere
+00017cf0: 6e74 7269 6573 203d 205b 656e 7472 7920  ntries = [entry 
+00017d00: 666f 7220 656e 7472 7920 696e 2065 6e74  for entry in ent
+00017d10: 7269 6573 0a20 2020 2020 2020 2020 2020  ries.           
+00017d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d30: 2069 6620 2774 7970 6527 2069 6e20 656e   if 'type' in en
+00017d40: 7472 6965 735b 656e 7472 795d 2061 6e64  tries[entry] and
+00017d50: 2065 6e74 7269 6573 5b65 6e74 7279 5d5b   entries[entry][
+00017d60: 2774 7970 6527 5d20 3d3d 2027 636f 6e74  'type'] == 'cont
+00017d70: 6169 6e65 7227 5d0a 2020 2020 2020 2020  ainer'].        
+00017d80: 616e 7369 626c 6565 6e74 7269 6573 203d  ansibleentries =
+00017d90: 205b 656e 7472 7920 666f 7220 656e 7472   [entry for entr
+00017da0: 7920 696e 2065 6e74 7269 6573 0a20 2020  y in entries.   
+00017db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017dc0: 2020 2020 2020 2069 6620 2774 7970 6527         if 'type'
+00017dd0: 2069 6e20 656e 7472 6965 735b 656e 7472   in entries[entr
+00017de0: 795d 2061 6e64 2065 6e74 7269 6573 5b65  y] and entries[e
+00017df0: 6e74 7279 5d5b 2774 7970 6527 5d20 3d3d  ntry]['type'] ==
+00017e00: 2027 616e 7369 626c 6527 5d0a 2020 2020   'ansible'].    
+00017e10: 2020 2020 7072 6f66 696c 6565 6e74 7269      profileentri
+00017e20: 6573 203d 205b 656e 7472 7920 666f 7220  es = [entry for 
+00017e30: 656e 7472 7920 696e 2065 6e74 7269 6573  entry in entries
+00017e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017e50: 2020 2020 2020 2020 2020 2069 6620 2774             if 't
+00017e60: 7970 6527 2069 6e20 656e 7472 6965 735b  ype' in entries[
+00017e70: 656e 7472 795d 2061 6e64 2065 6e74 7269  entry] and entri
+00017e80: 6573 5b65 6e74 7279 5d5b 2774 7970 6527  es[entry]['type'
+00017e90: 5d20 3d3d 2027 7072 6f66 696c 6527 5d0a  ] == 'profile'].
+00017ea0: 2020 2020 2020 2020 696d 6167 6565 6e74          imageent
+00017eb0: 7269 6573 203d 205b 656e 7472 7920 666f  ries = [entry fo
+00017ec0: 7220 656e 7472 7920 696e 2065 6e74 7269  r entry in entri
+00017ed0: 6573 2069 6620 2774 7970 6527 2069 6e0a  es if 'type' in.
+00017ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ef0: 2020 2020 2020 2020 656e 7472 6965 735b          entries[
+00017f00: 656e 7472 795d 2061 6e64 2028 656e 7472  entry] and (entr
+00017f10: 6965 735b 656e 7472 795d 5b27 7479 7065  ies[entry]['type
+00017f20: 275d 203d 3d20 2769 6d61 6765 2720 6f72  '] == 'image' or
+00017f30: 2065 6e74 7269 6573 5b65 6e74 7279 5d5b   entries[entry][
+00017f40: 2774 7970 6527 5d20 3d3d 2027 7465 6d70  'type'] == 'temp
+00017f50: 6c61 7465 2729 5d0a 2020 2020 2020 2020  late')].        
+00017f60: 706f 6f6c 656e 7472 6965 7320 3d20 5b65  poolentries = [e
+00017f70: 6e74 7279 2066 6f72 2065 6e74 7279 2069  ntry for entry i
+00017f80: 6e20 656e 7472 6965 7320 6966 2027 7479  n entries if 'ty
+00017f90: 7065 2720 696e 2065 6e74 7269 6573 5b65  pe' in entries[e
+00017fa0: 6e74 7279 5d20 616e 6420 656e 7472 6965  ntry] and entrie
+00017fb0: 735b 656e 7472 795d 5b27 7479 7065 275d  s[entry]['type']
+00017fc0: 203d 3d20 2770 6f6f 6c27 5d0a 2020 2020   == 'pool'].    
+00017fd0: 2020 2020 706c 616e 656e 7472 6965 7320      planentries 
+00017fe0: 3d20 5b65 6e74 7279 2066 6f72 2065 6e74  = [entry for ent
+00017ff0: 7279 2069 6e20 656e 7472 6965 7320 6966  ry in entries if
+00018000: 2027 7479 7065 2720 696e 2065 6e74 7269   'type' in entri
+00018010: 6573 5b65 6e74 7279 5d20 616e 6420 656e  es[entry] and en
+00018020: 7472 6965 735b 656e 7472 795d 5b27 7479  tries[entry]['ty
+00018030: 7065 275d 203d 3d20 2770 6c61 6e27 5d0a  pe'] == 'plan'].
+00018040: 2020 2020 2020 2020 646e 7365 6e74 7269          dnsentri
+00018050: 6573 203d 205b 656e 7472 7920 666f 7220  es = [entry for 
+00018060: 656e 7472 7920 696e 2065 6e74 7269 6573  entry in entries
+00018070: 2069 6620 2774 7970 6527 2069 6e20 656e   if 'type' in en
+00018080: 7472 6965 735b 656e 7472 795d 2061 6e64  tries[entry] and
+00018090: 2065 6e74 7269 6573 5b65 6e74 7279 5d5b   entries[entry][
+000180a0: 2774 7970 6527 5d20 3d3d 2027 646e 7327  'type'] == 'dns'
+000180b0: 5d0a 2020 2020 2020 2020 6b75 6265 7320  ].        kubes 
+000180c0: 3d20 5b27 6b75 6265 272c 2027 636c 7573  = ['kube', 'clus
+000180d0: 7465 7227 5d0a 2020 2020 2020 2020 6b75  ter'].        ku
+000180e0: 6265 656e 7472 6965 7320 3d20 5b65 6e74  beentries = [ent
+000180f0: 7279 2066 6f72 2065 6e74 7279 2069 6e20  ry for entry in 
+00018100: 656e 7472 6965 7320 6966 2027 7479 7065  entries if 'type
+00018110: 2720 696e 2065 6e74 7269 6573 5b65 6e74  ' in entries[ent
+00018120: 7279 5d20 616e 6420 656e 7472 6965 735b  ry] and entries[
+00018130: 656e 7472 795d 5b27 7479 7065 275d 2069  entry]['type'] i
+00018140: 6e20 6b75 6265 735d 0a20 2020 2020 2020  n kubes].       
+00018150: 206c 6273 203d 205b 656e 7472 7920 666f   lbs = [entry fo
+00018160: 7220 656e 7472 7920 696e 2065 6e74 7269  r entry in entri
+00018170: 6573 2069 6620 2774 7970 6527 2069 6e20  es if 'type' in 
+00018180: 656e 7472 6965 735b 656e 7472 795d 2061  entries[entry] a
+00018190: 6e64 2065 6e74 7269 6573 5b65 6e74 7279  nd entries[entry
+000181a0: 5d5b 2774 7970 6527 5d20 3d3d 2027 6c6f  ]['type'] == 'lo
+000181b0: 6164 6261 6c61 6e63 6572 275d 0a20 2020  adbalancer'].   
+000181c0: 2020 2020 2073 6773 203d 205b 656e 7472       sgs = [entr
+000181d0: 7920 666f 7220 656e 7472 7920 696e 2065  y for entry in e
+000181e0: 6e74 7269 6573 2069 6620 2774 7970 6527  ntries if 'type'
+000181f0: 2069 6e20 656e 7472 6965 735b 656e 7472   in entries[entr
+00018200: 795d 2061 6e64 2065 6e74 7269 6573 5b65  y] and entries[e
+00018210: 6e74 7279 5d5b 2774 7970 6527 5d20 3d3d  ntry]['type'] ==
+00018220: 2027 7365 6375 7269 7479 6772 6f75 7027   'securitygroup'
+00018230: 5d0a 2020 2020 2020 2020 6275 636b 6574  ].        bucket
+00018240: 656e 7472 6965 7320 3d20 5b65 6e74 7279  entries = [entry
+00018250: 2066 6f72 2065 6e74 7279 2069 6e20 656e   for entry in en
+00018260: 7472 6965 7320 6966 2027 7479 7065 2720  tries if 'type' 
+00018270: 696e 2065 6e74 7269 6573 5b65 6e74 7279  in entries[entry
+00018280: 5d20 616e 6420 656e 7472 6965 735b 656e  ] and entries[en
+00018290: 7472 795d 5b27 7479 7065 275d 203d 3d20  try]['type'] == 
+000182a0: 2762 7563 6b65 7427 5d0a 2020 2020 2020  'bucket'].      
+000182b0: 2020 776f 726b 666c 6f77 656e 7472 6965    workflowentrie
+000182c0: 7320 3d20 5b65 6e74 7279 2066 6f72 2065  s = [entry for e
+000182d0: 6e74 7279 2069 6e20 656e 7472 6965 730a  ntry in entries.
+000182e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000182f0: 2020 2020 2020 2020 2020 2069 6620 2774             if 't
+00018300: 7970 6527 2069 6e20 656e 7472 6965 735b  ype' in entries[
+00018310: 656e 7472 795d 2061 6e64 2065 6e74 7269  entry] and entri
+00018320: 6573 5b65 6e74 7279 5d5b 2774 7970 6527  es[entry]['type'
+00018330: 5d20 3d3d 2027 776f 726b 666c 6f77 275d  ] == 'workflow']
+00018340: 0a20 2020 2020 2020 2066 6f72 2070 2069  .        for p i
+00018350: 6e20 7072 6f66 696c 6565 6e74 7269 6573  n profileentries
+00018360: 3a0a 2020 2020 2020 2020 2020 2020 766d  :.            vm
+00018370: 7072 6f66 696c 6573 5b70 5d20 3d20 656e  profiles[p] = en
+00018380: 7472 6965 735b 705d 0a20 2020 2020 2020  tries[p].       
+00018390: 2069 6620 6e65 7477 6f72 6b65 6e74 7269   if networkentri
+000183a0: 6573 2061 6e64 206e 6f74 206f 6e6c 7961  es and not onlya
+000183b0: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
+000183c0: 2020 2070 7072 696e 7428 2244 6570 6c6f     pprint("Deplo
+000183d0: 7969 6e67 204e 6574 776f 726b 732e 2e2e  ying Networks...
+000183e0: 2229 0a20 2020 2020 2020 2020 2020 2066  ").            f
+000183f0: 6f72 206e 6574 2069 6e20 6e65 7477 6f72  or net in networ
+00018400: 6b65 6e74 7269 6573 3a0a 2020 2020 2020  kentries:.      
+00018410: 2020 2020 2020 2020 2020 6e65 7470 726f            netpro
+00018420: 6669 6c65 203d 2065 6e74 7269 6573 5b6e  file = entries[n
+00018430: 6574 5d0a 2020 2020 2020 2020 2020 2020  et].            
+00018440: 2020 2020 6966 206b 2e6e 6574 5f65 7869      if k.net_exi
+00018450: 7374 7328 6e65 7429 3a0a 2020 2020 2020  sts(net):.      
+00018460: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+00018470: 7269 6e74 2866 224e 6574 776f 726b 207b  rint(f"Network {
+00018480: 6e65 747d 2073 6b69 7070 6564 2122 290a  net} skipped!").
+00018490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184a0: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+000184b0: 2020 2020 2020 2020 2020 2020 2063 6964               cid
+000184c0: 7220 3d20 6e65 7470 726f 6669 6c65 2e67  r = netprofile.g
+000184d0: 6574 2827 6369 6472 2729 0a20 2020 2020  et('cidr').     
+000184e0: 2020 2020 2020 2020 2020 206e 6174 203d             nat =
+000184f0: 2062 6f6f 6c28 6e65 7470 726f 6669 6c65   bool(netprofile
+00018500: 2e67 6574 2827 6e61 7427 2c20 5472 7565  .get('nat', True
+00018510: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00018520: 2020 2069 6620 6369 6472 2069 7320 4e6f     if cidr is No
+00018530: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00018540: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+00018550: 6622 4d69 7373 696e 6720 4369 6472 2066  f"Missing Cidr f
+00018560: 6f72 206e 6574 776f 726b 207b 6e65 747d  or network {net}
+00018570: 2e20 4e6f 7420 6372 6561 7469 6e67 2069  . Not creating i
+00018580: 742e 2e2e 2229 0a20 2020 2020 2020 2020  t...").         
+00018590: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+000185a0: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+000185b0: 2020 2020 6468 6370 203d 206e 6574 7072      dhcp = netpr
+000185c0: 6f66 696c 652e 6765 7428 2764 6863 7027  ofile.get('dhcp'
+000185d0: 2c20 5472 7565 290a 2020 2020 2020 2020  , True).        
+000185e0: 2020 2020 2020 2020 646f 6d61 696e 203d          domain =
+000185f0: 206e 6574 7072 6f66 696c 652e 6765 7428   netprofile.get(
+00018600: 2764 6f6d 6169 6e27 290a 2020 2020 2020  'domain').      
+00018610: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00018620: 203d 206b 2e63 7265 6174 655f 6e65 7477   = k.create_netw
+00018630: 6f72 6b28 6e61 6d65 3d6e 6574 2c20 6369  ork(name=net, ci
+00018640: 6472 3d63 6964 722c 2064 6863 703d 6468  dr=cidr, dhcp=dh
+00018650: 6370 2c20 6e61 743d 6e61 742c 2064 6f6d  cp, nat=nat, dom
+00018660: 6169 6e3d 646f 6d61 696e 2c20 706c 616e  ain=domain, plan
+00018670: 3d70 6c61 6e2c 0a20 2020 2020 2020 2020  =plan,.         
+00018680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000186a0: 206f 7665 7272 6964 6573 3d6e 6574 7072   overrides=netpr
+000186b0: 6f66 696c 6529 0a20 2020 2020 2020 2020  ofile).         
+000186c0: 2020 2020 2020 2063 6f6d 6d6f 6e2e 6861         common.ha
+000186d0: 6e64 6c65 5f72 6573 706f 6e73 6528 7265  ndle_response(re
+000186e0: 7375 6c74 2c20 6e65 742c 2065 6c65 6d65  sult, net, eleme
+000186f0: 6e74 3d27 4e65 7477 6f72 6b20 2729 0a20  nt='Network '). 
+00018700: 2020 2020 2020 2069 6620 706f 6f6c 656e         if poolen
+00018710: 7472 6965 7320 616e 6420 6e6f 7420 6f6e  tries and not on
+00018720: 6c79 6173 7365 7473 3a0a 2020 2020 2020  lyassets:.      
+00018730: 2020 2020 2020 7070 7269 6e74 2822 4465        pprint("De
+00018740: 706c 6f79 696e 6720 506f 6f6c 732e 2e2e  ploying Pools...
+00018750: 2229 0a20 2020 2020 2020 2020 2020 2070  ").            p
+00018760: 6f6f 6c73 203d 206b 2e6c 6973 745f 706f  ools = k.list_po
+00018770: 6f6c 7328 290a 2020 2020 2020 2020 2020  ols().          
+00018780: 2020 666f 7220 706f 6f6c 2069 6e20 706f    for pool in po
+00018790: 6f6c 656e 7472 6965 733a 0a20 2020 2020  olentries:.     
+000187a0: 2020 2020 2020 2020 2020 2069 6620 706f             if po
+000187b0: 6f6c 2069 6e20 706f 6f6c 733a 0a20 2020  ol in pools:.   
+000187c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000187d0: 2070 7072 696e 7428 6622 506f 6f6c 207b   pprint(f"Pool {
+000187e0: 706f 6f6c 7d20 736b 6970 7065 6421 2229  pool} skipped!")
+000187f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018800: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+00018810: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00018820: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00018830: 2020 2020 2020 2020 706f 6f6c 7072 6f66          poolprof
+00018840: 696c 6520 3d20 656e 7472 6965 735b 706f  ile = entries[po
+00018850: 6f6c 5d0a 2020 2020 2020 2020 2020 2020  ol].            
+00018860: 2020 2020 2020 2020 706f 6f6c 7061 7468          poolpath
+00018870: 203d 2070 6f6f 6c70 726f 6669 6c65 2e67   = poolprofile.g
+00018880: 6574 2827 7061 7468 2729 0a20 2020 2020  et('path').     
+00018890: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000188a0: 6620 706f 6f6c 7061 7468 2069 7320 4e6f  f poolpath is No
+000188b0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000188c0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+000188d0: 696e 6728 6622 506f 6f6c 207b 706f 6f6c  ing(f"Pool {pool
+000188e0: 7d20 736b 6970 7065 6420 6173 2070 6174  } skipped as pat
+000188f0: 6820 6973 206d 6973 7369 6e67 2122 290a  h is missing!").
+00018900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018910: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00018920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018930: 2020 2020 206b 2e63 7265 6174 655f 706f       k.create_po
+00018940: 6f6c 2870 6f6f 6c2c 2070 6f6f 6c70 6174  ol(pool, poolpat
+00018950: 6829 0a20 2020 2020 2020 2069 6620 696d  h).        if im
+00018960: 6167 6565 6e74 7269 6573 2061 6e64 206e  ageentries and n
+00018970: 6f74 206f 6e6c 7961 7373 6574 733a 0a20  ot onlyassets:. 
+00018980: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+00018990: 7428 2244 6570 6c6f 7969 6e67 2049 6d61  t("Deploying Ima
+000189a0: 6765 732e 2e2e 2229 0a20 2020 2020 2020  ges...").       
+000189b0: 2020 2020 2069 6d61 6765 7320 3d20 5b6f       images = [o
+000189c0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+000189d0: 7429 2066 6f72 2074 2069 6e20 6b2e 766f  t) for t in k.vo
+000189e0: 6c75 6d65 7328 295d 0a20 2020 2020 2020  lumes()].       
+000189f0: 2020 2020 2066 6f72 2069 6d61 6765 2069       for image i
+00018a00: 6e20 696d 6167 6565 6e74 7269 6573 3a0a  n imageentries:.
+00018a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a20: 696d 6167 6570 726f 6669 6c65 203d 2065  imageprofile = e
+00018a30: 6e74 7269 6573 5b69 6d61 6765 5d0a 2020  ntries[image].  
+00018a40: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00018a50: 6f6c 203d 2069 6d61 6765 7072 6f66 696c  ol = imageprofil
+00018a60: 652e 6765 7428 2770 6f6f 6c27 2c20 7365  e.get('pool', se
+00018a70: 6c66 2e70 6f6f 6c29 0a20 2020 2020 2020  lf.pool).       
+00018a80: 2020 2020 2020 2020 2069 6d61 6765 7369           imagesi
+00018a90: 7a65 203d 2069 6d61 6765 7072 6f66 696c  ze = imageprofil
+00018aa0: 652e 6765 7428 2773 697a 6527 290a 2020  e.get('size').  
+00018ab0: 2020 2020 2020 2020 2020 2020 2020 696d                im
+00018ac0: 6167 6575 726c 203d 2069 6d61 6765 7072  ageurl = imagepr
+00018ad0: 6f66 696c 652e 6765 7428 2775 726c 2729  ofile.get('url')
+00018ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018af0: 2069 6620 696d 6167 6520 696e 2069 6d61   if image in ima
+00018b00: 6765 733a 0a20 2020 2020 2020 2020 2020  ges:.           
+00018b10: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00018b20: 6622 496d 6167 6520 7b69 6d61 6765 7d20  f"Image {image} 
+00018b30: 736b 6970 7065 6421 2229 0a20 2020 2020  skipped!").     
+00018b40: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00018b50: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+00018b60: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00018b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b80: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00018b90: 696d 6167 6575 726c 2c20 7374 7229 2061  imageurl, str) a
+00018ba0: 6e64 2069 6d61 6765 7572 6c20 3d3d 2022  nd imageurl == "
+00018bb0: 4e6f 6e65 223a 0a20 2020 2020 2020 2020  None":.         
+00018bc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00018bd0: 6d61 6765 7572 6c20 3d20 4e6f 6e65 0a20  mageurl = None. 
+00018be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018bf0: 2020 2063 6d64 203d 2069 6d61 6765 7072     cmd = imagepr
+00018c00: 6f66 696c 652e 6765 7428 2763 6d64 2729  ofile.get('cmd')
+00018c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018c20: 2020 2020 2073 656c 662e 6861 6e64 6c65       self.handle
+00018c30: 5f68 6f73 7428 706f 6f6c 3d70 6f6f 6c2c  _host(pool=pool,
+00018c40: 2069 6d61 6765 3d69 6d61 6765 2c20 646f   image=image, do
+00018c50: 776e 6c6f 6164 3d54 7275 652c 2063 6d64  wnload=True, cmd
+00018c60: 3d63 6d64 2c20 7572 6c3d 696d 6167 6575  =cmd, url=imageu
+00018c70: 726c 2c20 7369 7a65 3d69 6d61 6765 7369  rl, size=imagesi
+00018c80: 7a65 290a 2020 2020 2020 2020 6966 2062  ze).        if b
+00018c90: 7563 6b65 7465 6e74 7269 6573 2061 6e64  ucketentries and
+00018ca0: 206e 6f74 206f 6e6c 7961 7373 6574 7320   not onlyassets 
+00018cb0: 616e 6420 7365 6c66 2e74 7970 6520 696e  and self.type in
+00018cc0: 205b 2761 7773 272c 2027 6763 7027 2c20   ['aws', 'gcp', 
+00018cd0: 276f 7065 6e73 7461 636b 275d 3a0a 2020  'openstack']:.  
+00018ce0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00018cf0: 2822 4465 706c 6f79 696e 6720 4275 636b  ("Deploying Buck
+00018d00: 6574 2045 6e74 7269 6573 2e2e 2e22 290a  et Entries...").
+00018d10: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00018d20: 6275 636b 6574 656e 7472 7920 696e 2062  bucketentry in b
+00018d30: 7563 6b65 7465 6e74 7269 6573 3a0a 2020  ucketentries:.  
+00018d40: 2020 2020 2020 2020 2020 2020 2020 6275                bu
+00018d50: 636b 6574 7072 6f66 696c 6520 3d20 656e  cketprofile = en
+00018d60: 7472 6965 735b 6275 636b 6574 656e 7472  tries[bucketentr
+00018d70: 795d 0a20 2020 2020 2020 2020 2020 2020  y].             
+00018d80: 2020 205f 6669 6c65 7320 3d20 6275 636b     _files = buck
+00018d90: 6574 7072 6f66 696c 652e 6765 7428 2766  etprofile.get('f
+00018da0: 696c 6573 272c 205b 5d29 0a20 2020 2020  iles', []).     
+00018db0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00018dc0: 6b2e 6372 6561 7465 5f62 7563 6b65 7428  k.create_bucket(
+00018dd0: 6275 636b 6574 656e 7472 7929 0a20 2020  bucketentry).   
+00018de0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00018df0: 205f 6669 6c20 696e 205f 6669 6c65 733a   _fil in _files:
+00018e00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018e10: 2020 2020 2073 656c 662e 6b2e 7570 6c6f       self.k.uplo
+00018e20: 6164 5f74 6f5f 6275 636b 6574 2862 7563  ad_to_bucket(buc
+00018e30: 6b65 7465 6e74 7279 2c20 5f66 696c 290a  ketentry, _fil).
+00018e40: 2020 2020 2020 2020 7465 6d70 6b65 7920          tempkey 
+00018e50: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+00018e60: 2774 656d 706b 6579 272c 2046 616c 7365  'tempkey', False
+00018e70: 2920 6f72 2073 656c 662e 7465 6d70 6b65  ) or self.tempke
+00018e80: 790a 2020 2020 2020 2020 6966 2074 656d  y.        if tem
+00018e90: 706b 6579 3a0a 2020 2020 2020 2020 2020  pkey:.          
+00018ea0: 2020 7465 6d70 6b65 7964 6972 203d 2054    tempkeydir = T
+00018eb0: 656d 706f 7261 7279 4469 7265 6374 6f72  emporaryDirector
+00018ec0: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
+00018ed0: 6f76 6572 7269 6465 735b 2774 656d 706b  overrides['tempk
+00018ee0: 6579 6469 7227 5d20 3d20 7465 6d70 6b65  eydir'] = tempke
+00018ef0: 7964 6972 0a20 2020 2020 2020 2020 2020  ydir.           
+00018f00: 206f 7665 7272 6964 6573 5b27 7465 6d70   overrides['temp
+00018f10: 6b65 7964 6972 6b65 6570 275d 203d 2054  keydirkeep'] = T
+00018f20: 7275 650a 2020 2020 2020 2020 6966 2070  rue.        if p
+00018f30: 6c61 6e65 6e74 7269 6573 3a0a 2020 2020  lanentries:.    
+00018f40: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
+00018f50: 4465 706c 6f79 696e 6720 506c 616e 732e  Deploying Plans.
+00018f60: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+00018f70: 2066 6f72 2070 6c61 6e65 6e74 7279 2069   for planentry i
+00018f80: 6e20 706c 616e 656e 7472 6965 733a 0a20  n planentries:. 
+00018f90: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00018fa0: 6574 6169 6c73 203d 2065 6e74 7269 6573  etails = entries
+00018fb0: 5b70 6c61 6e65 6e74 7279 5d0a 2020 2020  [planentry].    
+00018fc0: 2020 2020 2020 2020 2020 2020 706c 616e              plan
+00018fd0: 7572 6c20 3d20 6465 7461 696c 732e 6765  url = details.ge
+00018fe0: 7428 2775 726c 2729 0a20 2020 2020 2020  t('url').       
+00018ff0: 2020 2020 2020 2020 2070 6c61 6e66 696c           planfil
+00019000: 6520 3d20 6465 7461 696c 732e 6765 7428  e = details.get(
+00019010: 2766 696c 6527 290a 2020 2020 2020 2020  'file').        
+00019020: 2020 2020 2020 2020 6966 2070 6c61 6e75          if planu
+00019030: 726c 2069 7320 4e6f 6e65 2061 6e64 2070  rl is None and p
+00019040: 6c61 6e66 696c 6520 6973 204e 6f6e 653a  lanfile is None:
+00019050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019060: 2020 2020 2077 6172 6e69 6e67 2866 224d       warning(f"M
+00019070: 6973 7369 6e67 2055 726c 2f46 696c 6520  issing Url/File 
+00019080: 666f 7220 706c 616e 207b 706c 616e 656e  for plan {planen
+00019090: 7472 797d 2e20 4e6f 7420 6372 6561 7469  try}. Not creati
+000190a0: 6e67 2069 742e 2e2e 2229 0a20 2020 2020  ng it...").     
+000190b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000190c0: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+000190d0: 2020 2020 2020 2020 656c 6966 2070 6c61          elif pla
+000190e0: 6e75 726c 2069 7320 6e6f 7420 4e6f 6e65  nurl is not None
+000190f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00019100: 2020 2020 2020 7061 7468 203d 2070 6c61        path = pla
+00019110: 6e65 6e74 7279 0a20 2020 2020 2020 2020  nentry.         
+00019120: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00019130: 7420 706c 616e 7572 6c2e 656e 6473 7769  t planurl.endswi
+00019140: 7468 2827 796d 6c27 293a 0a20 2020 2020  th('yml'):.     
+00019150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019160: 2020 2070 6c61 6e75 726c 203d 2066 227b     planurl = f"{
+00019170: 706c 616e 7572 6c7d 2f6b 636c 695f 706c  planurl}/kcli_pl
+00019180: 616e 2e79 6d6c 220a 2020 2020 2020 2020  an.yml".        
+00019190: 2020 2020 2020 2020 656c 6966 2027 2f27          elif '/'
+000191a0: 2069 6e20 706c 616e 6669 6c65 3a0a 2020   in planfile:.  
+000191b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191c0: 2020 7061 7468 203d 206f 732e 7061 7468    path = os.path
+000191d0: 2e64 6972 6e61 6d65 2870 6c61 6e66 696c  .dirname(planfil
+000191e0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+000191f0: 2020 2020 2020 2069 6e70 7574 6669 6c65         inputfile
+00019200: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
+00019210: 616d 6528 706c 616e 6669 6c65 290a 2020  ame(planfile).  
+00019220: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00019230: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00019240: 2020 2020 2020 2020 7061 7468 203d 2027          path = '
+00019250: 2e27 0a20 2020 2020 2020 2020 2020 2020  .'.             
+00019260: 2020 2020 2020 2069 6e70 7574 6669 6c65         inputfile
+00019270: 203d 2070 6c61 6e65 6e74 7279 0a20 2020   = planentry.   
+00019280: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00019290: 6e6f 5f6f 7665 7272 6964 6573 2061 6e64  no_overrides and
+000192a0: 2070 6172 616d 6574 6572 733a 0a20 2020   parameters:.   
+000192b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192c0: 2070 7072 696e 7428 2255 7369 6e67 2070   pprint("Using p
+000192d0: 6172 616d 6574 6572 7320 6672 6f6d 2066  arameters from f
+000192e0: 6174 6865 7220 706c 616e 2069 6e20 6368  ather plan in ch
+000192f0: 696c 6420 6f6e 6573 2229 0a20 2020 2020  ild ones").     
+00019300: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00019310: 6f72 206f 7665 7272 6964 6520 696e 206f  or override in o
+00019320: 7665 7272 6964 6573 3a0a 2020 2020 2020  verrides:.      
+00019330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019340: 2020 7072 696e 7428 2255 7369 6e67 2070    print("Using p
+00019350: 6172 616d 6574 6572 2025 733a 2025 7322  arameter %s: %s"
+00019360: 2025 2028 6f76 6572 7269 6465 2c20 6f76   % (override, ov
+00019370: 6572 7269 6465 735b 6f76 6572 7269 6465  errides[override
+00019380: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
+00019390: 2020 2020 7365 6c66 2e70 6c61 6e28 706c      self.plan(pl
+000193a0: 616e 2c20 616e 7369 626c 653d 4661 6c73  an, ansible=Fals
+000193b0: 652c 2075 726c 3d70 6c61 6e75 726c 2c20  e, url=planurl, 
+000193c0: 7061 7468 3d70 6174 682c 2063 6f6e 7461  path=path, conta
+000193d0: 696e 6572 3d46 616c 7365 2c20 696e 7075  iner=False, inpu
+000193e0: 7466 696c 653d 696e 7075 7466 696c 652c  tfile=inputfile,
+000193f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019400: 2020 2020 2020 2020 2020 206f 7665 7272             overr
+00019410: 6964 6573 3d6f 7665 7272 6964 6573 2c20  ides=overrides, 
+00019420: 656d 6265 6464 6564 3d65 6d62 6564 6465  embedded=embedde
+00019430: 642c 2064 6f77 6e6c 6f61 643d 646f 776e  d, download=down
+00019440: 6c6f 6164 290a 2020 2020 2020 2020 6966  load).        if
+00019450: 206b 7562 6565 6e74 7269 6573 2061 6e64   kubeentries and
+00019460: 206e 6f74 206f 6e6c 7961 7373 6574 733a   not onlyassets:
+00019470: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
+00019480: 696e 7428 2244 6570 6c6f 7969 6e67 204b  int("Deploying K
+00019490: 7562 6520 456e 7472 6965 732e 2e2e 2229  ube Entries...")
+000194a0: 0a20 2020 2020 2020 2020 2020 2064 6e73  .            dns
+000194b0: 636c 6965 6e74 7320 3d20 7b7d 0a20 2020  clients = {}.   
+000194c0: 2020 2020 2020 2020 206b 7562 6574 6872           kubethr
+000194d0: 6561 6465 6420 3d20 5472 7565 2069 6620  eaded = True if 
+000194e0: 6c65 6e28 6b75 6265 656e 7472 6965 7329  len(kubeentries)
+000194f0: 203e 2031 2065 6c73 6520 4661 6c73 650a   > 1 else False.
+00019500: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+00019510: 7562 6574 6872 6561 6465 643a 0a20 2020  ubethreaded:.   
+00019520: 2020 2020 2020 2020 2020 2020 2077 6172               war
+00019530: 6e69 6e67 2822 4c61 756e 6368 696e 6720  ning("Launching 
+00019540: 6561 6368 2063 6c75 7374 6572 2069 6e20  each cluster in 
+00019550: 6120 7468 7265 6164 2061 7320 7468 6572  a thread as ther
+00019560: 6520 6973 206d 6f72 6520 7468 616e 206f  e is more than o
+00019570: 6e65 2065 6e74 7279 2e2e 2e22 290a 2020  ne entry...").  
+00019580: 2020 2020 2020 2020 2020 666f 7220 636c            for cl
+00019590: 7573 7465 7220 696e 206b 7562 6565 6e74  uster in kubeent
+000195a0: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
+000195b0: 2020 2020 2020 7070 7269 6e74 2866 2244        pprint(f"D
+000195c0: 6570 6c6f 7969 6e67 2043 6c75 7374 6572  eploying Cluster
+000195d0: 207b 636c 7573 7465 727d 2e2e 2e22 290a   {cluster}...").
+000195e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000195f0: 6b75 6265 7072 6f66 696c 6520 3d20 656e  kubeprofile = en
+00019600: 7472 6965 735b 636c 7573 7465 725d 0a20  tries[cluster]. 
+00019610: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00019620: 7562 6563 6c69 656e 7420 3d20 6b75 6265  ubeclient = kube
+00019630: 7072 6f66 696c 652e 6765 7428 2763 6c69  profile.get('cli
+00019640: 656e 7427 290a 2020 2020 2020 2020 2020  ent').          
+00019650: 2020 2020 2020 6966 206b 7562 6563 6c69        if kubecli
+00019660: 656e 7420 6973 204e 6f6e 653a 0a20 2020  ent is None:.   
+00019670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019680: 2063 7572 7265 6e74 636f 6e66 6967 203d   currentconfig =
+00019690: 2073 656c 660a 2020 2020 2020 2020 2020   self.          
+000196a0: 2020 2020 2020 656c 6966 206b 7562 6563        elif kubec
+000196b0: 6c69 656e 7420 696e 2073 656c 662e 636c  lient in self.cl
+000196c0: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
+000196d0: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+000196e0: 6e74 636f 6e66 6967 203d 204b 636f 6e66  ntconfig = Kconf
+000196f0: 6967 2863 6c69 656e 743d 6b75 6265 636c  ig(client=kubecl
+00019700: 6965 6e74 290a 2020 2020 2020 2020 2020  ient).          
+00019710: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00019720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019730: 6572 726f 7228 6622 436c 6965 6e74 207b  error(f"Client {
+00019740: 6b75 6265 636c 6965 6e74 7d20 6e6f 7420  kubeclient} not 
+00019750: 666f 756e 642e 2073 6b69 7070 6564 2229  found. skipped")
+00019760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019770: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+00019780: 2020 2020 2020 2020 2020 2020 2020 6b75                ku
+00019790: 6265 7479 7065 203d 206b 7562 6570 726f  betype = kubepro
+000197a0: 6669 6c65 2e67 6574 2827 6b75 6265 7479  file.get('kubety
+000197b0: 7065 2729 206f 7220 6b75 6265 7072 6f66  pe') or kubeprof
+000197c0: 696c 652e 6765 7428 2763 6c75 7374 6572  ile.get('cluster
+000197d0: 7479 7065 272c 2027 6765 6e65 7269 6327  type', 'generic'
+000197e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000197f0: 2020 6b75 6265 5f6f 7665 7272 6964 6573    kube_overrides
+00019800: 203d 206f 7665 7272 6964 6573 2e63 6f70   = overrides.cop
+00019810: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
+00019820: 2020 2020 6b75 6265 5f6f 7665 7272 6964      kube_overrid
+00019830: 6573 2e75 7064 6174 6528 6b75 6265 7072  es.update(kubepr
+00019840: 6f66 696c 6529 0a20 2020 2020 2020 2020  ofile).         
+00019850: 2020 2020 2020 206b 7562 655f 6f76 6572         kube_over
+00019860: 7269 6465 735b 2763 6c75 7374 6572 275d  rides['cluster']
+00019870: 203d 2063 6c75 7374 6572 0a20 2020 2020   = cluster.     
+00019880: 2020 2020 2020 2020 2020 2065 7869 7374             exist
+00019890: 696e 675f 6374 6c70 6c61 6e65 7320 3d20  ing_ctlplanes = 
+000198a0: 5b76 2066 6f72 2076 2069 6e20 6375 7272  [v for v in curr
+000198b0: 656e 7463 6f6e 6669 672e 6b2e 6c69 7374  entconfig.k.list
+000198c0: 2829 2069 6620 6627 7b63 6c75 7374 6572  () if f'{cluster
+000198d0: 7d2d 6374 6c70 6c61 6e65 2720 696e 2076  }-ctlplane' in v
+000198e0: 5b27 6e61 6d65 275d 5d0a 2020 2020 2020  ['name']].      
+000198f0: 2020 2020 2020 2020 2020 6966 2065 7869            if exi
+00019900: 7374 696e 675f 6374 6c70 6c61 6e65 733a  sting_ctlplanes:
+00019910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019920: 2020 2020 2070 7072 696e 7428 6622 436c       pprint(f"Cl
+00019930: 7573 7465 7220 7b63 6c75 7374 6572 7d20  uster {cluster} 
+00019940: 666f 756e 642e 2073 6b69 7070 6564 2122  found. skipped!"
+00019950: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00019960: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+00019970: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00019980: 6620 6b75 6265 7479 7065 206e 6f74 2069  f kubetype not i
+00019990: 6e20 5b27 6765 6e65 7269 6327 2c20 276f  n ['generic', 'o
+000199a0: 7065 6e73 6869 6674 272c 2027 6879 7065  penshift', 'hype
+000199b0: 7273 6869 6674 272c 2027 6d69 6372 6f73  rshift', 'micros
+000199c0: 6869 6674 272c 2027 6b33 7327 2c20 2767  hift', 'k3s', 'g
+000199d0: 6b65 275d 3a0a 2020 2020 2020 2020 2020  ke']:.          
+000199e0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+000199f0: 6728 6622 496e 636f 7272 6563 7420 6b75  g(f"Incorrect ku
+00019a00: 6265 7479 7065 207b 6b75 6265 7479 7065  betype {kubetype
+00019a10: 7d20 7370 6563 6966 6965 642e 2073 6b69  } specified. ski
+00019a20: 7070 6564 2122 290a 2020 2020 2020 2020  pped!").        
+00019a30: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00019a40: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+00019a50: 2020 2020 2069 6620 6b75 6265 7468 7265       if kubethre
+00019a60: 6164 6564 3a0a 2020 2020 2020 2020 2020  aded:.          
+00019a70: 2020 2020 2020 2020 2020 6b75 6265 5f6f            kube_o
+00019a80: 7665 7272 6964 6573 5b27 7573 655f 6578  verrides['use_ex
+00019a90: 6973 7469 6e67 5f6f 7065 6e73 6869 6674  isting_openshift
+00019aa0: 275d 203d 2054 7275 650a 2020 2020 2020  '] = True.      
+00019ab0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00019ac0: 775f 6172 6773 203d 2028 706c 616e 2c20  w_args = (plan, 
+00019ad0: 6b75 6265 7479 7065 2c20 6b75 6265 5f6f  kubetype, kube_o
+00019ae0: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
+00019af0: 2020 2020 2020 2020 2020 2020 2020 7420                t 
+00019b00: 3d20 7468 7265 6164 696e 672e 5468 7265  = threading.Thre
+00019b10: 6164 2874 6172 6765 743d 7365 6c66 2e74  ad(target=self.t
+00019b20: 6872 6561 6465 645f 6372 6561 7465 5f6b  hreaded_create_k
+00019b30: 7562 652c 2061 7267 733d 6e65 775f 6172  ube, args=new_ar
+00019b40: 6773 290a 2020 2020 2020 2020 2020 2020  gs).            
+00019b50: 2020 2020 2020 2020 7468 7265 6164 732e          threads.
+00019b60: 6170 7065 6e64 2874 290a 2020 2020 2020  append(t).      
+00019b70: 2020 2020 2020 2020 2020 2020 2020 742e                t.
+00019b80: 7374 6172 7428 290a 2020 2020 2020 2020  start().        
+00019b90: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00019ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019bb0: 2020 6375 7272 656e 7463 6f6e 6669 672e    currentconfig.
+00019bc0: 6372 6561 7465 5f6b 7562 6528 706c 616e  create_kube(plan
+00019bd0: 2c20 6b75 6265 7479 7065 2c20 6f76 6572  , kubetype, over
+00019be0: 7269 6465 733d 6b75 6265 5f6f 7665 7272  rides=kube_overr
+00019bf0: 6964 6573 290a 2020 2020 2020 2020 766d  ides).        vm
+00019c00: 636c 6965 6e74 7320 3d20 5b5d 0a20 2020  clients = [].   
+00019c10: 2020 2020 2069 6620 766d 656e 7472 6965       if vmentrie
+00019c20: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+00019c30: 6620 6e6f 7420 6f6e 6c79 6173 7365 7473  f not onlyassets
+00019c40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00019c50: 2020 7070 7269 6e74 2822 4465 706c 6f79    pprint("Deploy
+00019c60: 696e 6720 566d 732e 2e2e 2229 0a20 2020  ing Vms...").   
+00019c70: 2020 2020 2020 2020 2076 6d63 6f75 6e74           vmcount
+00019c80: 6572 203d 2030 0a20 2020 2020 2020 2020  er = 0.         
+00019c90: 2020 2068 6f73 7473 203d 207b 7d0a 2020     hosts = {}.  
+00019ca0: 2020 2020 2020 2020 2020 766d 735f 746f            vms_to
+00019cb0: 5f68 6f73 7420 3d20 7b7d 0a20 2020 2020  _host = {}.     
+00019cc0: 2020 2020 2020 2062 6173 6570 6c61 6e73         baseplans
+00019cd0: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+00019ce0: 2020 766d 6e61 6d65 7320 3d20 5b6e 616d    vmnames = [nam
+00019cf0: 6520 666f 7220 6e61 6d65 2069 6e20 766d  e for name in vm
+00019d00: 656e 7472 6965 735d 0a20 2020 2020 2020  entries].       
+00019d10: 2020 2020 2069 6620 6261 7365 6669 6c65       if basefile
+00019d20: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00019d30: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+00019d40: 7365 6469 7220 3d20 6f73 2e70 6174 682e  sedir = os.path.
+00019d50: 6469 726e 616d 6528 696e 7075 7466 696c  dirname(inputfil
+00019d60: 6529 2069 6620 6f73 2e70 6174 682e 6973  e) if os.path.is
+00019d70: 6162 7328 696e 7075 7466 696c 6529 2065  abs(inputfile) e
+00019d80: 6c73 6520 272e 270a 2020 2020 2020 2020  lse '.'.        
+00019d90: 2020 2020 2020 2020 6261 7365 696e 7075          baseinpu
+00019da0: 7466 696c 6520 3d20 6622 7b62 6173 6564  tfile = f"{based
+00019db0: 6972 7d2f 7b62 6173 6566 696c 657d 220a  ir}/{basefile}".
+00019dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019dd0: 6966 2063 6f6e 7461 696e 6572 5f6d 6f64  if container_mod
+00019de0: 6528 2920 616e 6420 6e6f 7420 6f73 2e70  e() and not os.p
+00019df0: 6174 682e 6973 6162 7328 6261 7365 6669  ath.isabs(basefi
+00019e00: 6c65 2920 616e 6420 272f 776f 726b 6469  le) and '/workdi
+00019e10: 7227 206e 6f74 2069 6e20 6261 7365 6469  r' not in basedi
+00019e20: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00019e30: 2020 2020 2020 2062 6173 6569 6e70 7574         baseinput
+00019e40: 6669 6c65 203d 2066 222f 776f 726b 6469  file = f"/workdi
+00019e50: 722f 7b62 6173 6564 6972 7d2f 7b62 6173  r/{basedir}/{bas
+00019e60: 6566 696c 657d 220a 2020 2020 2020 2020  efile}".        
+00019e70: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00019e80: 2073 656c 662e 706c 616e 2870 6c61 6e2c   self.plan(plan,
+00019e90: 2069 6e70 7574 6669 6c65 3d62 6173 6569   inputfile=basei
+00019ea0: 6e70 7574 6669 6c65 2c20 6f76 6572 7269  nputfile, overri
+00019eb0: 6465 733d 6f76 6572 7269 6465 732c 2065  des=overrides, e
+00019ec0: 7863 6c75 6465 766d 733d 766d 6e61 6d65  xcludevms=vmname
+00019ed0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00019ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ef0: 2020 2020 2020 6261 7365 6d6f 6465 3d54        basemode=T
+00019f00: 7275 652c 206f 6e6c 7961 7373 6574 733d  rue, onlyassets=
+00019f10: 6f6e 6c79 6173 7365 7473 290a 2020 2020  onlyassets).    
+00019f20: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00019f30: 6573 756c 745b 2772 6573 756c 7427 5d20  esult['result'] 
+00019f40: 213d 2027 7375 6363 6573 7327 3a0a 2020  != 'success':.  
+00019f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f60: 2020 7265 7475 726e 2072 6573 756c 740a    return result.
+00019f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f80: 6261 7365 706c 616e 732e 6170 7065 6e64  baseplans.append
+00019f90: 2862 6173 6566 696c 6529 0a20 2020 2020  (basefile).     
+00019fa0: 2020 2020 2020 2076 6d72 756c 6573 5f73         vmrules_s
+00019fb0: 7472 6963 7420 3d20 6f76 6572 7269 6465  trict = override
+00019fc0: 732e 6765 7428 2776 6d72 756c 6573 5f73  s.get('vmrules_s
+00019fd0: 7472 6963 7427 2c20 7365 6c66 2e76 6d72  trict', self.vmr
+00019fe0: 756c 6573 5f73 7472 6963 7429 0a20 2020  ules_strict).   
+00019ff0: 2020 2020 2020 2020 2066 6f72 206e 616d           for nam
+0001a000: 6520 696e 2076 6d65 6e74 7269 6573 3a0a  e in vmentries:.
+0001a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a020: 6966 206e 616d 6520 696e 2065 7863 6c75  if name in exclu
+0001a030: 6465 766d 733a 0a20 2020 2020 2020 2020  devms:.         
+0001a040: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+0001a050: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+0001a060: 2020 2020 6375 7272 656e 7470 6c61 6e64      currentpland
+0001a070: 6972 203d 2062 6173 6564 6972 0a20 2020  ir = basedir.   
+0001a080: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001a090: 6c65 6e28 766d 656e 7472 6965 7329 203d  len(vmentries) =
+0001a0a0: 3d20 3120 616e 6420 276e 616d 6527 2069  = 1 and 'name' i
+0001a0b0: 6e20 6f76 6572 7269 6465 733a 0a20 2020  n overrides:.   
+0001a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0d0: 206e 6577 6e61 6d65 203d 206f 7665 7272   newname = overr
+0001a0e0: 6964 6573 5b27 6e61 6d65 275d 0a20 2020  ides['name'].   
+0001a0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a100: 2070 726f 6669 6c65 203d 2065 6e74 7269   profile = entri
+0001a110: 6573 5b6e 616d 655d 0a20 2020 2020 2020  es[name].       
+0001a120: 2020 2020 2020 2020 2020 2020 206e 616d               nam
+0001a130: 6520 3d20 6e65 776e 616d 650a 2020 2020  e = newname.    
+0001a140: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001a150: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a160: 2020 2020 2020 7072 6f66 696c 6520 3d20        profile = 
+0001a170: 656e 7472 6965 735b 6e61 6d65 5d0a 2020  entries[name].  
+0001a180: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001a190: 2027 6e61 6d65 2720 696e 2070 726f 6669   'name' in profi
+0001a1a0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+0001a1b0: 2020 2020 2020 2020 6e61 6d65 203d 2070          name = p
+0001a1c0: 726f 6669 6c65 5b27 6e61 6d65 275d 0a20  rofile['name']. 
+0001a1d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001a1e0: 6620 2762 6173 6576 6d27 2069 6e20 7072  f 'basevm' in pr
+0001a1f0: 6f66 696c 6520 6f72 2027 6261 7365 706c  ofile or 'basepl
+0001a200: 616e 2720 696e 2070 726f 6669 6c65 3a0a  an' in profile:.
+0001a210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a220: 2020 2020 6261 7365 7072 6f66 696c 6520      baseprofile 
+0001a230: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
+0001a240: 2020 2020 2020 2020 2061 7070 656e 646b           appendk
+0001a250: 6579 7320 3d20 5b27 6469 736b 7327 2c20  eys = ['disks', 
+0001a260: 276e 6574 7327 2c20 2766 696c 6573 272c  'nets', 'files',
+0001a270: 2027 7363 7269 7074 7327 2c20 2763 6d64   'scripts', 'cmd
+0001a280: 7327 5d0a 2020 2020 2020 2020 2020 2020  s'].            
+0001a290: 2020 2020 2020 2020 6966 2027 6261 7365          if 'base
+0001a2a0: 706c 616e 2720 696e 2070 726f 6669 6c65  plan' in profile
+0001a2b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a2c0: 2020 2020 2020 2020 2020 6261 7365 706c            basepl
+0001a2d0: 616e 203d 2070 726f 6669 6c65 5b27 6261  an = profile['ba
+0001a2e0: 7365 706c 616e 275d 0a20 2020 2020 2020  seplan'].       
+0001a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a300: 2062 6173 6564 6972 203d 206f 732e 7061   basedir = os.pa
+0001a310: 7468 2e64 6972 6e61 6d65 2869 6e70 7574  th.dirname(input
+0001a320: 6669 6c65 2920 6966 2027 2f27 2069 6e20  file) if '/' in 
+0001a330: 696e 7075 7466 696c 6520 656c 7365 2027  inputfile else '
+0001a340: 2e27 0a20 2020 2020 2020 2020 2020 2020  .'.             
+0001a350: 2020 2020 2020 2020 2020 2062 6173 6569             basei
+0001a360: 6e70 7574 6669 6c65 203d 2066 227b 6261  nputfile = f"{ba
+0001a370: 7365 6469 727d 2f7b 6261 7365 706c 616e  sedir}/{baseplan
+0001a380: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+0001a390: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+0001a3a0: 6e74 6169 6e65 725f 6d6f 6465 2829 2061  ntainer_mode() a
+0001a3b0: 6e64 206e 6f74 206f 732e 7061 7468 2e69  nd not os.path.i
+0001a3c0: 7361 6273 2862 6173 6570 6c61 6e29 2061  sabs(baseplan) a
+0001a3d0: 6e64 2027 2f77 6f72 6b64 6972 2720 6e6f  nd '/workdir' no
+0001a3e0: 7420 696e 2062 6173 6564 6972 3a0a 2020  t in basedir:.  
+0001a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a400: 2020 2020 2020 2020 2020 6261 7365 696e            basein
+0001a410: 7075 7466 696c 6520 3d20 6622 2f77 6f72  putfile = f"/wor
+0001a420: 6b64 6972 2f7b 6261 7365 6469 727d 2f7b  kdir/{basedir}/{
+0001a430: 6261 7365 706c 616e 7d22 0a20 2020 2020  baseplan}".     
+0001a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a450: 2020 2062 6173 6576 6d20 3d20 7072 6f66     basevm = prof
+0001a460: 696c 655b 2762 6173 6576 6d27 5d20 6966  ile['basevm'] if
+0001a470: 2027 6261 7365 766d 2720 696e 2070 726f   'basevm' in pro
+0001a480: 6669 6c65 2065 6c73 6520 6e61 6d65 0a20  file else name. 
+0001a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a4a0: 2020 2020 2020 2069 6620 6261 7365 706c         if basepl
+0001a4b0: 616e 206e 6f74 2069 6e20 6261 7365 706c  an not in basepl
+0001a4c0: 616e 733a 0a20 2020 2020 2020 2020 2020  ans:.           
+0001a4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a4e0: 2073 656c 662e 706c 616e 2870 6c61 6e2c   self.plan(plan,
+0001a4f0: 2069 6e70 7574 6669 6c65 3d62 6173 6569   inputfile=basei
+0001a500: 6e70 7574 6669 6c65 2c20 6f76 6572 7269  nputfile, overri
+0001a510: 6465 733d 6f76 6572 7269 6465 732c 2065  des=overrides, e
+0001a520: 7863 6c75 6465 766d 733d 766d 6e61 6d65  xcludevms=vmname
+0001a530: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0001a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a550: 2020 2020 2020 2020 2062 6173 656d 6f64           basemod
+0001a560: 653d 5472 7565 2c20 6f6e 6c79 6173 7365  e=True, onlyasse
+0001a570: 7473 3d6f 6e6c 7961 7373 6574 7329 0a20  ts=onlyassets). 
+0001a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a590: 2020 2020 2020 2020 2020 2062 6173 6570             basep
+0001a5a0: 6c61 6e73 2e61 7070 656e 6428 6261 7365  lans.append(base
+0001a5b0: 706c 616e 290a 2020 2020 2020 2020 2020  plan).          
+0001a5c0: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+0001a5d0: 7365 696e 666f 203d 2073 656c 662e 7072  seinfo = self.pr
+0001a5e0: 6f63 6573 735f 696e 7075 7466 696c 6528  ocess_inputfile(
+0001a5f0: 706c 616e 2c20 6261 7365 696e 7075 7466  plan, baseinputf
+0001a600: 696c 652c 206f 7665 7272 6964 6573 3d6f  ile, overrides=o
+0001a610: 7665 7272 6964 6573 2c20 6675 6c6c 3d54  verrides, full=T
+0001a620: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0001a630: 2020 2020 2020 2020 2020 2020 2062 6173               bas
+0001a640: 6570 726f 6669 6c65 203d 2062 6173 6569  eprofile = basei
+0001a650: 6e66 6f5b 305d 5b62 6173 6576 6d5d 2069  nfo[0][basevm] i
+0001a660: 6620 6261 7365 766d 2069 6e20 6261 7365  f basevm in base
+0001a670: 696e 666f 5b30 5d20 656c 7365 207b 7d0a  info[0] else {}.
+0001a680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a690: 2020 2020 2020 2020 6375 7272 656e 7470          currentp
+0001a6a0: 6c61 6e64 6972 203d 2062 6173 6569 6e66  landir = baseinf
+0001a6b0: 6f5b 335d 2069 6620 6f73 2e70 6174 682e  o[3] if os.path.
+0001a6c0: 6973 6162 7328 6261 7365 696e 666f 5b33  isabs(baseinfo[3
+0001a6d0: 5d29 2065 6c73 6520 272e 270a 2020 2020  ]) else '.'.    
+0001a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a6f0: 656c 6966 2027 6261 7365 766d 2720 696e  elif 'basevm' in
+0001a700: 2070 726f 6669 6c65 2061 6e64 2070 726f   profile and pro
+0001a710: 6669 6c65 5b27 6261 7365 766d 275d 2069  file['basevm'] i
+0001a720: 6e20 6261 7365 656e 7472 6965 733a 0a20  n baseentries:. 
 0001a730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a740: 7275 6c65 203d 206c 6973 7428 656e 7472  rule = list(entr
-0001a750: 792e 6b65 7973 2829 295b 305d 0a20 2020  y.keys())[0].   
-0001a760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a770: 2069 6620 2872 652e 6d61 7463 6828 7275   if (re.match(ru
-0001a780: 6c65 2c20 6e61 6d65 2920 6f72 2066 6e6d  le, name) or fnm
-0001a790: 6174 6368 286e 616d 652c 2072 756c 6529  atch(name, rule)
-0001a7a0: 2920 616e 6420 6973 696e 7374 616e 6365  ) and isinstance
-0001a7b0: 2865 6e74 7279 5b72 756c 655d 2c20 6469  (entry[rule], di
-0001a7c0: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
-0001a7d0: 2020 2020 2020 2020 2020 2020 2072 756c               rul
-0001a7e0: 6566 6f75 6e64 203d 2054 7275 650a 2020  efound = True.  
-0001a7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a800: 2020 2020 2020 6c69 7374 6b65 7973 203d        listkeys =
-0001a810: 205b 2763 6d64 7327 2c20 2766 696c 6573   ['cmds', 'files
-0001a820: 272c 2027 7363 7269 7074 7327 5d0a 2020  ', 'scripts'].  
+0001a740: 2020 2020 2020 2062 6173 6570 726f 6669         baseprofi
+0001a750: 6c65 203d 2062 6173 6565 6e74 7269 6573  le = baseentries
+0001a760: 5b70 726f 6669 6c65 5b27 6261 7365 766d  [profile['basevm
+0001a770: 275d 5d0a 2020 2020 2020 2020 2020 2020  ']].            
+0001a780: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0001a790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7a0: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
+0001a7b0: 496e 636f 7272 6563 7420 6261 7365 2065  Incorrect base e
+0001a7c0: 6e74 7279 2066 6f72 207b 6e61 6d65 7d2e  ntry for {name}.
+0001a7d0: 2053 6b69 7070 696e 672e 2e2e 2229 0a20   Skipping..."). 
+0001a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7f0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+0001a800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a810: 2020 2020 666f 7220 6b65 7920 696e 2062      for key in b
+0001a820: 6173 6570 726f 6669 6c65 3a0a 2020 2020  aseprofile:.    
 0001a830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a840: 2020 2020 2020 666f 7220 7275 6c65 2069        for rule i
-0001a850: 6e20 656e 7472 793a 0a20 2020 2020 2020  n entry:.       
+0001a840: 2020 2020 6966 206b 6579 206e 6f74 2069      if key not i
+0001a850: 6e20 7072 6f66 696c 653a 0a20 2020 2020  n profile:.     
 0001a860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a870: 2020 2020 2063 7572 7265 6e74 203d 2065       current = e
-0001a880: 6e74 7279 5b72 756c 655d 0a20 2020 2020  ntry[rule].     
-0001a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a8a0: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
-0001a8b0: 6e20 6375 7272 656e 743a 0a20 2020 2020  n current:.     
-0001a8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a8d0: 2020 2020 2020 2020 2020 2069 6620 6b65             if ke
-0001a8e0: 7920 696e 206c 6973 746b 6579 7320 616e  y in listkeys an
-0001a8f0: 6420 6973 696e 7374 616e 6365 2863 7572  d isinstance(cur
-0001a900: 7265 6e74 5b6b 6579 5d2c 206c 6973 7429  rent[key], list)
-0001a910: 2061 6e64 206b 6579 2069 6e20 7072 6f66   and key in prof
-0001a920: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-0001a930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a940: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-0001a950: 5b6b 6579 5d20 3d20 7072 6f66 696c 655b  [key] = profile[
-0001a960: 6b65 795d 202b 2063 7572 7265 6e74 5b6b  key] + current[k
-0001a970: 6579 5d0a 2020 2020 2020 2020 2020 2020  ey].            
-0001a980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a990: 7072 6f66 696c 652e 7570 6461 7465 2865  profile.update(e
-0001a9a0: 6e74 7279 5b72 756c 655d 290a 2020 2020  ntry[rule]).    
-0001a9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9c0: 2020 2020 2020 2020 6966 2027 6e61 6d65          if 'name
-0001a9d0: 2720 696e 2065 6e74 7279 5b72 756c 655d  ' in entry[rule]
-0001a9e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa00: 2020 7761 726e 696e 6728 6622 5265 6e61    warning(f"Rena
-0001aa10: 6d69 6e67 207b 6e61 6d65 7d20 746f 207b  ming {name} to {
-0001aa20: 656e 7472 795b 7275 6c65 5d5b 276e 616d  entry[rule]['nam
-0001aa30: 6527 5d7d 2229 0a20 2020 2020 2020 2020  e']}").         
-0001aa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa50: 2020 2020 2020 206e 616d 6520 3d20 656e         name = en
-0001aa60: 7472 795b 7275 6c65 5d5b 276e 616d 6527  try[rule]['name'
-0001aa70: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001aa80: 2020 6966 2076 6d72 756c 6573 5f73 7472    if vmrules_str
-0001aa90: 6963 7420 616e 6420 6e6f 7420 7275 6c65  ict and not rule
-0001aaa0: 666f 756e 643a 0a20 2020 2020 2020 2020  found:.         
-0001aab0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-0001aac0: 6e67 2866 224e 6f20 766d 7275 6c65 7320  ng(f"No vmrules 
-0001aad0: 666f 756e 6420 666f 7220 7b6e 616d 657d  found for {name}
-0001aae0: 2e20 536b 6970 7069 6e67 2e2e 2e22 290a  . Skipping...").
+0001a870: 2020 2020 2020 2070 726f 6669 6c65 5b6b         profile[k
+0001a880: 6579 5d20 3d20 6261 7365 7072 6f66 696c  ey] = baseprofil
+0001a890: 655b 6b65 795d 0a20 2020 2020 2020 2020  e[key].         
+0001a8a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001a8b0: 6c69 6620 6b65 7920 696e 2062 6173 6570  lif key in basep
+0001a8c0: 726f 6669 6c65 2061 6e64 206b 6579 2069  rofile and key i
+0001a8d0: 6e20 7072 6f66 696c 6520 616e 6420 6b65  n profile and ke
+0001a8e0: 7920 696e 2061 7070 656e 646b 6579 733a  y in appendkeys:
+0001a8f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a900: 2020 2020 2020 2020 2020 2020 2070 726f               pro
+0001a910: 6669 6c65 5b6b 6579 5d20 3d20 6261 7365  file[key] = base
+0001a920: 7072 6f66 696c 655b 6b65 795d 202b 2070  profile[key] + p
+0001a930: 726f 6669 6c65 5b6b 6579 5d0a 2020 2020  rofile[key].    
+0001a940: 2020 2020 2020 2020 2020 2020 7275 6c65              rule
+0001a950: 666f 756e 6420 3d20 4661 6c73 650a 2020  found = False.  
+0001a960: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001a970: 7220 656e 7472 7920 696e 206f 7665 7272  r entry in overr
+0001a980: 6964 6573 2e67 6574 2827 766d 7275 6c65  ides.get('vmrule
+0001a990: 7327 2c20 7365 6c66 2e76 6d72 756c 6573  s', self.vmrules
+0001a9a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001a9b0: 2020 2020 2020 2069 6620 6c65 6e28 656e         if len(en
+0001a9c0: 7472 7929 2021 3d20 313a 0a20 2020 2020  try) != 1:.     
+0001a9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9e0: 2020 2065 7272 6f72 2866 2257 726f 6e67     error(f"Wrong
+0001a9f0: 2076 6d20 7275 6c65 207b 656e 7472 797d   vm rule {entry}
+0001aa00: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001aa10: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+0001aa20: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
+0001aa30: 2020 2020 2020 2020 2020 2072 756c 6520             rule 
+0001aa40: 3d20 6c69 7374 2865 6e74 7279 2e6b 6579  = list(entry.key
+0001aa50: 7328 2929 5b30 5d0a 2020 2020 2020 2020  s())[0].        
+0001aa60: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+0001aa70: 7265 2e6d 6174 6368 2872 756c 652c 206e  re.match(rule, n
+0001aa80: 616d 6529 206f 7220 666e 6d61 7463 6828  ame) or fnmatch(
+0001aa90: 6e61 6d65 2c20 7275 6c65 2929 2061 6e64  name, rule)) and
+0001aaa0: 2069 7369 6e73 7461 6e63 6528 656e 7472   isinstance(entr
+0001aab0: 795b 7275 6c65 5d2c 2064 6963 7429 3a0a  y[rule], dict):.
+0001aac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aad0: 2020 2020 2020 2020 7275 6c65 666f 756e          rulefoun
+0001aae0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
 0001aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab00: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
-0001ab10: 2020 2020 2020 2020 2020 2020 2076 6d63               vmc
-0001ab20: 6c69 656e 7420 3d20 7072 6f66 696c 652e  lient = profile.
-0001ab30: 6765 7428 2763 6c69 656e 7427 290a 2020  get('client').  
-0001ab40: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001ab50: 2076 6d63 6c69 656e 7420 6973 206e 6f74   vmclient is not
-0001ab60: 204e 6f6e 6520 616e 6420 766d 636c 6965   None and vmclie
-0001ab70: 6e74 206e 6f74 2069 6e20 766d 636c 6965  nt not in vmclie
-0001ab80: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
-0001ab90: 2020 2020 2020 2020 2076 6d63 6c69 656e           vmclien
-0001aba0: 7473 2e61 7070 656e 6428 766d 636c 6965  ts.append(vmclie
-0001abb0: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
-0001abc0: 2020 2020 6966 2076 6d63 6c69 656e 7420      if vmclient 
-0001abd0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0001abe0: 2020 2020 2020 2020 2020 2020 207a 203d               z =
-0001abf0: 206b 0a20 2020 2020 2020 2020 2020 2020   k.             
-0001ac00: 2020 2020 2020 2076 6d63 6c69 656e 7420         vmclient 
-0001ac10: 3d20 7365 6c66 2e63 6c69 656e 740a 2020  = self.client.  
+0001ab00: 206c 6973 746b 6579 7320 3d20 5b27 636d   listkeys = ['cm
+0001ab10: 6473 272c 2027 6669 6c65 7327 2c20 2773  ds', 'files', 's
+0001ab20: 6372 6970 7473 275d 0a20 2020 2020 2020  cripts'].       
+0001ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab40: 2066 6f72 2072 756c 6520 696e 2065 6e74   for rule in ent
+0001ab50: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0001ab60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab70: 6375 7272 656e 7420 3d20 656e 7472 795b  current = entry[
+0001ab80: 7275 6c65 5d0a 2020 2020 2020 2020 2020  rule].          
+0001ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aba0: 2020 666f 7220 6b65 7920 696e 2063 7572    for key in cur
+0001abb0: 7265 6e74 3a0a 2020 2020 2020 2020 2020  rent:.          
+0001abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abd0: 2020 2020 2020 6966 206b 6579 2069 6e20        if key in 
+0001abe0: 6c69 7374 6b65 7973 2061 6e64 2069 7369  listkeys and isi
+0001abf0: 6e73 7461 6e63 6528 6375 7272 656e 745b  nstance(current[
+0001ac00: 6b65 795d 2c20 6c69 7374 2920 616e 6420  key], list) and 
+0001ac10: 6b65 7920 696e 2070 726f 6669 6c65 3a0a  key in profile:.
 0001ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac30: 2020 6966 2076 6d63 6c69 656e 7420 6e6f    if vmclient no
-0001ac40: 7420 696e 2068 6f73 7473 3a0a 2020 2020  t in hosts:.    
-0001ac50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac60: 2020 2020 686f 7374 735b 766d 636c 6965      hosts[vmclie
-0001ac70: 6e74 5d20 3d20 7365 6c66 0a20 2020 2020  nt] = self.     
-0001ac80: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0001ac90: 766d 636c 6965 6e74 2069 6e20 686f 7374  vmclient in host
-0001aca0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0001acb0: 2020 2020 2020 207a 203d 2068 6f73 7473         z = hosts
-0001acc0: 5b76 6d63 6c69 656e 745d 2e6b 0a20 2020  [vmclient].k.   
-0001acd0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-0001ace0: 6620 766d 636c 6965 6e74 2069 6e20 7365  f vmclient in se
-0001acf0: 6c66 2e63 6c69 656e 7473 3a0a 2020 2020  lf.clients:.    
-0001ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad10: 6e65 7763 6c69 656e 7420 3d20 4b63 6f6e  newclient = Kcon
-0001ad20: 6669 6728 636c 6965 6e74 3d76 6d63 6c69  fig(client=vmcli
-0001ad30: 656e 7429 0a20 2020 2020 2020 2020 2020  ent).           
-0001ad40: 2020 2020 2020 2020 207a 203d 206e 6577           z = new
-0001ad50: 636c 6965 6e74 2e6b 0a20 2020 2020 2020  client.k.       
-0001ad60: 2020 2020 2020 2020 2020 2020 2068 6f73               hos
-0001ad70: 7473 5b76 6d63 6c69 656e 745d 203d 206e  ts[vmclient] = n
-0001ad80: 6577 636c 6965 6e74 0a20 2020 2020 2020  ewclient.       
-0001ad90: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0001ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001adb0: 2020 2077 6172 6e69 6e67 2866 2243 6c69     warning(f"Cli
-0001adc0: 656e 7420 7b76 6d63 6c69 656e 747d 206e  ent {vmclient} n
-0001add0: 6f74 2066 6f75 6e64 2e20 5573 696e 6720  ot found. Using 
-0001ade0: 6465 6661 756c 7420 6f6e 6522 290a 2020  default one").  
-0001adf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae00: 2020 7a20 3d20 6b0a 2020 2020 2020 2020    z = k.        
-0001ae10: 2020 2020 2020 2020 2020 2020 766d 636c              vmcl
-0001ae20: 6965 6e74 203d 2073 656c 662e 636c 6965  ient = self.clie
-0001ae30: 6e74 0a20 2020 2020 2020 2020 2020 2020  nt.             
-0001ae40: 2020 2020 2020 2069 6620 766d 636c 6965         if vmclie
-0001ae50: 6e74 206e 6f74 2069 6e20 686f 7374 733a  nt not in hosts:
-0001ae60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ae70: 2020 2020 2020 2020 2068 6f73 7473 5b76           hosts[v
-0001ae80: 6d63 6c69 656e 745d 203d 2073 656c 660a  mclient] = self.
-0001ae90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aea0: 766d 735f 746f 5f68 6f73 745b 6e61 6d65  vms_to_host[name
-0001aeb0: 5d20 3d20 686f 7374 735b 766d 636c 6965  ] = hosts[vmclie
-0001aec0: 6e74 5d0a 2020 2020 2020 2020 2020 2020  nt].            
-0001aed0: 2020 2020 6966 2027 7072 6f66 696c 6527      if 'profile'
-0001aee0: 2069 6e20 7072 6f66 696c 6520 616e 6420   in profile and 
-0001aef0: 7072 6f66 696c 655b 2770 726f 6669 6c65  profile['profile
-0001af00: 275d 2069 6e20 766d 7072 6f66 696c 6573  '] in vmprofiles
-0001af10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001af20: 2020 2020 2020 6375 7374 6f6d 7072 6f66        customprof
-0001af30: 696c 6520 3d20 766d 7072 6f66 696c 6573  ile = vmprofiles
-0001af40: 5b70 726f 6669 6c65 5b27 7072 6f66 696c  [profile['profil
-0001af50: 6527 5d5d 0a20 2020 2020 2020 2020 2020  e']].           
-0001af60: 2020 2020 2020 2020 2070 726f 6669 6c65           profile
-0001af70: 6e61 6d65 203d 2070 726f 6669 6c65 5b27  name = profile['
-0001af80: 7072 6f66 696c 6527 5d0a 2020 2020 2020  profile'].      
-0001af90: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0001ac30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac40: 2020 2020 6375 7272 656e 745b 6b65 795d      current[key]
+0001ac50: 203d 2070 726f 6669 6c65 5b6b 6579 5d20   = profile[key] 
+0001ac60: 2b20 6375 7272 656e 745b 6b65 795d 0a20  + current[key]. 
+0001ac70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac80: 2020 2020 2020 2020 2020 2070 726f 6669             profi
+0001ac90: 6c65 2e75 7064 6174 6528 656e 7472 795b  le.update(entry[
+0001aca0: 7275 6c65 5d29 0a20 2020 2020 2020 2020  rule]).         
+0001acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acc0: 2020 2069 6620 276e 616d 6527 2069 6e20     if 'name' in 
+0001acd0: 656e 7472 795b 7275 6c65 5d3a 0a20 2020  entry[rule]:.   
+0001ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acf0: 2020 2020 2020 2020 2020 2020 2077 6172               war
+0001ad00: 6e69 6e67 2866 2252 656e 616d 696e 6720  ning(f"Renaming 
+0001ad10: 7b6e 616d 657d 2074 6f20 7b65 6e74 7279  {name} to {entry
+0001ad20: 5b72 756c 655d 5b27 6e61 6d65 275d 7d22  [rule]['name']}"
+0001ad30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad50: 2020 6e61 6d65 203d 2065 6e74 7279 5b72    name = entry[r
+0001ad60: 756c 655d 5b27 6e61 6d65 275d 0a20 2020  ule]['name'].   
+0001ad70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001ad80: 766d 7275 6c65 735f 7374 7269 6374 2061  vmrules_strict a
+0001ad90: 6e64 206e 6f74 2072 756c 6566 6f75 6e64  nd not rulefound
+0001ada0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001adb0: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
+0001adc0: 4e6f 2076 6d72 756c 6573 2066 6f75 6e64  No vmrules found
+0001add0: 2066 6f72 207b 6e61 6d65 7d2e 2053 6b69   for {name}. Ski
+0001ade0: 7070 696e 672e 2e2e 2229 0a20 2020 2020  pping...").     
+0001adf0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001ae00: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+0001ae10: 2020 2020 2020 2020 766d 636c 6965 6e74          vmclient
+0001ae20: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+0001ae30: 636c 6965 6e74 2729 0a20 2020 2020 2020  client').       
+0001ae40: 2020 2020 2020 2020 2069 6620 766d 636c           if vmcl
+0001ae50: 6965 6e74 2069 7320 6e6f 7420 4e6f 6e65  ient is not None
+0001ae60: 2061 6e64 2076 6d63 6c69 656e 7420 6e6f   and vmclient no
+0001ae70: 7420 696e 2076 6d63 6c69 656e 7473 3a0a  t in vmclients:.
+0001ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae90: 2020 2020 766d 636c 6965 6e74 732e 6170      vmclients.ap
+0001aea0: 7065 6e64 2876 6d63 6c69 656e 7429 0a20  pend(vmclient). 
+0001aeb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001aec0: 6620 766d 636c 6965 6e74 2069 7320 4e6f  f vmclient is No
+0001aed0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0001aee0: 2020 2020 2020 2020 7a20 3d20 6b0a 2020          z = k.  
+0001aef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af00: 2020 766d 636c 6965 6e74 203d 2073 656c    vmclient = sel
+0001af10: 662e 636c 6965 6e74 0a20 2020 2020 2020  f.client.       
+0001af20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001af30: 766d 636c 6965 6e74 206e 6f74 2069 6e20  vmclient not in 
+0001af40: 686f 7374 733a 0a20 2020 2020 2020 2020  hosts:.         
+0001af50: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0001af60: 6f73 7473 5b76 6d63 6c69 656e 745d 203d  osts[vmclient] =
+0001af70: 2073 656c 660a 2020 2020 2020 2020 2020   self.          
+0001af80: 2020 2020 2020 656c 6966 2076 6d63 6c69        elif vmcli
+0001af90: 656e 7420 696e 2068 6f73 7473 3a0a 2020  ent in hosts:.  
 0001afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001afb0: 2020 2020 6375 7374 6f6d 7072 6f66 696c      customprofil
-0001afc0: 6520 3d20 7b7d 0a20 2020 2020 2020 2020  e = {}.         
-0001afd0: 2020 2020 2020 2020 2020 2070 726f 6669             profi
-0001afe0: 6c65 6e61 6d65 203d 2027 6b76 6972 7427  lename = 'kvirt'
-0001aff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b000: 2069 6620 6375 7374 6f6d 7072 6f66 696c   if customprofil
-0001b010: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001b020: 2020 2020 2020 2063 7573 746f 6d70 726f         custompro
-0001b030: 6669 6c65 2e75 7064 6174 6528 7072 6f66  file.update(prof
-0001b040: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
-0001b050: 2020 2020 2020 2020 2070 726f 6669 6c65           profile
-0001b060: 203d 2063 7573 746f 6d70 726f 6669 6c65   = customprofile
-0001b070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b080: 2069 6620 2770 6c61 7962 6f6f 6b27 2069   if 'playbook' i
-0001b090: 6e20 7072 6f66 696c 6520 616e 6420 7072  n profile and pr
-0001b0a0: 6f66 696c 655b 2770 6c61 7962 6f6f 6b27  ofile['playbook'
-0001b0b0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-0001b0c0: 2020 2020 2020 2069 6620 2773 6372 6970         if 'scrip
-0001b0d0: 7473 2720 6e6f 7420 696e 2070 726f 6669  ts' not in profi
-0001b0e0: 6c65 2061 6e64 2027 6669 6c65 7327 206e  le and 'files' n
-0001b0f0: 6f74 2069 6e20 7072 6f66 696c 6520 616e  ot in profile an
-0001b100: 6420 2763 6d64 7327 206e 6f74 2069 6e20  d 'cmds' not in 
-0001b110: 7072 6f66 696c 653a 0a20 2020 2020 2020  profile:.       
-0001b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b130: 2070 7072 696e 7428 6622 536b 6970 7069   pprint(f"Skippi
-0001b140: 6e67 2065 6d70 7479 2070 6c61 7962 6f6f  ng empty playboo
-0001b150: 6b20 666f 7220 7b6e 616d 657d 2229 0a20  k for {name}"). 
+0001afb0: 2020 7a20 3d20 686f 7374 735b 766d 636c    z = hosts[vmcl
+0001afc0: 6965 6e74 5d2e 6b0a 2020 2020 2020 2020  ient].k.        
+0001afd0: 2020 2020 2020 2020 656c 6966 2076 6d63          elif vmc
+0001afe0: 6c69 656e 7420 696e 2073 656c 662e 636c  lient in self.cl
+0001aff0: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
+0001b000: 2020 2020 2020 2020 2020 206e 6577 636c             newcl
+0001b010: 6965 6e74 203d 204b 636f 6e66 6967 2863  ient = Kconfig(c
+0001b020: 6c69 656e 743d 766d 636c 6965 6e74 290a  lient=vmclient).
+0001b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b040: 2020 2020 7a20 3d20 6e65 7763 6c69 656e      z = newclien
+0001b050: 742e 6b0a 2020 2020 2020 2020 2020 2020  t.k.            
+0001b060: 2020 2020 2020 2020 686f 7374 735b 766d          hosts[vm
+0001b070: 636c 6965 6e74 5d20 3d20 6e65 7763 6c69  client] = newcli
+0001b080: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
+0001b090: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001b0a0: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+0001b0b0: 726e 696e 6728 6622 436c 6965 6e74 207b  rning(f"Client {
+0001b0c0: 766d 636c 6965 6e74 7d20 6e6f 7420 666f  vmclient} not fo
+0001b0d0: 756e 642e 2055 7369 6e67 2064 6566 6175  und. Using defau
+0001b0e0: 6c74 206f 6e65 2229 0a20 2020 2020 2020  lt one").       
+0001b0f0: 2020 2020 2020 2020 2020 2020 207a 203d               z =
+0001b100: 206b 0a20 2020 2020 2020 2020 2020 2020   k.             
+0001b110: 2020 2020 2020 2076 6d63 6c69 656e 7420         vmclient 
+0001b120: 3d20 7365 6c66 2e63 6c69 656e 740a 2020  = self.client.  
+0001b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b140: 2020 6966 2076 6d63 6c69 656e 7420 6e6f    if vmclient no
+0001b150: 7420 696e 2068 6f73 7473 3a0a 2020 2020  t in hosts:.    
 0001b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b170: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b190: 2069 6620 2769 6d61 6765 2720 696e 2070   if 'image' in p
-0001b1a0: 726f 6669 6c65 2061 6e64 2027 7268 656c  rofile and 'rhel
-0001b1b0: 2720 696e 2070 726f 6669 6c65 5b27 696d  ' in profile['im
-0001b1c0: 6167 6527 5d5c 0a20 2020 2020 2020 2020  age']\.         
-0001b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1e0: 2020 2020 2020 2061 6e64 2027 7268 6e72         and 'rhnr
-0001b1f0: 6567 6973 7465 7227 2069 6e20 7072 6f66  egister' in prof
-0001b200: 696c 6520 616e 6420 7072 6f66 696c 655b  ile and profile[
-0001b210: 2772 686e 7265 6769 7374 6572 275d 3a0a  'rhnregister']:.
-0001b220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b230: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-0001b240: 696e 6728 6622 4d61 6b65 2073 7572 6520  ing(f"Make sure 
-0001b250: 746f 2073 7562 7363 7269 6265 207b 6e61  to subscribe {na
-0001b260: 6d65 7d20 746f 2052 6564 2048 6174 206e  me} to Red Hat n
-0001b270: 6574 776f 726b 2229 0a20 2020 2020 2020  etwork").       
-0001b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b290: 2069 6620 2770 7269 7661 7465 6b65 7927   if 'privatekey'
-0001b2a0: 2069 6e20 7072 6f66 696c 6520 616e 6420   in profile and 
-0001b2b0: 7072 6f66 696c 655b 2770 7269 7661 7465  profile['private
-0001b2c0: 6b65 7927 5d3a 0a20 2020 2020 2020 2020  key']:.         
-0001b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b2e0: 2020 2077 6172 6e69 6e67 2866 2243 6f70     warning(f"Cop
-0001b2f0: 7920 796f 7572 2070 7269 7661 7465 206b  y your private k
-0001b300: 6579 2074 6f20 7b6e 616d 657d 2229 0a20  ey to {name}"). 
+0001b170: 2020 2020 686f 7374 735b 766d 636c 6965      hosts[vmclie
+0001b180: 6e74 5d20 3d20 7365 6c66 0a20 2020 2020  nt] = self.     
+0001b190: 2020 2020 2020 2020 2020 2076 6d73 5f74             vms_t
+0001b1a0: 6f5f 686f 7374 5b6e 616d 655d 203d 2068  o_host[name] = h
+0001b1b0: 6f73 7473 5b76 6d63 6c69 656e 745d 0a20  osts[vmclient]. 
+0001b1c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001b1d0: 6620 2770 726f 6669 6c65 2720 696e 2070  f 'profile' in p
+0001b1e0: 726f 6669 6c65 2061 6e64 2070 726f 6669  rofile and profi
+0001b1f0: 6c65 5b27 7072 6f66 696c 6527 5d20 696e  le['profile'] in
+0001b200: 2076 6d70 726f 6669 6c65 733a 0a20 2020   vmprofiles:.   
+0001b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b220: 2063 7573 746f 6d70 726f 6669 6c65 203d   customprofile =
+0001b230: 2076 6d70 726f 6669 6c65 735b 7072 6f66   vmprofiles[prof
+0001b240: 696c 655b 2770 726f 6669 6c65 275d 5d0a  ile['profile']].
+0001b250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b260: 2020 2020 7072 6f66 696c 656e 616d 6520      profilename 
+0001b270: 3d20 7072 6f66 696c 655b 2770 726f 6669  = profile['profi
+0001b280: 6c65 275d 0a20 2020 2020 2020 2020 2020  le'].           
+0001b290: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001b2a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001b2b0: 7573 746f 6d70 726f 6669 6c65 203d 207b  ustomprofile = {
+0001b2c0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+0001b2d0: 2020 2020 2020 7072 6f66 696c 656e 616d        profilenam
+0001b2e0: 6520 3d20 276b 7669 7274 270a 2020 2020  e = 'kvirt'.    
+0001b2f0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0001b300: 7573 746f 6d70 726f 6669 6c65 3a0a 2020  ustomprofile:.  
 0001b310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b320: 2020 2020 2020 2066 6f72 206e 6574 2069         for net i
-0001b330: 6e20 7072 6f66 696c 652e 6765 7428 276e  n profile.get('n
-0001b340: 6574 7327 2c20 5b5d 293a 0a20 2020 2020  ets', []):.     
-0001b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b360: 2020 2020 2020 2069 6620 2769 7027 2069         if 'ip' i
-0001b370: 6e20 6e65 7420 616e 6420 276d 6173 6b27  n net and 'mask'
-0001b380: 2069 6e20 6e65 7420 616e 6420 2767 6174   in net and 'gat
-0001b390: 6577 6179 2720 696e 206e 6574 3a0a 2020  eway' in net:.  
-0001b3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3b0: 2020 2020 2020 2020 2020 2020 2020 6970                ip
-0001b3c0: 2c20 6d61 736b 2c20 6761 7465 7761 7920  , mask, gateway 
-0001b3d0: 3d20 6e65 745b 2769 7027 5d2c 206e 6574  = net['ip'], net
-0001b3e0: 5b27 6d61 736b 275d 2c20 6e65 745b 2767  ['mask'], net['g
-0001b3f0: 6174 6577 6179 275d 0a20 2020 2020 2020  ateway'].       
-0001b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b410: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0001b420: 2866 2241 6464 206d 616e 7561 6c6c 7920  (f"Add manually 
-0001b430: 7468 6973 206e 6574 776f 726b 207b 6970  this network {ip
-0001b440: 7d2f 7b6d 6173 6b7d 2077 6974 6820 6761  }/{mask} with ga
-0001b450: 7465 7761 7920 7b67 6174 6577 6179 7d22  teway {gateway}"
-0001b460: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001b470: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001b480: 2027 7669 7073 2720 696e 206e 6574 3a0a   'vips' in net:.
-0001b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4b0: 7669 7073 203d 2027 2c27 2e6a 6f69 6e28  vips = ','.join(
-0001b4c0: 6e65 745b 2776 6970 7327 5d29 0a20 2020  net['vips']).   
+0001b320: 2020 6375 7374 6f6d 7072 6f66 696c 652e    customprofile.
+0001b330: 7570 6461 7465 2870 726f 6669 6c65 290a  update(profile).
+0001b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b350: 2020 2020 7072 6f66 696c 6520 3d20 6375      profile = cu
+0001b360: 7374 6f6d 7072 6f66 696c 650a 2020 2020  stomprofile.    
+0001b370: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+0001b380: 706c 6179 626f 6f6b 2720 696e 2070 726f  playbook' in pro
+0001b390: 6669 6c65 2061 6e64 2070 726f 6669 6c65  file and profile
+0001b3a0: 5b27 706c 6179 626f 6f6b 275d 3a0a 2020  ['playbook']:.  
+0001b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b3c0: 2020 6966 2027 7363 7269 7074 7327 206e    if 'scripts' n
+0001b3d0: 6f74 2069 6e20 7072 6f66 696c 6520 616e  ot in profile an
+0001b3e0: 6420 2766 696c 6573 2720 6e6f 7420 696e  d 'files' not in
+0001b3f0: 2070 726f 6669 6c65 2061 6e64 2027 636d   profile and 'cm
+0001b400: 6473 2720 6e6f 7420 696e 2070 726f 6669  ds' not in profi
+0001b410: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+0001b420: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+0001b430: 6e74 2866 2253 6b69 7070 696e 6720 656d  nt(f"Skipping em
+0001b440: 7074 7920 706c 6179 626f 6f6b 2066 6f72  pty playbook for
+0001b450: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
+0001b460: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0001b470: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001b480: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+0001b490: 696d 6167 6527 2069 6e20 7072 6f66 696c  image' in profil
+0001b4a0: 6520 616e 6420 2772 6865 6c27 2069 6e20  e and 'rhel' in 
+0001b4b0: 7072 6f66 696c 655b 2769 6d61 6765 275d  profile['image']
+0001b4c0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
 0001b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4e0: 2020 2020 2020 2020 2020 2020 2077 6172               war
-0001b4f0: 6e69 6e67 2866 2241 6464 206d 616e 7561  ning(f"Add manua
-0001b500: 6c6c 7920 7669 7073 207b 7669 7073 7d22  lly vips {vips}"
-0001b510: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001b520: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-0001b530: 2822 4d61 6b65 2073 7572 6520 746f 2065  ("Make sure to e
-0001b540: 7870 6f72 7420 414e 5349 424c 455f 4a49  xport ANSIBLE_JI
-0001b550: 4e4a 4132 5f45 5854 454e 5349 4f4e 533d  NJA2_EXTENSIONS=
-0001b560: 6a69 6e6a 6132 2e65 7874 2e64 6f22 290a  jinja2.ext.do").
-0001b570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b580: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
-0001b590: 6174 655f 766d 5f70 6c61 7962 6f6f 6b28  ate_vm_playbook(
-0001b5a0: 6e61 6d65 2c20 7072 6f66 696c 652c 206f  name, profile, o
-0001b5b0: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
-0001b5c0: 6573 2c20 7374 6f72 653d 5472 7565 290a  es, store=True).
-0001b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b5e0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-0001b5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b600: 2069 6620 7a2e 6578 6973 7473 286e 616d   if z.exists(nam
-0001b610: 6529 2061 6e64 206e 6f74 206f 6e6c 7961  e) and not onlya
-0001b620: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
-0001b630: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0001b640: 7420 7570 6461 7465 3a0a 2020 2020 2020  t update:.      
+0001b4e0: 2020 616e 6420 2772 686e 7265 6769 7374    and 'rhnregist
+0001b4f0: 6572 2720 696e 2070 726f 6669 6c65 2061  er' in profile a
+0001b500: 6e64 2070 726f 6669 6c65 5b27 7268 6e72  nd profile['rhnr
+0001b510: 6567 6973 7465 7227 5d3a 0a20 2020 2020  egister']:.     
+0001b520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b530: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
+0001b540: 224d 616b 6520 7375 7265 2074 6f20 7375  "Make sure to su
+0001b550: 6273 6372 6962 6520 7b6e 616d 657d 2074  bscribe {name} t
+0001b560: 6f20 5265 6420 4861 7420 6e65 7477 6f72  o Red Hat networ
+0001b570: 6b22 290a 2020 2020 2020 2020 2020 2020  k").            
+0001b580: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+0001b590: 7072 6976 6174 656b 6579 2720 696e 2070  privatekey' in p
+0001b5a0: 726f 6669 6c65 2061 6e64 2070 726f 6669  rofile and profi
+0001b5b0: 6c65 5b27 7072 6976 6174 656b 6579 275d  le['privatekey']
+0001b5c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001b5d0: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+0001b5e0: 726e 696e 6728 6622 436f 7079 2079 6f75  rning(f"Copy you
+0001b5f0: 7220 7072 6976 6174 6520 6b65 7920 746f  r private key to
+0001b600: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
+0001b610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b620: 2020 666f 7220 6e65 7420 696e 2070 726f    for net in pro
+0001b630: 6669 6c65 2e67 6574 2827 6e65 7473 272c  file.get('nets',
+0001b640: 205b 5d29 3a0a 2020 2020 2020 2020 2020   []):.          
 0001b650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b660: 2020 7070 7269 6e74 2866 227b 6e61 6d65    pprint(f"{name
-0001b670: 7dc2 a073 6b69 7070 6564 206f 6e20 7b76  }..skipped on {v
-0001b680: 6d63 6c69 656e 747d 2122 290a 2020 2020  mclient}!").    
-0001b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b6a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001b6b0: 2020 2020 2020 2020 2020 2020 2020 7570                up
-0001b6c0: 6461 7465 6420 3d20 4661 6c73 650a 2020  dated = False.  
-0001b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b6e0: 2020 2020 2020 6375 7272 656e 7476 6d20        currentvm 
-0001b6f0: 3d20 7a2e 696e 666f 286e 616d 6529 0a20  = z.info(name). 
+0001b660: 2020 6966 2027 6970 2720 696e 206e 6574    if 'ip' in net
+0001b670: 2061 6e64 2027 6d61 736b 2720 696e 206e   and 'mask' in n
+0001b680: 6574 2061 6e64 2027 6761 7465 7761 7927  et and 'gateway'
+0001b690: 2069 6e20 6e65 743a 0a20 2020 2020 2020   in net:.       
+0001b6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b6b0: 2020 2020 2020 2020 2069 702c 206d 6173           ip, mas
+0001b6c0: 6b2c 2067 6174 6577 6179 203d 206e 6574  k, gateway = net
+0001b6d0: 5b27 6970 275d 2c20 6e65 745b 276d 6173  ['ip'], net['mas
+0001b6e0: 6b27 5d2c 206e 6574 5b27 6761 7465 7761  k'], net['gatewa
+0001b6f0: 7927 5d0a 2020 2020 2020 2020 2020 2020  y'].            
 0001b700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b710: 2020 2020 2020 2063 7572 7265 6e74 7374         currentst
-0001b720: 6172 7420 3d20 6375 7272 656e 7476 6d2e  art = currentvm.
-0001b730: 6765 7428 2761 7574 6f73 7461 7274 272c  get('autostart',
-0001b740: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
-0001b750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b760: 6375 7272 656e 746d 656d 6f72 7920 3d20  currentmemory = 
-0001b770: 6375 7272 656e 7476 6d5b 276d 656d 6f72  currentvm['memor
-0001b780: 7927 5d0a 2020 2020 2020 2020 2020 2020  y'].            
-0001b790: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-0001b7a0: 656e 7469 6d61 6765 203d 2063 7572 7265  entimage = curre
-0001b7b0: 6e74 766d 2e67 6574 2827 7465 6d70 6c61  ntvm.get('templa
-0001b7c0: 7465 2729 0a20 2020 2020 2020 2020 2020  te').           
-0001b7d0: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-0001b7e0: 7265 6e74 696d 6167 6520 3d20 6375 7272  rentimage = curr
-0001b7f0: 656e 7476 6d2e 6765 7428 2769 6d61 6765  entvm.get('image
-0001b800: 272c 2063 7572 7265 6e74 696d 6167 6529  ', currentimage)
-0001b810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b820: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-0001b830: 6370 7573 203d 2069 6e74 2863 7572 7265  cpus = int(curre
-0001b840: 6e74 766d 5b27 6370 7573 275d 290a 2020  ntvm['cpus']).  
-0001b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b860: 2020 2020 2020 6375 7272 656e 746e 6574        currentnet
-0001b870: 7320 3d20 6375 7272 656e 7476 6d5b 276e  s = currentvm['n
-0001b880: 6574 7327 5d0a 2020 2020 2020 2020 2020  ets'].          
-0001b890: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0001b8a0: 7272 656e 7464 6973 6b73 203d 2063 7572  rrentdisks = cur
-0001b8b0: 7265 6e74 766d 5b27 6469 736b 7327 5d0a  rentvm['disks'].
-0001b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b8d0: 2020 2020 2020 2020 6375 7272 656e 7466          currentf
-0001b8e0: 6c61 766f 7220 3d20 6375 7272 656e 7476  lavor = currentv
-0001b8f0: 6d2e 6765 7428 2766 6c61 766f 7227 290a  m.get('flavor').
-0001b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b910: 2020 2020 2020 2020 6966 2027 6175 746f          if 'auto
-0001b920: 7374 6172 7427 2069 6e20 7072 6f66 696c  start' in profil
-0001b930: 6520 616e 6420 6375 7272 656e 7473 7461  e and currentsta
-0001b940: 7274 2021 3d20 7072 6f66 696c 655b 2761  rt != profile['a
-0001b950: 7574 6f73 7461 7274 275d 3a0a 2020 2020  utostart']:.    
-0001b960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b970: 2020 2020 2020 2020 7570 6461 7465 6420          updated 
-0001b980: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-0001b990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9a0: 2020 2070 7072 696e 7428 6622 5570 6461     pprint(f"Upda
-0001b9b0: 7469 6e67 2061 7574 6f73 7461 7274 206f  ting autostart o
-0001b9c0: 6620 7b6e 616d 657d 2074 6f20 7b70 726f  f {name} to {pro
-0001b9d0: 6669 6c65 5b27 6175 746f 7374 6172 7427  file['autostart'
-0001b9e0: 5d7d 2229 0a20 2020 2020 2020 2020 2020  ]}").           
-0001b9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba00: 207a 2e75 7064 6174 655f 7374 6172 7428   z.update_start(
-0001ba10: 6e61 6d65 2c20 7072 6f66 696c 655b 2761  name, profile['a
-0001ba20: 7574 6f73 7461 7274 275d 290a 2020 2020  utostart']).    
-0001ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba40: 2020 2020 6966 2027 666c 6176 6f72 2720      if 'flavor' 
-0001ba50: 696e 2070 726f 6669 6c65 2061 6e64 2063  in profile and c
-0001ba60: 7572 7265 6e74 666c 6176 6f72 2021 3d20  urrentflavor != 
-0001ba70: 7072 6f66 696c 655b 2766 6c61 766f 7227  profile['flavor'
-0001ba80: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-0001ba90: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-0001baa0: 7064 6174 6564 203d 2054 7275 650a 2020  pdated = True.  
-0001bab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bac0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-0001bad0: 2866 2255 7064 6174 696e 6720 666c 6176  (f"Updating flav
-0001bae0: 6f72 206f 6620 7b6e 616d 657d 2074 6f20  or of {name} to 
-0001baf0: 7b70 726f 6669 6c65 5b27 666c 6176 6f72  {profile['flavor
-0001bb00: 275d 7d22 290a 2020 2020 2020 2020 2020  ']}").          
+0001b710: 2020 2020 7761 726e 696e 6728 6622 4164      warning(f"Ad
+0001b720: 6420 6d61 6e75 616c 6c79 2074 6869 7320  d manually this 
+0001b730: 6e65 7477 6f72 6b20 7b69 707d 2f7b 6d61  network {ip}/{ma
+0001b740: 736b 7d20 7769 7468 2067 6174 6577 6179  sk} with gateway
+0001b750: 207b 6761 7465 7761 797d 2229 0a20 2020   {gateway}").   
+0001b760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b770: 2020 2020 2020 2020 2069 6620 2776 6970           if 'vip
+0001b780: 7327 2069 6e20 6e65 743a 0a20 2020 2020  s' in net:.     
+0001b790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b7a0: 2020 2020 2020 2020 2020 2076 6970 7320             vips 
+0001b7b0: 3d20 272c 272e 6a6f 696e 286e 6574 5b27  = ','.join(net['
+0001b7c0: 7669 7073 275d 290a 2020 2020 2020 2020  vips']).        
+0001b7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b7e0: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+0001b7f0: 6622 4164 6420 6d61 6e75 616c 6c79 2076  f"Add manually v
+0001b800: 6970 7320 7b76 6970 737d 2229 0a20 2020  ips {vips}").   
+0001b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b820: 2020 2020 2070 7072 696e 7428 224d 616b       pprint("Mak
+0001b830: 6520 7375 7265 2074 6f20 6578 706f 7274  e sure to export
+0001b840: 2041 4e53 4942 4c45 5f4a 494e 4a41 325f   ANSIBLE_JINJA2_
+0001b850: 4558 5445 4e53 494f 4e53 3d6a 696e 6a61  EXTENSIONS=jinja
+0001b860: 322e 6578 742e 646f 2229 0a20 2020 2020  2.ext.do").     
+0001b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b880: 2020 2073 656c 662e 6372 6561 7465 5f76     self.create_v
+0001b890: 6d5f 706c 6179 626f 6f6b 286e 616d 652c  m_playbook(name,
+0001b8a0: 2070 726f 6669 6c65 2c20 6f76 6572 7269   profile, overri
+0001b8b0: 6465 733d 6f76 6572 7269 6465 732c 2073  des=overrides, s
+0001b8c0: 746f 7265 3d54 7275 6529 0a20 2020 2020  tore=True).     
+0001b8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8e0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+0001b8f0: 2020 2020 2020 2020 2020 2020 6966 207a              if z
+0001b900: 2e65 7869 7374 7328 6e61 6d65 2920 616e  .exists(name) an
+0001b910: 6420 6e6f 7420 6f6e 6c79 6173 7365 7473  d not onlyassets
+0001b920: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001b930: 2020 2020 2020 6966 206e 6f74 2075 7064        if not upd
+0001b940: 6174 653a 0a20 2020 2020 2020 2020 2020  ate:.           
+0001b950: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+0001b960: 696e 7428 6622 7b6e 616d 657d c2a0 736b  int(f"{name}..sk
+0001b970: 6970 7065 6420 6f6e 207b 766d 636c 6965  ipped on {vmclie
+0001b980: 6e74 7d21 2229 0a20 2020 2020 2020 2020  nt}!").         
+0001b990: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001b9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b9b0: 2020 2020 2020 2020 2075 7064 6174 6564           updated
+0001b9c0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+0001b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b9e0: 2063 7572 7265 6e74 766d 203d 207a 2e69   currentvm = z.i
+0001b9f0: 6e66 6f28 6e61 6d65 290a 2020 2020 2020  nfo(name).      
+0001ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba10: 2020 6375 7272 656e 7473 7461 7274 203d    currentstart =
+0001ba20: 2063 7572 7265 6e74 766d 2e67 6574 2827   currentvm.get('
+0001ba30: 6175 746f 7374 6172 7427 2c20 4661 6c73  autostart', Fals
+0001ba40: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0001ba50: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+0001ba60: 6e74 6d65 6d6f 7279 203d 2063 7572 7265  ntmemory = curre
+0001ba70: 6e74 766d 5b27 6d65 6d6f 7279 275d 0a20  ntvm['memory']. 
+0001ba80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba90: 2020 2020 2020 2063 7572 7265 6e74 696d         currentim
+0001baa0: 6167 6520 3d20 6375 7272 656e 7476 6d2e  age = currentvm.
+0001bab0: 6765 7428 2774 656d 706c 6174 6527 290a  get('template').
+0001bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bad0: 2020 2020 2020 2020 6375 7272 656e 7469          currenti
+0001bae0: 6d61 6765 203d 2063 7572 7265 6e74 766d  mage = currentvm
+0001baf0: 2e67 6574 2827 696d 6167 6527 2c20 6375  .get('image', cu
+0001bb00: 7272 656e 7469 6d61 6765 290a 2020 2020  rrentimage).    
 0001bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb20: 2020 7a2e 7570 6461 7465 5f66 6c61 766f    z.update_flavo
-0001bb30: 7228 6e61 6d65 2c20 7072 6f66 696c 655b  r(name, profile[
-0001bb40: 2766 6c61 766f 7227 5d29 0a20 2020 2020  'flavor']).     
+0001bb20: 2020 2020 6375 7272 656e 7463 7075 7320      currentcpus 
+0001bb30: 3d20 696e 7428 6375 7272 656e 7476 6d5b  = int(currentvm[
+0001bb40: 2763 7075 7327 5d29 0a20 2020 2020 2020  'cpus']).       
 0001bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb60: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb80: 2020 2020 2069 6620 276d 656d 6f72 7927       if 'memory'
-0001bb90: 2069 6e20 7072 6f66 696c 6520 616e 6420   in profile and 
-0001bba0: 6375 7272 656e 746d 656d 6f72 7920 213d  currentmemory !=
-0001bbb0: 2070 726f 6669 6c65 5b27 6d65 6d6f 7279   profile['memory
-0001bbc0: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-0001bbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bbe0: 2020 2020 7570 6461 7465 6420 3d20 5472      updated = Tr
-0001bbf0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+0001bb60: 2063 7572 7265 6e74 6e65 7473 203d 2063   currentnets = c
+0001bb70: 7572 7265 6e74 766d 5b27 6e65 7473 275d  urrentvm['nets']
+0001bb80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bb90: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+0001bba0: 6469 736b 7320 3d20 6375 7272 656e 7476  disks = currentv
+0001bbb0: 6d5b 2764 6973 6b73 275d 0a20 2020 2020  m['disks'].     
+0001bbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bbd0: 2020 2063 7572 7265 6e74 666c 6176 6f72     currentflavor
+0001bbe0: 203d 2063 7572 7265 6e74 766d 2e67 6574   = currentvm.get
+0001bbf0: 2827 666c 6176 6f72 2729 0a20 2020 2020  ('flavor').     
 0001bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc10: 2020 2070 7072 696e 7428 6622 5570 6461     pprint(f"Upda
-0001bc20: 7469 6e67 206d 656d 6f72 7920 6f66 207b  ting memory of {
-0001bc30: 6e61 6d65 7d20 746f 207b 7072 6f66 696c  name} to {profil
-0001bc40: 655b 276d 656d 6f72 7927 5d7d 2229 0a20  e['memory']}"). 
-0001bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc60: 2020 2020 2020 2020 2020 2020 2020 207a                 z
-0001bc70: 2e75 7064 6174 655f 6d65 6d6f 7279 286e  .update_memory(n
-0001bc80: 616d 652c 2070 726f 6669 6c65 5b27 6d65  ame, profile['me
-0001bc90: 6d6f 7279 275d 290a 2020 2020 2020 2020  mory']).        
-0001bca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bcb0: 2020 2020 6966 2027 6e75 6d63 7075 7327      if 'numcpus'
-0001bcc0: 2069 6e20 7072 6f66 696c 6520 616e 6420   in profile and 
-0001bcd0: 6375 7272 656e 7463 7075 7320 213d 2070  currentcpus != p
-0001bce0: 726f 6669 6c65 5b27 6e75 6d63 7075 7327  rofile['numcpus'
-0001bcf0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-0001bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd10: 2020 2075 7064 6174 6564 203d 2054 7275     updated = Tru
-0001bd20: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd40: 2020 7070 7269 6e74 2866 2255 7064 6174    pprint(f"Updat
-0001bd50: 696e 6720 6370 7573 206f 6620 7b6e 616d  ing cpus of {nam
-0001bd60: 657d 2074 6f20 7b70 726f 6669 6c65 5b27  e} to {profile['
-0001bd70: 6e75 6d63 7075 7327 5d7d 2229 0a20 2020  numcpus']}").   
+0001bc10: 2020 2069 6620 2761 7574 6f73 7461 7274     if 'autostart
+0001bc20: 2720 696e 2070 726f 6669 6c65 2061 6e64  ' in profile and
+0001bc30: 2063 7572 7265 6e74 7374 6172 7420 213d   currentstart !=
+0001bc40: 2070 726f 6669 6c65 5b27 6175 746f 7374   profile['autost
+0001bc50: 6172 7427 5d3a 0a20 2020 2020 2020 2020  art']:.         
+0001bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc70: 2020 2075 7064 6174 6564 203d 2054 7275     updated = Tru
+0001bc80: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0001bc90: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+0001bca0: 7269 6e74 2866 2255 7064 6174 696e 6720  rint(f"Updating 
+0001bcb0: 6175 746f 7374 6172 7420 6f66 207b 6e61  autostart of {na
+0001bcc0: 6d65 7d20 746f 207b 7072 6f66 696c 655b  me} to {profile[
+0001bcd0: 2761 7574 6f73 7461 7274 275d 7d22 290a  'autostart']}").
+0001bce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bcf0: 2020 2020 2020 2020 2020 2020 7a2e 7570              z.up
+0001bd00: 6461 7465 5f73 7461 7274 286e 616d 652c  date_start(name,
+0001bd10: 2070 726f 6669 6c65 5b27 6175 746f 7374   profile['autost
+0001bd20: 6172 7427 5d29 0a20 2020 2020 2020 2020  art']).         
+0001bd30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001bd40: 6620 2766 6c61 766f 7227 2069 6e20 7072  f 'flavor' in pr
+0001bd50: 6f66 696c 6520 616e 6420 6375 7272 656e  ofile and curren
+0001bd60: 7466 6c61 766f 7220 213d 2070 726f 6669  tflavor != profi
+0001bd70: 6c65 5b27 666c 6176 6f72 275d 3a0a 2020  le['flavor']:.  
 0001bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd90: 2020 2020 2020 2020 2020 2020 207a 2e75               z.u
-0001bda0: 7064 6174 655f 6370 7573 286e 616d 652c  pdate_cpus(name,
-0001bdb0: 2070 726f 6669 6c65 5b27 6e75 6d63 7075   profile['numcpu
-0001bdc0: 7327 5d29 0a20 2020 2020 2020 2020 2020  s']).           
-0001bdd0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001bde0: 2764 6973 6b73 2720 696e 2070 726f 6669  'disks' in profi
-0001bdf0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-0001be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be10: 6966 206c 656e 2863 7572 7265 6e74 6469  if len(currentdi
-0001be20: 736b 7329 203c 206c 656e 2870 726f 6669  sks) < len(profi
-0001be30: 6c65 5b27 6469 736b 7327 5d29 3a0a 2020  le['disks']):.  
-0001be40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be50: 2020 2020 2020 2020 2020 2020 2020 7570                up
-0001be60: 6461 7465 6420 3d20 5472 7565 0a20 2020  dated = True.   
+0001bd90: 2020 2020 2020 2020 2020 7570 6461 7465            update
+0001bda0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
+0001bdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bdc0: 2020 2020 2070 7072 696e 7428 6622 5570       pprint(f"Up
+0001bdd0: 6461 7469 6e67 2066 6c61 766f 7220 6f66  dating flavor of
+0001bde0: 207b 6e61 6d65 7d20 746f 207b 7072 6f66   {name} to {prof
+0001bdf0: 696c 655b 2766 6c61 766f 7227 5d7d 2229  ile['flavor']}")
+0001be00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001be10: 2020 2020 2020 2020 2020 2020 207a 2e75               z.u
+0001be20: 7064 6174 655f 666c 6176 6f72 286e 616d  pdate_flavor(nam
+0001be30: 652c 2070 726f 6669 6c65 5b27 666c 6176  e, profile['flav
+0001be40: 6f72 275d 290a 2020 2020 2020 2020 2020  or']).          
+0001be50: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0001be60: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
 0001be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be80: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-0001be90: 696e 7428 6622 4164 6469 6e67 2044 6973  int(f"Adding Dis
-0001bea0: 6b73 2074 6f20 7b6e 616d 657d 2229 0a20  ks to {name}"). 
-0001beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bec0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001bed0: 6f72 2064 6973 6b20 696e 2070 726f 6669  or disk in profi
-0001bee0: 6c65 5b27 6469 736b 7327 5d5b 6c65 6e28  le['disks'][len(
-0001bef0: 6375 7272 656e 7464 6973 6b73 293a 5d3a  currentdisks):]:
-0001bf00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf20: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0001bf30: 6365 2864 6973 6b2c 2069 6e74 293a 0a20  ce(disk, int):. 
-0001bf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be80: 6966 2027 6d65 6d6f 7279 2720 696e 2070  if 'memory' in p
+0001be90: 726f 6669 6c65 2061 6e64 2063 7572 7265  rofile and curre
+0001bea0: 6e74 6d65 6d6f 7279 2021 3d20 7072 6f66  ntmemory != prof
+0001beb0: 696c 655b 276d 656d 6f72 7927 5d3a 0a20  ile['memory']:. 
+0001bec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bed0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0001bee0: 7064 6174 6564 203d 2054 7275 650a 2020  pdated = True.  
+0001bef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf00: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+0001bf10: 7269 6e74 2866 2255 7064 6174 696e 6720  rint(f"Updating 
+0001bf20: 6d65 6d6f 7279 206f 6620 7b6e 616d 657d  memory of {name}
+0001bf30: 2074 6f20 7b70 726f 6669 6c65 5b27 6d65   to {profile['me
+0001bf40: 6d6f 7279 275d 7d22 290a 2020 2020 2020  mory']}").      
 0001bf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf60: 2020 2020 2020 2073 697a 6520 3d20 6469         size = di
-0001bf70: 736b 0a20 2020 2020 2020 2020 2020 2020  sk.             
-0001bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf90: 2020 2020 2020 2020 2020 2070 6f6f 6c20             pool 
-0001bfa0: 3d20 7365 6c66 2e70 6f6f 6c0a 2020 2020  = self.pool.    
-0001bfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bfd0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-0001bfe0: 6469 736b 2c20 7374 7229 2061 6e64 2064  disk, str) and d
-0001bff0: 6973 6b2e 6973 6469 6769 7428 293a 0a20  isk.isdigit():. 
-0001c000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c020: 2020 2020 2020 2073 697a 6520 3d20 696e         size = in
-0001c030: 7428 6469 736b 290a 2020 2020 2020 2020  t(disk).        
-0001c040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c060: 706f 6f6c 203d 2073 656c 662e 706f 6f6c  pool = self.pool
-0001c070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bf60: 2020 2020 2020 2020 2020 7a2e 7570 6461            z.upda
+0001bf70: 7465 5f6d 656d 6f72 7928 6e61 6d65 2c20  te_memory(name, 
+0001bf80: 7072 6f66 696c 655b 276d 656d 6f72 7927  profile['memory'
+0001bf90: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+0001bfa0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001bfb0: 6620 276e 756d 6370 7573 2720 696e 2070  f 'numcpus' in p
+0001bfc0: 726f 6669 6c65 2061 6e64 2063 7572 7265  rofile and curre
+0001bfd0: 6e74 6370 7573 2021 3d20 7072 6f66 696c  ntcpus != profil
+0001bfe0: 655b 276e 756d 6370 7573 275d 3a0a 2020  e['numcpus']:.  
+0001bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c000: 2020 2020 2020 2020 2020 2020 2020 7570                up
+0001c010: 6461 7465 6420 3d20 5472 7565 0a20 2020  dated = True.   
+0001c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c030: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+0001c040: 696e 7428 6622 5570 6461 7469 6e67 2063  int(f"Updating c
+0001c050: 7075 7320 6f66 207b 6e61 6d65 7d20 746f  pus of {name} to
+0001c060: 207b 7072 6f66 696c 655b 276e 756d 6370   {profile['numcp
+0001c070: 7573 275d 7d22 290a 2020 2020 2020 2020  us']}").        
 0001c080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c090: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-0001c0a0: 616e 6365 2864 6973 6b2c 2064 6963 7429  ance(disk, dict)
-0001c0b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001c090: 2020 2020 2020 2020 7a2e 7570 6461 7465          z.update
+0001c0a0: 5f63 7075 7328 6e61 6d65 2c20 7072 6f66  _cpus(name, prof
+0001c0b0: 696c 655b 276e 756d 6370 7573 275d 290a  ile['numcpus']).
 0001c0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0d0: 2020 2020 2020 2020 2020 7369 7a65 203d            size =
-0001c0e0: 2064 6973 6b2e 6765 7428 2773 697a 6527   disk.get('size'
-0001c0f0: 2c20 7365 6c66 2e64 6973 6b73 697a 6529  , self.disksize)
-0001c100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c120: 2020 2020 2020 2020 2070 6f6f 6c20 3d20           pool = 
-0001c130: 6469 736b 2e67 6574 2827 706f 6f6c 272c  disk.get('pool',
-0001c140: 2073 656c 662e 706f 6f6c 290a 2020 2020   self.pool).    
-0001c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c170: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c190: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0001c1a0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+0001c0d0: 2020 2020 2020 2020 6966 2027 6469 736b          if 'disk
+0001c0e0: 7327 2069 6e20 7072 6f66 696c 653a 0a20  s' in profile:. 
+0001c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c100: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+0001c110: 6e28 6375 7272 656e 7464 6973 6b73 2920  n(currentdisks) 
+0001c120: 3c20 6c65 6e28 7072 6f66 696c 655b 2764  < len(profile['d
+0001c130: 6973 6b73 275d 293a 0a20 2020 2020 2020  isks']):.       
+0001c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c150: 2020 2020 2020 2020 2075 7064 6174 6564           updated
+0001c160: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+0001c170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c180: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0001c190: 2241 6464 696e 6720 4469 736b 7320 746f  "Adding Disks to
+0001c1a0: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
 0001c1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1c0: 2020 2020 2020 2020 2020 207a 2e61 6464             z.add
-0001c1d0: 5f64 6973 6b28 6e61 6d65 3d6e 616d 652c  _disk(name=name,
-0001c1e0: 2073 697a 653d 7369 7a65 2c20 706f 6f6c   size=size, pool
-0001c1f0: 3d70 6f6f 6c29 0a20 2020 2020 2020 2020  =pool).         
+0001c1c0: 2020 2020 2020 2020 2020 666f 7220 6469            for di
+0001c1d0: 736b 2069 6e20 7072 6f66 696c 655b 2764  sk in profile['d
+0001c1e0: 6973 6b73 275d 5b6c 656e 2863 7572 7265  isks'][len(curre
+0001c1f0: 6e74 6469 736b 7329 3a5d 3a0a 2020 2020  ntdisks):]:.    
 0001c200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c210: 2020 2069 6620 6c65 6e28 6375 7272 656e     if len(curren
-0001c220: 7464 6973 6b73 2920 3e20 6c65 6e28 7072  tdisks) > len(pr
-0001c230: 6f66 696c 655b 2764 6973 6b73 275d 293a  ofile['disks']):
-0001c240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c220: 6966 2069 7369 6e73 7461 6e63 6528 6469  if isinstance(di
+0001c230: 736b 2c20 696e 7429 3a0a 2020 2020 2020  sk, int):.      
+0001c240: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c260: 2075 7064 6174 6564 203d 2054 7275 650a   updated = True.
+0001c260: 2020 7369 7a65 203d 2064 6973 6b0a 2020    size = disk.  
 0001c270: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001c280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c290: 7070 7269 6e74 2866 2252 656d 6f76 696e  pprint(f"Removin
-0001c2a0: 6720 4469 736b 7320 6f66 207b 6e61 6d65  g Disks of {name
-0001c2b0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0001c2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2d0: 2020 2020 666f 7220 6469 736b 2069 6e20      for disk in 
-0001c2e0: 6375 7272 656e 7464 6973 6b73 5b6c 656e  currentdisks[len
-0001c2f0: 2863 7572 7265 6e74 6469 736b 7329 202d  (currentdisks) -
-0001c300: 206c 656e 2870 726f 6669 6c65 5b27 6469   len(profile['di
-0001c310: 736b 7327 5d29 3a5d 3a0a 2020 2020 2020  sks']):]:.      
-0001c320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c330: 2020 2020 2020 2020 2020 2020 2020 6469                di
-0001c340: 736b 6e61 6d65 203d 206f 732e 7061 7468  skname = os.path
-0001c350: 2e62 6173 656e 616d 6528 6469 736b 5b27  .basename(disk['
-0001c360: 7061 7468 275d 290a 2020 2020 2020 2020  path']).        
+0001c290: 2020 2020 2020 706f 6f6c 203d 2073 656c        pool = sel
+0001c2a0: 662e 706f 6f6c 0a20 2020 2020 2020 2020  f.pool.         
+0001c2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c2c0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001c2d0: 6973 696e 7374 616e 6365 2864 6973 6b2c  isinstance(disk,
+0001c2e0: 2073 7472 2920 616e 6420 6469 736b 2e69   str) and disk.i
+0001c2f0: 7364 6967 6974 2829 3a0a 2020 2020 2020  sdigit():.      
+0001c300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c320: 2020 7369 7a65 203d 2069 6e74 2864 6973    size = int(dis
+0001c330: 6b29 0a20 2020 2020 2020 2020 2020 2020  k).             
+0001c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c350: 2020 2020 2020 2020 2020 2070 6f6f 6c20             pool 
+0001c360: 3d20 7365 6c66 2e70 6f6f 6c0a 2020 2020  = self.pool.    
 0001c370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c380: 2020 2020 2020 2020 2020 2020 6469 736b              disk
-0001c390: 706f 6f6c 203d 206f 732e 7061 7468 2e64  pool = os.path.d
-0001c3a0: 6972 6e61 6d65 2864 6973 6b5b 2770 6174  irname(disk['pat
-0001c3b0: 6827 5d29 0a20 2020 2020 2020 2020 2020  h']).           
+0001c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c390: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+0001c3a0: 6469 736b 2c20 6469 6374 293a 0a20 2020  disk, dict):.   
+0001c3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c3d0: 2020 2020 2020 2020 207a 2e64 656c 6574           z.delet
-0001c3e0: 655f 6469 736b 286e 616d 653d 6e61 6d65  e_disk(name=name
-0001c3f0: 2c20 6469 736b 6e61 6d65 3d64 6973 6b6e  , diskname=diskn
-0001c400: 616d 652c 2070 6f6f 6c3d 6469 736b 706f  ame, pool=diskpo
-0001c410: 6f6c 290a 2020 2020 2020 2020 2020 2020  ol).            
-0001c420: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-0001c430: 6e65 7473 2720 696e 2070 726f 6669 6c65  nets' in profile
-0001c440: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c450: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001c460: 206c 656e 2863 7572 7265 6e74 6e65 7473   len(currentnets
-0001c470: 2920 3c20 6c65 6e28 7072 6f66 696c 655b  ) < len(profile[
-0001c480: 276e 6574 7327 5d29 3a0a 2020 2020 2020  'nets']):.      
-0001c490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4a0: 2020 2020 2020 2020 2020 7570 6461 7465            update
-0001c4b0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
-0001c4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4d0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-0001c4e0: 6622 4164 6469 6e67 204e 6963 7320 746f  f"Adding Nics to
-0001c4f0: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
-0001c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c510: 2020 2020 2020 2020 2020 666f 7220 6e65            for ne
-0001c520: 7420 696e 2070 726f 6669 6c65 5b27 6e65  t in profile['ne
-0001c530: 7473 275d 5b6c 656e 2863 7572 7265 6e74  ts'][len(current
-0001c540: 6e65 7473 293a 5d3a 0a20 2020 2020 2020  nets):]:.       
-0001c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c560: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001c570: 6973 696e 7374 616e 6365 286e 6574 2c20  isinstance(net, 
-0001c580: 7374 7229 3a0a 2020 2020 2020 2020 2020  str):.          
-0001c590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5a0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0001c5b0: 7477 6f72 6b20 3d20 6e65 740a 2020 2020  twork = net.    
-0001c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5e0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-0001c5f0: 6e65 742c 2064 6963 7429 2061 6e64 2027  net, dict) and '
-0001c600: 6e61 6d65 2720 696e 206e 6574 3a0a 2020  name' in net:.  
-0001c610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3d0: 2020 2020 2073 697a 6520 3d20 6469 736b       size = disk
+0001c3e0: 2e67 6574 2827 7369 7a65 272c 2073 656c  .get('size', sel
+0001c3f0: 662e 6469 736b 7369 7a65 290a 2020 2020  f.disksize).    
+0001c400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c420: 2020 2020 706f 6f6c 203d 2064 6973 6b2e      pool = disk.
+0001c430: 6765 7428 2770 6f6f 6c27 2c20 7365 6c66  get('pool', self
+0001c440: 2e70 6f6f 6c29 0a20 2020 2020 2020 2020  .pool).         
+0001c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c460: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001c470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c490: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+0001c4a0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0001c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c4c0: 2020 2020 2020 7a2e 6164 645f 6469 736b        z.add_disk
+0001c4d0: 286e 616d 653d 6e61 6d65 2c20 7369 7a65  (name=name, size
+0001c4e0: 3d73 697a 652c 2070 6f6f 6c3d 706f 6f6c  =size, pool=pool
+0001c4f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001c500: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001c510: 206c 656e 2863 7572 7265 6e74 6469 736b   len(currentdisk
+0001c520: 7329 203e 206c 656e 2870 726f 6669 6c65  s) > len(profile
+0001c530: 5b27 6469 736b 7327 5d29 3a0a 2020 2020  ['disks']):.    
+0001c540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c550: 2020 2020 2020 2020 2020 2020 7570 6461              upda
+0001c560: 7465 6420 3d20 5472 7565 0a20 2020 2020  ted = True.     
+0001c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c580: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+0001c590: 7428 6622 5265 6d6f 7669 6e67 2044 6973  t(f"Removing Dis
+0001c5a0: 6b73 206f 6620 7b6e 616d 657d 2229 0a20  ks of {name}"). 
+0001c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c5c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001c5d0: 6f72 2064 6973 6b20 696e 2063 7572 7265  or disk in curre
+0001c5e0: 6e74 6469 736b 735b 6c65 6e28 6375 7272  ntdisks[len(curr
+0001c5f0: 656e 7464 6973 6b73 2920 2d20 6c65 6e28  entdisks) - len(
+0001c600: 7072 6f66 696c 655b 2764 6973 6b73 275d  profile['disks']
+0001c610: 293a 5d3a 0a20 2020 2020 2020 2020 2020  ):]:.           
 0001c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c630: 2020 2020 2020 6e65 7477 6f72 6b20 3d20        network = 
-0001c640: 6e65 745b 276e 616d 6527 5d0a 2020 2020  net['name'].    
-0001c650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c670: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c690: 2020 2020 2020 2020 2020 2020 2020 6572                er
-0001c6a0: 726f 7228 6622 536b 7070 696e 6720 7772  ror(f"Skpping wr
-0001c6b0: 6f6e 6720 6e69 6320 7370 6563 2066 6f72  ong nic spec for
-0001c6c0: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
-0001c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c6f0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-0001c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c710: 2020 2020 2020 2020 2020 2020 2020 207a                 z
-0001c720: 2e61 6464 5f6e 6963 286e 616d 652c 206e  .add_nic(name, n
-0001c730: 6574 776f 726b 290a 2020 2020 2020 2020  etwork).        
+0001c630: 2020 2020 2020 2020 2064 6973 6b6e 616d           disknam
+0001c640: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
+0001c650: 6e61 6d65 2864 6973 6b5b 2770 6174 6827  name(disk['path'
+0001c660: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+0001c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c680: 2020 2020 2020 2064 6973 6b70 6f6f 6c20         diskpool 
+0001c690: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
+0001c6a0: 6528 6469 736b 5b27 7061 7468 275d 290a  e(disk['path']).
+0001c6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6d0: 2020 2020 7a2e 6465 6c65 7465 5f64 6973      z.delete_dis
+0001c6e0: 6b28 6e61 6d65 3d6e 616d 652c 2064 6973  k(name=name, dis
+0001c6f0: 6b6e 616d 653d 6469 736b 6e61 6d65 2c20  kname=diskname, 
+0001c700: 706f 6f6c 3d64 6973 6b70 6f6f 6c29 0a20  pool=diskpool). 
+0001c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c720: 2020 2020 2020 2069 6620 276e 6574 7327         if 'nets'
+0001c730: 2069 6e20 7072 6f66 696c 653a 0a20 2020   in profile:.   
 0001c740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c750: 2020 2020 6966 206c 656e 2863 7572 7265      if len(curre
-0001c760: 6e74 6e65 7473 2920 3e20 6c65 6e28 7072  ntnets) > len(pr
-0001c770: 6f66 696c 655b 276e 6574 7327 5d29 3a0a  ofile['nets']):.
-0001c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c750: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0001c760: 6375 7272 656e 746e 6574 7329 203c 206c  currentnets) < l
+0001c770: 656e 2870 726f 6669 6c65 5b27 6e65 7473  en(profile['nets
+0001c780: 275d 293a 0a20 2020 2020 2020 2020 2020  ']):.           
 0001c790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7a0: 7570 6461 7465 6420 3d20 5472 7565 0a20  updated = True. 
-0001c7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001c7d0: 7072 696e 7428 6622 5265 6d6f 7669 6e67  print(f"Removing
-0001c7e0: 204e 6963 7320 6f66 207b 6e61 6d65 7d22   Nics of {name}"
-0001c7f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001c7a0: 2020 2020 2075 7064 6174 6564 203d 2054       updated = T
+0001c7b0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+0001c7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7d0: 2020 2020 7070 7269 6e74 2866 2241 6464      pprint(f"Add
+0001c7e0: 696e 6720 4e69 6373 2074 6f20 7b6e 616d  ing Nics to {nam
+0001c7f0: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
 0001c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c810: 2020 666f 7220 6e65 7420 696e 2072 616e    for net in ran
-0001c820: 6765 286c 656e 2863 7572 7265 6e74 6e65  ge(len(currentne
-0001c830: 7473 292c 206c 656e 2870 726f 6669 6c65  ts), len(profile
-0001c840: 5b27 6e65 7473 275d 292c 202d 3129 3a0a  ['nets']), -1):.
+0001c810: 2020 2020 2066 6f72 206e 6574 2069 6e20       for net in 
+0001c820: 7072 6f66 696c 655b 276e 6574 7327 5d5b  profile['nets'][
+0001c830: 6c65 6e28 6375 7272 656e 746e 6574 7329  len(currentnets)
+0001c840: 3a5d 3a0a 2020 2020 2020 2020 2020 2020  :]:.            
 0001c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c870: 2020 2020 696e 7465 7266 6163 6520 3d20      interface = 
-0001c880: 6622 6574 687b 6e65 7420 2d31 7d22 0a20  f"eth{net -1}". 
+0001c860: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0001c870: 7461 6e63 6528 6e65 742c 2073 7472 293a  tance(net, str):
+0001c880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0001c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c8b0: 2020 207a 2e64 656c 6574 655f 6e69 6328     z.delete_nic(
-0001c8c0: 6e61 6d65 2c20 696e 7465 7266 6163 6529  name, interface)
-0001c8d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c8e0: 2020 2020 2020 2020 2069 6620 6f76 6572           if over
-0001c8f0: 7269 6465 732e 6765 7428 2773 6b69 705f  rides.get('skip_
-0001c900: 6669 6c65 735f 7265 6d65 6469 6174 696f  files_remediatio
-0001c910: 6e27 2c20 4661 6c73 6529 3a0a 2020 2020  n', False):.    
+0001c8a0: 2020 2020 2020 2020 206e 6574 776f 726b           network
+0001c8b0: 203d 206e 6574 0a20 2020 2020 2020 2020   = net.         
+0001c8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8d0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001c8e0: 6973 696e 7374 616e 6365 286e 6574 2c20  isinstance(net, 
+0001c8f0: 6469 6374 2920 616e 6420 276e 616d 6527  dict) and 'name'
+0001c900: 2069 6e20 6e65 743a 0a20 2020 2020 2020   in net:.       
+0001c910: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c930: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-0001c940: 2253 6b69 7070 696e 6720 5265 6d65 6469  "Skipping Remedi
-0001c950: 6174 696f 6e20 6669 6c65 7320 6f66 207b  ation files of {
-0001c960: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
-0001c970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c980: 656c 6966 2073 656c 662e 7265 6d65 6469  elif self.remedi
-0001c990: 6174 655f 6669 6c65 7328 6e61 6d65 2c20  ate_files(name, 
-0001c9a0: 7072 6f66 696c 652e 6765 7428 2766 696c  profile.get('fil
-0001c9b0: 6573 272c 205b 5d29 2c20 6f76 6572 7269  es', []), overri
-0001c9c0: 6465 732c 2069 6e70 7574 6469 723d 696e  des, inputdir=in
-0001c9d0: 7075 7464 6972 293a 0a20 2020 2020 2020  putdir):.       
-0001c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c9f0: 2020 2020 2075 7064 6174 6564 203d 2054       updated = T
-0001ca00: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-0001ca10: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0001ca20: 6f74 2075 7064 6174 6564 3a0a 2020 2020  ot updated:.    
-0001ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca40: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-0001ca50: 227b 6e61 6d65 7d20 736b 6970 7065 6420  "{name} skipped 
-0001ca60: 6f6e 207b 766d 636c 6965 6e74 7d21 2229  on {vmclient}!")
-0001ca70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ca80: 2020 2020 2065 7869 7374 696e 6776 6d73       existingvms
-0001ca90: 2e61 7070 656e 6428 6e61 6d65 290a 2020  .append(name).  
-0001caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cab0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-0001cac0: 2020 2020 2020 2020 2020 2073 6861 7265             share
-0001cad0: 646b 6579 203d 2070 726f 6669 6c65 2e67  dkey = profile.g
-0001cae0: 6574 2827 7368 6172 6564 6b65 7927 2c20  et('sharedkey', 
-0001caf0: 7365 6c66 2e73 6861 7265 646b 6579 290a  self.sharedkey).
-0001cb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb10: 6966 2073 6861 7265 646b 6579 3a0a 2020  if sharedkey:.  
-0001cb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb30: 2020 766d 636f 756e 7465 7220 2b3d 2031    vmcounter += 1
-0001cb40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cb50: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
-0001cb60: 6174 682e 6578 6973 7473 2866 227b 706c  ath.exists(f"{pl
-0001cb70: 616e 7d2e 6b65 7922 2920 6f72 206e 6f74  an}.key") or not
-0001cb80: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-0001cb90: 6622 7b70 6c61 6e7d 2e6b 6579 2e70 7562  f"{plan}.key.pub
-0001cba0: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-0001cbb0: 2020 2020 2020 2020 2020 2020 6f73 2e73              os.s
-0001cbc0: 7973 7465 6d28 6622 7373 682d 6b65 7967  ystem(f"ssh-keyg
-0001cbd0: 656e 202d 7174 2072 7361 202d 4e20 2727  en -qt rsa -N ''
-0001cbe0: 202d 6620 7b70 6c61 6e7d 2e6b 6579 2229   -f {plan}.key")
-0001cbf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cc00: 2020 2020 2070 7562 6c69 636b 6579 203d       publickey =
-0001cc10: 206f 7065 6e28 6622 7b70 6c61 6e7d 2e6b   open(f"{plan}.k
-0001cc20: 6579 2e70 7562 2229 2e72 6561 6428 292e  ey.pub").read().
-0001cc30: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
-0001cc40: 2020 2020 2020 2020 2020 2020 7072 6976              priv
-0001cc50: 6174 656b 6579 203d 206f 7065 6e28 6622  atekey = open(f"
-0001cc60: 7b70 6c61 6e7d 2e6b 6579 2229 2e72 6561  {plan}.key").rea
-0001cc70: 6428 292e 7374 7269 7028 290a 2020 2020  d().strip().    
-0001cc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc90: 6966 2027 6b65 7973 2720 6e6f 7420 696e  if 'keys' not in
-0001cca0: 2070 726f 6669 6c65 3a0a 2020 2020 2020   profile:.      
-0001ccb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ccc0: 2020 7072 6f66 696c 655b 276b 6579 7327    profile['keys'
-0001ccd0: 5d20 3d20 5b70 7562 6c69 636b 6579 5d0a  ] = [publickey].
+0001c930: 206e 6574 776f 726b 203d 206e 6574 5b27   network = net['
+0001c940: 6e61 6d65 275d 0a20 2020 2020 2020 2020  name'].         
+0001c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c960: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001c970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c990: 2020 2020 2020 2020 2065 7272 6f72 2866           error(f
+0001c9a0: 2253 6b70 7069 6e67 2077 726f 6e67 206e  "Skpping wrong n
+0001c9b0: 6963 2073 7065 6320 666f 7220 7b6e 616d  ic spec for {nam
+0001c9c0: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+0001c9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9e0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001c9f0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+0001ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca10: 2020 2020 2020 2020 2020 7a2e 6164 645f            z.add_
+0001ca20: 6e69 6328 6e61 6d65 2c20 6e65 7477 6f72  nic(name, networ
+0001ca30: 6b29 0a20 2020 2020 2020 2020 2020 2020  k).             
+0001ca40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001ca50: 6620 6c65 6e28 6375 7272 656e 746e 6574  f len(currentnet
+0001ca60: 7329 203e 206c 656e 2870 726f 6669 6c65  s) > len(profile
+0001ca70: 5b27 6e65 7473 275d 293a 0a20 2020 2020  ['nets']):.     
+0001ca80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca90: 2020 2020 2020 2020 2020 2075 7064 6174             updat
+0001caa0: 6564 203d 2054 7275 650a 2020 2020 2020  ed = True.      
+0001cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cac0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+0001cad0: 2866 2252 656d 6f76 696e 6720 4e69 6373  (f"Removing Nics
+0001cae0: 206f 6620 7b6e 616d 657d 2229 0a20 2020   of {name}").   
+0001caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb00: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001cb10: 206e 6574 2069 6e20 7261 6e67 6528 6c65   net in range(le
+0001cb20: 6e28 6375 7272 656e 746e 6574 7329 2c20  n(currentnets), 
+0001cb30: 6c65 6e28 7072 6f66 696c 655b 276e 6574  len(profile['net
+0001cb40: 7327 5d29 2c20 2d31 293a 0a20 2020 2020  s']), -1):.     
+0001cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001cb70: 6e74 6572 6661 6365 203d 2066 2265 7468  nterface = f"eth
+0001cb80: 7b6e 6574 202d 317d 220a 2020 2020 2020  {net -1}".      
+0001cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cba0: 2020 2020 2020 2020 2020 2020 2020 7a2e                z.
+0001cbb0: 6465 6c65 7465 5f6e 6963 286e 616d 652c  delete_nic(name,
+0001cbc0: 2069 6e74 6572 6661 6365 290a 2020 2020   interface).    
+0001cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbe0: 2020 2020 6966 206f 7665 7272 6964 6573      if overrides
+0001cbf0: 2e67 6574 2827 736b 6970 5f66 696c 6573  .get('skip_files
+0001cc00: 5f72 656d 6564 6961 7469 6f6e 272c 2046  _remediation', F
+0001cc10: 616c 7365 293a 0a20 2020 2020 2020 2020  alse):.         
+0001cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc30: 2020 2070 7072 696e 7428 6622 536b 6970     pprint(f"Skip
+0001cc40: 7069 6e67 2052 656d 6564 6961 7469 6f6e  ping Remediation
+0001cc50: 2066 696c 6573 206f 6620 7b6e 616d 657d   files of {name}
+0001cc60: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001cc70: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001cc80: 7365 6c66 2e72 656d 6564 6961 7465 5f66  self.remediate_f
+0001cc90: 696c 6573 286e 616d 652c 2070 726f 6669  iles(name, profi
+0001cca0: 6c65 2e67 6574 2827 6669 6c65 7327 2c20  le.get('files', 
+0001ccb0: 5b5d 292c 206f 7665 7272 6964 6573 2c20  []), overrides, 
+0001ccc0: 696e 7075 7464 6972 3d69 6e70 7574 6469  inputdir=inputdi
+0001ccd0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
 0001cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ccf0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001ccf0: 7570 6461 7465 6420 3d20 5472 7565 0a20  updated = True. 
 0001cd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd10: 2020 7072 6f66 696c 655b 276b 6579 7327    profile['keys'
-0001cd20: 5d2e 6170 7065 6e64 2870 7562 6c69 636b  ].append(publick
-0001cd30: 6579 290a 2020 2020 2020 2020 2020 2020  ey).            
-0001cd40: 2020 2020 2020 2020 6966 2027 6669 6c65          if 'file
-0001cd50: 7327 2069 6e20 7072 6f66 696c 653a 0a20  s' in profile:. 
-0001cd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd70: 2020 2020 2020 2070 726f 6669 6c65 5b27         profile['
-0001cd80: 6669 6c65 7327 5d2e 6170 7065 6e64 287b  files'].append({
-0001cd90: 2770 6174 6827 3a20 272f 726f 6f74 2f2e  'path': '/root/.
-0001cda0: 7373 682f 6964 5f72 7361 272c 2027 636f  ssh/id_rsa', 'co
-0001cdb0: 6e74 656e 7427 3a20 7072 6976 6174 656b  ntent': privatek
-0001cdc0: 6579 7d29 0a20 2020 2020 2020 2020 2020  ey}).           
-0001cdd0: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-0001cde0: 6669 6c65 5b27 6669 6c65 7327 5d2e 6170  file['files'].ap
-0001cdf0: 7065 6e64 287b 2770 6174 6827 3a20 272f  pend({'path': '/
-0001ce00: 726f 6f74 2f2e 7373 682f 6964 5f72 7361  root/.ssh/id_rsa
-0001ce10: 2e70 7562 272c 2027 636f 6e74 656e 7427  .pub', 'content'
-0001ce20: 3a20 7075 626c 6963 6b65 797d 290a 2020  : publickey}).  
-0001ce30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce40: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce60: 7072 6f66 696c 655b 2766 696c 6573 275d  profile['files']
-0001ce70: 203d 205b 7b27 7061 7468 273a 2027 2f72   = [{'path': '/r
-0001ce80: 6f6f 742f 2e73 7368 2f69 645f 7273 6127  oot/.ssh/id_rsa'
-0001ce90: 2c20 2763 6f6e 7465 6e74 273a 2070 7269  , 'content': pri
-0001cea0: 7661 7465 6b65 797d 2c0a 2020 2020 2020  vatekey},.      
-0001ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ced0: 2020 2020 2020 7b27 7061 7468 273a 2027        {'path': '
-0001cee0: 2f72 6f6f 742f 2e73 7368 2f69 645f 7273  /root/.ssh/id_rs
-0001cef0: 612e 7075 6227 2c20 2763 6f6e 7465 6e74  a.pub', 'content
-0001cf00: 273a 2070 7562 6c69 636b 6579 7d5d 0a20  ': publickey}]. 
-0001cf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf20: 2020 2069 6620 766d 636f 756e 7465 7220     if vmcounter 
-0001cf30: 3e3d 206c 656e 2876 6d65 6e74 7269 6573  >= len(vmentries
-0001cf40: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001cf50: 2020 2020 2020 2020 2020 206f 732e 7265             os.re
-0001cf60: 6d6f 7665 2866 227b 706c 616e 7d2e 6b65  move(f"{plan}.ke
-0001cf70: 792e 7075 6222 290a 2020 2020 2020 2020  y.pub").        
-0001cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf90: 6f73 2e72 656d 6f76 6528 6622 7b70 6c61  os.remove(f"{pla
-0001cfa0: 6e7d 2e6b 6579 2229 0a20 2020 2020 2020  n}.key").       
-0001cfb0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-0001cfc0: 6f76 6572 7269 6465 7320 3d20 6f76 6572  overrides = over
-0001cfd0: 7269 6465 732e 636f 7079 2829 0a20 2020  rides.copy().   
-0001cfe0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001cff0: 2769 6d61 6765 2720 696e 2070 726f 6669  'image' in profi
-0001d000: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-0001d010: 2020 2020 2020 2020 666f 7220 656e 7472          for entr
-0001d020: 7920 696e 2073 656c 662e 6c69 7374 5f70  y in self.list_p
-0001d030: 726f 6669 6c65 7328 293a 0a20 2020 2020  rofiles():.     
-0001d040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d050: 2020 2063 7572 7265 6e74 696d 6167 6520     currentimage 
-0001d060: 3d20 7072 6f66 696c 655b 2769 6d61 6765  = profile['image
-0001d070: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-0001d080: 2020 2020 2020 2020 2020 2065 6e74 7279             entry
-0001d090: 7072 6f66 696c 6520 3d20 656e 7472 795b  profile = entry[
-0001d0a0: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
-0001d0b0: 2020 2020 2020 2020 2020 2069 6620 656e             if en
-0001d0c0: 7472 7970 726f 6669 6c65 203d 3d20 6375  tryprofile == cu
-0001d0d0: 7272 656e 7469 6d61 6765 3a0a 2020 2020  rrentimage:.    
-0001d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d0f0: 2020 2020 2020 2020 7072 6f66 696c 655b          profile[
-0001d100: 2769 6d61 6765 275d 203d 2065 6e74 7279  'image'] = entry
-0001d110: 5b34 5d0a 2020 2020 2020 2020 2020 2020  [4].            
-0001d120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d130: 6375 7272 656e 746f 7665 7272 6964 6573  currentoverrides
-0001d140: 5b27 696d 6167 6527 5d20 3d20 7072 6f66  ['image'] = prof
-0001d150: 696c 655b 2769 6d61 6765 275d 0a20 2020  ile['image'].   
-0001d160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d170: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-0001d180: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001d190: 6620 7468 7265 6164 6564 3a0a 2020 2020  f threaded:.    
-0001d1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d1b0: 6e65 775f 6172 6773 203d 2028 6e61 6d65  new_args = (name
-0001d1c0: 2c20 7072 6f66 696c 656e 616d 652c 2063  , profilename, c
-0001d1d0: 7572 7265 6e74 6f76 6572 7269 6465 732c  urrentoverrides,
-0001d1e0: 2070 726f 6669 6c65 2c20 7a2c 2070 6c61   profile, z, pla
-0001d1f0: 6e2c 2063 7572 7265 6e74 706c 616e 6469  n, currentplandi
-0001d200: 722c 2076 6d63 6c69 656e 742c 0a20 2020  r, vmclient,.   
-0001d210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d220: 2020 2020 2020 2020 2020 2020 206f 6e66               onf
-0001d230: 6c79 2c20 6f6e 6c79 6173 7365 7473 2c20  ly, onlyassets, 
-0001d240: 6e65 7776 6d73 2c20 6661 696c 6564 766d  newvms, failedvm
-0001d250: 732c 2061 7379 6e63 7761 6974 766d 732c  s, asyncwaitvms,
-0001d260: 206e 6577 6173 7365 7473 290a 2020 2020   newassets).    
-0001d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d280: 7420 3d20 7468 7265 6164 696e 672e 5468  t = threading.Th
-0001d290: 7265 6164 2874 6172 6765 743d 7365 6c66  read(target=self
-0001d2a0: 2e74 6872 6561 6465 645f 6372 6561 7465  .threaded_create
-0001d2b0: 5f76 6d2c 2061 7267 733d 6e65 775f 6172  _vm, args=new_ar
-0001d2c0: 6773 290a 2020 2020 2020 2020 2020 2020  gs).            
-0001d2d0: 2020 2020 2020 2020 7468 7265 6164 732e          threads.
-0001d2e0: 6170 7065 6e64 2874 290a 2020 2020 2020  append(t).      
-0001d2f0: 2020 2020 2020 2020 2020 2020 2020 742e                t.
-0001d300: 7374 6172 7428 290a 2020 2020 2020 2020  start().        
-0001d310: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0001d320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d330: 2020 7265 7375 6c74 203d 2073 656c 662e    result = self.
-0001d340: 6372 6561 7465 5f76 6d28 6e61 6d65 2c20  create_vm(name, 
-0001d350: 7072 6f66 696c 656e 616d 652c 206f 7665  profilename, ove
-0001d360: 7272 6964 6573 3d63 7572 7265 6e74 6f76  rrides=currentov
-0001d370: 6572 7269 6465 732c 2063 7573 746f 6d70  errides, customp
-0001d380: 726f 6669 6c65 3d70 726f 6669 6c65 2c20  rofile=profile, 
-0001d390: 6b3d 7a2c 0a20 2020 2020 2020 2020 2020  k=z,.           
+0001cd10: 2020 2020 2020 2069 6620 6e6f 7420 7570         if not up
+0001cd20: 6461 7465 643a 0a20 2020 2020 2020 2020  dated:.         
+0001cd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd40: 2020 2070 7072 696e 7428 6622 7b6e 616d     pprint(f"{nam
+0001cd50: 657d 2073 6b69 7070 6564 206f 6e20 7b76  e} skipped on {v
+0001cd60: 6d63 6c69 656e 747d 2122 290a 2020 2020  mclient}!").    
+0001cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd80: 6578 6973 7469 6e67 766d 732e 6170 7065  existingvms.appe
+0001cd90: 6e64 286e 616d 6529 0a20 2020 2020 2020  nd(name).       
+0001cda0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001cdb0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+0001cdc0: 2020 2020 2020 7368 6172 6564 6b65 7920        sharedkey 
+0001cdd0: 3d20 7072 6f66 696c 652e 6765 7428 2773  = profile.get('s
+0001cde0: 6861 7265 646b 6579 272c 2073 656c 662e  haredkey', self.
+0001cdf0: 7368 6172 6564 6b65 7929 0a20 2020 2020  sharedkey).     
+0001ce00: 2020 2020 2020 2020 2020 2069 6620 7368             if sh
+0001ce10: 6172 6564 6b65 793a 0a20 2020 2020 2020  aredkey:.       
+0001ce20: 2020 2020 2020 2020 2020 2020 2076 6d63               vmc
+0001ce30: 6f75 6e74 6572 202b 3d20 310a 2020 2020  ounter += 1.    
+0001ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce50: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
+0001ce60: 7869 7374 7328 6622 7b70 6c61 6e7d 2e6b  xists(f"{plan}.k
+0001ce70: 6579 2229 206f 7220 6e6f 7420 6f73 2e70  ey") or not os.p
+0001ce80: 6174 682e 6578 6973 7473 2866 227b 706c  ath.exists(f"{pl
+0001ce90: 616e 7d2e 6b65 792e 7075 6222 293a 0a20  an}.key.pub"):. 
+0001cea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ceb0: 2020 2020 2020 206f 732e 7379 7374 656d         os.system
+0001cec0: 2866 2273 7368 2d6b 6579 6765 6e20 2d71  (f"ssh-keygen -q
+0001ced0: 7420 7273 6120 2d4e 2027 2720 2d66 207b  t rsa -N '' -f {
+0001cee0: 706c 616e 7d2e 6b65 7922 290a 2020 2020  plan}.key").    
+0001cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf00: 7075 626c 6963 6b65 7920 3d20 6f70 656e  publickey = open
+0001cf10: 2866 227b 706c 616e 7d2e 6b65 792e 7075  (f"{plan}.key.pu
+0001cf20: 6222 292e 7265 6164 2829 2e73 7472 6970  b").read().strip
+0001cf30: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0001cf40: 2020 2020 2020 2070 7269 7661 7465 6b65         privateke
+0001cf50: 7920 3d20 6f70 656e 2866 227b 706c 616e  y = open(f"{plan
+0001cf60: 7d2e 6b65 7922 292e 7265 6164 2829 2e73  }.key").read().s
+0001cf70: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
+0001cf80: 2020 2020 2020 2020 2020 2069 6620 276b             if 'k
+0001cf90: 6579 7327 206e 6f74 2069 6e20 7072 6f66  eys' not in prof
+0001cfa0: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
+0001cfb0: 2020 2020 2020 2020 2020 2020 2070 726f               pro
+0001cfc0: 6669 6c65 5b27 6b65 7973 275d 203d 205b  file['keys'] = [
+0001cfd0: 7075 626c 6963 6b65 795d 0a20 2020 2020  publickey].     
+0001cfe0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001cff0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001d000: 2020 2020 2020 2020 2020 2020 2070 726f               pro
+0001d010: 6669 6c65 5b27 6b65 7973 275d 2e61 7070  file['keys'].app
+0001d020: 656e 6428 7075 626c 6963 6b65 7929 0a20  end(publickey). 
+0001d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d040: 2020 2069 6620 2766 696c 6573 2720 696e     if 'files' in
+0001d050: 2070 726f 6669 6c65 3a0a 2020 2020 2020   profile:.      
+0001d060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d070: 2020 7072 6f66 696c 655b 2766 696c 6573    profile['files
+0001d080: 275d 2e61 7070 656e 6428 7b27 7061 7468  '].append({'path
+0001d090: 273a 2027 2f72 6f6f 742f 2e73 7368 2f69  ': '/root/.ssh/i
+0001d0a0: 645f 7273 6127 2c20 2763 6f6e 7465 6e74  d_rsa', 'content
+0001d0b0: 273a 2070 7269 7661 7465 6b65 797d 290a  ': privatekey}).
+0001d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0d0: 2020 2020 2020 2020 7072 6f66 696c 655b          profile[
+0001d0e0: 2766 696c 6573 275d 2e61 7070 656e 6428  'files'].append(
+0001d0f0: 7b27 7061 7468 273a 2027 2f72 6f6f 742f  {'path': '/root/
+0001d100: 2e73 7368 2f69 645f 7273 612e 7075 6227  .ssh/id_rsa.pub'
+0001d110: 2c20 2763 6f6e 7465 6e74 273a 2070 7562  , 'content': pub
+0001d120: 6c69 636b 6579 7d29 0a20 2020 2020 2020  lickey}).       
+0001d130: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0001d140: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001d150: 2020 2020 2020 2020 2020 2070 726f 6669             profi
+0001d160: 6c65 5b27 6669 6c65 7327 5d20 3d20 5b7b  le['files'] = [{
+0001d170: 2770 6174 6827 3a20 272f 726f 6f74 2f2e  'path': '/root/.
+0001d180: 7373 682f 6964 5f72 7361 272c 2027 636f  ssh/id_rsa', 'co
+0001d190: 6e74 656e 7427 3a20 7072 6976 6174 656b  ntent': privatek
+0001d1a0: 6579 7d2c 0a20 2020 2020 2020 2020 2020  ey},.           
+0001d1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1d0: 207b 2770 6174 6827 3a20 272f 726f 6f74   {'path': '/root
+0001d1e0: 2f2e 7373 682f 6964 5f72 7361 2e70 7562  /.ssh/id_rsa.pub
+0001d1f0: 272c 2027 636f 6e74 656e 7427 3a20 7075  ', 'content': pu
+0001d200: 626c 6963 6b65 797d 5d0a 2020 2020 2020  blickey}].      
+0001d210: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001d220: 2076 6d63 6f75 6e74 6572 203e 3d20 6c65   vmcounter >= le
+0001d230: 6e28 766d 656e 7472 6965 7329 3a0a 2020  n(vmentries):.  
+0001d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d250: 2020 2020 2020 6f73 2e72 656d 6f76 6528        os.remove(
+0001d260: 6622 7b70 6c61 6e7d 2e6b 6579 2e70 7562  f"{plan}.key.pub
+0001d270: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001d280: 2020 2020 2020 2020 2020 206f 732e 7265             os.re
+0001d290: 6d6f 7665 2866 227b 706c 616e 7d2e 6b65  move(f"{plan}.ke
+0001d2a0: 7922 290a 2020 2020 2020 2020 2020 2020  y").            
+0001d2b0: 2020 2020 6375 7272 656e 746f 7665 7272      currentoverr
+0001d2c0: 6964 6573 203d 206f 7665 7272 6964 6573  ides = overrides
+0001d2d0: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+0001d2e0: 2020 2020 2020 2020 6966 2027 696d 6167          if 'imag
+0001d2f0: 6527 2069 6e20 7072 6f66 696c 653a 0a20  e' in profile:. 
+0001d300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d310: 2020 2066 6f72 2065 6e74 7279 2069 6e20     for entry in 
+0001d320: 7365 6c66 2e6c 6973 745f 7072 6f66 696c  self.list_profil
+0001d330: 6573 2829 3a0a 2020 2020 2020 2020 2020  es():.          
+0001d340: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0001d350: 7272 656e 7469 6d61 6765 203d 2070 726f  rrentimage = pro
+0001d360: 6669 6c65 5b27 696d 6167 6527 5d0a 2020  file['image'].  
+0001d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d380: 2020 2020 2020 656e 7472 7970 726f 6669        entryprofi
+0001d390: 6c65 203d 2065 6e74 7279 5b30 5d0a 2020  le = entry[0].  
 0001d3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d3c0: 2070 6c61 6e3d 706c 616e 2c20 6261 7365   plan=plan, base
-0001d3d0: 6469 723d 6375 7272 656e 7470 6c61 6e64  dir=currentpland
-0001d3e0: 6972 2c20 636c 6965 6e74 3d76 6d63 6c69  ir, client=vmcli
-0001d3f0: 656e 742c 206f 6e66 6c79 3d6f 6e66 6c79  ent, onfly=onfly
-0001d400: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001d3b0: 2020 2020 2020 6966 2065 6e74 7279 7072        if entrypr
+0001d3c0: 6f66 696c 6520 3d3d 2063 7572 7265 6e74  ofile == current
+0001d3d0: 696d 6167 653a 0a20 2020 2020 2020 2020  image:.         
+0001d3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d3f0: 2020 2070 726f 6669 6c65 5b27 696d 6167     profile['imag
+0001d400: 6527 5d20 3d20 656e 7472 795b 345d 0a20  e'] = entry[4]. 
 0001d410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d420: 2020 2020 2020 2020 2020 2020 2020 6f6e                on
-0001d430: 6c79 6173 7365 7473 3d6f 6e6c 7961 7373  lyassets=onlyass
-0001d440: 6574 7329 0a20 2020 2020 2020 2020 2020  ets).           
-0001d450: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0001d460: 6f6e 6c79 6173 7365 7473 3a0a 2020 2020  onlyassets:.    
-0001d470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d480: 2020 2020 636f 6d6d 6f6e 2e68 616e 646c      common.handl
-0001d490: 655f 7265 7370 6f6e 7365 2872 6573 756c  e_response(resul
-0001d4a0: 742c 206e 616d 652c 2063 6c69 656e 743d  t, name, client=
-0001d4b0: 766d 636c 6965 6e74 290a 2020 2020 2020  vmclient).      
-0001d4c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0001d4d0: 6c66 2e68 616e 646c 655f 766d 5f72 6573  lf.handle_vm_res
-0001d4e0: 756c 7428 6e61 6d65 2c20 7072 6f66 696c  ult(name, profil
-0001d4f0: 652c 2072 6573 756c 743d 7265 7375 6c74  e, result=result
-0001d500: 2c20 6e65 7776 6d73 3d6e 6577 766d 732c  , newvms=newvms,
-0001d510: 2066 6169 6c65 6476 6d73 3d66 6169 6c65   failedvms=faile
-0001d520: 6476 6d73 2c0a 2020 2020 2020 2020 2020  dvms,.          
-0001d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d550: 6173 796e 6377 6169 7476 6d73 3d61 7379  asyncwaitvms=asy
-0001d560: 6e63 7761 6974 766d 732c 206f 6e6c 7961  ncwaitvms, onlya
-0001d570: 7373 6574 733d 6f6e 6c79 6173 7365 7473  ssets=onlyassets
-0001d580: 2c20 6e65 7761 7373 6574 733d 6e65 7761  , newassets=newa
-0001d590: 7373 6574 732c 0a20 2020 2020 2020 2020  ssets,.         
-0001d5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5c0: 2076 6d63 6c69 656e 743d 766d 636c 6965   vmclient=vmclie
-0001d5d0: 6e74 290a 2020 2020 2020 2020 6966 2076  nt).        if v
-0001d5e0: 6d65 6e74 7269 6573 2061 6e64 2074 6872  mentries and thr
-0001d5f0: 6561 6465 643a 0a20 2020 2020 2020 2020  eaded:.         
-0001d600: 2020 2077 6869 6c65 2054 7275 653a 0a20     while True:. 
-0001d610: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001d620: 6f72 2069 6e64 6578 2c20 7420 696e 2065  or index, t in e
-0001d630: 6e75 6d65 7261 7465 2874 6872 6561 6473  numerate(threads
-0001d640: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001d650: 2020 2020 2020 2069 6620 6e6f 7420 742e         if not t.
-0001d660: 6973 5f61 6c69 7665 2829 3a0a 2020 2020  is_alive():.    
-0001d670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d680: 2020 2020 6465 6c20 7468 7265 6164 735b      del threads[
-0001d690: 696e 6465 785d 0a20 2020 2020 2020 2020  index].         
-0001d6a0: 2020 2020 2020 2069 6620 6e6f 7420 7468         if not th
-0001d6b0: 7265 6164 733a 0a20 2020 2020 2020 2020  reads:.         
-0001d6c0: 2020 2020 2020 2020 2020 2062 7265 616b             break
-0001d6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d6e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001d6f0: 2020 2020 2020 2020 2020 2073 6c65 6570             sleep
-0001d700: 2831 290a 2020 2020 2020 2020 6966 2076  (1).        if v
-0001d710: 6d63 6c69 656e 7473 3a0a 2020 2020 2020  mclients:.      
-0001d720: 2020 2020 2020 7961 6d6c 2e73 6166 655f        yaml.safe_
-0001d730: 6475 6d70 2876 6d63 6c69 656e 7473 2c20  dump(vmclients, 
-0001d740: 6f70 656e 286f 732e 7061 7468 2e65 7870  open(os.path.exp
-0001d750: 616e 6475 7365 7228 6627 7e2f 2e6b 636c  anduser(f'~/.kcl
-0001d760: 692f 766d 636c 6965 6e74 735f 7b70 6c61  i/vmclients_{pla
-0001d770: 6e7d 2729 2c20 2777 2729 290a 2020 2020  n}'), 'w')).    
-0001d780: 2020 2020 6966 2064 6973 6b65 6e74 7269      if diskentri
-0001d790: 6573 2061 6e64 206e 6f74 206f 6e6c 7961  es and not onlya
-0001d7a0: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
-0001d7b0: 2020 2070 7072 696e 7428 2244 6570 6c6f     pprint("Deplo
-0001d7c0: 7969 6e67 2044 6973 6b73 2e2e 2e22 290a  ying Disks...").
-0001d7d0: 2020 2020 2020 2020 666f 7220 6469 736b          for disk
-0001d7e0: 2069 6e20 6469 736b 656e 7472 6965 733a   in diskentries:
-0001d7f0: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
-0001d800: 6669 6c65 203d 2065 6e74 7269 6573 5b64  file = entries[d
-0001d810: 6973 6b5d 0a20 2020 2020 2020 2020 2020  isk].           
-0001d820: 2070 6f6f 6c20 3d20 7072 6f66 696c 652e   pool = profile.
-0001d830: 6765 7428 2770 6f6f 6c27 290a 2020 2020  get('pool').    
-0001d840: 2020 2020 2020 2020 766d 7320 3d20 7072          vms = pr
-0001d850: 6f66 696c 652e 6765 7428 2776 6d73 2729  ofile.get('vms')
-0001d860: 0a20 2020 2020 2020 2020 2020 2074 656d  .            tem
-0001d870: 706c 6174 6520 3d20 7072 6f66 696c 652e  plate = profile.
-0001d880: 6765 7428 2774 656d 706c 6174 6527 290a  get('template').
-0001d890: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-0001d8a0: 6520 3d20 7072 6f66 696c 652e 6765 7428  e = profile.get(
-0001d8b0: 2769 6d61 6765 272c 2074 656d 706c 6174  'image', templat
-0001d8c0: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
-0001d8d0: 697a 6520 3d20 696e 7428 7072 6f66 696c  ize = int(profil
-0001d8e0: 652e 6765 7428 2773 697a 6527 2c20 3130  e.get('size', 10
-0001d8f0: 2929 0a20 2020 2020 2020 2020 2020 2069  )).            i
-0001d900: 6620 706f 6f6c 2069 7320 4e6f 6e65 3a0a  f pool is None:.
-0001d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d920: 6572 726f 7228 6622 4d69 7373 696e 6720  error(f"Missing 
-0001d930: 4b65 7920 506f 6f6c 2066 6f72 2064 6973  Key Pool for dis
-0001d940: 6b20 7365 6374 696f 6e20 7b64 6973 6b7d  k section {disk}
-0001d950: 2e20 4e6f 7420 6372 6561 7469 6e67 2069  . Not creating i
-0001d960: 742e 2e2e 2229 0a20 2020 2020 2020 2020  t...").         
-0001d970: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-0001d980: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-0001d990: 6d73 2069 7320 4e6f 6e65 3a0a 2020 2020  ms is None:.    
-0001d9a0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-0001d9b0: 7228 6622 4d69 7373 696e 6720 6f72 2049  r(f"Missing or I
-0001d9c0: 6e63 6f72 7265 6374 204b 6579 2056 6d73  ncorrect Key Vms
-0001d9d0: 2066 6f72 2064 6973 6b20 7365 6374 696f   for disk sectio
-0001d9e0: 6e20 7b64 6973 6b7d 2e20 4e6f 7420 6372  n {disk}. Not cr
-0001d9f0: 6561 7469 6e67 2069 742e 2e2e 2229 0a20  eating it..."). 
-0001da00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001da10: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-0001da20: 2020 2020 7368 6172 6561 626c 6520 3d20      shareable = 
-0001da30: 5472 7565 2069 6620 6c65 6e28 766d 7329  True if len(vms)
-0001da40: 203e 2031 2065 6c73 6520 4661 6c73 650a   > 1 else False.
-0001da50: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-0001da60: 2e64 6973 6b5f 6578 6973 7473 2870 6f6f  .disk_exists(poo
-0001da70: 6c2c 2064 6973 6b29 3a0a 2020 2020 2020  l, disk):.      
-0001da80: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-0001da90: 2866 2243 7265 6174 696f 6e20 666f 7220  (f"Creation for 
-0001daa0: 4469 736b 207b 6469 736b 7d20 736b 6970  Disk {disk} skip
-0001dab0: 7065 6421 2229 0a20 2020 2020 2020 2020  ped!").         
-0001dac0: 2020 2020 2020 2070 6f6f 6c70 6174 6820         poolpath 
-0001dad0: 3d20 6b2e 6765 745f 706f 6f6c 5f70 6174  = k.get_pool_pat
-0001dae0: 6828 706f 6f6c 290a 2020 2020 2020 2020  h(pool).        
-0001daf0: 2020 2020 2020 2020 6e65 7764 6973 6b20          newdisk 
-0001db00: 3d20 6622 7b70 6f6f 6c70 6174 687d 2f7b  = f"{poolpath}/{
-0001db10: 6469 736b 7d22 0a20 2020 2020 2020 2020  disk}".         
-0001db20: 2020 2020 2020 2066 6f72 2076 6d20 696e         for vm in
-0001db30: 2076 6d73 3a0a 2020 2020 2020 2020 2020   vms:.          
-0001db40: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-0001db50: 2866 2241 6464 696e 6720 6469 736b 207b  (f"Adding disk {
-0001db60: 6469 736b 7d20 746f 207b 766d 7d22 290a  disk} to {vm}").
-0001db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db80: 2020 2020 6b2e 6164 645f 6469 736b 286e      k.add_disk(n
-0001db90: 616d 653d 766d 2c20 7369 7a65 3d73 697a  ame=vm, size=siz
-0001dba0: 652c 2070 6f6f 6c3d 706f 6f6c 2c20 696d  e, pool=pool, im
-0001dbb0: 6167 653d 696d 6167 652c 2073 6861 7265  age=image, share
-0001dbc0: 6162 6c65 3d73 6861 7265 6162 6c65 2c20  able=shareable, 
-0001dbd0: 6578 6973 7469 6e67 3d6e 6577 6469 736b  existing=newdisk
-0001dbe0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001dbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc00: 2074 6869 6e3d 4661 6c73 6529 0a20 2020   thin=False).   
-0001dc10: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0001dc20: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001dc30: 6577 6469 736b 203d 206b 2e63 7265 6174  ewdisk = k.creat
-0001dc40: 655f 6469 736b 2864 6973 6b2c 2073 697a  e_disk(disk, siz
-0001dc50: 653d 7369 7a65 2c20 706f 6f6c 3d70 6f6f  e=size, pool=poo
-0001dc60: 6c2c 2069 6d61 6765 3d69 6d61 6765 2c20  l, image=image, 
-0001dc70: 7468 696e 3d46 616c 7365 290a 2020 2020  thin=False).    
-0001dc80: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0001dc90: 6577 6469 736b 2069 7320 4e6f 6e65 3a0a  ewdisk is None:.
-0001dca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dcb0: 2020 2020 6572 726f 7228 6622 4469 736b      error(f"Disk
-0001dcc0: 207b 6469 736b 7d20 6e6f 7420 6465 706c   {disk} not depl
-0001dcd0: 6f79 6564 2e20 4974 2077 6f6e 2774 2062  oyed. It won't b
-0001dce0: 6520 6164 6465 6420 746f 2061 6e79 2076  e added to any v
-0001dcf0: 6d22 290a 2020 2020 2020 2020 2020 2020  m").            
-0001dd00: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001dd10: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0001dd20: 6d6d 6f6e 2e70 7072 696e 7428 6622 4469  mmon.pprint(f"Di
-0001dd30: 736b 207b 6469 736b 7d20 6465 706c 6f79  sk {disk} deploy
-0001dd40: 6564 2122 290a 2020 2020 2020 2020 2020  ed!").          
-0001dd50: 2020 2020 2020 2020 2020 666f 7220 766d            for vm
-0001dd60: 2069 6e20 766d 733a 0a20 2020 2020 2020   in vms:.       
-0001dd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd80: 2070 7072 696e 7428 6622 4164 6469 6e67   pprint(f"Adding
-0001dd90: 2064 6973 6b20 7b64 6973 6b7d 2074 6f20   disk {disk} to 
-0001dda0: 7b76 6d7d 2229 0a20 2020 2020 2020 2020  {vm}").         
-0001ddb0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-0001ddc0: 2e61 6464 5f64 6973 6b28 6e61 6d65 3d76  .add_disk(name=v
-0001ddd0: 6d2c 2073 697a 653d 7369 7a65 2c20 706f  m, size=size, po
-0001dde0: 6f6c 3d70 6f6f 6c2c 2069 6d61 6765 3d69  ol=pool, image=i
-0001ddf0: 6d61 6765 2c20 7368 6172 6561 626c 653d  mage, shareable=
-0001de00: 7368 6172 6561 626c 652c 0a20 2020 2020  shareable,.     
-0001de10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de20: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0001de30: 6973 7469 6e67 3d6e 6577 6469 736b 2c20  isting=newdisk, 
-0001de40: 7468 696e 3d46 616c 7365 290a 2020 2020  thin=False).    
-0001de50: 2020 2020 6966 2063 6f6e 7461 696e 6572      if container
-0001de60: 656e 7472 6965 7320 616e 6420 6e6f 7420  entries and not 
-0001de70: 6f6e 6c79 6173 7365 7473 3a0a 2020 2020  onlyassets:.    
-0001de80: 2020 2020 2020 2020 636f 6e74 203d 204b          cont = K
-0001de90: 636f 6e74 6169 6e65 7263 6f6e 6669 6728  containerconfig(
-0001dea0: 7365 6c66 2c20 636c 6965 6e74 3d73 656c  self, client=sel
-0001deb0: 662e 636f 6e74 6169 6e65 7263 6c69 656e  f.containerclien
-0001dec0: 7429 2e63 6f6e 740a 2020 2020 2020 2020  t).cont.        
-0001ded0: 2020 2020 7070 7269 6e74 2822 4465 706c      pprint("Depl
-0001dee0: 6f79 696e 6720 436f 6e74 6169 6e65 7273  oying Containers
-0001def0: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
-0001df00: 2020 6c61 6265 6c20 3d20 6622 706c 616e    label = f"plan
-0001df10: 3d7b 706c 616e 7d22 0a20 2020 2020 2020  ={plan}".       
-0001df20: 2020 2020 2066 6f72 2063 6f6e 7461 696e       for contain
-0001df30: 6572 2069 6e20 636f 6e74 6169 6e65 7265  er in containere
-0001df40: 6e74 7269 6573 3a0a 2020 2020 2020 2020  ntries:.        
-0001df50: 2020 2020 2020 2020 6966 2063 6f6e 742e          if cont.
-0001df60: 6578 6973 7473 5f63 6f6e 7461 696e 6572  exists_container
-0001df70: 2863 6f6e 7461 696e 6572 293a 0a20 2020  (container):.   
-0001df80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df90: 2070 7072 696e 7428 6622 436f 6e74 6169   pprint(f"Contai
-0001dfa0: 6e65 7220 7b63 6f6e 7461 696e 6572 7d20  ner {container} 
-0001dfb0: 736b 6970 7065 6421 2229 0a20 2020 2020  skipped!").     
-0001dfc0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001dfd0: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-0001dfe0: 2020 2020 2020 2020 7072 6f66 696c 6520          profile 
-0001dff0: 3d20 656e 7472 6965 735b 636f 6e74 6169  = entries[contai
-0001e000: 6e65 725d 0a20 2020 2020 2020 2020 2020  ner].           
-0001e010: 2020 2020 2069 6620 2770 726f 6669 6c65       if 'profile
-0001e020: 2720 696e 2070 726f 6669 6c65 2061 6e64  ' in profile and
-0001e030: 2070 726f 6669 6c65 5b27 7072 6f66 696c   profile['profil
-0001e040: 6527 5d20 696e 2063 6f6e 7461 696e 6572  e'] in container
-0001e050: 7072 6f66 696c 6573 3a0a 2020 2020 2020  profiles:.      
-0001e060: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0001e070: 7374 6f6d 7072 6f66 696c 6520 3d20 636f  stomprofile = co
-0001e080: 6e74 6169 6e65 7270 726f 6669 6c65 735b  ntainerprofiles[
-0001e090: 7072 6f66 696c 655b 2770 726f 6669 6c65  profile['profile
-0001e0a0: 275d 5d0a 2020 2020 2020 2020 2020 2020  ']].            
-0001e0b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001e0c0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0001e0d0: 7374 6f6d 7072 6f66 696c 6520 3d20 7b7d  stomprofile = {}
-0001e0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e0f0: 2063 6f6e 7461 696e 6572 696d 6167 6520   containerimage 
-0001e100: 3d20 6e65 7874 2828 6520 666f 7220 6520  = next((e for e 
-0001e110: 696e 205b 7072 6f66 696c 652e 6765 7428  in [profile.get(
-0001e120: 2769 6d61 6765 2729 2c20 7072 6f66 696c  'image'), profil
-0001e130: 652e 6765 7428 2769 6d61 6765 2729 2c0a  e.get('image'),.
-0001e140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e170: 2020 2063 7573 746f 6d70 726f 6669 6c65     customprofile
-0001e180: 2e67 6574 2827 696d 6167 6527 292c 0a20  .get('image'),. 
-0001e190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1c0: 2020 6375 7374 6f6d 7072 6f66 696c 652e    customprofile.
-0001e1d0: 6765 7428 2769 6d61 6765 2729 5d20 6966  get('image')] if
-0001e1e0: 2065 2069 7320 6e6f 7420 4e6f 6e65 292c   e is not None),
-0001e1f0: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
-0001e200: 2020 2020 2020 206e 6574 7320 3d20 6e65         nets = ne
-0001e210: 7874 2828 6520 666f 7220 6520 696e 205b  xt((e for e in [
-0001e220: 7072 6f66 696c 652e 6765 7428 276e 6574  profile.get('net
-0001e230: 7327 292c 2063 7573 746f 6d70 726f 6669  s'), customprofi
-0001e240: 6c65 2e67 6574 2827 6e65 7473 2729 5d20  le.get('nets')] 
-0001e250: 6966 2065 2069 7320 6e6f 7420 4e6f 6e65  if e is not None
-0001e260: 292c 204e 6f6e 6529 0a20 2020 2020 2020  ), None).       
-0001e270: 2020 2020 2020 2020 2070 6f72 7473 203d           ports =
-0001e280: 206e 6578 7428 2865 2066 6f72 2065 2069   next((e for e i
-0001e290: 6e20 5b70 726f 6669 6c65 2e67 6574 2827  n [profile.get('
-0001e2a0: 706f 7274 7327 292c 2063 7573 746f 6d70  ports'), customp
-0001e2b0: 726f 6669 6c65 2e67 6574 2827 706f 7274  rofile.get('port
-0001e2c0: 7327 295d 2069 6620 6520 6973 206e 6f74  s')] if e is not
-0001e2d0: 204e 6f6e 6529 2c20 4e6f 6e65 290a 2020   None), None).  
-0001e2e0: 2020 2020 2020 2020 2020 2020 2020 766f                vo
-0001e2f0: 6c75 6d65 7320 3d20 6e65 7874 2828 6520  lumes = next((e 
-0001e300: 666f 7220 6520 696e 205b 7072 6f66 696c  for e in [profil
-0001e310: 652e 6765 7428 2776 6f6c 756d 6573 2729  e.get('volumes')
-0001e320: 2c20 7072 6f66 696c 652e 6765 7428 2764  , profile.get('d
-0001e330: 6973 6b73 2729 2c0a 2020 2020 2020 2020  isks'),.        
-0001e340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e360: 2020 2020 6375 7374 6f6d 7072 6f66 696c      customprofil
-0001e370: 652e 6765 7428 2776 6f6c 756d 6573 2729  e.get('volumes')
-0001e380: 2c20 6375 7374 6f6d 7072 6f66 696c 652e  , customprofile.
-0001e390: 6765 7428 2764 6973 6b73 2729 5d0a 2020  get('disks')].  
-0001e3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e3b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001e3c0: 2065 2069 7320 6e6f 7420 4e6f 6e65 292c   e is not None),
-0001e3d0: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
-0001e3e0: 2020 2020 2020 2065 6e76 6972 6f6e 6d65         environme
-0001e3f0: 6e74 203d 206e 6578 7428 2865 2066 6f72  nt = next((e for
-0001e400: 2065 2069 6e20 5b70 726f 6669 6c65 2e67   e in [profile.g
-0001e410: 6574 2827 656e 7669 726f 6e6d 656e 7427  et('environment'
-0001e420: 292c 2063 7573 746f 6d70 726f 6669 6c65  ), customprofile
-0001e430: 2e67 6574 2827 656e 7669 726f 6e6d 656e  .get('environmen
-0001e440: 7427 295d 0a20 2020 2020 2020 2020 2020  t')].           
+0001d420: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+0001d430: 6e74 6f76 6572 7269 6465 735b 2769 6d61  ntoverrides['ima
+0001d440: 6765 275d 203d 2070 726f 6669 6c65 5b27  ge'] = profile['
+0001d450: 696d 6167 6527 5d0a 2020 2020 2020 2020  image'].        
+0001d460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d470: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
+0001d480: 2020 2020 2020 2020 2020 6966 2074 6872            if thr
+0001d490: 6561 6465 643a 0a20 2020 2020 2020 2020  eaded:.         
+0001d4a0: 2020 2020 2020 2020 2020 206e 6577 5f61             new_a
+0001d4b0: 7267 7320 3d20 286e 616d 652c 2070 726f  rgs = (name, pro
+0001d4c0: 6669 6c65 6e61 6d65 2c20 6375 7272 656e  filename, curren
+0001d4d0: 746f 7665 7272 6964 6573 2c20 7072 6f66  toverrides, prof
+0001d4e0: 696c 652c 207a 2c20 706c 616e 2c20 6375  ile, z, plan, cu
+0001d4f0: 7272 656e 7470 6c61 6e64 6972 2c20 766d  rrentplandir, vm
+0001d500: 636c 6965 6e74 2c0a 2020 2020 2020 2020  client,.        
+0001d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d520: 2020 2020 2020 2020 6f6e 666c 792c 206f          onfly, o
+0001d530: 6e6c 7961 7373 6574 732c 206e 6577 766d  nlyassets, newvm
+0001d540: 732c 2066 6169 6c65 6476 6d73 2c20 6173  s, failedvms, as
+0001d550: 796e 6377 6169 7476 6d73 2c20 6e65 7761  yncwaitvms, newa
+0001d560: 7373 6574 7329 0a20 2020 2020 2020 2020  ssets).         
+0001d570: 2020 2020 2020 2020 2020 2074 203d 2074             t = t
+0001d580: 6872 6561 6469 6e67 2e54 6872 6561 6428  hreading.Thread(
+0001d590: 7461 7267 6574 3d73 656c 662e 7468 7265  target=self.thre
+0001d5a0: 6164 6564 5f63 7265 6174 655f 766d 2c20  aded_create_vm, 
+0001d5b0: 6172 6773 3d6e 6577 5f61 7267 7329 0a20  args=new_args). 
+0001d5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d5d0: 2020 2074 6872 6561 6473 2e61 7070 656e     threads.appen
+0001d5e0: 6428 7429 0a20 2020 2020 2020 2020 2020  d(t).           
+0001d5f0: 2020 2020 2020 2020 2074 2e73 7461 7274           t.start
+0001d600: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0001d610: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001d620: 2020 2020 2020 2020 2020 2020 2072 6573               res
+0001d630: 756c 7420 3d20 7365 6c66 2e63 7265 6174  ult = self.creat
+0001d640: 655f 766d 286e 616d 652c 2070 726f 6669  e_vm(name, profi
+0001d650: 6c65 6e61 6d65 2c20 6f76 6572 7269 6465  lename, override
+0001d660: 733d 6375 7272 656e 746f 7665 7272 6964  s=currentoverrid
+0001d670: 6573 2c20 6375 7374 6f6d 7072 6f66 696c  es, customprofil
+0001d680: 653d 7072 6f66 696c 652c 206b 3d7a 2c0a  e=profile, k=z,.
+0001d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6b0: 2020 2020 2020 2020 2020 2020 706c 616e              plan
+0001d6c0: 3d70 6c61 6e2c 2062 6173 6564 6972 3d63  =plan, basedir=c
+0001d6d0: 7572 7265 6e74 706c 616e 6469 722c 2063  urrentplandir, c
+0001d6e0: 6c69 656e 743d 766d 636c 6965 6e74 2c20  lient=vmclient, 
+0001d6f0: 6f6e 666c 793d 6f6e 666c 792c 0a20 2020  onfly=onfly,.   
+0001d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d720: 2020 2020 2020 2020 206f 6e6c 7961 7373           onlyass
+0001d730: 6574 733d 6f6e 6c79 6173 7365 7473 290a  ets=onlyassets).
+0001d740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d750: 2020 2020 6966 206e 6f74 206f 6e6c 7961      if not onlya
+0001d760: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
+0001d770: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001d780: 6f6d 6d6f 6e2e 6861 6e64 6c65 5f72 6573  ommon.handle_res
+0001d790: 706f 6e73 6528 7265 7375 6c74 2c20 6e61  ponse(result, na
+0001d7a0: 6d65 2c20 636c 6965 6e74 3d76 6d63 6c69  me, client=vmcli
+0001d7b0: 656e 7429 0a20 2020 2020 2020 2020 2020  ent).           
+0001d7c0: 2020 2020 2020 2020 2073 656c 662e 6861           self.ha
+0001d7d0: 6e64 6c65 5f76 6d5f 7265 7375 6c74 286e  ndle_vm_result(n
+0001d7e0: 616d 652c 2070 726f 6669 6c65 2c20 7265  ame, profile, re
+0001d7f0: 7375 6c74 3d72 6573 756c 742c 206e 6577  sult=result, new
+0001d800: 766d 733d 6e65 7776 6d73 2c20 6661 696c  vms=newvms, fail
+0001d810: 6564 766d 733d 6661 696c 6564 766d 732c  edvms=failedvms,
+0001d820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d840: 2020 2020 2020 2020 2020 2061 7379 6e63             async
+0001d850: 7761 6974 766d 733d 6173 796e 6377 6169  waitvms=asyncwai
+0001d860: 7476 6d73 2c20 6f6e 6c79 6173 7365 7473  tvms, onlyassets
+0001d870: 3d6f 6e6c 7961 7373 6574 732c 206e 6577  =onlyassets, new
+0001d880: 6173 7365 7473 3d6e 6577 6173 7365 7473  assets=newassets
+0001d890: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001d8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d8b0: 2020 2020 2020 2020 2020 2020 766d 636c              vmcl
+0001d8c0: 6965 6e74 3d76 6d63 6c69 656e 7429 0a20  ient=vmclient). 
+0001d8d0: 2020 2020 2020 2069 6620 766d 656e 7472         if vmentr
+0001d8e0: 6965 7320 616e 6420 7468 7265 6164 6564  ies and threaded
+0001d8f0: 3a0a 2020 2020 2020 2020 2020 2020 7768  :.            wh
+0001d900: 696c 6520 5472 7565 3a0a 2020 2020 2020  ile True:.      
+0001d910: 2020 2020 2020 2020 2020 666f 7220 696e            for in
+0001d920: 6465 782c 2074 2069 6e20 656e 756d 6572  dex, t in enumer
+0001d930: 6174 6528 7468 7265 6164 7329 3a0a 2020  ate(threads):.  
+0001d940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d950: 2020 6966 206e 6f74 2074 2e69 735f 616c    if not t.is_al
+0001d960: 6976 6528 293a 0a20 2020 2020 2020 2020  ive():.         
+0001d970: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0001d980: 656c 2074 6872 6561 6473 5b69 6e64 6578  el threads[index
+0001d990: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001d9a0: 2020 6966 206e 6f74 2074 6872 6561 6473    if not threads
+0001d9b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001d9c0: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+0001d9d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001d9e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001d9f0: 2020 2020 2020 736c 6565 7028 3129 0a20        sleep(1). 
+0001da00: 2020 2020 2020 2069 6620 766d 636c 6965         if vmclie
+0001da10: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
+0001da20: 2079 616d 6c2e 7361 6665 5f64 756d 7028   yaml.safe_dump(
+0001da30: 766d 636c 6965 6e74 732c 206f 7065 6e28  vmclients, open(
+0001da40: 6f73 2e70 6174 682e 6578 7061 6e64 7573  os.path.expandus
+0001da50: 6572 2866 277e 2f2e 6b63 6c69 2f76 6d63  er(f'~/.kcli/vmc
+0001da60: 6c69 656e 7473 5f7b 706c 616e 7d27 292c  lients_{plan}'),
+0001da70: 2027 7727 2929 0a20 2020 2020 2020 2069   'w')).        i
+0001da80: 6620 6469 736b 656e 7472 6965 7320 616e  f diskentries an
+0001da90: 6420 6e6f 7420 6f6e 6c79 6173 7365 7473  d not onlyassets
+0001daa0: 3a0a 2020 2020 2020 2020 2020 2020 7070  :.            pp
+0001dab0: 7269 6e74 2822 4465 706c 6f79 696e 6720  rint("Deploying 
+0001dac0: 4469 736b 732e 2e2e 2229 0a20 2020 2020  Disks...").     
+0001dad0: 2020 2066 6f72 2064 6973 6b20 696e 2064     for disk in d
+0001dae0: 6973 6b65 6e74 7269 6573 3a0a 2020 2020  iskentries:.    
+0001daf0: 2020 2020 2020 2020 7072 6f66 696c 6520          profile 
+0001db00: 3d20 656e 7472 6965 735b 6469 736b 5d0a  = entries[disk].
+0001db10: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+0001db20: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+0001db30: 706f 6f6c 2729 0a20 2020 2020 2020 2020  pool').         
+0001db40: 2020 2076 6d73 203d 2070 726f 6669 6c65     vms = profile
+0001db50: 2e67 6574 2827 766d 7327 290a 2020 2020  .get('vms').    
+0001db60: 2020 2020 2020 2020 7465 6d70 6c61 7465          template
+0001db70: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+0001db80: 7465 6d70 6c61 7465 2729 0a20 2020 2020  template').     
+0001db90: 2020 2020 2020 2069 6d61 6765 203d 2070         image = p
+0001dba0: 726f 6669 6c65 2e67 6574 2827 696d 6167  rofile.get('imag
+0001dbb0: 6527 2c20 7465 6d70 6c61 7465 290a 2020  e', template).  
+0001dbc0: 2020 2020 2020 2020 2020 7369 7a65 203d            size =
+0001dbd0: 2069 6e74 2870 726f 6669 6c65 2e67 6574   int(profile.get
+0001dbe0: 2827 7369 7a65 272c 2031 3029 290a 2020  ('size', 10)).  
+0001dbf0: 2020 2020 2020 2020 2020 6966 2070 6f6f            if poo
+0001dc00: 6c20 6973 204e 6f6e 653a 0a20 2020 2020  l is None:.     
+0001dc10: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+0001dc20: 2866 224d 6973 7369 6e67 204b 6579 2050  (f"Missing Key P
+0001dc30: 6f6f 6c20 666f 7220 6469 736b 2073 6563  ool for disk sec
+0001dc40: 7469 6f6e 207b 6469 736b 7d2e 204e 6f74  tion {disk}. Not
+0001dc50: 2063 7265 6174 696e 6720 6974 2e2e 2e22   creating it..."
+0001dc60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001dc70: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+0001dc80: 2020 2020 2020 2069 6620 766d 7320 6973         if vms is
+0001dc90: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0001dca0: 2020 2020 2020 2065 7272 6f72 2866 224d         error(f"M
+0001dcb0: 6973 7369 6e67 206f 7220 496e 636f 7272  issing or Incorr
+0001dcc0: 6563 7420 4b65 7920 566d 7320 666f 7220  ect Key Vms for 
+0001dcd0: 6469 736b 2073 6563 7469 6f6e 207b 6469  disk section {di
+0001dce0: 736b 7d2e 204e 6f74 2063 7265 6174 696e  sk}. Not creatin
+0001dcf0: 6720 6974 2e2e 2e22 290a 2020 2020 2020  g it...").      
+0001dd00: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+0001dd10: 7565 0a20 2020 2020 2020 2020 2020 2073  ue.            s
+0001dd20: 6861 7265 6162 6c65 203d 2054 7275 6520  hareable = True 
+0001dd30: 6966 206c 656e 2876 6d73 2920 3e20 3120  if len(vms) > 1 
+0001dd40: 656c 7365 2046 616c 7365 0a20 2020 2020  else False.     
+0001dd50: 2020 2020 2020 2069 6620 6b2e 6469 736b         if k.disk
+0001dd60: 5f65 7869 7374 7328 706f 6f6c 2c20 6469  _exists(pool, di
+0001dd70: 736b 293a 0a20 2020 2020 2020 2020 2020  sk):.           
+0001dd80: 2020 2020 2070 7072 696e 7428 6622 4372       pprint(f"Cr
+0001dd90: 6561 7469 6f6e 2066 6f72 2044 6973 6b20  eation for Disk 
+0001dda0: 7b64 6973 6b7d 2073 6b69 7070 6564 2122  {disk} skipped!"
+0001ddb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001ddc0: 2020 706f 6f6c 7061 7468 203d 206b 2e67    poolpath = k.g
+0001ddd0: 6574 5f70 6f6f 6c5f 7061 7468 2870 6f6f  et_pool_path(poo
+0001dde0: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
+0001ddf0: 2020 206e 6577 6469 736b 203d 2066 227b     newdisk = f"{
+0001de00: 706f 6f6c 7061 7468 7d2f 7b64 6973 6b7d  poolpath}/{disk}
+0001de10: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0001de20: 2020 666f 7220 766d 2069 6e20 766d 733a    for vm in vms:
+0001de30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001de40: 2020 2020 2070 7072 696e 7428 6622 4164       pprint(f"Ad
+0001de50: 6469 6e67 2064 6973 6b20 7b64 6973 6b7d  ding disk {disk}
+0001de60: 2074 6f20 7b76 6d7d 2229 0a20 2020 2020   to {vm}").     
+0001de70: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0001de80: 2e61 6464 5f64 6973 6b28 6e61 6d65 3d76  .add_disk(name=v
+0001de90: 6d2c 2073 697a 653d 7369 7a65 2c20 706f  m, size=size, po
+0001dea0: 6f6c 3d70 6f6f 6c2c 2069 6d61 6765 3d69  ol=pool, image=i
+0001deb0: 6d61 6765 2c20 7368 6172 6561 626c 653d  mage, shareable=
+0001dec0: 7368 6172 6561 626c 652c 2065 7869 7374  shareable, exist
+0001ded0: 696e 673d 6e65 7764 6973 6b2c 0a20 2020  ing=newdisk,.   
+0001dee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001def0: 2020 2020 2020 2020 2020 2020 7468 696e              thin
+0001df00: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+0001df10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001df20: 2020 2020 2020 2020 2020 6e65 7764 6973            newdis
+0001df30: 6b20 3d20 6b2e 6372 6561 7465 5f64 6973  k = k.create_dis
+0001df40: 6b28 6469 736b 2c20 7369 7a65 3d73 697a  k(disk, size=siz
+0001df50: 652c 2070 6f6f 6c3d 706f 6f6c 2c20 696d  e, pool=pool, im
+0001df60: 6167 653d 696d 6167 652c 2074 6869 6e3d  age=image, thin=
+0001df70: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+0001df80: 2020 2020 2020 2069 6620 6e65 7764 6973         if newdis
+0001df90: 6b20 6973 204e 6f6e 653a 0a20 2020 2020  k is None:.     
+0001dfa0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001dfb0: 7272 6f72 2866 2244 6973 6b20 7b64 6973  rror(f"Disk {dis
+0001dfc0: 6b7d 206e 6f74 2064 6570 6c6f 7965 642e  k} not deployed.
+0001dfd0: 2049 7420 776f 6e27 7420 6265 2061 6464   It won't be add
+0001dfe0: 6564 2074 6f20 616e 7920 766d 2229 0a20  ed to any vm"). 
+0001dff0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001e000: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001e010: 2020 2020 2020 2020 2063 6f6d 6d6f 6e2e           common.
+0001e020: 7070 7269 6e74 2866 2244 6973 6b20 7b64  pprint(f"Disk {d
+0001e030: 6973 6b7d 2064 6570 6c6f 7965 6421 2229  isk} deployed!")
+0001e040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e050: 2020 2020 2066 6f72 2076 6d20 696e 2076       for vm in v
+0001e060: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+0001e070: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+0001e080: 6e74 2866 2241 6464 696e 6720 6469 736b  nt(f"Adding disk
+0001e090: 207b 6469 736b 7d20 746f 207b 766d 7d22   {disk} to {vm}"
+0001e0a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001e0b0: 2020 2020 2020 2020 2020 6b2e 6164 645f            k.add_
+0001e0c0: 6469 736b 286e 616d 653d 766d 2c20 7369  disk(name=vm, si
+0001e0d0: 7a65 3d73 697a 652c 2070 6f6f 6c3d 706f  ze=size, pool=po
+0001e0e0: 6f6c 2c20 696d 6167 653d 696d 6167 652c  ol, image=image,
+0001e0f0: 2073 6861 7265 6162 6c65 3d73 6861 7265   shareable=share
+0001e100: 6162 6c65 2c0a 2020 2020 2020 2020 2020  able,.          
+0001e110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e120: 2020 2020 2020 2020 2065 7869 7374 696e           existin
+0001e130: 673d 6e65 7764 6973 6b2c 2074 6869 6e3d  g=newdisk, thin=
+0001e140: 4661 6c73 6529 0a20 2020 2020 2020 2069  False).        i
+0001e150: 6620 636f 6e74 6169 6e65 7265 6e74 7269  f containerentri
+0001e160: 6573 2061 6e64 206e 6f74 206f 6e6c 7961  es and not onlya
+0001e170: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
+0001e180: 2020 2063 6f6e 7420 3d20 4b63 6f6e 7461     cont = Kconta
+0001e190: 696e 6572 636f 6e66 6967 2873 656c 662c  inerconfig(self,
+0001e1a0: 2063 6c69 656e 743d 7365 6c66 2e63 6f6e   client=self.con
+0001e1b0: 7461 696e 6572 636c 6965 6e74 292e 636f  tainerclient).co
+0001e1c0: 6e74 0a20 2020 2020 2020 2020 2020 2070  nt.            p
+0001e1d0: 7072 696e 7428 2244 6570 6c6f 7969 6e67  print("Deploying
+0001e1e0: 2043 6f6e 7461 696e 6572 732e 2e2e 2229   Containers...")
+0001e1f0: 0a20 2020 2020 2020 2020 2020 206c 6162  .            lab
+0001e200: 656c 203d 2066 2270 6c61 6e3d 7b70 6c61  el = f"plan={pla
+0001e210: 6e7d 220a 2020 2020 2020 2020 2020 2020  n}".            
+0001e220: 666f 7220 636f 6e74 6169 6e65 7220 696e  for container in
+0001e230: 2063 6f6e 7461 696e 6572 656e 7472 6965   containerentrie
+0001e240: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0001e250: 2020 2069 6620 636f 6e74 2e65 7869 7374     if cont.exist
+0001e260: 735f 636f 6e74 6169 6e65 7228 636f 6e74  s_container(cont
+0001e270: 6169 6e65 7229 3a0a 2020 2020 2020 2020  ainer):.        
+0001e280: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+0001e290: 6e74 2866 2243 6f6e 7461 696e 6572 207b  nt(f"Container {
+0001e2a0: 636f 6e74 6169 6e65 727d 2073 6b69 7070  container} skipp
+0001e2b0: 6564 2122 290a 2020 2020 2020 2020 2020  ed!").          
+0001e2c0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+0001e2d0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+0001e2e0: 2020 2070 726f 6669 6c65 203d 2065 6e74     profile = ent
+0001e2f0: 7269 6573 5b63 6f6e 7461 696e 6572 5d0a  ries[container].
+0001e300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e310: 6966 2027 7072 6f66 696c 6527 2069 6e20  if 'profile' in 
+0001e320: 7072 6f66 696c 6520 616e 6420 7072 6f66  profile and prof
+0001e330: 696c 655b 2770 726f 6669 6c65 275d 2069  ile['profile'] i
+0001e340: 6e20 636f 6e74 6169 6e65 7270 726f 6669  n containerprofi
+0001e350: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+0001e360: 2020 2020 2020 2020 2063 7573 746f 6d70           customp
+0001e370: 726f 6669 6c65 203d 2063 6f6e 7461 696e  rofile = contain
+0001e380: 6572 7072 6f66 696c 6573 5b70 726f 6669  erprofiles[profi
+0001e390: 6c65 5b27 7072 6f66 696c 6527 5d5d 0a20  le['profile']]. 
+0001e3a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001e3b0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001e3c0: 2020 2020 2020 2020 2063 7573 746f 6d70           customp
+0001e3d0: 726f 6669 6c65 203d 207b 7d0a 2020 2020  rofile = {}.    
+0001e3e0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0001e3f0: 6169 6e65 7269 6d61 6765 203d 206e 6578  ainerimage = nex
+0001e400: 7428 2865 2066 6f72 2065 2069 6e20 5b70  t((e for e in [p
+0001e410: 726f 6669 6c65 2e67 6574 2827 696d 6167  rofile.get('imag
+0001e420: 6527 292c 2070 726f 6669 6c65 2e67 6574  e'), profile.get
+0001e430: 2827 696d 6167 6527 292c 0a20 2020 2020  ('image'),.     
+0001e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001e450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e460: 2020 2020 2020 2020 2069 6620 6520 6973           if e is
-0001e470: 206e 6f74 204e 6f6e 6529 2c20 4e6f 6e65   not None), None
-0001e480: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001e490: 2020 636d 6473 203d 206e 6578 7428 2865    cmds = next((e
-0001e4a0: 2066 6f72 2065 2069 6e20 5b70 726f 6669   for e in [profi
-0001e4b0: 6c65 2e67 6574 2827 636d 6473 2729 2c20  le.get('cmds'), 
-0001e4c0: 6375 7374 6f6d 7072 6f66 696c 652e 6765  customprofile.ge
-0001e4d0: 7428 2763 6d64 7327 295d 2069 6620 6520  t('cmds')] if e 
-0001e4e0: 6973 206e 6f74 204e 6f6e 6529 2c20 5b5d  is not None), []
+0001e460: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0001e470: 7374 6f6d 7072 6f66 696c 652e 6765 7428  stomprofile.get(
+0001e480: 2769 6d61 6765 2729 2c0a 2020 2020 2020  'image'),.      
+0001e490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e4b0: 2020 2020 2020 2020 2020 2020 2063 7573               cus
+0001e4c0: 746f 6d70 726f 6669 6c65 2e67 6574 2827  tomprofile.get('
+0001e4d0: 696d 6167 6527 295d 2069 6620 6520 6973  image')] if e is
+0001e4e0: 206e 6f74 204e 6f6e 6529 2c20 4e6f 6e65   not None), None
 0001e4f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001e500: 2020 7375 6363 6573 7328 6622 436f 6e74    success(f"Cont
-0001e510: 6169 6e65 7220 7b63 6f6e 7461 696e 6572  ainer {container
-0001e520: 7dc2 a064 6570 6c6f 7965 6421 2229 0a20  }..deployed!"). 
-0001e530: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001e540: 6f6e 742e 6372 6561 7465 5f63 6f6e 7461  ont.create_conta
-0001e550: 696e 6572 286e 616d 653d 636f 6e74 6169  iner(name=contai
-0001e560: 6e65 722c 2069 6d61 6765 3d63 6f6e 7461  ner, image=conta
-0001e570: 696e 6572 696d 6167 652c 206e 6574 733d  inerimage, nets=
-0001e580: 6e65 7473 2c20 636d 6473 3d63 6d64 732c  nets, cmds=cmds,
-0001e590: 2070 6f72 7473 3d70 6f72 7473 2c0a 2020   ports=ports,.  
-0001e5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e5c0: 2020 2020 766f 6c75 6d65 733d 766f 6c75      volumes=volu
-0001e5d0: 6d65 732c 2065 6e76 6972 6f6e 6d65 6e74  mes, environment
-0001e5e0: 3d65 6e76 6972 6f6e 6d65 6e74 2c20 6c61  =environment, la
-0001e5f0: 6265 6c3d 6c61 6265 6c29 0a20 2020 2020  bel=label).     
-0001e600: 2020 2069 6620 646e 7365 6e74 7269 6573     if dnsentries
-0001e610: 2061 6e64 206e 6f74 206f 6e6c 7961 7373   and not onlyass
-0001e620: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
-0001e630: 2070 7072 696e 7428 2244 6570 6c6f 7969   pprint("Deployi
-0001e640: 6e67 2044 6e73 2045 6e74 7269 6573 2e2e  ng Dns Entries..
-0001e650: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-0001e660: 646e 7363 6c69 656e 7473 203d 207b 7d0a  dnsclients = {}.
-0001e670: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001e680: 646e 7365 6e74 7279 2069 6e20 646e 7365  dnsentry in dnse
-0001e690: 6e74 7269 6573 3a0a 2020 2020 2020 2020  ntries:.        
-0001e6a0: 2020 2020 2020 2020 646e 7370 726f 6669          dnsprofi
-0001e6b0: 6c65 203d 2065 6e74 7269 6573 5b64 6e73  le = entries[dns
-0001e6c0: 656e 7472 795d 0a20 2020 2020 2020 2020  entry].         
-0001e6d0: 2020 2020 2020 2064 6e73 646f 6d61 696e         dnsdomain
-0001e6e0: 203d 2064 6e73 7072 6f66 696c 652e 6765   = dnsprofile.ge
-0001e6f0: 7428 2764 6f6d 6169 6e27 290a 2020 2020  t('domain').    
-0001e700: 2020 2020 2020 2020 2020 2020 646e 736e              dnsn
-0001e710: 6574 203d 2064 6e73 7072 6f66 696c 652e  et = dnsprofile.
-0001e720: 6765 7428 276e 6574 272c 2027 6465 6661  get('net', 'defa
-0001e730: 756c 7427 290a 2020 2020 2020 2020 2020  ult').          
-0001e740: 2020 2020 2020 646e 7369 7020 3d20 646e        dnsip = dn
-0001e750: 7370 726f 6669 6c65 2e67 6574 2827 6970  sprofile.get('ip
-0001e760: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0001e770: 2020 2064 6e73 616c 6961 7320 3d20 646e     dnsalias = dn
-0001e780: 7370 726f 6669 6c65 2e67 6574 2827 616c  sprofile.get('al
-0001e790: 6961 7327 2c20 5b5d 290a 2020 2020 2020  ias', []).      
-0001e7a0: 2020 2020 2020 2020 2020 646e 7363 6c69            dnscli
-0001e7b0: 656e 7420 3d20 646e 7370 726f 6669 6c65  ent = dnsprofile
-0001e7c0: 2e67 6574 2827 636c 6965 6e74 2729 0a20  .get('client'). 
-0001e7d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001e7e0: 6620 646e 7363 6c69 656e 7420 6973 204e  f dnsclient is N
-0001e7f0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0001e800: 2020 2020 2020 2020 207a 203d 206b 0a20           z = k. 
-0001e810: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001e820: 6c69 6620 646e 7363 6c69 656e 7420 696e  lif dnsclient in
-0001e830: 2064 6e73 636c 6965 6e74 733a 0a20 2020   dnsclients:.   
-0001e840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e850: 207a 203d 2064 6e73 636c 6965 6e74 735b   z = dnsclients[
-0001e860: 646e 7363 6c69 656e 745d 0a20 2020 2020  dnsclient].     
-0001e870: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0001e880: 646e 7363 6c69 656e 7420 696e 2073 656c  dnsclient in sel
-0001e890: 662e 636c 6965 6e74 733a 0a20 2020 2020  f.clients:.     
-0001e8a0: 2020 2020 2020 2020 2020 2020 2020 207a                 z
-0001e8b0: 203d 204b 636f 6e66 6967 2863 6c69 656e   = Kconfig(clien
-0001e8c0: 743d 646e 7363 6c69 656e 7429 2e6b 0a20  t=dnsclient).k. 
-0001e8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e8e0: 2020 2064 6e73 636c 6965 6e74 735b 646e     dnsclients[dn
-0001e8f0: 7363 6c69 656e 745d 203d 207a 0a20 2020  sclient] = z.   
-0001e900: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0001e910: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001e920: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
-0001e930: 2243 6c69 656e 7420 7b64 6e73 636c 6965  "Client {dnsclie
-0001e940: 6e74 7d20 6e6f 7420 666f 756e 642e 2053  nt} not found. S
-0001e950: 6b69 7070 696e 6722 290a 2020 2020 2020  kipping").      
-0001e960: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001e970: 7475 726e 0a20 2020 2020 2020 2020 2020  turn.           
-0001e980: 2020 2020 2069 6620 646e 7369 7020 6973       if dnsip is
-0001e990: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0001e9a0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-0001e9b0: 6e67 2822 4d69 7373 696e 6720 6970 2e20  ng("Missing ip. 
-0001e9c0: 536b 6970 7069 6e67 2122 290a 2020 2020  Skipping!").    
-0001e9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e9e0: 7265 7475 726e 0a20 2020 2020 2020 2020  return.         
-0001e9f0: 2020 2020 2020 2069 6620 646e 736e 6574         if dnsnet
-0001ea00: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0001ea10: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-0001ea20: 726e 696e 6728 224d 6973 7369 6e67 206e  rning("Missing n
-0001ea30: 6574 2e20 536b 6970 7069 6e67 2122 290a  et. Skipping!").
-0001ea40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea50: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-0001ea60: 2020 2020 2020 2020 2020 207a 2e72 6573             z.res
-0001ea70: 6572 7665 5f64 6e73 286e 616d 653d 646e  erve_dns(name=dn
-0001ea80: 7365 6e74 7279 2c20 6e65 7473 3d5b 646e  sentry, nets=[dn
-0001ea90: 736e 6574 5d2c 2064 6f6d 6169 6e3d 646e  snet], domain=dn
-0001eaa0: 7364 6f6d 6169 6e2c 2069 703d 646e 7369  sdomain, ip=dnsi
-0001eab0: 702c 2061 6c69 6173 3d64 6e73 616c 6961  p, alias=dnsalia
-0001eac0: 732c 2066 6f72 6365 3d54 7275 652c 0a20  s, force=True,. 
-0001ead0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eae0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0001eaf0: 6d61 7279 3d54 7275 6529 0a20 2020 2020  mary=True).     
-0001eb00: 2020 2069 6620 616e 7369 626c 6565 6e74     if ansibleent
-0001eb10: 7269 6573 2061 6e64 206e 6f74 206f 6e6c  ries and not onl
-0001eb20: 7961 7373 6574 733a 0a20 2020 2020 2020  yassets:.       
-0001eb30: 2020 2020 2069 6620 6e6f 7420 6e65 7776       if not newv
-0001eb40: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-0001eb50: 2020 2020 7761 726e 696e 6728 2241 6e73      warning("Ans
-0001eb60: 6962 6c65 2073 6b69 7070 6564 2061 7320  ible skipped as 
-0001eb70: 6e6f 206e 6577 2076 6d20 7769 7468 696e  no new vm within
-0001eb80: 2070 6c61 7962 6f6f 6b20 7072 6f76 6973   playbook provis
-0001eb90: 696f 6e65 6422 290a 2020 2020 2020 2020  ioned").        
-0001eba0: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-0001ebb0: 2020 2020 2020 2020 2020 2066 6f72 2065             for e
-0001ebc0: 6e74 7279 2069 6e20 736f 7274 6564 2861  ntry in sorted(a
-0001ebd0: 6e73 6962 6c65 656e 7472 6965 7329 3a0a  nsibleentries):.
-0001ebe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ebf0: 5f61 6e73 6962 6c65 203d 2065 6e74 7269  _ansible = entri
-0001ec00: 6573 5b65 6e74 7279 5d0a 2020 2020 2020  es[entry].      
-0001ec10: 2020 2020 2020 2020 2020 6966 2027 706c            if 'pl
-0001ec20: 6179 626f 6f6b 2720 6e6f 7420 696e 205f  aybook' not in _
-0001ec30: 616e 7369 626c 653a 0a20 2020 2020 2020  ansible:.       
-0001ec40: 2020 2020 2020 2020 2020 2020 2065 7272               err
-0001ec50: 6f72 2822 4d69 7373 696e 6720 506c 6179  or("Missing Play
-0001ec60: 626f 6f6b 2066 6f72 2061 6e73 6962 6c65  book for ansible
-0001ec70: 2e49 676e 6f72 696e 672e 2e2e 2229 0a20  .Ignoring..."). 
-0001ec80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ec90: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-0001eca0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001ecb0: 6c61 7962 6f6f 6b20 3d20 5f61 6e73 6962  laybook = _ansib
-0001ecc0: 6c65 5b27 706c 6179 626f 6f6b 275d 0a20  le['playbook']. 
-0001ecd0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0001ece0: 6572 626f 7365 203d 205f 616e 7369 626c  erbose = _ansibl
-0001ecf0: 655b 2776 6572 626f 7365 275d 2069 6620  e['verbose'] if 
-0001ed00: 2776 6572 626f 7365 2720 696e 205f 616e  'verbose' in _an
-0001ed10: 7369 626c 6520 656c 7365 2046 616c 7365  sible else False
-0001ed20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ed30: 2067 726f 7570 7320 3d20 5f61 6e73 6962   groups = _ansib
-0001ed40: 6c65 2e67 6574 2827 6772 6f75 7073 272c  le.get('groups',
-0001ed50: 207b 7d29 0a20 2020 2020 2020 2020 2020   {}).           
-0001ed60: 2020 2020 2075 7365 7220 3d20 5f61 6e73       user = _ans
-0001ed70: 6962 6c65 2e67 6574 2827 7573 6572 2729  ible.get('user')
-0001ed80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ed90: 2076 6172 6961 626c 6573 203d 205f 616e   variables = _an
-0001eda0: 7369 626c 652e 6765 7428 2776 6172 6961  sible.get('varia
-0001edb0: 626c 6573 272c 207b 7d29 0a20 2020 2020  bles', {}).     
-0001edc0: 2020 2020 2020 2020 2020 2074 6172 6765             targe
-0001edd0: 7476 6d73 203d 205b 766d 2066 6f72 2076  tvms = [vm for v
-0001ede0: 6d20 696e 205f 616e 7369 626c 655b 2776  m in _ansible['v
-0001edf0: 6d73 275d 2069 6620 766d 2069 6e20 6e65  ms'] if vm in ne
-0001ee00: 7776 6d73 5d20 6966 2027 766d 7327 2069  wvms] if 'vms' i
-0001ee10: 6e20 5f61 6e73 6962 6c65 2065 6c73 6520  n _ansible else 
-0001ee20: 6e65 7776 6d73 0a20 2020 2020 2020 2020  newvms.         
-0001ee30: 2020 2020 2020 2069 6620 6e6f 7420 7461         if not ta
-0001ee40: 7267 6574 766d 733a 0a20 2020 2020 2020  rgetvms:.       
-0001ee50: 2020 2020 2020 2020 2020 2020 2077 6172               war
-0001ee60: 6e69 6e67 2822 416e 7369 626c 6520 736b  ning("Ansible sk
-0001ee70: 6970 7065 6420 6173 206e 6f20 6e65 7720  ipped as no new 
-0001ee80: 766d 2077 6974 6869 6e20 706c 6179 626f  vm within playbo
-0001ee90: 6f6b 2070 726f 7669 7369 6f6e 6564 2229  ok provisioned")
-0001eea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001eeb0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-0001eec0: 2020 2020 2020 2020 2020 2020 616e 7369              ansi
-0001eed0: 626c 6563 6f6d 6d61 6e64 203d 2022 616e  blecommand = "an
-0001eee0: 7369 626c 652d 706c 6179 626f 6f6b 220a  sible-playbook".
-0001eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef00: 6966 2076 6572 626f 7365 3a0a 2020 2020  if verbose:.    
-0001ef10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef20: 616e 7369 626c 6563 6f6d 6d61 6e64 202b  ansiblecommand +
-0001ef30: 3d20 2220 2d76 7676 220a 2020 2020 2020  = " -vvv".      
-0001ef40: 2020 2020 2020 2020 2020 696e 7665 6e74            invent
-0001ef50: 6f72 7966 696c 6520 3d20 6622 2f74 6d70  oryfile = f"/tmp
-0001ef60: 2f7b 706c 616e 7d2e 696e 762e 7961 6d6c  /{plan}.inv.yaml
-0001ef70: 2220 6966 2073 656c 662e 7961 6d6c 696e  " if self.yamlin
-0001ef80: 7665 6e74 6f72 7920 656c 7365 2066 222f  ventory else f"/
-0001ef90: 746d 702f 7b70 6c61 6e7d 2e69 6e76 220a  tmp/{plan}.inv".
-0001efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001efb0: 616e 7369 626c 6575 7469 6c73 2e6d 616b  ansibleutils.mak
-0001efc0: 655f 706c 616e 5f69 6e76 656e 746f 7279  e_plan_inventory
-0001efd0: 2876 6d73 5f74 6f5f 686f 7374 2c20 706c  (vms_to_host, pl
-0001efe0: 616e 2c20 7461 7267 6574 766d 732c 2067  an, targetvms, g
-0001eff0: 726f 7570 733d 6772 6f75 7073 2c20 7573  roups=groups, us
-0001f000: 6572 3d75 7365 722c 0a20 2020 2020 2020  er=user,.       
-0001f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f030: 2020 2020 2020 2020 2020 7961 6d6c 696e            yamlin
-0001f040: 7665 6e74 6f72 793d 7365 6c66 2e79 616d  ventory=self.yam
-0001f050: 6c69 6e76 656e 746f 7279 2c20 7475 6e6e  linventory, tunn
-0001f060: 656c 3d73 656c 662e 7475 6e6e 656c 2c0a  el=self.tunnel,.
-0001f070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f0a0: 2074 756e 6e65 6c68 6f73 743d 7365 6c66   tunnelhost=self
-0001f0b0: 2e74 756e 6e65 6c68 6f73 742c 2074 756e  .tunnelhost, tun
-0001f0c0: 6e65 6c75 7365 723d 7365 6c66 2e74 756e  neluser=self.tun
-0001f0d0: 6e65 6c75 7365 722c 0a20 2020 2020 2020  neluser,.       
-0001f0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f100: 2020 2020 2020 2020 2020 7475 6e6e 656c            tunnel
-0001f110: 706f 7274 3d73 656c 662e 7475 6e6e 656c  port=self.tunnel
-0001f120: 706f 7274 2c20 696e 7365 6375 7265 3d73  port, insecure=s
-0001f130: 656c 662e 696e 7365 6375 7265 290a 2020  elf.insecure).  
-0001f140: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001f150: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
-0001f160: 7374 7328 277e 2f2e 616e 7369 626c 652e  sts('~/.ansible.
-0001f170: 6366 6727 293a 0a20 2020 2020 2020 2020  cfg'):.         
-0001f180: 2020 2020 2020 2020 2020 2061 6e73 6962             ansib
-0001f190: 6c65 636f 6e66 6967 203d 206f 732e 7061  leconfig = os.pa
-0001f1a0: 7468 2e65 7870 616e 6475 7365 7228 277e  th.expanduser('~
-0001f1b0: 2f2e 616e 7369 626c 652e 6366 6727 290a  /.ansible.cfg').
-0001f1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f1d0: 2020 2020 7769 7468 206f 7065 6e28 616e      with open(an
-0001f1e0: 7369 626c 6563 6f6e 6669 672c 2022 7722  sibleconfig, "w"
-0001f1f0: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
-0001f200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f210: 662e 7772 6974 6528 225b 7373 685f 636f  f.write("[ssh_co
-0001f220: 6e6e 6563 7469 6f6e 5d5c 6e72 6574 7269  nnection]\nretri
-0001f230: 6573 3d31 305c 6e22 290a 2020 2020 2020  es=10\n").      
-0001f240: 2020 2020 2020 2020 2020 6966 2076 6172            if var
-0001f250: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
-0001f260: 2020 2020 2020 2020 2020 2020 7661 7273              vars
-0001f270: 6669 6c65 203d 2066 222f 746d 702f 7b70  file = f"/tmp/{p
-0001f280: 6c61 6e7d 2e76 6172 732e 796d 6c22 0a20  lan}.vars.yml". 
-0001f290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f2a0: 2020 2077 6974 6820 6f70 656e 2876 6172     with open(var
-0001f2b0: 7366 696c 652c 2027 7727 2920 6173 2066  sfile, 'w') as f
-0001f2c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001f2d0: 2020 2020 2020 2020 2020 7961 6d6c 2e64            yaml.d
-0001f2e0: 756d 7028 7661 7269 6162 6c65 732c 2066  ump(variables, f
-0001f2f0: 2c20 6465 6661 756c 745f 666c 6f77 5f73  , default_flow_s
-0001f300: 7479 6c65 3d46 616c 7365 290a 2020 2020  tyle=False).    
+0001e500: 2020 6e65 7473 203d 206e 6578 7428 2865    nets = next((e
+0001e510: 2066 6f72 2065 2069 6e20 5b70 726f 6669   for e in [profi
+0001e520: 6c65 2e67 6574 2827 6e65 7473 2729 2c20  le.get('nets'), 
+0001e530: 6375 7374 6f6d 7072 6f66 696c 652e 6765  customprofile.ge
+0001e540: 7428 276e 6574 7327 295d 2069 6620 6520  t('nets')] if e 
+0001e550: 6973 206e 6f74 204e 6f6e 6529 2c20 4e6f  is not None), No
+0001e560: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
+0001e570: 2020 2020 706f 7274 7320 3d20 6e65 7874      ports = next
+0001e580: 2828 6520 666f 7220 6520 696e 205b 7072  ((e for e in [pr
+0001e590: 6f66 696c 652e 6765 7428 2770 6f72 7473  ofile.get('ports
+0001e5a0: 2729 2c20 6375 7374 6f6d 7072 6f66 696c  '), customprofil
+0001e5b0: 652e 6765 7428 2770 6f72 7473 2729 5d20  e.get('ports')] 
+0001e5c0: 6966 2065 2069 7320 6e6f 7420 4e6f 6e65  if e is not None
+0001e5d0: 292c 204e 6f6e 6529 0a20 2020 2020 2020  ), None).       
+0001e5e0: 2020 2020 2020 2020 2076 6f6c 756d 6573           volumes
+0001e5f0: 203d 206e 6578 7428 2865 2066 6f72 2065   = next((e for e
+0001e600: 2069 6e20 5b70 726f 6669 6c65 2e67 6574   in [profile.get
+0001e610: 2827 766f 6c75 6d65 7327 292c 2070 726f  ('volumes'), pro
+0001e620: 6669 6c65 2e67 6574 2827 6469 736b 7327  file.get('disks'
+0001e630: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0001e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e650: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001e660: 7573 746f 6d70 726f 6669 6c65 2e67 6574  ustomprofile.get
+0001e670: 2827 766f 6c75 6d65 7327 292c 2063 7573  ('volumes'), cus
+0001e680: 746f 6d70 726f 6669 6c65 2e67 6574 2827  tomprofile.get('
+0001e690: 6469 736b 7327 295d 0a20 2020 2020 2020  disks')].       
+0001e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6b0: 2020 2020 2020 2020 2069 6620 6520 6973           if e is
+0001e6c0: 206e 6f74 204e 6f6e 6529 2c20 4e6f 6e65   not None), None
+0001e6d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001e6e0: 2020 656e 7669 726f 6e6d 656e 7420 3d20    environment = 
+0001e6f0: 6e65 7874 2828 6520 666f 7220 6520 696e  next((e for e in
+0001e700: 205b 7072 6f66 696c 652e 6765 7428 2765   [profile.get('e
+0001e710: 6e76 6972 6f6e 6d65 6e74 2729 2c20 6375  nvironment'), cu
+0001e720: 7374 6f6d 7072 6f66 696c 652e 6765 7428  stomprofile.get(
+0001e730: 2765 6e76 6972 6f6e 6d65 6e74 2729 5d0a  'environment')].
+0001e740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e760: 2020 2020 6966 2065 2069 7320 6e6f 7420      if e is not 
+0001e770: 4e6f 6e65 292c 204e 6f6e 6529 0a20 2020  None), None).   
+0001e780: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
+0001e790: 7320 3d20 6e65 7874 2828 6520 666f 7220  s = next((e for 
+0001e7a0: 6520 696e 205b 7072 6f66 696c 652e 6765  e in [profile.ge
+0001e7b0: 7428 2763 6d64 7327 292c 2063 7573 746f  t('cmds'), custo
+0001e7c0: 6d70 726f 6669 6c65 2e67 6574 2827 636d  mprofile.get('cm
+0001e7d0: 6473 2729 5d20 6966 2065 2069 7320 6e6f  ds')] if e is no
+0001e7e0: 7420 4e6f 6e65 292c 205b 5d29 0a20 2020  t None), []).   
+0001e7f0: 2020 2020 2020 2020 2020 2020 2073 7563               suc
+0001e800: 6365 7373 2866 2243 6f6e 7461 696e 6572  cess(f"Container
+0001e810: 207b 636f 6e74 6169 6e65 727d c2a0 6465   {container}..de
+0001e820: 706c 6f79 6564 2122 290a 2020 2020 2020  ployed!").      
+0001e830: 2020 2020 2020 2020 2020 636f 6e74 2e63            cont.c
+0001e840: 7265 6174 655f 636f 6e74 6169 6e65 7228  reate_container(
+0001e850: 6e61 6d65 3d63 6f6e 7461 696e 6572 2c20  name=container, 
+0001e860: 696d 6167 653d 636f 6e74 6169 6e65 7269  image=containeri
+0001e870: 6d61 6765 2c20 6e65 7473 3d6e 6574 732c  mage, nets=nets,
+0001e880: 2063 6d64 733d 636d 6473 2c20 706f 7274   cmds=cmds, port
+0001e890: 733d 706f 7274 732c 0a20 2020 2020 2020  s=ports,.       
+0001e8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8b0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0001e8c0: 6f6c 756d 6573 3d76 6f6c 756d 6573 2c20  olumes=volumes, 
+0001e8d0: 656e 7669 726f 6e6d 656e 743d 656e 7669  environment=envi
+0001e8e0: 726f 6e6d 656e 742c 206c 6162 656c 3d6c  ronment, label=l
+0001e8f0: 6162 656c 290a 2020 2020 2020 2020 6966  abel).        if
+0001e900: 2064 6e73 656e 7472 6965 7320 616e 6420   dnsentries and 
+0001e910: 6e6f 7420 6f6e 6c79 6173 7365 7473 3a0a  not onlyassets:.
+0001e920: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+0001e930: 6e74 2822 4465 706c 6f79 696e 6720 446e  nt("Deploying Dn
+0001e940: 7320 456e 7472 6965 732e 2e2e 2229 0a20  s Entries..."). 
+0001e950: 2020 2020 2020 2020 2020 2064 6e73 636c             dnscl
+0001e960: 6965 6e74 7320 3d20 7b7d 0a20 2020 2020  ients = {}.     
+0001e970: 2020 2020 2020 2066 6f72 2064 6e73 656e         for dnsen
+0001e980: 7472 7920 696e 2064 6e73 656e 7472 6965  try in dnsentrie
+0001e990: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0001e9a0: 2020 2064 6e73 7072 6f66 696c 6520 3d20     dnsprofile = 
+0001e9b0: 656e 7472 6965 735b 646e 7365 6e74 7279  entries[dnsentry
+0001e9c0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001e9d0: 2020 646e 7364 6f6d 6169 6e20 3d20 646e    dnsdomain = dn
+0001e9e0: 7370 726f 6669 6c65 2e67 6574 2827 646f  sprofile.get('do
+0001e9f0: 6d61 696e 2729 0a20 2020 2020 2020 2020  main').         
+0001ea00: 2020 2020 2020 2064 6e73 6e65 7420 3d20         dnsnet = 
+0001ea10: 646e 7370 726f 6669 6c65 2e67 6574 2827  dnsprofile.get('
+0001ea20: 6e65 7427 2c20 2764 6566 6175 6c74 2729  net', 'default')
+0001ea30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ea40: 2064 6e73 6970 203d 2064 6e73 7072 6f66   dnsip = dnsprof
+0001ea50: 696c 652e 6765 7428 2769 7027 290a 2020  ile.get('ip').  
+0001ea60: 2020 2020 2020 2020 2020 2020 2020 646e                dn
+0001ea70: 7361 6c69 6173 203d 2064 6e73 7072 6f66  salias = dnsprof
+0001ea80: 696c 652e 6765 7428 2761 6c69 6173 272c  ile.get('alias',
+0001ea90: 205b 5d29 0a20 2020 2020 2020 2020 2020   []).           
+0001eaa0: 2020 2020 2064 6e73 636c 6965 6e74 203d       dnsclient =
+0001eab0: 2064 6e73 7072 6f66 696c 652e 6765 7428   dnsprofile.get(
+0001eac0: 2763 6c69 656e 7427 290a 2020 2020 2020  'client').      
+0001ead0: 2020 2020 2020 2020 2020 6966 2064 6e73            if dns
+0001eae0: 636c 6965 6e74 2069 7320 4e6f 6e65 3a0a  client is None:.
+0001eaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eb00: 2020 2020 7a20 3d20 6b0a 2020 2020 2020      z = k.      
+0001eb10: 2020 2020 2020 2020 2020 656c 6966 2064            elif d
+0001eb20: 6e73 636c 6965 6e74 2069 6e20 646e 7363  nsclient in dnsc
+0001eb30: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
+0001eb40: 2020 2020 2020 2020 2020 2020 7a20 3d20              z = 
+0001eb50: 646e 7363 6c69 656e 7473 5b64 6e73 636c  dnsclients[dnscl
+0001eb60: 6965 6e74 5d0a 2020 2020 2020 2020 2020  ient].          
+0001eb70: 2020 2020 2020 656c 6966 2064 6e73 636c        elif dnscl
+0001eb80: 6965 6e74 2069 6e20 7365 6c66 2e63 6c69  ient in self.cli
+0001eb90: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
+0001eba0: 2020 2020 2020 2020 2020 7a20 3d20 4b63            z = Kc
+0001ebb0: 6f6e 6669 6728 636c 6965 6e74 3d64 6e73  onfig(client=dns
+0001ebc0: 636c 6965 6e74 292e 6b0a 2020 2020 2020  client).k.      
+0001ebd0: 2020 2020 2020 2020 2020 2020 2020 646e                dn
+0001ebe0: 7363 6c69 656e 7473 5b64 6e73 636c 6965  sclients[dnsclie
+0001ebf0: 6e74 5d20 3d20 7a0a 2020 2020 2020 2020  nt] = z.        
+0001ec00: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0001ec10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec20: 2020 7761 726e 696e 6728 6622 436c 6965    warning(f"Clie
+0001ec30: 6e74 207b 646e 7363 6c69 656e 747d 206e  nt {dnsclient} n
+0001ec40: 6f74 2066 6f75 6e64 2e20 536b 6970 7069  ot found. Skippi
+0001ec50: 6e67 2229 0a20 2020 2020 2020 2020 2020  ng").           
+0001ec60: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+0001ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec80: 6966 2064 6e73 6970 2069 7320 4e6f 6e65  if dnsip is None
+0001ec90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001eca0: 2020 2020 2020 7761 726e 696e 6728 224d        warning("M
+0001ecb0: 6973 7369 6e67 2069 702e 2053 6b69 7070  issing ip. Skipp
+0001ecc0: 696e 6721 2229 0a20 2020 2020 2020 2020  ing!").         
+0001ecd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001ece0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+0001ecf0: 2020 6966 2064 6e73 6e65 7420 6973 204e    if dnsnet is N
+0001ed00: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001ed10: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0001ed20: 2822 4d69 7373 696e 6720 6e65 742e 2053  ("Missing net. S
+0001ed30: 6b69 7070 696e 6721 2229 0a20 2020 2020  kipping!").     
+0001ed40: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001ed50: 6574 7572 6e0a 2020 2020 2020 2020 2020  eturn.          
+0001ed60: 2020 2020 2020 7a2e 7265 7365 7276 655f        z.reserve_
+0001ed70: 646e 7328 6e61 6d65 3d64 6e73 656e 7472  dns(name=dnsentr
+0001ed80: 792c 206e 6574 733d 5b64 6e73 6e65 745d  y, nets=[dnsnet]
+0001ed90: 2c20 646f 6d61 696e 3d64 6e73 646f 6d61  , domain=dnsdoma
+0001eda0: 696e 2c20 6970 3d64 6e73 6970 2c20 616c  in, ip=dnsip, al
+0001edb0: 6961 733d 646e 7361 6c69 6173 2c20 666f  ias=dnsalias, fo
+0001edc0: 7263 653d 5472 7565 2c0a 2020 2020 2020  rce=True,.      
+0001edd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ede0: 2020 2020 2020 2020 7072 696d 6172 793d          primary=
+0001edf0: 5472 7565 290a 2020 2020 2020 2020 6966  True).        if
+0001ee00: 2061 6e73 6962 6c65 656e 7472 6965 7320   ansibleentries 
+0001ee10: 616e 6420 6e6f 7420 6f6e 6c79 6173 7365  and not onlyasse
+0001ee20: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+0001ee30: 6966 206e 6f74 206e 6577 766d 733a 0a20  if not newvms:. 
+0001ee40: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0001ee50: 6172 6e69 6e67 2822 416e 7369 626c 6520  arning("Ansible 
+0001ee60: 736b 6970 7065 6420 6173 206e 6f20 6e65  skipped as no ne
+0001ee70: 7720 766d 2077 6974 6869 6e20 706c 6179  w vm within play
+0001ee80: 626f 6f6b 2070 726f 7669 7369 6f6e 6564  book provisioned
+0001ee90: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001eea0: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+0001eeb0: 2020 2020 2020 666f 7220 656e 7472 7920        for entry 
+0001eec0: 696e 2073 6f72 7465 6428 616e 7369 626c  in sorted(ansibl
+0001eed0: 6565 6e74 7269 6573 293a 0a20 2020 2020  eentries):.     
+0001eee0: 2020 2020 2020 2020 2020 205f 616e 7369             _ansi
+0001eef0: 626c 6520 3d20 656e 7472 6965 735b 656e  ble = entries[en
+0001ef00: 7472 795d 0a20 2020 2020 2020 2020 2020  try].           
+0001ef10: 2020 2020 2069 6620 2770 6c61 7962 6f6f       if 'playboo
+0001ef20: 6b27 206e 6f74 2069 6e20 5f61 6e73 6962  k' not in _ansib
+0001ef30: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+0001ef40: 2020 2020 2020 2020 6572 726f 7228 224d          error("M
+0001ef50: 6973 7369 6e67 2050 6c61 7962 6f6f 6b20  issing Playbook 
+0001ef60: 666f 7220 616e 7369 626c 652e 4967 6e6f  for ansible.Igno
+0001ef70: 7269 6e67 2e2e 2e22 290a 2020 2020 2020  ring...").      
+0001ef80: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+0001ef90: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
+0001efa0: 2020 2020 2020 2020 2020 706c 6179 626f            playbo
+0001efb0: 6f6b 203d 205f 616e 7369 626c 655b 2770  ok = _ansible['p
+0001efc0: 6c61 7962 6f6f 6b27 5d0a 2020 2020 2020  laybook'].      
+0001efd0: 2020 2020 2020 2020 2020 7665 7262 6f73            verbos
+0001efe0: 6520 3d20 5f61 6e73 6962 6c65 5b27 7665  e = _ansible['ve
+0001eff0: 7262 6f73 6527 5d20 6966 2027 7665 7262  rbose'] if 'verb
+0001f000: 6f73 6527 2069 6e20 5f61 6e73 6962 6c65  ose' in _ansible
+0001f010: 2065 6c73 6520 4661 6c73 650a 2020 2020   else False.    
+0001f020: 2020 2020 2020 2020 2020 2020 6772 6f75              grou
+0001f030: 7073 203d 205f 616e 7369 626c 652e 6765  ps = _ansible.ge
+0001f040: 7428 2767 726f 7570 7327 2c20 7b7d 290a  t('groups', {}).
+0001f050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f060: 7573 6572 203d 205f 616e 7369 626c 652e  user = _ansible.
+0001f070: 6765 7428 2775 7365 7227 290a 2020 2020  get('user').    
+0001f080: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+0001f090: 6162 6c65 7320 3d20 5f61 6e73 6962 6c65  ables = _ansible
+0001f0a0: 2e67 6574 2827 7661 7269 6162 6c65 7327  .get('variables'
+0001f0b0: 2c20 7b7d 290a 2020 2020 2020 2020 2020  , {}).          
+0001f0c0: 2020 2020 2020 7461 7267 6574 766d 7320        targetvms 
+0001f0d0: 3d20 5b76 6d20 666f 7220 766d 2069 6e20  = [vm for vm in 
+0001f0e0: 5f61 6e73 6962 6c65 5b27 766d 7327 5d20  _ansible['vms'] 
+0001f0f0: 6966 2076 6d20 696e 206e 6577 766d 735d  if vm in newvms]
+0001f100: 2069 6620 2776 6d73 2720 696e 205f 616e   if 'vms' in _an
+0001f110: 7369 626c 6520 656c 7365 206e 6577 766d  sible else newvm
+0001f120: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+0001f130: 2020 6966 206e 6f74 2074 6172 6765 7476    if not targetv
+0001f140: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+0001f150: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+0001f160: 2241 6e73 6962 6c65 2073 6b69 7070 6564  "Ansible skipped
+0001f170: 2061 7320 6e6f 206e 6577 2076 6d20 7769   as no new vm wi
+0001f180: 7468 696e 2070 6c61 7962 6f6f 6b20 7072  thin playbook pr
+0001f190: 6f76 6973 696f 6e65 6422 290a 2020 2020  ovisioned").    
+0001f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f1b0: 7265 7475 726e 0a20 2020 2020 2020 2020  return.         
+0001f1c0: 2020 2020 2020 2061 6e73 6962 6c65 636f         ansibleco
+0001f1d0: 6d6d 616e 6420 3d20 2261 6e73 6962 6c65  mmand = "ansible
+0001f1e0: 2d70 6c61 7962 6f6f 6b22 0a20 2020 2020  -playbook".     
+0001f1f0: 2020 2020 2020 2020 2020 2069 6620 7665             if ve
+0001f200: 7262 6f73 653a 0a20 2020 2020 2020 2020  rbose:.         
+0001f210: 2020 2020 2020 2020 2020 2061 6e73 6962             ansib
+0001f220: 6c65 636f 6d6d 616e 6420 2b3d 2022 202d  lecommand += " -
+0001f230: 7676 7622 0a20 2020 2020 2020 2020 2020  vvv".           
+0001f240: 2020 2020 2069 6e76 656e 746f 7279 6669       inventoryfi
+0001f250: 6c65 203d 2066 222f 746d 702f 7b70 6c61  le = f"/tmp/{pla
+0001f260: 6e7d 2e69 6e76 2e79 616d 6c22 2069 6620  n}.inv.yaml" if 
+0001f270: 7365 6c66 2e79 616d 6c69 6e76 656e 746f  self.yamlinvento
+0001f280: 7279 2065 6c73 6520 6622 2f74 6d70 2f7b  ry else f"/tmp/{
+0001f290: 706c 616e 7d2e 696e 7622 0a20 2020 2020  plan}.inv".     
+0001f2a0: 2020 2020 2020 2020 2020 2061 6e73 6962             ansib
+0001f2b0: 6c65 7574 696c 732e 6d61 6b65 5f70 6c61  leutils.make_pla
+0001f2c0: 6e5f 696e 7665 6e74 6f72 7928 766d 735f  n_inventory(vms_
+0001f2d0: 746f 5f68 6f73 742c 2070 6c61 6e2c 2074  to_host, plan, t
+0001f2e0: 6172 6765 7476 6d73 2c20 6772 6f75 7073  argetvms, groups
+0001f2f0: 3d67 726f 7570 732c 2075 7365 723d 7573  =groups, user=us
+0001f300: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
 0001f310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f320: 616e 7369 626c 6563 6f6d 6d61 6e64 202b  ansiblecommand +
-0001f330: 3d20 6622 202d 2d65 7874 7261 2d76 6172  = f" --extra-var
-0001f340: 7320 407b 7661 7273 6669 6c65 7d22 0a20  s @{varsfile}". 
-0001f350: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0001f360: 6e73 6962 6c65 636f 6d6d 616e 6420 2b3d  nsiblecommand +=
-0001f370: 2066 2220 2d69 207b 696e 7665 6e74 6f72   f" -i {inventor
-0001f380: 7966 696c 657d 207b 706c 6179 626f 6f6b  yfile} {playbook
-0001f390: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-0001f3a0: 2020 2070 7072 696e 7428 6622 5275 6e6e     pprint(f"Runn
-0001f3b0: 696e 673a 207b 616e 7369 626c 6563 6f6d  ing: {ansiblecom
-0001f3c0: 6d61 6e64 7d22 290a 2020 2020 2020 2020  mand}").        
-0001f3d0: 2020 2020 2020 2020 6f73 2e73 7973 7465          os.syste
-0001f3e0: 6d28 616e 7369 626c 6563 6f6d 6d61 6e64  m(ansiblecommand
-0001f3f0: 290a 2020 2020 2020 2020 6966 2061 6e73  ).        if ans
-0001f400: 6962 6c65 2061 6e64 206e 6f74 206f 6e6c  ible and not onl
-0001f410: 7961 7373 6574 733a 0a20 2020 2020 2020  yassets:.       
-0001f420: 2020 2020 2070 7072 696e 7428 2244 6570       pprint("Dep
-0001f430: 6c6f 7969 6e67 2041 6e73 6962 6c65 2049  loying Ansible I
-0001f440: 6e76 656e 746f 7279 2e2e 2e22 290a 2020  nventory...").  
-0001f450: 2020 2020 2020 2020 2020 696e 7665 6e74            invent
-0001f460: 6f72 7966 696c 6520 3d20 6622 2f74 6d70  oryfile = f"/tmp
-0001f470: 2f7b 706c 616e 7d2e 696e 762e 7961 6d6c  /{plan}.inv.yaml
-0001f480: 2220 6966 2073 656c 662e 7961 6d6c 696e  " if self.yamlin
-0001f490: 7665 6e74 6f72 7920 656c 7365 2066 222f  ventory else f"/
-0001f4a0: 746d 702f 7b70 6c61 6e7d 2e69 6e76 220a  tmp/{plan}.inv".
-0001f4b0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-0001f4c0: 732e 7061 7468 2e65 7869 7374 7328 696e  s.path.exists(in
-0001f4d0: 7665 6e74 6f72 7966 696c 6529 3a0a 2020  ventoryfile):.  
-0001f4e0: 2020 2020 2020 2020 2020 2020 2020 7070                pp
-0001f4f0: 7269 6e74 2866 2249 6e76 656e 746f 7279  rint(f"Inventory
-0001f500: 2069 6e20 7b69 6e76 656e 746f 7279 6669   in {inventoryfi
-0001f510: 6c65 7d20 736b 6970 7065 6421 2229 0a20  le} skipped!"). 
-0001f520: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0001f530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f540: 2070 7072 696e 7428 6622 4372 6561 7469   pprint(f"Creati
-0001f550: 6e67 2061 6e73 6962 6c65 2069 6e76 656e  ng ansible inven
-0001f560: 746f 7279 2066 6f72 2070 6c61 6e20 7b70  tory for plan {p
-0001f570: 6c61 6e7d 2069 6e20 7b69 6e76 656e 746f  lan} in {invento
-0001f580: 7279 6669 6c65 7d22 290a 2020 2020 2020  ryfile}").      
-0001f590: 2020 2020 2020 2020 2020 766d 7320 3d20            vms = 
-0001f5a0: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
-0001f5b0: 2020 2066 6f72 2076 6d20 696e 2073 6f72     for vm in sor
-0001f5c0: 7465 6428 6b2e 6c69 7374 2829 2c20 6b65  ted(k.list(), ke
-0001f5d0: 793d 6c61 6d62 6461 2078 3a20 785b 276e  y=lambda x: x['n
-0001f5e0: 616d 6527 5d29 3a0a 2020 2020 2020 2020  ame']):.        
-0001f5f0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-0001f600: 203d 2076 6d5b 276e 616d 6527 5d0a 2020   = vm['name'].  
-0001f610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f620: 2020 6465 7363 7269 7074 696f 6e20 3d20    description = 
-0001f630: 766d 5b27 706c 616e 275d 0a20 2020 2020  vm['plan'].     
-0001f640: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001f650: 6620 6465 7363 7269 7074 696f 6e20 3d3d  f description ==
-0001f660: 2070 6c61 6e3a 0a20 2020 2020 2020 2020   plan:.         
-0001f670: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0001f680: 6d73 2e61 7070 656e 6428 6e61 6d65 290a  ms.append(name).
-0001f690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f6a0: 616e 7369 626c 6575 7469 6c73 2e6d 616b  ansibleutils.mak
-0001f6b0: 655f 706c 616e 5f69 6e76 656e 746f 7279  e_plan_inventory
-0001f6c0: 2876 6d73 5f74 6f5f 686f 7374 2c20 706c  (vms_to_host, pl
-0001f6d0: 616e 2c20 766d 732c 2079 616d 6c69 6e76  an, vms, yamlinv
-0001f6e0: 656e 746f 7279 3d73 656c 662e 7961 6d6c  entory=self.yaml
-0001f6f0: 696e 7665 6e74 6f72 792c 0a20 2020 2020  inventory,.     
-0001f700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f720: 2020 2020 2020 2020 2020 2020 696e 7365              inse
-0001f730: 6375 7265 3d73 656c 662e 696e 7365 6375  cure=self.insecu
-0001f740: 7265 290a 2020 2020 2020 2020 2020 2020  re).            
-0001f750: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
-0001f760: 756c 7427 3a20 2773 7563 6365 7373 272c  ult': 'success',
-0001f770: 2027 706c 616e 273a 2070 6c61 6e7d 0a20   'plan': plan}. 
-0001f780: 2020 2020 2020 2069 6620 6c62 7320 616e         if lbs an
-0001f790: 6420 6e6f 7420 6f6e 6c79 6173 7365 7473  d not onlyassets
-0001f7a0: 3a0a 2020 2020 2020 2020 2020 2020 646e  :.            dn
-0001f7b0: 7363 6c69 656e 7473 203d 207b 7d0a 2020  sclients = {}.  
-0001f7c0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-0001f7d0: 2822 4465 706c 6f79 696e 6720 4c6f 6164  ("Deploying Load
-0001f7e0: 6261 6c61 6e63 6572 732e 2e2e 2229 0a20  balancers..."). 
-0001f7f0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-0001f800: 6e64 6578 2c20 6c62 656e 7472 7920 696e  ndex, lbentry in
-0001f810: 2065 6e75 6d65 7261 7465 286c 6273 293a   enumerate(lbs):
-0001f820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f830: 2064 6574 6169 6c73 203d 2065 6e74 7269   details = entri
-0001f840: 6573 5b6c 6265 6e74 7279 5d0a 2020 2020  es[lbentry].    
-0001f850: 2020 2020 2020 2020 2020 2020 706f 7274              port
-0001f860: 7320 3d20 6465 7461 696c 732e 6765 7428  s = details.get(
-0001f870: 2770 6f72 7473 272c 205b 5d29 0a20 2020  'ports', []).   
-0001f880: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001f890: 6e6f 7420 706f 7274 733a 0a20 2020 2020  not ports:.     
-0001f8a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001f8b0: 7272 6f72 2822 4d69 7373 696e 6720 506f  rror("Missing Po
-0001f8c0: 7274 7320 666f 7220 6c6f 6164 6261 6c61  rts for loadbala
-0001f8d0: 6e63 6572 2e20 4e6f 7420 6372 6561 7469  ncer. Not creati
-0001f8e0: 6e67 2069 742e 2e2e 2229 0a20 2020 2020  ng it...").     
-0001f8f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001f900: 6574 7572 6e0a 2020 2020 2020 2020 2020  eturn.          
-0001f910: 2020 2020 2020 6368 6563 6b70 6174 6820        checkpath 
-0001f920: 3d20 6465 7461 696c 732e 6765 7428 2763  = details.get('c
-0001f930: 6865 636b 7061 7468 272c 2027 2f27 290a  heckpath', '/').
-0001f940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f950: 6368 6563 6b70 6f72 7420 3d20 6465 7461  checkport = deta
-0001f960: 696c 732e 6765 7428 2763 6865 636b 706f  ils.get('checkpo
-0001f970: 7274 272c 2038 3029 0a20 2020 2020 2020  rt', 80).       
-0001f980: 2020 2020 2020 2020 2061 6c69 6173 203d           alias =
-0001f990: 2064 6574 6169 6c73 2e67 6574 2827 616c   details.get('al
-0001f9a0: 6961 7327 2c20 5b5d 290a 2020 2020 2020  ias', []).      
-0001f9b0: 2020 2020 2020 2020 2020 646f 6d61 696e            domain
-0001f9c0: 203d 2064 6574 6169 6c73 2e67 6574 2827   = details.get('
-0001f9d0: 646f 6d61 696e 2729 0a20 2020 2020 2020  domain').       
-0001f9e0: 2020 2020 2020 2020 2064 6e73 636c 6965           dnsclie
-0001f9f0: 6e74 203d 2064 6574 6169 6c73 2e67 6574  nt = details.get
-0001fa00: 2827 646e 7363 6c69 656e 7427 2c20 6f76  ('dnsclient', ov
-0001fa10: 6572 7269 6465 732e 6765 7428 2764 6e73  errides.get('dns
-0001fa20: 636c 6965 6e74 2729 290a 2020 2020 2020  client')).      
-0001fa30: 2020 2020 2020 2020 2020 6c62 766d 7320            lbvms 
-0001fa40: 3d20 6465 7461 696c 732e 6765 7428 2776  = details.get('v
-0001fa50: 6d73 272c 205b 5d29 0a20 2020 2020 2020  ms', []).       
-0001fa60: 2020 2020 2020 2020 206c 626e 6574 7320           lbnets 
-0001fa70: 3d20 6465 7461 696c 732e 6765 7428 276e  = details.get('n
-0001fa80: 6574 7327 2c20 5b27 6465 6661 756c 7427  ets', ['default'
-0001fa90: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0001faa0: 2020 2069 6e74 6572 6e61 6c20 3d20 6465     internal = de
-0001fab0: 7461 696c 732e 6765 7428 2769 6e74 6572  tails.get('inter
-0001fac0: 6e61 6c27 290a 2020 2020 2020 2020 2020  nal').          
-0001fad0: 2020 2020 2020 7375 626e 6574 6964 203d        subnetid =
-0001fae0: 2064 6574 6169 6c73 2e67 6574 2827 7375   details.get('su
-0001faf0: 626e 6574 6964 2729 0a20 2020 2020 2020  bnetid').       
-0001fb00: 2020 2020 2020 2020 2069 7020 3d20 6465           ip = de
-0001fb10: 7461 696c 732e 6765 7428 2769 7027 290a  tails.get('ip').
-0001fb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb30: 7365 6c66 2e63 7265 6174 655f 6c6f 6164  self.create_load
-0001fb40: 6261 6c61 6e63 6572 286c 6265 6e74 7279  balancer(lbentry
-0001fb50: 2c20 6e65 7473 3d6c 626e 6574 732c 2070  , nets=lbnets, p
-0001fb60: 6f72 7473 3d70 6f72 7473 2c20 6368 6563  orts=ports, chec
-0001fb70: 6b70 6174 683d 6368 6563 6b70 6174 682c  kpath=checkpath,
-0001fb80: 2076 6d73 3d6c 6276 6d73 2c0a 2020 2020   vms=lbvms,.    
-0001fb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fbb0: 2020 2020 2064 6f6d 6169 6e3d 646f 6d61       domain=doma
-0001fbc0: 696e 2c20 706c 616e 3d70 6c61 6e2c 2063  in, plan=plan, c
-0001fbd0: 6865 636b 706f 7274 3d63 6865 636b 706f  heckport=checkpo
-0001fbe0: 7274 2c20 616c 6961 733d 616c 6961 732c  rt, alias=alias,
-0001fbf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fc10: 2020 2020 2020 2020 2020 696e 7465 726e            intern
-0001fc20: 616c 3d69 6e74 6572 6e61 6c2c 2064 6e73  al=internal, dns
-0001fc30: 636c 6965 6e74 3d64 6e73 636c 6965 6e74  client=dnsclient
-0001fc40: 2c20 7375 626e 6574 6964 3d73 7562 6e65  , subnetid=subne
-0001fc50: 7469 642c 2069 703d 6970 290a 2020 2020  tid, ip=ip).    
-0001fc60: 2020 2020 6966 2073 6773 2061 6e64 206e      if sgs and n
-0001fc70: 6f74 206f 6e6c 7961 7373 6574 733a 0a20  ot onlyassets:. 
-0001fc80: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0001fc90: 7428 2244 6570 6c6f 7969 6e67 2053 6563  t("Deploying Sec
-0001fca0: 7572 6974 7947 726f 7570 732e 2e2e 2229  urityGroups...")
-0001fcb0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0001fcc0: 2073 6720 696e 2073 6773 3a0a 2020 2020   sg in sgs:.    
-0001fcd0: 2020 2020 2020 2020 2020 2020 6465 7461              deta
-0001fce0: 696c 7320 3d20 656e 7472 6965 735b 7367  ils = entries[sg
-0001fcf0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001fd00: 2020 6e61 6d65 0a20 2020 2020 2020 2020    name.         
-0001fd10: 2020 2020 2020 2070 6f72 7473 203d 2064         ports = d
-0001fd20: 6574 6169 6c73 2e67 6574 2827 706f 7274  etails.get('port
-0001fd30: 7327 2c20 5b5d 290a 2020 2020 2020 2020  s', []).        
-0001fd40: 2020 2020 2020 2020 6966 206e 6f74 2070          if not p
-0001fd50: 6f72 7473 3a0a 2020 2020 2020 2020 2020  orts:.          
-0001fd60: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-0001fd70: 224d 6973 7369 6e67 2050 6f72 7473 2066  "Missing Ports f
-0001fd80: 6f72 2073 6773 2e20 4e6f 7420 6372 6561  or sgs. Not crea
-0001fd90: 7469 6e67 2069 742e 2e2e 2229 0a20 2020  ting it...").   
-0001fda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fdb0: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
-0001fdc0: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
-0001fdd0: 6174 655f 7365 6375 7269 7479 5f67 726f  ate_security_gro
-0001fde0: 7570 2873 672c 207b 2770 6f72 7473 273a  up(sg, {'ports':
-0001fdf0: 2070 6f72 7473 7d29 0a20 2020 2020 2020   ports}).       
-0001fe00: 2069 6620 776f 726b 666c 6f77 656e 7472   if workflowentr
-0001fe10: 6965 7320 616e 6420 6e6f 7420 6f6e 6c79  ies and not only
-0001fe20: 6173 7365 7473 3a0a 2020 2020 2020 2020  assets:.        
-0001fe30: 2020 2020 7070 7269 6e74 2822 4465 706c      pprint("Depl
-0001fe40: 6f79 696e 6720 576f 726b 666c 6f77 2045  oying Workflow E
-0001fe50: 6e74 7269 6573 2e2e 2e22 290a 2020 2020  ntries...").    
-0001fe60: 2020 2020 2020 2020 666f 7220 776f 726b          for work
-0001fe70: 666c 6f77 2069 6e20 776f 726b 666c 6f77  flow in workflow
-0001fe80: 656e 7472 6965 733a 0a20 2020 2020 2020  entries:.       
-0001fe90: 2020 2020 2020 2020 2077 6f72 6b66 6c6f           workflo
-0001fea0: 775f 6f76 6572 7269 6465 7320 3d20 6f76  w_overrides = ov
-0001feb0: 6572 7269 6465 732e 636f 7079 2829 0a20  errides.copy(). 
-0001fec0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0001fed0: 6f72 6b66 6c6f 775f 6f76 6572 7269 6465  orkflow_override
-0001fee0: 732e 7570 6461 7465 2865 6e74 7269 6573  s.update(entries
-0001fef0: 5b77 6f72 6b66 6c6f 775d 290a 2020 2020  [workflow]).    
-0001ff00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001ff10: 2e63 7265 6174 655f 776f 726b 666c 6f77  .create_workflow
-0001ff20: 2877 6f72 6b66 6c6f 772c 206f 7665 7272  (workflow, overr
-0001ff30: 6964 6573 3d77 6f72 6b66 6c6f 775f 6f76  ides=workflow_ov
-0001ff40: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
-0001ff50: 2072 6574 7572 6e64 6174 6120 3d20 7b27   returndata = {'
-0001ff60: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
-0001ff70: 7327 2c20 2770 6c61 6e27 3a20 706c 616e  s', 'plan': plan
-0001ff80: 7d0a 2020 2020 2020 2020 7265 7475 726e  }.        return
-0001ff90: 6461 7461 5b27 6e65 7776 6d73 275d 203d  data['newvms'] =
-0001ffa0: 206e 6577 766d 7320 6966 206e 6577 766d   newvms if newvm
-0001ffb0: 7320 656c 7365 205b 5d0a 2020 2020 2020  s else [].      
-0001ffc0: 2020 7265 7475 726e 6461 7461 5b27 6578    returndata['ex
-0001ffd0: 6973 7469 6e67 766d 7327 5d20 3d20 6578  istingvms'] = ex
-0001ffe0: 6973 7469 6e67 766d 7320 6966 2065 7869  istingvms if exi
-0001fff0: 7374 696e 6776 6d73 2065 6c73 6520 5b5d  stingvms else []
-00020000: 0a20 2020 2020 2020 2072 6574 7572 6e64  .        returnd
-00020010: 6174 615b 2766 6169 6c65 6476 6d73 275d  ata['failedvms']
-00020020: 203d 2066 6169 6c65 6476 6d73 2069 6620   = failedvms if 
-00020030: 6661 696c 6564 766d 7320 656c 7365 205b  failedvms else [
-00020040: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
-00020050: 6461 7461 5b27 6173 7365 7473 275d 203d  data['assets'] =
-00020060: 206e 6577 6173 7365 7473 2069 6620 6e65   newassets if ne
-00020070: 7761 7373 6574 7320 656c 7365 205b 5d0a  wassets else [].
-00020080: 2020 2020 2020 2020 6966 2066 6169 6c65          if faile
-00020090: 6476 6d73 3a0a 2020 2020 2020 2020 2020  dvms:.          
-000200a0: 2020 7265 7475 726e 6461 7461 5b27 7265    returndata['re
-000200b0: 7375 6c74 275d 203d 2027 6661 696c 7572  sult'] = 'failur
-000200c0: 6527 0a20 2020 2020 2020 2020 2020 2066  e'.            f
-000200d0: 6169 6c65 646e 616d 6573 203d 2027 2c27  ailednames = ','
-000200e0: 2e6a 6f69 6e28 5b76 5b27 6e61 6d65 275d  .join([v['name']
-000200f0: 2066 6f72 2076 2069 6e20 6661 696c 6564   for v in failed
-00020100: 766d 735d 290a 2020 2020 2020 2020 2020  vms]).          
-00020110: 2020 7265 7475 726e 6461 7461 5b27 7265    returndata['re
-00020120: 6173 6f6e 275d 203d 2066 2754 6865 2066  ason'] = f'The f
-00020130: 6f6c 6c6f 7769 6e67 2076 6d73 2066 6169  ollowing vms fai
-00020140: 6c65 643a 207b 6661 696c 6564 6e61 6d65  led: {failedname
-00020150: 737d 270a 2020 2020 2020 2020 6966 2067  s}'.        if g
-00020160: 6574 6261 636b 206f 7220 746f 636c 6561  etback or toclea
-00020170: 6e3a 0a20 2020 2020 2020 2020 2020 206f  n:.            o
-00020180: 732e 6368 6469 7228 272e 2e27 290a 2020  s.chdir('..').  
-00020190: 2020 2020 2020 6966 2074 6f63 6c65 616e        if toclean
-000201a0: 3a0a 2020 2020 2020 2020 2020 2020 726d  :.            rm
-000201b0: 7472 6565 2870 6174 6829 0a20 2020 2020  tree(path).     
-000201c0: 2020 2069 6620 696e 7075 7473 7472 696e     if inputstrin
-000201d0: 6720 6973 206e 6f74 204e 6f6e 6520 616e  g is not None an
-000201e0: 6420 6f73 2e70 6174 682e 6578 6973 7473  d os.path.exists
-000201f0: 2866 2274 656d 705f 706c 616e 5f7b 706c  (f"temp_plan_{pl
-00020200: 616e 7d2e 796d 6c22 293a 0a20 2020 2020  an}.yml"):.     
-00020210: 2020 2020 2020 206f 732e 7265 6d6f 7665         os.remove
-00020220: 2866 2274 656d 705f 706c 616e 5f7b 706c  (f"temp_plan_{pl
-00020230: 616e 7d2e 796d 6c22 290a 2020 2020 2020  an}.yml").      
-00020240: 2020 666f 7220 656e 7472 7920 696e 2061    for entry in a
-00020250: 7379 6e63 7761 6974 766d 733a 0a20 2020  syncwaitvms:.   
-00020260: 2020 2020 2020 2020 206e 616d 652c 2066           name, f
-00020270: 696e 6973 6866 696c 6573 203d 2065 6e74  inishfiles = ent
-00020280: 7279 5b27 6e61 6d65 275d 2c20 656e 7472  ry['name'], entr
-00020290: 795b 2766 696e 6973 6866 696c 6573 275d  y['finishfiles']
-000202a0: 0a20 2020 2020 2020 2020 2020 2077 6169  .            wai
-000202b0: 7463 6f6d 6d61 6e64 2c20 7761 6974 7469  tcommand, waitti
-000202c0: 6d65 6f75 7420 3d20 656e 7472 795b 2777  meout = entry['w
-000202d0: 6169 7463 6f6d 6d61 6e64 275d 2c20 656e  aitcommand'], en
-000202e0: 7472 795b 2777 6169 7474 696d 656f 7574  try['waittimeout
-000202f0: 275d 0a20 2020 2020 2020 2020 2020 2076  '].            v
-00020300: 6d63 6c69 656e 7420 3d20 656e 7472 795b  mclient = entry[
-00020310: 2776 6d63 6c69 656e 7427 5d0a 2020 2020  'vmclient'].    
-00020320: 2020 2020 2020 2020 7365 6c66 2e77 6169          self.wai
-00020330: 745f 6669 6e69 7368 286e 616d 652c 2077  t_finish(name, w
-00020340: 6169 7463 6f6d 6d61 6e64 3d77 6169 7463  aitcommand=waitc
-00020350: 6f6d 6d61 6e64 2c20 7761 6974 7469 6d65  ommand, waittime
-00020360: 6f75 743d 7761 6974 7469 6d65 6f75 742c  out=waittimeout,
-00020370: 2076 6d63 6c69 656e 743d 766d 636c 6965   vmclient=vmclie
-00020380: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
-00020390: 6966 2066 696e 6973 6866 696c 6573 3a0a  if finishfiles:.
-000203a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000203b0: 7365 6c66 2e68 616e 646c 655f 6669 6e69  self.handle_fini
-000203c0: 7368 6669 6c65 7328 6e61 6d65 2c20 6669  shfiles(name, fi
-000203d0: 6e69 7368 6669 6c65 732c 2076 6d63 6c69  nishfiles, vmcli
-000203e0: 656e 743d 766d 636c 6965 6e74 290a 2020  ent=vmclient).  
-000203f0: 2020 2020 2020 706f 7374 5f73 6372 6970        post_scrip
-00020400: 7420 3d20 6627 7b69 6e70 7574 6469 727d  t = f'{inputdir}
-00020410: 2f6b 636c 695f 706f 7374 2e73 6827 0a20  /kcli_post.sh'. 
-00020420: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-00020430: 682e 6578 6973 7473 2870 6f73 745f 7363  h.exists(post_sc
-00020440: 7269 7074 293a 0a20 2020 2020 2020 2020  ript):.         
-00020450: 2020 2069 6620 706f 7374 3a0a 2020 2020     if post:.    
-00020460: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-00020470: 6e74 2822 5275 6e6e 696e 6720 6b63 6c69  nt("Running kcli
-00020480: 5f70 6f73 742e 7368 2229 0a20 2020 2020  _post.sh").     
-00020490: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-000204a0: 5465 6d70 6f72 6172 7944 6972 6563 746f  TemporaryDirecto
-000204b0: 7279 2829 2061 7320 746d 7064 6972 3a0a  ry() as tmpdir:.
-000204c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000204d0: 2020 2020 706f 7374 5f73 6372 6970 7420      post_script 
-000204e0: 3d20 7365 6c66 2e70 726f 6365 7373 5f69  = self.process_i
-000204f0: 6e70 7574 6669 6c65 2827 7878 7827 2c20  nputfile('xxx', 
-00020500: 706f 7374 5f73 6372 6970 742c 206f 7665  post_script, ove
-00020510: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
-00020520: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00020530: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-00020540: 6622 7b74 6d70 6469 727d 2f70 6f73 742e  f"{tmpdir}/post.
-00020550: 7368 222c 2027 7727 2920 6173 2066 3a0a  sh", 'w') as f:.
-00020560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020570: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
-00020580: 706f 7374 5f73 6372 6970 7429 0a20 2020  post_script).   
-00020590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000205a0: 2070 6f73 745f 7275 6e20 3d20 7275 6e28   post_run = run(
-000205b0: 6627 6261 7368 207b 746d 7064 6972 7d2f  f'bash {tmpdir}/
-000205c0: 706f 7374 2e73 6827 2c20 7368 656c 6c3d  post.sh', shell=
-000205d0: 5472 7565 2c20 7374 646f 7574 3d50 4950  True, stdout=PIP
-000205e0: 452c 2073 7464 6572 723d 5354 444f 5554  E, stderr=STDOUT
-000205f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00020600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020610: 2020 2020 2075 6e69 7665 7273 616c 5f6e       universal_n
-00020620: 6577 6c69 6e65 733d 5472 7565 290a 2020  ewlines=True).  
-00020630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020640: 2020 6966 2070 6f73 745f 7275 6e2e 7265    if post_run.re
-00020650: 7475 726e 636f 6465 2021 3d20 303a 0a20  turncode != 0:. 
-00020660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020670: 2020 2020 2020 206d 7367 203d 2066 2249         msg = f"I
-00020680: 7373 7565 2077 6865 6e20 7275 6e6e 696e  ssue when runnin
-00020690: 6720 6b63 6c69 5f70 6f73 742e 7368 203a  g kcli_post.sh :
-000206a0: 5c6e 7b70 6f73 745f 7275 6e2e 7374 646f  \n{post_run.stdo
-000206b0: 7574 7d22 0a20 2020 2020 2020 2020 2020  ut}".           
-000206c0: 2020 2020 2020 2020 2020 2020 2065 7272               err
-000206d0: 6f72 286d 7367 290a 2020 2020 2020 2020  or(msg).        
-000206e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000206f0: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
-00020700: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
-00020710: 6173 6f6e 273a 206d 7367 7d0a 2020 2020  ason': msg}.    
-00020720: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00020730: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-00020740: 726e 696e 6728 2253 6b69 7070 696e 6720  rning("Skipping 
-00020750: 6b63 6c69 5f70 6f73 742e 7368 2061 7320  kcli_post.sh as 
-00020760: 7265 7175 6573 7465 6422 290a 2020 2020  requested").    
-00020770: 2020 2020 6966 206f 7665 7272 6964 6573      if overrides
-00020780: 2e67 6574 2827 7465 6d70 6b65 7964 6972  .get('tempkeydir
-00020790: 2729 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ') is not None:.
-000207a0: 2020 2020 2020 2020 2020 2020 6f76 6572              over
-000207b0: 7269 6465 732e 6765 7428 2774 656d 706b  rides.get('tempk
-000207c0: 6579 6469 7227 292e 636c 6561 6e75 7028  eydir').cleanup(
-000207d0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-000207e0: 2072 6574 7572 6e64 6174 610a 0a20 2020   returndata..   
-000207f0: 2064 6566 2068 616e 646c 655f 686f 7374   def handle_host
-00020800: 2873 656c 662c 2070 6f6f 6c3d 4e6f 6e65  (self, pool=None
-00020810: 2c20 696d 6167 653d 4e6f 6e65 2c20 7377  , image=None, sw
-00020820: 6974 6368 3d4e 6f6e 652c 2064 6f77 6e6c  itch=None, downl
-00020830: 6f61 643d 4661 6c73 652c 0a20 2020 2020  oad=False,.     
-00020840: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00020850: 726c 3d4e 6f6e 652c 2063 6d64 3d4e 6f6e  rl=None, cmd=Non
-00020860: 652c 2073 796e 633d 4661 6c73 652c 2073  e, sync=False, s
-00020870: 697a 653d 4e6f 6e65 2c20 6172 6368 3d27  ize=None, arch='
-00020880: 7838 365f 3634 272c 0a20 2020 2020 2020  x86_64',.       
-00020890: 2020 2020 2020 2020 2020 2020 206b 766d               kvm
-000208a0: 5f6f 7065 6e73 7461 636b 3d54 7275 652c  _openstack=True,
-000208b0: 2072 6863 6f73 5f63 6f6d 6d69 743d 4e6f   rhcos_commit=No
-000208c0: 6e65 2c20 7268 636f 735f 696e 7374 616c  ne, rhcos_instal
-000208d0: 6c65 723d 4661 6c73 6529 3a0a 2020 2020  ler=False):.    
-000208e0: 2020 2020 6966 2064 6f77 6e6c 6f61 643a      if download:
-000208f0: 0a20 2020 2020 2020 2020 2020 206b 203d  .            k =
-00020900: 2073 656c 662e 6b0a 2020 2020 2020 2020   self.k.        
-00020910: 2020 2020 6966 2070 6f6f 6c20 6973 204e      if pool is N
-00020920: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00020930: 2020 2020 2070 6f6f 6c20 3d20 7365 6c66       pool = self
-00020940: 2e70 6f6f 6c0a 2020 2020 2020 2020 2020  .pool.          
-00020950: 2020 2020 2020 7070 7269 6e74 2866 2255        pprint(f"U
-00020960: 7369 6e67 2070 6f6f 6c20 7b70 6f6f 6c7d  sing pool {pool}
-00020970: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-00020980: 6620 696d 6167 6520 6973 206e 6f74 204e  f image is not N
-00020990: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000209a0: 2020 2020 2069 6620 7572 6c20 6973 204e       if url is N
-000209b0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000209c0: 2020 2020 2020 2020 2069 6620 6172 6368           if arch
-000209d0: 2021 3d20 2778 3836 5f36 3427 3a0a 2020   != 'x86_64':.  
-000209e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000209f0: 2020 2020 2020 494d 4147 4553 2e75 7064        IMAGES.upd
-00020a00: 6174 6528 7b69 3a20 494d 4147 4553 5b69  ate({i: IMAGES[i
-00020a10: 5d2e 7265 706c 6163 6528 2778 3836 5f36  ].replace('x86_6
-00020a20: 3427 2c20 6172 6368 292e 7265 706c 6163  4', arch).replac
-00020a30: 6528 2761 6d64 3634 272c 2061 7263 6829  e('amd64', arch)
-00020a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a60: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-00020a70: 2049 4d41 4745 537d 290a 2020 2020 2020   IMAGES}).      
-00020a80: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00020a90: 2069 6d61 6765 206e 6f74 2069 6e20 494d   image not in IM
-00020aa0: 4147 4553 3a0a 2020 2020 2020 2020 2020  AGES:.          
-00020ab0: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00020ac0: 726f 7228 6622 496d 6167 6520 7b69 6d61  ror(f"Image {ima
-00020ad0: 6765 7d20 6861 7320 6e6f 2061 7373 6f63  ge} has no assoc
-00020ae0: 6961 7465 6420 7572 6c22 290a 2020 2020  iated url").    
-00020af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020b00: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
-00020b10: 756c 7427 3a20 2766 6169 6c75 7265 272c  ult': 'failure',
-00020b20: 2027 7265 6173 6f6e 273a 2022 496e 636f   'reason': "Inco
-00020b30: 7272 6563 7420 696d 6167 6522 7d0a 2020  rrect image"}.  
-00020b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020b50: 2020 7572 6c20 3d20 494d 4147 4553 5b69    url = IMAGES[i
-00020b60: 6d61 6765 5d0a 2020 2020 2020 2020 2020  mage].          
-00020b70: 2020 2020 2020 2020 2020 696d 6167 655f            image_
-00020b80: 7479 7065 203d 2027 6f70 656e 7374 6163  type = 'openstac
-00020b90: 6b27 2069 6620 6b76 6d5f 6f70 656e 7374  k' if kvm_openst
-00020ba0: 6163 6b20 616e 6420 7365 6c66 2e74 7970  ack and self.typ
-00020bb0: 6520 3d3d 2027 6b76 6d27 2065 6c73 6520  e == 'kvm' else 
-00020bc0: 7365 6c66 2e74 7970 650a 2020 2020 2020  self.type.      
-00020bd0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00020be0: 206e 6f74 206b 766d 5f6f 7065 6e73 7461   not kvm_opensta
-00020bf0: 636b 2061 6e64 2073 656c 662e 7479 7065  ck and self.type
-00020c00: 203d 3d20 276b 766d 273a 0a20 2020 2020   == 'kvm':.     
-00020c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c20: 2020 2069 6d61 6765 202b 3d20 222d 7165     image += "-qe
-00020c30: 6d75 220a 2020 2020 2020 2020 2020 2020  mu".            
-00020c40: 2020 2020 2020 2020 6966 2027 7268 636f          if 'rhco
-00020c50: 7327 2069 6e20 696d 6167 6520 616e 6420  s' in image and 
-00020c60: 6e6f 7420 696d 6167 652e 656e 6473 7769  not image.endswi
-00020c70: 7468 2827 7163 6f77 322e 677a 2729 3a0a  th('qcow2.gz'):.
-00020c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c90: 2020 2020 2020 2020 6966 2072 6863 6f73          if rhcos
-00020ca0: 5f63 6f6d 6d69 7420 6973 206e 6f74 204e  _commit is not N
-00020cb0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00020cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020cd0: 2075 726c 203d 2063 6f6d 6d6f 6e2e 6765   url = common.ge
-00020ce0: 745f 636f 6d6d 6974 5f72 6863 6f73 2872  t_commit_rhcos(r
-00020cf0: 6863 6f73 5f63 6f6d 6d69 742c 205f 7479  hcos_commit, _ty
-00020d00: 7065 3d69 6d61 6765 5f74 7970 6529 0a20  pe=image_type). 
-00020d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d20: 2020 2020 2020 2065 6c69 6620 7268 636f         elif rhco
-00020d30: 735f 696e 7374 616c 6c65 723a 0a20 2020  s_installer:.   
+0001f320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f330: 2020 2020 2079 616d 6c69 6e76 656e 746f       yamlinvento
+0001f340: 7279 3d73 656c 662e 7961 6d6c 696e 7665  ry=self.yamlinve
+0001f350: 6e74 6f72 792c 2074 756e 6e65 6c3d 7365  ntory, tunnel=se
+0001f360: 6c66 2e74 756e 6e65 6c2c 0a20 2020 2020  lf.tunnel,.     
+0001f370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f390: 2020 2020 2020 2020 2020 2020 7475 6e6e              tunn
+0001f3a0: 656c 686f 7374 3d73 656c 662e 7475 6e6e  elhost=self.tunn
+0001f3b0: 656c 686f 7374 2c20 7475 6e6e 656c 7573  elhost, tunnelus
+0001f3c0: 6572 3d73 656c 662e 7475 6e6e 656c 7573  er=self.tunnelus
+0001f3d0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+0001f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f400: 2020 2020 2074 756e 6e65 6c70 6f72 743d       tunnelport=
+0001f410: 7365 6c66 2e74 756e 6e65 6c70 6f72 742c  self.tunnelport,
+0001f420: 2069 6e73 6563 7572 653d 7365 6c66 2e69   insecure=self.i
+0001f430: 6e73 6563 7572 6529 0a20 2020 2020 2020  nsecure).       
+0001f440: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0001f450: 6f73 2e70 6174 682e 6578 6973 7473 2827  os.path.exists('
+0001f460: 7e2f 2e61 6e73 6962 6c65 2e63 6667 2729  ~/.ansible.cfg')
+0001f470: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001f480: 2020 2020 2020 616e 7369 626c 6563 6f6e        ansiblecon
+0001f490: 6669 6720 3d20 6f73 2e70 6174 682e 6578  fig = os.path.ex
+0001f4a0: 7061 6e64 7573 6572 2827 7e2f 2e61 6e73  panduser('~/.ans
+0001f4b0: 6962 6c65 2e63 6667 2729 0a20 2020 2020  ible.cfg').     
+0001f4c0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0001f4d0: 6974 6820 6f70 656e 2861 6e73 6962 6c65  ith open(ansible
+0001f4e0: 636f 6e66 6967 2c20 2277 2229 2061 7320  config, "w") as 
+0001f4f0: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
+0001f500: 2020 2020 2020 2020 2020 2066 2e77 7269             f.wri
+0001f510: 7465 2822 5b73 7368 5f63 6f6e 6e65 6374  te("[ssh_connect
+0001f520: 696f 6e5d 5c6e 7265 7472 6965 733d 3130  ion]\nretries=10
+0001f530: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
+0001f540: 2020 2020 2069 6620 7661 7269 6162 6c65       if variable
+0001f550: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0001f560: 2020 2020 2020 2076 6172 7366 696c 6520         varsfile 
+0001f570: 3d20 6622 2f74 6d70 2f7b 706c 616e 7d2e  = f"/tmp/{plan}.
+0001f580: 7661 7273 2e79 6d6c 220a 2020 2020 2020  vars.yml".      
+0001f590: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+0001f5a0: 7468 206f 7065 6e28 7661 7273 6669 6c65  th open(varsfile
+0001f5b0: 2c20 2777 2729 2061 7320 663a 0a20 2020  , 'w') as f:.   
+0001f5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f5d0: 2020 2020 2079 616d 6c2e 6475 6d70 2876       yaml.dump(v
+0001f5e0: 6172 6961 626c 6573 2c20 662c 2064 6566  ariables, f, def
+0001f5f0: 6175 6c74 5f66 6c6f 775f 7374 796c 653d  ault_flow_style=
+0001f600: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+0001f610: 2020 2020 2020 2020 2020 2061 6e73 6962             ansib
+0001f620: 6c65 636f 6d6d 616e 6420 2b3d 2066 2220  lecommand += f" 
+0001f630: 2d2d 6578 7472 612d 7661 7273 2040 7b76  --extra-vars @{v
+0001f640: 6172 7366 696c 657d 220a 2020 2020 2020  arsfile}".      
+0001f650: 2020 2020 2020 2020 2020 616e 7369 626c            ansibl
+0001f660: 6563 6f6d 6d61 6e64 202b 3d20 6622 202d  ecommand += f" -
+0001f670: 6920 7b69 6e76 656e 746f 7279 6669 6c65  i {inventoryfile
+0001f680: 7d20 7b70 6c61 7962 6f6f 6b7d 220a 2020  } {playbook}".  
+0001f690: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+0001f6a0: 7269 6e74 2866 2252 756e 6e69 6e67 3a20  rint(f"Running: 
+0001f6b0: 7b61 6e73 6962 6c65 636f 6d6d 616e 647d  {ansiblecommand}
+0001f6c0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001f6d0: 2020 206f 732e 7379 7374 656d 2861 6e73     os.system(ans
+0001f6e0: 6962 6c65 636f 6d6d 616e 6429 0a20 2020  iblecommand).   
+0001f6f0: 2020 2020 2069 6620 616e 7369 626c 6520       if ansible 
+0001f700: 616e 6420 6e6f 7420 6f6e 6c79 6173 7365  and not onlyasse
+0001f710: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+0001f720: 7070 7269 6e74 2822 4465 706c 6f79 696e  pprint("Deployin
+0001f730: 6720 416e 7369 626c 6520 496e 7665 6e74  g Ansible Invent
+0001f740: 6f72 792e 2e2e 2229 0a20 2020 2020 2020  ory...").       
+0001f750: 2020 2020 2069 6e76 656e 746f 7279 6669       inventoryfi
+0001f760: 6c65 203d 2066 222f 746d 702f 7b70 6c61  le = f"/tmp/{pla
+0001f770: 6e7d 2e69 6e76 2e79 616d 6c22 2069 6620  n}.inv.yaml" if 
+0001f780: 7365 6c66 2e79 616d 6c69 6e76 656e 746f  self.yamlinvento
+0001f790: 7279 2065 6c73 6520 6622 2f74 6d70 2f7b  ry else f"/tmp/{
+0001f7a0: 706c 616e 7d2e 696e 7622 0a20 2020 2020  plan}.inv".     
+0001f7b0: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+0001f7c0: 682e 6578 6973 7473 2869 6e76 656e 746f  h.exists(invento
+0001f7d0: 7279 6669 6c65 293a 0a20 2020 2020 2020  ryfile):.       
+0001f7e0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+0001f7f0: 6622 496e 7665 6e74 6f72 7920 696e 207b  f"Inventory in {
+0001f800: 696e 7665 6e74 6f72 7966 696c 657d 2073  inventoryfile} s
+0001f810: 6b69 7070 6564 2122 290a 2020 2020 2020  kipped!").      
+0001f820: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001f830: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+0001f840: 6e74 2866 2243 7265 6174 696e 6720 616e  nt(f"Creating an
+0001f850: 7369 626c 6520 696e 7665 6e74 6f72 7920  sible inventory 
+0001f860: 666f 7220 706c 616e 207b 706c 616e 7d20  for plan {plan} 
+0001f870: 696e 207b 696e 7665 6e74 6f72 7966 696c  in {inventoryfil
+0001f880: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+0001f890: 2020 2020 2076 6d73 203d 205b 5d0a 2020       vms = [].  
+0001f8a0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001f8b0: 7220 766d 2069 6e20 736f 7274 6564 286b  r vm in sorted(k
+0001f8c0: 2e6c 6973 7428 292c 206b 6579 3d6c 616d  .list(), key=lam
+0001f8d0: 6264 6120 783a 2078 5b27 6e61 6d65 275d  bda x: x['name']
+0001f8e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001f8f0: 2020 2020 2020 206e 616d 6520 3d20 766d         name = vm
+0001f900: 5b27 6e61 6d65 275d 0a20 2020 2020 2020  ['name'].       
+0001f910: 2020 2020 2020 2020 2020 2020 2064 6573               des
+0001f920: 6372 6970 7469 6f6e 203d 2076 6d5b 2770  cription = vm['p
+0001f930: 6c61 6e27 5d0a 2020 2020 2020 2020 2020  lan'].          
+0001f940: 2020 2020 2020 2020 2020 6966 2064 6573            if des
+0001f950: 6372 6970 7469 6f6e 203d 3d20 706c 616e  cription == plan
+0001f960: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001f970: 2020 2020 2020 2020 2020 766d 732e 6170            vms.ap
+0001f980: 7065 6e64 286e 616d 6529 0a20 2020 2020  pend(name).     
+0001f990: 2020 2020 2020 2020 2020 2061 6e73 6962             ansib
+0001f9a0: 6c65 7574 696c 732e 6d61 6b65 5f70 6c61  leutils.make_pla
+0001f9b0: 6e5f 696e 7665 6e74 6f72 7928 766d 735f  n_inventory(vms_
+0001f9c0: 746f 5f68 6f73 742c 2070 6c61 6e2c 2076  to_host, plan, v
+0001f9d0: 6d73 2c20 7961 6d6c 696e 7665 6e74 6f72  ms, yamlinventor
+0001f9e0: 793d 7365 6c66 2e79 616d 6c69 6e76 656e  y=self.yamlinven
+0001f9f0: 746f 7279 2c0a 2020 2020 2020 2020 2020  tory,.          
+0001fa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa20: 2020 2020 2020 2069 6e73 6563 7572 653d         insecure=
+0001fa30: 7365 6c66 2e69 6e73 6563 7572 6529 0a20  self.insecure). 
+0001fa40: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001fa50: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+0001fa60: 2027 7375 6363 6573 7327 2c20 2770 6c61   'success', 'pla
+0001fa70: 6e27 3a20 706c 616e 7d0a 2020 2020 2020  n': plan}.      
+0001fa80: 2020 6966 206c 6273 2061 6e64 206e 6f74    if lbs and not
+0001fa90: 206f 6e6c 7961 7373 6574 733a 0a20 2020   onlyassets:.   
+0001faa0: 2020 2020 2020 2020 2064 6e73 636c 6965           dnsclie
+0001fab0: 6e74 7320 3d20 7b7d 0a20 2020 2020 2020  nts = {}.       
+0001fac0: 2020 2020 2070 7072 696e 7428 2244 6570       pprint("Dep
+0001fad0: 6c6f 7969 6e67 204c 6f61 6462 616c 616e  loying Loadbalan
+0001fae0: 6365 7273 2e2e 2e22 290a 2020 2020 2020  cers...").      
+0001faf0: 2020 2020 2020 666f 7220 696e 6465 782c        for index,
+0001fb00: 206c 6265 6e74 7279 2069 6e20 656e 756d   lbentry in enum
+0001fb10: 6572 6174 6528 6c62 7329 3a0a 2020 2020  erate(lbs):.    
+0001fb20: 2020 2020 2020 2020 2020 2020 6465 7461              deta
+0001fb30: 696c 7320 3d20 656e 7472 6965 735b 6c62  ils = entries[lb
+0001fb40: 656e 7472 795d 0a20 2020 2020 2020 2020  entry].         
+0001fb50: 2020 2020 2020 2070 6f72 7473 203d 2064         ports = d
+0001fb60: 6574 6169 6c73 2e67 6574 2827 706f 7274  etails.get('port
+0001fb70: 7327 2c20 5b5d 290a 2020 2020 2020 2020  s', []).        
+0001fb80: 2020 2020 2020 2020 6966 206e 6f74 2070          if not p
+0001fb90: 6f72 7473 3a0a 2020 2020 2020 2020 2020  orts:.          
+0001fba0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+0001fbb0: 224d 6973 7369 6e67 2050 6f72 7473 2066  "Missing Ports f
+0001fbc0: 6f72 206c 6f61 6462 616c 616e 6365 722e  or loadbalancer.
+0001fbd0: 204e 6f74 2063 7265 6174 696e 6720 6974   Not creating it
+0001fbe0: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+0001fbf0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001fc00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fc10: 2063 6865 636b 7061 7468 203d 2064 6574   checkpath = det
+0001fc20: 6169 6c73 2e67 6574 2827 6368 6563 6b70  ails.get('checkp
+0001fc30: 6174 6827 2c20 272f 2729 0a20 2020 2020  ath', '/').     
+0001fc40: 2020 2020 2020 2020 2020 2063 6865 636b             check
+0001fc50: 706f 7274 203d 2064 6574 6169 6c73 2e67  port = details.g
+0001fc60: 6574 2827 6368 6563 6b70 6f72 7427 2c20  et('checkport', 
+0001fc70: 3830 290a 2020 2020 2020 2020 2020 2020  80).            
+0001fc80: 2020 2020 616c 6961 7320 3d20 6465 7461      alias = deta
+0001fc90: 696c 732e 6765 7428 2761 6c69 6173 272c  ils.get('alias',
+0001fca0: 205b 5d29 0a20 2020 2020 2020 2020 2020   []).           
+0001fcb0: 2020 2020 2064 6f6d 6169 6e20 3d20 6465       domain = de
+0001fcc0: 7461 696c 732e 6765 7428 2764 6f6d 6169  tails.get('domai
+0001fcd0: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
+0001fce0: 2020 2020 646e 7363 6c69 656e 7420 3d20      dnsclient = 
+0001fcf0: 6465 7461 696c 732e 6765 7428 2764 6e73  details.get('dns
+0001fd00: 636c 6965 6e74 272c 206f 7665 7272 6964  client', overrid
+0001fd10: 6573 2e67 6574 2827 646e 7363 6c69 656e  es.get('dnsclien
+0001fd20: 7427 2929 0a20 2020 2020 2020 2020 2020  t')).           
+0001fd30: 2020 2020 206c 6276 6d73 203d 2064 6574       lbvms = det
+0001fd40: 6169 6c73 2e67 6574 2827 766d 7327 2c20  ails.get('vms', 
+0001fd50: 5b5d 290a 2020 2020 2020 2020 2020 2020  []).            
+0001fd60: 2020 2020 6c62 6e65 7473 203d 2064 6574      lbnets = det
+0001fd70: 6169 6c73 2e67 6574 2827 6e65 7473 272c  ails.get('nets',
+0001fd80: 205b 2764 6566 6175 6c74 275d 290a 2020   ['default']).  
+0001fd90: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0001fda0: 7465 726e 616c 203d 2064 6574 6169 6c73  ternal = details
+0001fdb0: 2e67 6574 2827 696e 7465 726e 616c 2729  .get('internal')
+0001fdc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fdd0: 2073 7562 6e65 7469 6420 3d20 6465 7461   subnetid = deta
+0001fde0: 696c 732e 6765 7428 2773 7562 6e65 7469  ils.get('subneti
+0001fdf0: 6427 290a 2020 2020 2020 2020 2020 2020  d').            
+0001fe00: 2020 2020 6970 203d 2064 6574 6169 6c73      ip = details
+0001fe10: 2e67 6574 2827 6970 2729 0a20 2020 2020  .get('ip').     
+0001fe20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001fe30: 6372 6561 7465 5f6c 6f61 6462 616c 616e  create_loadbalan
+0001fe40: 6365 7228 6c62 656e 7472 792c 206e 6574  cer(lbentry, net
+0001fe50: 733d 6c62 6e65 7473 2c20 706f 7274 733d  s=lbnets, ports=
+0001fe60: 706f 7274 732c 2063 6865 636b 7061 7468  ports, checkpath
+0001fe70: 3d63 6865 636b 7061 7468 2c20 766d 733d  =checkpath, vms=
+0001fe80: 6c62 766d 732c 0a20 2020 2020 2020 2020  lbvms,.         
+0001fe90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001feb0: 646f 6d61 696e 3d64 6f6d 6169 6e2c 2070  domain=domain, p
+0001fec0: 6c61 6e3d 706c 616e 2c20 6368 6563 6b70  lan=plan, checkp
+0001fed0: 6f72 743d 6368 6563 6b70 6f72 742c 2061  ort=checkport, a
+0001fee0: 6c69 6173 3d61 6c69 6173 2c0a 2020 2020  lias=alias,.    
+0001fef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff10: 2020 2020 2069 6e74 6572 6e61 6c3d 696e       internal=in
+0001ff20: 7465 726e 616c 2c20 646e 7363 6c69 656e  ternal, dnsclien
+0001ff30: 743d 646e 7363 6c69 656e 742c 2073 7562  t=dnsclient, sub
+0001ff40: 6e65 7469 643d 7375 626e 6574 6964 2c20  netid=subnetid, 
+0001ff50: 6970 3d69 7029 0a20 2020 2020 2020 2069  ip=ip).        i
+0001ff60: 6620 7367 7320 616e 6420 6e6f 7420 6f6e  f sgs and not on
+0001ff70: 6c79 6173 7365 7473 3a0a 2020 2020 2020  lyassets:.      
+0001ff80: 2020 2020 2020 7070 7269 6e74 2822 4465        pprint("De
+0001ff90: 706c 6f79 696e 6720 5365 6375 7269 7479  ploying Security
+0001ffa0: 4772 6f75 7073 2e2e 2e22 290a 2020 2020  Groups...").    
+0001ffb0: 2020 2020 2020 2020 666f 7220 7367 2069          for sg i
+0001ffc0: 6e20 7367 733a 0a20 2020 2020 2020 2020  n sgs:.         
+0001ffd0: 2020 2020 2020 2064 6574 6169 6c73 203d         details =
+0001ffe0: 2065 6e74 7269 6573 5b73 675d 0a20 2020   entries[sg].   
+0001fff0: 2020 2020 2020 2020 2020 2020 206e 616d               nam
+00020000: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00020010: 2020 706f 7274 7320 3d20 6465 7461 696c    ports = detail
+00020020: 732e 6765 7428 2770 6f72 7473 272c 205b  s.get('ports', [
+00020030: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00020040: 2020 2069 6620 6e6f 7420 706f 7274 733a     if not ports:
+00020050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020060: 2020 2020 2065 7272 6f72 2822 4d69 7373       error("Miss
+00020070: 696e 6720 506f 7274 7320 666f 7220 7367  ing Ports for sg
+00020080: 732e 204e 6f74 2063 7265 6174 696e 6720  s. Not creating 
+00020090: 6974 2e2e 2e22 290a 2020 2020 2020 2020  it...").        
+000200a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000200b0: 726e 0a20 2020 2020 2020 2020 2020 2020  rn.             
+000200c0: 2020 2073 656c 662e 6372 6561 7465 5f73     self.create_s
+000200d0: 6563 7572 6974 795f 6772 6f75 7028 7367  ecurity_group(sg
+000200e0: 2c20 7b27 706f 7274 7327 3a20 706f 7274  , {'ports': port
+000200f0: 737d 290a 2020 2020 2020 2020 6966 2077  s}).        if w
+00020100: 6f72 6b66 6c6f 7765 6e74 7269 6573 2061  orkflowentries a
+00020110: 6e64 206e 6f74 206f 6e6c 7961 7373 6574  nd not onlyasset
+00020120: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
+00020130: 7072 696e 7428 2244 6570 6c6f 7969 6e67  print("Deploying
+00020140: 2057 6f72 6b66 6c6f 7720 456e 7472 6965   Workflow Entrie
+00020150: 732e 2e2e 2229 0a20 2020 2020 2020 2020  s...").         
+00020160: 2020 2066 6f72 2077 6f72 6b66 6c6f 7720     for workflow 
+00020170: 696e 2077 6f72 6b66 6c6f 7765 6e74 7269  in workflowentri
+00020180: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00020190: 2020 2020 776f 726b 666c 6f77 5f6f 7665      workflow_ove
+000201a0: 7272 6964 6573 203d 206f 7665 7272 6964  rrides = overrid
+000201b0: 6573 2e63 6f70 7928 290a 2020 2020 2020  es.copy().      
+000201c0: 2020 2020 2020 2020 2020 776f 726b 666c            workfl
+000201d0: 6f77 5f6f 7665 7272 6964 6573 2e75 7064  ow_overrides.upd
+000201e0: 6174 6528 656e 7472 6965 735b 776f 726b  ate(entries[work
+000201f0: 666c 6f77 5d29 0a20 2020 2020 2020 2020  flow]).         
+00020200: 2020 2020 2020 2073 656c 662e 6372 6561         self.crea
+00020210: 7465 5f77 6f72 6b66 6c6f 7728 776f 726b  te_workflow(work
+00020220: 666c 6f77 2c20 6f76 6572 7269 6465 733d  flow, overrides=
+00020230: 776f 726b 666c 6f77 5f6f 7665 7272 6964  workflow_overrid
+00020240: 6573 290a 2020 2020 2020 2020 7265 7475  es).        retu
+00020250: 726e 6461 7461 203d 207b 2772 6573 756c  rndata = {'resul
+00020260: 7427 3a20 2773 7563 6365 7373 272c 2027  t': 'success', '
+00020270: 706c 616e 273a 2070 6c61 6e7d 0a20 2020  plan': plan}.   
+00020280: 2020 2020 2072 6574 7572 6e64 6174 615b       returndata[
+00020290: 276e 6577 766d 7327 5d20 3d20 6e65 7776  'newvms'] = newv
+000202a0: 6d73 2069 6620 6e65 7776 6d73 2065 6c73  ms if newvms els
+000202b0: 6520 5b5d 0a20 2020 2020 2020 2072 6574  e [].        ret
+000202c0: 7572 6e64 6174 615b 2765 7869 7374 696e  urndata['existin
+000202d0: 6776 6d73 275d 203d 2065 7869 7374 696e  gvms'] = existin
+000202e0: 6776 6d73 2069 6620 6578 6973 7469 6e67  gvms if existing
+000202f0: 766d 7320 656c 7365 205b 5d0a 2020 2020  vms else [].    
+00020300: 2020 2020 7265 7475 726e 6461 7461 5b27      returndata['
+00020310: 6661 696c 6564 766d 7327 5d20 3d20 6661  failedvms'] = fa
+00020320: 696c 6564 766d 7320 6966 2066 6169 6c65  iledvms if faile
+00020330: 6476 6d73 2065 6c73 6520 5b5d 0a20 2020  dvms else [].   
+00020340: 2020 2020 2072 6574 7572 6e64 6174 615b       returndata[
+00020350: 2761 7373 6574 7327 5d20 3d20 6e65 7761  'assets'] = newa
+00020360: 7373 6574 7320 6966 206e 6577 6173 7365  ssets if newasse
+00020370: 7473 2065 6c73 6520 5b5d 0a20 2020 2020  ts else [].     
+00020380: 2020 2069 6620 6661 696c 6564 766d 733a     if failedvms:
+00020390: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000203a0: 7572 6e64 6174 615b 2772 6573 756c 7427  urndata['result'
+000203b0: 5d20 3d20 2766 6169 6c75 7265 270a 2020  ] = 'failure'.  
+000203c0: 2020 2020 2020 2020 2020 6661 696c 6564            failed
+000203d0: 6e61 6d65 7320 3d20 272c 272e 6a6f 696e  names = ','.join
+000203e0: 285b 765b 276e 616d 6527 5d20 666f 7220  ([v['name'] for 
+000203f0: 7620 696e 2066 6169 6c65 6476 6d73 5d29  v in failedvms])
+00020400: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00020410: 7572 6e64 6174 615b 2772 6561 736f 6e27  urndata['reason'
+00020420: 5d20 3d20 6627 5468 6520 666f 6c6c 6f77  ] = f'The follow
+00020430: 696e 6720 766d 7320 6661 696c 6564 3a20  ing vms failed: 
+00020440: 7b66 6169 6c65 646e 616d 6573 7d27 0a20  {failednames}'. 
+00020450: 2020 2020 2020 2069 6620 6765 7462 6163         if getbac
+00020460: 6b20 6f72 2074 6f63 6c65 616e 3a0a 2020  k or toclean:.  
+00020470: 2020 2020 2020 2020 2020 6f73 2e63 6864            os.chd
+00020480: 6972 2827 2e2e 2729 0a20 2020 2020 2020  ir('..').       
+00020490: 2069 6620 746f 636c 6561 6e3a 0a20 2020   if toclean:.   
+000204a0: 2020 2020 2020 2020 2072 6d74 7265 6528           rmtree(
+000204b0: 7061 7468 290a 2020 2020 2020 2020 6966  path).        if
+000204c0: 2069 6e70 7574 7374 7269 6e67 2069 7320   inputstring is 
+000204d0: 6e6f 7420 4e6f 6e65 2061 6e64 206f 732e  not None and os.
+000204e0: 7061 7468 2e65 7869 7374 7328 6622 7465  path.exists(f"te
+000204f0: 6d70 5f70 6c61 6e5f 7b70 6c61 6e7d 2e79  mp_plan_{plan}.y
+00020500: 6d6c 2229 3a0a 2020 2020 2020 2020 2020  ml"):.          
+00020510: 2020 6f73 2e72 656d 6f76 6528 6622 7465    os.remove(f"te
+00020520: 6d70 5f70 6c61 6e5f 7b70 6c61 6e7d 2e79  mp_plan_{plan}.y
+00020530: 6d6c 2229 0a20 2020 2020 2020 2066 6f72  ml").        for
+00020540: 2065 6e74 7279 2069 6e20 6173 796e 6377   entry in asyncw
+00020550: 6169 7476 6d73 3a0a 2020 2020 2020 2020  aitvms:.        
+00020560: 2020 2020 6e61 6d65 2c20 6669 6e69 7368      name, finish
+00020570: 6669 6c65 7320 3d20 656e 7472 795b 276e  files = entry['n
+00020580: 616d 6527 5d2c 2065 6e74 7279 5b27 6669  ame'], entry['fi
+00020590: 6e69 7368 6669 6c65 7327 5d0a 2020 2020  nishfiles'].    
+000205a0: 2020 2020 2020 2020 7761 6974 636f 6d6d          waitcomm
+000205b0: 616e 642c 2077 6169 7474 696d 656f 7574  and, waittimeout
+000205c0: 203d 2065 6e74 7279 5b27 7761 6974 636f   = entry['waitco
+000205d0: 6d6d 616e 6427 5d2c 2065 6e74 7279 5b27  mmand'], entry['
+000205e0: 7761 6974 7469 6d65 6f75 7427 5d0a 2020  waittimeout'].  
+000205f0: 2020 2020 2020 2020 2020 766d 636c 6965            vmclie
+00020600: 6e74 203d 2065 6e74 7279 5b27 766d 636c  nt = entry['vmcl
+00020610: 6965 6e74 275d 0a20 2020 2020 2020 2020  ient'].         
+00020620: 2020 2073 656c 662e 7761 6974 5f66 696e     self.wait_fin
+00020630: 6973 6828 6e61 6d65 2c20 7761 6974 636f  ish(name, waitco
+00020640: 6d6d 616e 643d 7761 6974 636f 6d6d 616e  mmand=waitcomman
+00020650: 642c 2077 6169 7474 696d 656f 7574 3d77  d, waittimeout=w
+00020660: 6169 7474 696d 656f 7574 2c20 766d 636c  aittimeout, vmcl
+00020670: 6965 6e74 3d76 6d63 6c69 656e 7429 0a20  ient=vmclient). 
+00020680: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+00020690: 6e69 7368 6669 6c65 733a 0a20 2020 2020  nishfiles:.     
+000206a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000206b0: 6861 6e64 6c65 5f66 696e 6973 6866 696c  handle_finishfil
+000206c0: 6573 286e 616d 652c 2066 696e 6973 6866  es(name, finishf
+000206d0: 696c 6573 2c20 766d 636c 6965 6e74 3d76  iles, vmclient=v
+000206e0: 6d63 6c69 656e 7429 0a20 2020 2020 2020  mclient).       
+000206f0: 2070 6f73 745f 7363 7269 7074 203d 2066   post_script = f
+00020700: 277b 696e 7075 7464 6972 7d2f 6b63 6c69  '{inputdir}/kcli
+00020710: 5f70 6f73 742e 7368 270a 2020 2020 2020  _post.sh'.      
+00020720: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
+00020730: 7374 7328 706f 7374 5f73 6372 6970 7429  sts(post_script)
+00020740: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00020750: 2070 6f73 743a 0a20 2020 2020 2020 2020   post:.         
+00020760: 2020 2020 2020 2070 7072 696e 7428 2252         pprint("R
+00020770: 756e 6e69 6e67 206b 636c 695f 706f 7374  unning kcli_post
+00020780: 2e73 6822 290a 2020 2020 2020 2020 2020  .sh").          
+00020790: 2020 2020 2020 7769 7468 2054 656d 706f        with Tempo
+000207a0: 7261 7279 4469 7265 6374 6f72 7928 2920  raryDirectory() 
+000207b0: 6173 2074 6d70 6469 723a 0a20 2020 2020  as tmpdir:.     
+000207c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000207d0: 6f73 745f 7363 7269 7074 203d 2073 656c  ost_script = sel
+000207e0: 662e 7072 6f63 6573 735f 696e 7075 7466  f.process_inputf
+000207f0: 696c 6528 2778 7878 272c 2070 6f73 745f  ile('xxx', post_
+00020800: 7363 7269 7074 2c20 6f76 6572 7269 6465  script, override
+00020810: 733d 6f76 6572 7269 6465 7329 0a20 2020  s=overrides).   
+00020820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020830: 2077 6974 6820 6f70 656e 2866 227b 746d   with open(f"{tm
+00020840: 7064 6972 7d2f 706f 7374 2e73 6822 2c20  pdir}/post.sh", 
+00020850: 2777 2729 2061 7320 663a 0a20 2020 2020  'w') as f:.     
+00020860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020870: 2020 2066 2e77 7269 7465 2870 6f73 745f     f.write(post_
+00020880: 7363 7269 7074 290a 2020 2020 2020 2020  script).        
+00020890: 2020 2020 2020 2020 2020 2020 706f 7374              post
+000208a0: 5f72 756e 203d 2072 756e 2866 2762 6173  _run = run(f'bas
+000208b0: 6820 7b74 6d70 6469 727d 2f70 6f73 742e  h {tmpdir}/post.
+000208c0: 7368 272c 2073 6865 6c6c 3d54 7275 652c  sh', shell=True,
+000208d0: 2073 7464 6f75 743d 5049 5045 2c20 7374   stdout=PIPE, st
+000208e0: 6465 7272 3d53 5444 4f55 542c 0a20 2020  derr=STDOUT,.   
+000208f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020910: 756e 6976 6572 7361 6c5f 6e65 776c 696e  universal_newlin
+00020920: 6573 3d54 7275 6529 0a20 2020 2020 2020  es=True).       
+00020930: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00020940: 706f 7374 5f72 756e 2e72 6574 7572 6e63  post_run.returnc
+00020950: 6f64 6520 213d 2030 3a0a 2020 2020 2020  ode != 0:.      
+00020960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020970: 2020 6d73 6720 3d20 6622 4973 7375 6520    msg = f"Issue 
+00020980: 7768 656e 2072 756e 6e69 6e67 206b 636c  when running kcl
+00020990: 695f 706f 7374 2e73 6820 3a5c 6e7b 706f  i_post.sh :\n{po
+000209a0: 7374 5f72 756e 2e73 7464 6f75 747d 220a  st_run.stdout}".
+000209b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000209c0: 2020 2020 2020 2020 6572 726f 7228 6d73          error(ms
+000209d0: 6729 0a20 2020 2020 2020 2020 2020 2020  g).             
+000209e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000209f0: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
+00020a00: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
+00020a10: 3a20 6d73 677d 0a20 2020 2020 2020 2020  : msg}.         
+00020a20: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00020a30: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+00020a40: 2822 536b 6970 7069 6e67 206b 636c 695f  ("Skipping kcli_
+00020a50: 706f 7374 2e73 6820 6173 2072 6571 7565  post.sh as reque
+00020a60: 7374 6564 2229 0a20 2020 2020 2020 2069  sted").        i
+00020a70: 6620 6f76 6572 7269 6465 732e 6765 7428  f overrides.get(
+00020a80: 2774 656d 706b 6579 6469 7227 2920 6973  'tempkeydir') is
+00020a90: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00020aa0: 2020 2020 2020 206f 7665 7272 6964 6573         overrides
+00020ab0: 2e67 6574 2827 7465 6d70 6b65 7964 6972  .get('tempkeydir
+00020ac0: 2729 2e63 6c65 616e 7570 2829 0a20 2020  ').cleanup().   
+00020ad0: 2020 2020 2072 6574 7572 6e20 7265 7475       return retu
+00020ae0: 726e 6461 7461 0a0a 2020 2020 6465 6620  rndata..    def 
+00020af0: 6861 6e64 6c65 5f68 6f73 7428 7365 6c66  handle_host(self
+00020b00: 2c20 706f 6f6c 3d4e 6f6e 652c 2069 6d61  , pool=None, ima
+00020b10: 6765 3d4e 6f6e 652c 2073 7769 7463 683d  ge=None, switch=
+00020b20: 4e6f 6e65 2c20 646f 776e 6c6f 6164 3d46  None, download=F
+00020b30: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00020b40: 2020 2020 2020 2020 2020 7572 6c3d 4e6f            url=No
+00020b50: 6e65 2c20 636d 643d 4e6f 6e65 2c20 7379  ne, cmd=None, sy
+00020b60: 6e63 3d46 616c 7365 2c20 7369 7a65 3d4e  nc=False, size=N
+00020b70: 6f6e 652c 2061 7263 683d 2778 3836 5f36  one, arch='x86_6
+00020b80: 3427 2c0a 2020 2020 2020 2020 2020 2020  4',.            
+00020b90: 2020 2020 2020 2020 6b76 6d5f 6f70 656e          kvm_open
+00020ba0: 7374 6163 6b3d 5472 7565 2c20 7268 636f  stack=True, rhco
+00020bb0: 735f 636f 6d6d 6974 3d4e 6f6e 652c 2072  s_commit=None, r
+00020bc0: 6863 6f73 5f69 6e73 7461 6c6c 6572 3d46  hcos_installer=F
+00020bd0: 616c 7365 293a 0a20 2020 2020 2020 2069  alse):.        i
+00020be0: 6620 646f 776e 6c6f 6164 3a0a 2020 2020  f download:.    
+00020bf0: 2020 2020 2020 2020 6b20 3d20 7365 6c66          k = self
+00020c00: 2e6b 0a20 2020 2020 2020 2020 2020 2069  .k.            i
+00020c10: 6620 706f 6f6c 2069 7320 4e6f 6e65 3a0a  f pool is None:.
+00020c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020c30: 706f 6f6c 203d 2073 656c 662e 706f 6f6c  pool = self.pool
+00020c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020c50: 2070 7072 696e 7428 6622 5573 696e 6720   pprint(f"Using 
+00020c60: 706f 6f6c 207b 706f 6f6c 7d22 290a 2020  pool {pool}").  
+00020c70: 2020 2020 2020 2020 2020 6966 2069 6d61            if ima
+00020c80: 6765 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ge is not None:.
+00020c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ca0: 6966 2075 726c 2069 7320 4e6f 6e65 3a0a  if url is None:.
+00020cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020cc0: 2020 2020 6966 2061 7263 6820 213d 2027      if arch != '
+00020cd0: 7838 365f 3634 273a 0a20 2020 2020 2020  x86_64':.       
+00020ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020cf0: 2049 4d41 4745 532e 7570 6461 7465 287b   IMAGES.update({
+00020d00: 693a 2049 4d41 4745 535b 695d 2e72 6570  i: IMAGES[i].rep
+00020d10: 6c61 6365 2827 7838 365f 3634 272c 2061  lace('x86_64', a
+00020d20: 7263 6829 2e72 6570 6c61 6365 2827 616d  rch).replace('am
+00020d30: 6436 3427 2c20 6172 6368 290a 2020 2020  d64', arch).    
 00020d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d50: 2020 2020 2020 2020 206f 732e 656e 7669           os.envi
-00020d60: 726f 6e5b 2750 4154 4827 5d20 2b3d 2066  ron['PATH'] += f
-00020d70: 273a 7b6f 732e 6765 7463 7764 2829 7d27  ':{os.getcwd()}'
-00020d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020d90: 2020 2020 2020 2020 2020 2020 2075 726c               url
-00020da0: 203d 2063 6f6d 6d6f 6e2e 6765 745f 696e   = common.get_in
-00020db0: 7374 616c 6c65 725f 7268 636f 7328 5f74  staller_rhcos(_t
-00020dc0: 7970 653d 696d 6167 655f 7479 7065 2c20  ype=image_type, 
-00020dd0: 6172 6368 3d61 7263 6829 0a20 2020 2020  arch=arch).     
-00020de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020df0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00020e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e10: 2020 2020 2069 6620 6172 6368 2021 3d20       if arch != 
-00020e20: 2778 3836 5f36 3427 3a0a 2020 2020 2020  'x86_64':.      
-00020e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e40: 2020 2020 2020 2020 2020 7572 6c20 2b3d            url +=
-00020e50: 2066 272d 7b61 7263 687d 270a 2020 2020   f'-{arch}'.    
-00020e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e70: 2020 2020 2020 2020 7572 6c20 3d20 636f          url = co
-00020e80: 6d6d 6f6e 2e67 6574 5f6c 6174 6573 745f  mmon.get_latest_
-00020e90: 7268 636f 7328 7572 6c2c 205f 7479 7065  rhcos(url, _type
-00020ea0: 3d69 6d61 6765 5f74 7970 652c 2061 7263  =image_type, arc
-00020eb0: 683d 6172 6368 290a 2020 2020 2020 2020  h=arch).        
-00020ec0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-00020ed0: 6663 6f73 2720 696e 2069 6d61 6765 3a0a  fcos' in image:.
-00020ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ef0: 2020 2020 2020 2020 7572 6c20 3d20 636f          url = co
-00020f00: 6d6d 6f6e 2e67 6574 5f6c 6174 6573 745f  mmon.get_latest_
-00020f10: 6663 6f73 2875 726c 2c20 5f74 7970 653d  fcos(url, _type=
-00020f20: 696d 6167 655f 7479 7065 290a 2020 2020  image_type).    
+00020d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d60: 2020 2066 6f72 2069 2069 6e20 494d 4147     for i in IMAG
+00020d70: 4553 7d29 0a20 2020 2020 2020 2020 2020  ES}).           
+00020d80: 2020 2020 2020 2020 2069 6620 696d 6167           if imag
+00020d90: 6520 6e6f 7420 696e 2049 4d41 4745 533a  e not in IMAGES:
+00020da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020db0: 2020 2020 2020 2020 2065 7272 6f72 2866           error(f
+00020dc0: 2249 6d61 6765 207b 696d 6167 657d 2068  "Image {image} h
+00020dd0: 6173 206e 6f20 6173 736f 6369 6174 6564  as no associated
+00020de0: 2075 726c 2229 0a20 2020 2020 2020 2020   url").         
+00020df0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00020e00: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+00020e10: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
+00020e20: 736f 6e27 3a20 2249 6e63 6f72 7265 6374  son': "Incorrect
+00020e30: 2069 6d61 6765 227d 0a20 2020 2020 2020   image"}.       
+00020e40: 2020 2020 2020 2020 2020 2020 2075 726c               url
+00020e50: 203d 2049 4d41 4745 535b 696d 6167 655d   = IMAGES[image]
+00020e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020e70: 2020 2020 2069 6d61 6765 5f74 7970 6520       image_type 
+00020e80: 3d20 276f 7065 6e73 7461 636b 2720 6966  = 'openstack' if
+00020e90: 206b 766d 5f6f 7065 6e73 7461 636b 2061   kvm_openstack a
+00020ea0: 6e64 2073 656c 662e 7479 7065 203d 3d20  nd self.type == 
+00020eb0: 276b 766d 2720 656c 7365 2073 656c 662e  'kvm' else self.
+00020ec0: 7479 7065 0a20 2020 2020 2020 2020 2020  type.           
+00020ed0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00020ee0: 6b76 6d5f 6f70 656e 7374 6163 6b20 616e  kvm_openstack an
+00020ef0: 6420 7365 6c66 2e74 7970 6520 3d3d 2027  d self.type == '
+00020f00: 6b76 6d27 3a0a 2020 2020 2020 2020 2020  kvm':.          
+00020f10: 2020 2020 2020 2020 2020 2020 2020 696d                im
+00020f20: 6167 6520 2b3d 2022 2d71 656d 7522 0a20  age += "-qemu". 
 00020f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f40: 6966 2069 6d61 6765 203d 3d20 2766 6564  if image == 'fed
-00020f50: 6f72 616c 6174 6573 7427 3a0a 2020 2020  oralatest':.    
-00020f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f70: 2020 2020 7572 6c20 3d20 636f 6d6d 6f6e      url = common
-00020f80: 2e67 6574 5f6c 6174 6573 745f 6665 646f  .get_latest_fedo
-00020f90: 7261 2875 726c 290a 2020 2020 2020 2020  ra(url).        
-00020fa0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-00020fb0: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
-00020fc0: 6e61 6d65 2869 6d61 6765 290a 2020 2020  name(image).    
-00020fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020fe0: 6966 2069 6d61 6765 2e73 7461 7274 7377  if image.startsw
-00020ff0: 6974 6828 2772 6865 6c27 293a 0a20 2020  ith('rhel'):.   
-00021000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021010: 2020 2020 2069 6620 2777 6562 2720 696e       if 'web' in
-00021020: 2073 7973 2e61 7267 765b 305d 3a0a 2020   sys.argv[0]:.  
-00021030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021040: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00021050: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
-00021060: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
-00021070: 2022 4d69 7373 696e 6720 7572 6c22 7d0a   "Missing url"}.
+00020f40: 2020 2069 6620 2772 6863 6f73 2720 696e     if 'rhcos' in
+00020f50: 2069 6d61 6765 2061 6e64 206e 6f74 2069   image and not i
+00020f60: 6d61 6765 2e65 6e64 7377 6974 6828 2771  mage.endswith('q
+00020f70: 636f 7732 2e67 7a27 293a 0a20 2020 2020  cow2.gz'):.     
+00020f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f90: 2020 2069 6620 7268 636f 735f 636f 6d6d     if rhcos_comm
+00020fa0: 6974 2069 7320 6e6f 7420 4e6f 6e65 3a0a  it is not None:.
+00020fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020fc0: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
+00020fd0: 3d20 636f 6d6d 6f6e 2e67 6574 5f63 6f6d  = common.get_com
+00020fe0: 6d69 745f 7268 636f 7328 7268 636f 735f  mit_rhcos(rhcos_
+00020ff0: 636f 6d6d 6974 2c20 5f74 7970 653d 696d  commit, _type=im
+00021000: 6167 655f 7479 7065 290a 2020 2020 2020  age_type).      
+00021010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021020: 2020 656c 6966 2072 6863 6f73 5f69 6e73    elif rhcos_ins
+00021030: 7461 6c6c 6572 3a0a 2020 2020 2020 2020  taller:.        
+00021040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021050: 2020 2020 6f73 2e65 6e76 6972 6f6e 5b27      os.environ['
+00021060: 5041 5448 275d 202b 3d20 6627 3a7b 6f73  PATH'] += f':{os
+00021070: 2e67 6574 6377 6428 297d 270a 2020 2020  .getcwd()}'.    
 00021080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021090: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-000210a0: 224f 7065 6e69 6e67 2075 726c 207b 7572  "Opening url {ur
-000210b0: 6c7d 2066 6f72 2079 6f75 2074 6f20 6772  l} for you to gr
-000210c0: 6162 2063 6f6d 706c 6574 6520 7572 6c20  ab complete url 
-000210d0: 666f 7220 7b69 6d61 6765 7d20 6b76 6d20  for {image} kvm 
-000210e0: 6775 6573 7420 696d 6167 6522 290a 2020  guest image").  
-000210f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021100: 2020 2020 2020 7765 6262 726f 7773 6572        webbrowser
-00021110: 2e6f 7065 6e28 7572 6c2c 206e 6577 3d32  .open(url, new=2
-00021120: 2c20 6175 746f 7261 6973 653d 5472 7565  , autoraise=True
-00021130: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00021140: 2020 2020 2020 2020 2020 7572 6c20 3d20            url = 
-00021150: 696e 7075 7428 2243 6f70 7920 5572 6c3a  input("Copy Url:
-00021160: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
-00021170: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00021180: 7572 6c2e 7374 7269 7028 2920 3d3d 2027  url.strip() == '
-00021190: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-000211a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000211b0: 7272 6f72 2822 4d69 7373 696e 6720 7072  rror("Missing pr
-000211c0: 6f70 6572 2075 726c 2e4c 6561 7669 6e67  oper url.Leaving
-000211d0: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+00021090: 2020 2020 2020 2020 7572 6c20 3d20 636f          url = co
+000210a0: 6d6d 6f6e 2e67 6574 5f69 6e73 7461 6c6c  mmon.get_install
+000210b0: 6572 5f72 6863 6f73 285f 7479 7065 3d69  er_rhcos(_type=i
+000210c0: 6d61 6765 5f74 7970 652c 2061 7263 683d  mage_type, arch=
+000210d0: 6172 6368 290a 2020 2020 2020 2020 2020  arch).          
+000210e0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000210f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00021100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021110: 6966 2061 7263 6820 213d 2027 7838 365f  if arch != 'x86_
+00021120: 3634 273a 0a20 2020 2020 2020 2020 2020  64':.           
+00021130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021140: 2020 2020 2075 726c 202b 3d20 6627 2d7b       url += f'-{
+00021150: 6172 6368 7d27 0a20 2020 2020 2020 2020  arch}'.         
+00021160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021170: 2020 2075 726c 203d 2063 6f6d 6d6f 6e2e     url = common.
+00021180: 6765 745f 6c61 7465 7374 5f72 6863 6f73  get_latest_rhcos
+00021190: 2875 726c 2c20 5f74 7970 653d 696d 6167  (url, _type=imag
+000211a0: 655f 7479 7065 2c20 6172 6368 3d61 7263  e_type, arch=arc
+000211b0: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
+000211c0: 2020 2020 2020 2069 6620 2766 636f 7327         if 'fcos'
+000211d0: 2069 6e20 696d 6167 653a 0a20 2020 2020   in image:.     
 000211e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000211f0: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
-00021200: 7427 3a20 2766 6169 6c75 7265 272c 2027  t': 'failure', '
-00021210: 7265 6173 6f6e 273a 2022 4d69 7373 696e  reason': "Missin
-00021220: 6720 696d 6167 6522 7d0a 2020 2020 2020  g image"}.      
-00021230: 2020 2020 2020 2020 2020 6966 2063 6d64            if cmd
-00021240: 2069 7320 4e6f 6e65 2061 6e64 2069 6d61   is None and ima
-00021250: 6765 2021 3d20 2727 2061 6e64 2069 6d61  ge != '' and ima
-00021260: 6765 2069 6e20 494d 4147 4553 434f 4d4d  ge in IMAGESCOMM
-00021270: 414e 4453 3a0a 2020 2020 2020 2020 2020  ANDS:.          
-00021280: 2020 2020 2020 2020 2020 636d 6420 3d20            cmd = 
-00021290: 494d 4147 4553 434f 4d4d 414e 4453 5b69  IMAGESCOMMANDS[i
-000212a0: 6d61 6765 5d0a 2020 2020 2020 2020 2020  mage].          
-000212b0: 2020 2020 2020 7070 7269 6e74 2866 2247        pprint(f"G
-000212c0: 7261 6262 696e 6720 696d 6167 6520 7b69  rabbing image {i
-000212d0: 6d61 6765 7d20 6672 6f6d 2075 726c 207b  mage} from url {
-000212e0: 7572 6c7d 2229 0a20 2020 2020 2020 2020  url}").         
-000212f0: 2020 2020 2020 206e 6565 645f 6973 6f20         need_iso 
-00021300: 3d20 2761 7069 2f61 7373 6973 7465 642d  = 'api/assisted-
-00021310: 696d 6167 6573 2f69 6d61 6765 7327 2069  images/images' i
-00021320: 6e20 7572 6c0a 2020 2020 2020 2020 2020  n url.          
-00021330: 2020 2020 2020 7368 6f72 746e 616d 6520        shortname 
-00021340: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
-00021350: 6d65 2875 726c 292e 7370 6c69 7428 273f  me(url).split('?
-00021360: 2729 5b30 5d0a 2020 2020 2020 2020 2020  ')[0].          
-00021370: 2020 2020 2020 6966 206e 6565 645f 6973        if need_is
-00021380: 6f3a 0a20 2020 2020 2020 2020 2020 2020  o:.             
-00021390: 2020 2020 2020 2069 6d61 6765 203d 2066         image = f
-000213a0: 2762 6f6f 742d 7b73 686f 7274 6e61 6d65  'boot-{shortname
-000213b0: 7d2e 6973 6f27 0a20 2020 2020 2020 2020  }.iso'.         
-000213c0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-000213d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000213e0: 636f 6e76 6572 7420 3d20 272e 7261 772e  convert = '.raw.
-000213f0: 2720 696e 2075 726c 0a20 2020 2020 2020  ' in url.       
-00021400: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00021410: 756c 7420 3d20 6b2e 6164 645f 696d 6167  ult = k.add_imag
-00021420: 6528 7572 6c2c 2070 6f6f 6c2c 2063 6d64  e(url, pool, cmd
-00021430: 3d63 6d64 2c20 6e61 6d65 3d69 6d61 6765  =cmd, name=image
-00021440: 2c20 7369 7a65 3d73 697a 652c 2063 6f6e  , size=size, con
-00021450: 7665 7274 3d63 6f6e 7665 7274 290a 2020  vert=convert).  
-00021460: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00021470: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-00021480: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-00021490: 2020 2020 2020 2020 2065 7272 6f72 2866           error(f
-000214a0: 2247 6f74 207b 657d 2229 0a20 2020 2020  "Got {e}").     
-000214b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000214c0: 7272 6f72 2866 2250 6c65 6173 6520 7275  rror(f"Please ru
-000214d0: 6e20 6b63 6c69 2064 656c 6574 6520 696d  n kcli delete im
-000214e0: 6167 6520 2d2d 7965 7320 7b73 686f 7274  age --yes {short
-000214f0: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
-00021500: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00021510: 726e 207b 2772 6573 756c 7427 3a20 2766  rn {'result': 'f
-00021520: 6169 6c75 7265 272c 2027 7265 6173 6f6e  ailure', 'reason
-00021530: 273a 2022 5573 6572 2069 6e74 6572 7275  ': "User interru
-00021540: 7074 696f 6e22 7d0a 2020 2020 2020 2020  ption"}.        
-00021550: 2020 2020 2020 2020 666f 756e 6420 3d20          found = 
-00021560: 2766 6f75 6e64 2720 696e 2072 6573 756c  'found' in resul
-00021570: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-00021580: 2020 6966 2066 6f75 6e64 3a0a 2020 2020    if found:.    
-00021590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000215a0: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
-000215b0: 3a20 2773 7563 6365 7373 277d 0a20 2020  : 'success'}.   
-000215c0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-000215d0: 6d6f 6e2e 6861 6e64 6c65 5f72 6573 706f  mon.handle_respo
-000215e0: 6e73 6528 7265 7375 6c74 2c20 696d 6167  nse(result, imag
-000215f0: 652c 2065 6c65 6d65 6e74 3d27 496d 6167  e, element='Imag
-00021600: 6527 2c20 6163 7469 6f6e 3d27 4164 6465  e', action='Adde
-00021610: 6427 290a 2020 2020 2020 2020 2020 2020  d').            
-00021620: 2020 2020 6966 2072 6573 756c 745b 2772      if result['r
-00021630: 6573 756c 7427 5d20 213d 2027 7375 6363  esult'] != 'succ
-00021640: 6573 7327 3a0a 2020 2020 2020 2020 2020  ess':.          
-00021650: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00021660: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
-00021670: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
-00021680: 2072 6573 756c 745b 2772 6561 736f 6e27   result['reason'
-00021690: 5d7d 0a20 2020 2020 2020 2020 2020 2072  ]}.            r
-000216a0: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-000216b0: 2027 7375 6363 6573 7327 7d0a 2020 2020   'success'}.    
-000216c0: 2020 2020 656c 6966 2073 7769 7463 683a      elif switch:
-000216d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000216e0: 7377 6974 6368 206e 6f74 2069 6e20 7365  switch not in se
-000216f0: 6c66 2e63 6c69 656e 7473 3a0a 2020 2020  lf.clients:.    
-00021700: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00021710: 7228 6622 436c 6965 6e74 207b 7377 6974  r(f"Client {swit
-00021720: 6368 7d20 6e6f 7420 666f 756e 6420 696e  ch} not found in
-00021730: 2063 6f6e 6669 672e 4c65 6176 696e 672e   config.Leaving.
-00021740: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
-00021750: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
-00021760: 6573 756c 7427 3a20 2766 6169 6c75 7265  esult': 'failure
-00021770: 272c 2027 7265 6173 6f6e 273a 2066 2243  ', 'reason': f"C
-00021780: 6c69 656e 7420 7b73 7769 7463 687d 206e  lient {switch} n
-00021790: 6f74 2066 6f75 6e64 2069 6e20 636f 6e66  ot found in conf
-000217a0: 6967 227d 0a20 2020 2020 2020 2020 2020  ig"}.           
-000217b0: 2065 6e61 626c 6564 203d 2073 656c 662e   enabled = self.
-000217c0: 696e 695b 7377 6974 6368 5d2e 6765 7428  ini[switch].get(
-000217d0: 2765 6e61 626c 6564 272c 2054 7275 6529  'enabled', True)
-000217e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000217f0: 6e6f 7420 656e 6162 6c65 643a 0a20 2020  not enabled:.   
-00021800: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00021810: 6f72 2866 2243 6c69 656e 7420 7b73 7769  or(f"Client {swi
-00021820: 7463 687d 2069 7320 6469 7361 626c 6564  tch} is disabled
-00021830: 2e4c 6561 7669 6e67 2e2e 2e2e 2229 0a20  .Leaving...."). 
-00021840: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00021850: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-00021860: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
-00021870: 736f 6e27 3a20 6622 436c 6965 6e74 207b  son': f"Client {
-00021880: 7377 6974 6368 7d20 6973 2064 6973 6162  switch} is disab
-00021890: 6c65 6422 7d0a 2020 2020 2020 2020 2020  led"}.          
-000218a0: 2020 7070 7269 6e74 2866 2253 7769 7463    pprint(f"Switc
-000218b0: 6869 6e67 2074 6f20 636c 6965 6e74 207b  hing to client {
-000218c0: 7377 6974 6368 7d2e 2e2e 2229 0a20 2020  switch}...").   
-000218d0: 2020 2020 2020 2020 2069 6e69 6669 6c65           inifile
-000218e0: 203d 2022 2573 2f2e 6b63 6c69 2f63 6f6e   = "%s/.kcli/con
-000218f0: 6669 672e 796d 6c22 2025 206f 732e 656e  fig.yml" % os.en
-00021900: 7669 726f 6e2e 6765 7428 2748 4f4d 4527  viron.get('HOME'
-00021910: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00021920: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-00021930: 696e 6966 696c 6529 3a0a 2020 2020 2020  inifile):.      
-00021940: 2020 2020 2020 2020 2020 6e65 7769 6e69            newini
-00021950: 203d 2027 270a 2020 2020 2020 2020 2020   = ''.          
-00021960: 2020 2020 2020 666f 7220 6c69 6e65 2069        for line i
-00021970: 6e20 6f70 656e 2869 6e69 6669 6c65 292e  n open(inifile).
-00021980: 7265 6164 6c69 6e65 7328 293a 0a20 2020  readlines():.   
-00021990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000219a0: 2069 6620 2763 6c69 656e 7427 2069 6e20   if 'client' in 
-000219b0: 6c69 6e65 3a0a 2020 2020 2020 2020 2020  line:.          
-000219c0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-000219d0: 7769 6e69 202b 3d20 6622 2063 6c69 656e  wini += f" clien
-000219e0: 743a 207b 7377 6974 6368 7d5c 6e22 0a20  t: {switch}\n". 
-000219f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a00: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00021a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a20: 206e 6577 696e 6920 2b3d 206c 696e 650a   newini += line.
-00021a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a40: 6f70 656e 2869 6e69 6669 6c65 2c20 2777  open(inifile, 'w
-00021a50: 2729 2e77 7269 7465 286e 6577 696e 6929  ').write(newini)
-00021a60: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00021a70: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
-00021a80: 7375 6363 6573 7327 7d0a 2020 2020 2020  success'}.      
-00021a90: 2020 656c 6966 2073 796e 633a 0a20 2020    elif sync:.   
-00021aa0: 2020 2020 2020 2020 206b 203d 2073 656c           k = sel
-00021ab0: 662e 6b0a 2020 2020 2020 2020 2020 2020  f.k.            
-00021ac0: 6966 206e 6f74 2073 656c 662e 6578 7472  if not self.extr
-00021ad0: 6163 6c69 656e 7473 3a0a 2020 2020 2020  aclients:.      
-00021ae0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-00021af0: 6728 224e 6f74 6869 6e67 2074 6f20 646f  g("Nothing to do
-00021b00: 2e20 4c65 6176 696e 672e 2e2e 2229 0a20  . Leaving..."). 
-00021b10: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00021b20: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-00021b30: 2027 7375 6363 6573 7327 7d0a 2020 2020   'success'}.    
-00021b40: 2020 2020 2020 2020 666f 7220 636c 6920          for cli 
-00021b50: 696e 2073 656c 662e 6578 7472 6163 6c69  in self.extracli
-00021b60: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
-00021b70: 2020 2020 2020 6465 7374 203d 2073 656c        dest = sel
-00021b80: 662e 6578 7472 6163 6c69 656e 7473 5b63  f.extraclients[c
-00021b90: 6c69 5d0a 2020 2020 2020 2020 2020 2020  li].            
-00021ba0: 2020 2020 7070 7269 6e74 2866 2273 796e      pprint(f"syn
-00021bb0: 6369 6e67 2063 6c69 656e 7420 696d 6167  cing client imag
-00021bc0: 6573 2066 726f 6d20 7b73 656c 662e 636c  es from {self.cl
-00021bd0: 6965 6e74 7d20 746f 207b 636c 697d 2229  ient} to {cli}")
-00021be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021bf0: 2077 6172 6e69 6e67 2822 4e6f 7465 2072   warning("Note r
-00021c00: 6865 6c20 696d 6167 6573 2061 7265 2063  hel images are c
-00021c10: 7572 7265 6e74 6c79 206e 6f74 2073 796e  urrently not syn
-00021c20: 6365 6422 290a 2020 2020 2020 2020 2020  ced").          
-00021c30: 2020 666f 7220 766f 6c20 696e 206b 2e76    for vol in k.v
-00021c40: 6f6c 756d 6573 2829 3a0a 2020 2020 2020  olumes():.      
-00021c50: 2020 2020 2020 2020 2020 696d 6167 6520            image 
-00021c60: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
-00021c70: 6d65 2876 6f6c 290a 2020 2020 2020 2020  me(vol).        
-00021c80: 2020 2020 2020 2020 6966 2069 6d61 6765          if image
-00021c90: 2069 6e20 5b6f 732e 7061 7468 2e62 6173   in [os.path.bas
-00021ca0: 656e 616d 6528 7629 2066 6f72 2076 2069  ename(v) for v i
-00021cb0: 6e20 6465 7374 2e76 6f6c 756d 6573 2829  n dest.volumes()
-00021cc0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00021cd0: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
-00021ce0: 2249 676e 6f72 696e 6720 7b69 6d61 6765  "Ignoring {image
-00021cf0: 7d20 6173 2069 7427 7320 616c 7265 6164  } as it's alread
-00021d00: 7920 7468 6572 6522 290a 2020 2020 2020  y there").      
-00021d10: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00021d20: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-00021d30: 2020 2020 2020 2075 726c 203d 204e 6f6e         url = Non
-00021d40: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00021d50: 2020 666f 7220 6e20 696e 206c 6973 7428    for n in list(
-00021d60: 494d 4147 4553 2e76 616c 7565 7328 2929  IMAGES.values())
-00021d70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00021d80: 2020 2020 2020 6966 206e 2069 7320 4e6f        if n is No
-00021d90: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00021da0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00021db0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-00021dc0: 2020 2020 2020 2020 2065 6c69 6620 6e2e           elif n.
-00021dd0: 7370 6c69 7428 272f 2729 5b2d 315d 203d  split('/')[-1] =
-00021de0: 3d20 696d 6167 653a 0a20 2020 2020 2020  = image:.       
-00021df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021e00: 2075 726c 203d 206e 0a20 2020 2020 2020   url = n.       
-00021e10: 2020 2020 2020 2020 2069 6620 7572 6c20           if url 
-00021e20: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00021e30: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00021e40: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
-00021e50: 6661 696c 7572 6527 2c20 2772 6561 736f  failure', 'reaso
-00021e60: 6e27 3a20 2269 6d61 6765 206e 6f74 2069  n': "image not i
-00021e70: 6e20 6465 6661 756c 7420 6c69 7374 227d  n default list"}
-00021e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021e90: 2069 6620 696d 6167 652e 7374 6172 7473   if image.starts
-00021ea0: 7769 7468 2827 7268 656c 2729 3a0a 2020  with('rhel'):.  
-00021eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ec0: 2020 6966 2027 7765 6227 2069 6e20 7379    if 'web' in sy
-00021ed0: 732e 6172 6776 5b30 5d3a 0a20 2020 2020  s.argv[0]:.     
-00021ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ef0: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
-00021f00: 6c74 273a 2027 6661 696c 7572 6527 2c20  lt': 'failure', 
-00021f10: 2772 6561 736f 6e27 3a20 224d 6973 7369  'reason': "Missi
-00021f20: 6e67 2075 726c 227d 0a20 2020 2020 2020  ng url"}.       
-00021f30: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-00021f40: 696e 7428 6622 4f70 656e 696e 6720 7572  int(f"Opening ur
-00021f50: 6c20 7b75 726c 7d20 666f 7220 796f 7520  l {url} for you 
-00021f60: 746f 2067 7261 6220 636f 6d70 6c65 7465  to grab complete
-00021f70: 2075 726c 2066 6f72 207b 766f 6c7d 206b   url for {vol} k
-00021f80: 766d 2067 7565 7374 2069 6d61 6765 2229  vm guest image")
-00021f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021fa0: 2020 2020 2077 6562 6272 6f77 7365 722e       webbrowser.
-00021fb0: 6f70 656e 2875 726c 2c20 6e65 773d 322c  open(url, new=2,
-00021fc0: 2061 7574 6f72 6169 7365 3d54 7275 6529   autoraise=True)
-00021fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021fe0: 2020 2020 2075 726c 203d 2069 6e70 7574       url = input
-00021ff0: 2822 436f 7079 2055 726c 3a5c 6e22 290a  ("Copy Url:\n").
-00022000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022010: 2020 2020 6966 2075 726c 2e73 7472 6970      if url.strip
-00022020: 2829 203d 3d20 2727 3a0a 2020 2020 2020  () == '':.      
-00022030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022040: 2020 6572 726f 7228 224d 6973 7369 6e67    error("Missing
-00022050: 2070 726f 7065 7220 7572 6c2e 4c65 6176   proper url.Leav
-00022060: 696e 672e 2e2e 2229 0a20 2020 2020 2020  ing...").       
+000211f0: 2020 2075 726c 203d 2063 6f6d 6d6f 6e2e     url = common.
+00021200: 6765 745f 6c61 7465 7374 5f66 636f 7328  get_latest_fcos(
+00021210: 7572 6c2c 205f 7479 7065 3d69 6d61 6765  url, _type=image
+00021220: 5f74 7970 6529 0a20 2020 2020 2020 2020  _type).         
+00021230: 2020 2020 2020 2020 2020 2069 6620 696d             if im
+00021240: 6167 6520 3d3d 2027 6665 646f 7261 6c61  age == 'fedorala
+00021250: 7465 7374 273a 0a20 2020 2020 2020 2020  test':.         
+00021260: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00021270: 726c 203d 2063 6f6d 6d6f 6e2e 6765 745f  rl = common.get_
+00021280: 6c61 7465 7374 5f66 6564 6f72 6128 7572  latest_fedora(ur
+00021290: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
+000212a0: 2020 2020 2020 2069 6d61 6765 203d 206f         image = o
+000212b0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+000212c0: 696d 6167 6529 0a20 2020 2020 2020 2020  image).         
+000212d0: 2020 2020 2020 2020 2020 2069 6620 696d             if im
+000212e0: 6167 652e 7374 6172 7473 7769 7468 2827  age.startswith('
+000212f0: 7268 656c 2729 3a0a 2020 2020 2020 2020  rhel'):.        
+00021300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021310: 6966 2027 7765 6227 2069 6e20 7379 732e  if 'web' in sys.
+00021320: 6172 6776 5b30 5d3a 0a20 2020 2020 2020  argv[0]:.       
+00021330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021340: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+00021350: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
+00021360: 2c20 2772 6561 736f 6e27 3a20 224d 6973  , 'reason': "Mis
+00021370: 7369 6e67 2075 726c 227d 0a20 2020 2020  sing url"}.     
+00021380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021390: 2020 2070 7072 696e 7428 6622 4f70 656e     pprint(f"Open
+000213a0: 696e 6720 7572 6c20 7b75 726c 7d20 666f  ing url {url} fo
+000213b0: 7220 796f 7520 746f 2067 7261 6220 636f  r you to grab co
+000213c0: 6d70 6c65 7465 2075 726c 2066 6f72 207b  mplete url for {
+000213d0: 696d 6167 657d 206b 766d 2067 7565 7374  image} kvm guest
+000213e0: 2069 6d61 6765 2229 0a20 2020 2020 2020   image").       
+000213f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021400: 2077 6562 6272 6f77 7365 722e 6f70 656e   webbrowser.open
+00021410: 2875 726c 2c20 6e65 773d 322c 2061 7574  (url, new=2, aut
+00021420: 6f72 6169 7365 3d54 7275 6529 0a20 2020  oraise=True).   
+00021430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021440: 2020 2020 2075 726c 203d 2069 6e70 7574       url = input
+00021450: 2822 436f 7079 2055 726c 3a5c 6e22 290a  ("Copy Url:\n").
+00021460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021470: 2020 2020 2020 2020 6966 2075 726c 2e73          if url.s
+00021480: 7472 6970 2829 203d 3d20 2727 3a0a 2020  trip() == '':.  
+00021490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000214a0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+000214b0: 224d 6973 7369 6e67 2070 726f 7065 7220  "Missing proper 
+000214c0: 7572 6c2e 4c65 6176 696e 672e 2e2e 2229  url.Leaving...")
+000214d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000214e0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000214f0: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
+00021500: 6661 696c 7572 6527 2c20 2772 6561 736f  failure', 'reaso
+00021510: 6e27 3a20 224d 6973 7369 6e67 2069 6d61  n': "Missing ima
+00021520: 6765 227d 0a20 2020 2020 2020 2020 2020  ge"}.           
+00021530: 2020 2020 2069 6620 636d 6420 6973 204e       if cmd is N
+00021540: 6f6e 6520 616e 6420 696d 6167 6520 213d  one and image !=
+00021550: 2027 2720 616e 6420 696d 6167 6520 696e   '' and image in
+00021560: 2049 4d41 4745 5343 4f4d 4d41 4e44 533a   IMAGESCOMMANDS:
+00021570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021580: 2020 2020 2063 6d64 203d 2049 4d41 4745       cmd = IMAGE
+00021590: 5343 4f4d 4d41 4e44 535b 696d 6167 655d  SCOMMANDS[image]
+000215a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000215b0: 2070 7072 696e 7428 6622 4772 6162 6269   pprint(f"Grabbi
+000215c0: 6e67 2069 6d61 6765 207b 696d 6167 657d  ng image {image}
+000215d0: 2066 726f 6d20 7572 6c20 7b75 726c 7d22   from url {url}"
+000215e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000215f0: 2020 6e65 6564 5f69 736f 203d 2027 6170    need_iso = 'ap
+00021600: 692f 6173 7369 7374 6564 2d69 6d61 6765  i/assisted-image
+00021610: 732f 696d 6167 6573 2720 696e 2075 726c  s/images' in url
+00021620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021630: 2073 686f 7274 6e61 6d65 203d 206f 732e   shortname = os.
+00021640: 7061 7468 2e62 6173 656e 616d 6528 7572  path.basename(ur
+00021650: 6c29 2e73 706c 6974 2827 3f27 295b 305d  l).split('?')[0]
+00021660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021670: 2069 6620 6e65 6564 5f69 736f 3a0a 2020   if need_iso:.  
+00021680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021690: 2020 696d 6167 6520 3d20 6627 626f 6f74    image = f'boot
+000216a0: 2d7b 7368 6f72 746e 616d 657d 2e69 736f  -{shortname}.iso
+000216b0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+000216c0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+000216d0: 2020 2020 2020 2020 2020 2063 6f6e 7665             conve
+000216e0: 7274 203d 2027 2e72 6177 2e27 2069 6e20  rt = '.raw.' in 
+000216f0: 7572 6c0a 2020 2020 2020 2020 2020 2020  url.            
+00021700: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00021710: 206b 2e61 6464 5f69 6d61 6765 2875 726c   k.add_image(url
+00021720: 2c20 706f 6f6c 2c20 636d 643d 636d 642c  , pool, cmd=cmd,
+00021730: 206e 616d 653d 696d 6167 652c 2073 697a   name=image, siz
+00021740: 653d 7369 7a65 2c20 636f 6e76 6572 743d  e=size, convert=
+00021750: 636f 6e76 6572 7429 0a20 2020 2020 2020  convert).       
+00021760: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00021770: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
+00021780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021790: 2020 2020 6572 726f 7228 6622 476f 7420      error(f"Got 
+000217a0: 7b65 7d22 290a 2020 2020 2020 2020 2020  {e}").          
+000217b0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+000217c0: 6622 506c 6561 7365 2072 756e 206b 636c  f"Please run kcl
+000217d0: 6920 6465 6c65 7465 2069 6d61 6765 202d  i delete image -
+000217e0: 2d79 6573 207b 7368 6f72 746e 616d 657d  -yes {shortname}
+000217f0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00021800: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
+00021810: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
+00021820: 6527 2c20 2772 6561 736f 6e27 3a20 2255  e', 'reason': "U
+00021830: 7365 7220 696e 7465 7272 7570 7469 6f6e  ser interruption
+00021840: 227d 0a20 2020 2020 2020 2020 2020 2020  "}.             
+00021850: 2020 2066 6f75 6e64 203d 2027 666f 756e     found = 'foun
+00021860: 6427 2069 6e20 7265 7375 6c74 0a20 2020  d' in result.   
+00021870: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00021880: 666f 756e 643a 0a20 2020 2020 2020 2020  found:.         
+00021890: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000218a0: 6e20 7b27 7265 7375 6c74 273a 2027 7375  n {'result': 'su
+000218b0: 6363 6573 7327 7d0a 2020 2020 2020 2020  ccess'}.        
+000218c0: 2020 2020 2020 2020 636f 6d6d 6f6e 2e68          common.h
+000218d0: 616e 646c 655f 7265 7370 6f6e 7365 2872  andle_response(r
+000218e0: 6573 756c 742c 2069 6d61 6765 2c20 656c  esult, image, el
+000218f0: 656d 656e 743d 2749 6d61 6765 272c 2061  ement='Image', a
+00021900: 6374 696f 6e3d 2741 6464 6564 2729 0a20  ction='Added'). 
+00021910: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00021920: 6620 7265 7375 6c74 5b27 7265 7375 6c74  f result['result
+00021930: 275d 2021 3d20 2773 7563 6365 7373 273a  '] != 'success':
+00021940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021950: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+00021960: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
+00021970: 2c20 2772 6561 736f 6e27 3a20 7265 7375  , 'reason': resu
+00021980: 6c74 5b27 7265 6173 6f6e 275d 7d0a 2020  lt['reason']}.  
+00021990: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000219a0: 207b 2772 6573 756c 7427 3a20 2773 7563   {'result': 'suc
+000219b0: 6365 7373 277d 0a20 2020 2020 2020 2065  cess'}.        e
+000219c0: 6c69 6620 7377 6974 6368 3a0a 2020 2020  lif switch:.    
+000219d0: 2020 2020 2020 2020 6966 2073 7769 7463          if switc
+000219e0: 6820 6e6f 7420 696e 2073 656c 662e 636c  h not in self.cl
+000219f0: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
+00021a00: 2020 2020 2020 2065 7272 6f72 2866 2243         error(f"C
+00021a10: 6c69 656e 7420 7b73 7769 7463 687d 206e  lient {switch} n
+00021a20: 6f74 2066 6f75 6e64 2069 6e20 636f 6e66  ot found in conf
+00021a30: 6967 2e4c 6561 7669 6e67 2e2e 2e2e 2229  ig.Leaving....")
+00021a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021a50: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
+00021a60: 273a 2027 6661 696c 7572 6527 2c20 2772  ': 'failure', 'r
+00021a70: 6561 736f 6e27 3a20 6622 436c 6965 6e74  eason': f"Client
+00021a80: 207b 7377 6974 6368 7d20 6e6f 7420 666f   {switch} not fo
+00021a90: 756e 6420 696e 2063 6f6e 6669 6722 7d0a  und in config"}.
+00021aa0: 2020 2020 2020 2020 2020 2020 656e 6162              enab
+00021ab0: 6c65 6420 3d20 7365 6c66 2e69 6e69 5b73  led = self.ini[s
+00021ac0: 7769 7463 685d 2e67 6574 2827 656e 6162  witch].get('enab
+00021ad0: 6c65 6427 2c20 5472 7565 290a 2020 2020  led', True).    
+00021ae0: 2020 2020 2020 2020 6966 206e 6f74 2065          if not e
+00021af0: 6e61 626c 6564 3a0a 2020 2020 2020 2020  nabled:.        
+00021b00: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
+00021b10: 436c 6965 6e74 207b 7377 6974 6368 7d20  Client {switch} 
+00021b20: 6973 2064 6973 6162 6c65 642e 4c65 6176  is disabled.Leav
+00021b30: 696e 672e 2e2e 2e22 290a 2020 2020 2020  ing....").      
+00021b40: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00021b50: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
+00021b60: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
+00021b70: 2066 2243 6c69 656e 7420 7b73 7769 7463   f"Client {switc
+00021b80: 687d 2069 7320 6469 7361 626c 6564 227d  h} is disabled"}
+00021b90: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
+00021ba0: 696e 7428 6622 5377 6974 6368 696e 6720  int(f"Switching 
+00021bb0: 746f 2063 6c69 656e 7420 7b73 7769 7463  to client {switc
+00021bc0: 687d 2e2e 2e22 290a 2020 2020 2020 2020  h}...").        
+00021bd0: 2020 2020 696e 6966 696c 6520 3d20 2225      inifile = "%
+00021be0: 732f 2e6b 636c 692f 636f 6e66 6967 2e79  s/.kcli/config.y
+00021bf0: 6d6c 2220 2520 6f73 2e65 6e76 6972 6f6e  ml" % os.environ
+00021c00: 2e67 6574 2827 484f 4d45 2729 0a20 2020  .get('HOME').   
+00021c10: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
+00021c20: 6174 682e 6578 6973 7473 2869 6e69 6669  ath.exists(inifi
+00021c30: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+00021c40: 2020 2020 206e 6577 696e 6920 3d20 2727       newini = ''
+00021c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021c60: 2066 6f72 206c 696e 6520 696e 206f 7065   for line in ope
+00021c70: 6e28 696e 6966 696c 6529 2e72 6561 646c  n(inifile).readl
+00021c80: 696e 6573 2829 3a0a 2020 2020 2020 2020  ines():.        
+00021c90: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00021ca0: 636c 6965 6e74 2720 696e 206c 696e 653a  client' in line:
+00021cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021cc0: 2020 2020 2020 2020 206e 6577 696e 6920           newini 
+00021cd0: 2b3d 2066 2220 636c 6965 6e74 3a20 7b73  += f" client: {s
+00021ce0: 7769 7463 687d 5c6e 220a 2020 2020 2020  witch}\n".      
+00021cf0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00021d00: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00021d10: 2020 2020 2020 2020 2020 2020 6e65 7769              newi
+00021d20: 6e69 202b 3d20 6c69 6e65 0a20 2020 2020  ni += line.     
+00021d30: 2020 2020 2020 2020 2020 206f 7065 6e28             open(
+00021d40: 696e 6966 696c 652c 2027 7727 292e 7772  inifile, 'w').wr
+00021d50: 6974 6528 6e65 7769 6e69 290a 2020 2020  ite(newini).    
+00021d60: 2020 2020 2020 2020 7265 7475 726e 207b          return {
+00021d70: 2772 6573 756c 7427 3a20 2773 7563 6365  'result': 'succe
+00021d80: 7373 277d 0a20 2020 2020 2020 2065 6c69  ss'}.        eli
+00021d90: 6620 7379 6e63 3a0a 2020 2020 2020 2020  f sync:.        
+00021da0: 2020 2020 6b20 3d20 7365 6c66 2e6b 0a20      k = self.k. 
+00021db0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00021dc0: 7420 7365 6c66 2e65 7874 7261 636c 6965  t self.extraclie
+00021dd0: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
+00021de0: 2020 2020 2077 6172 6e69 6e67 2822 4e6f       warning("No
+00021df0: 7468 696e 6720 746f 2064 6f2e 204c 6561  thing to do. Lea
+00021e00: 7669 6e67 2e2e 2e22 290a 2020 2020 2020  ving...").      
+00021e10: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00021e20: 207b 2772 6573 756c 7427 3a20 2773 7563   {'result': 'suc
+00021e30: 6365 7373 277d 0a20 2020 2020 2020 2020  cess'}.         
+00021e40: 2020 2066 6f72 2063 6c69 2069 6e20 7365     for cli in se
+00021e50: 6c66 2e65 7874 7261 636c 6965 6e74 733a  lf.extraclients:
+00021e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021e70: 2064 6573 7420 3d20 7365 6c66 2e65 7874   dest = self.ext
+00021e80: 7261 636c 6965 6e74 735b 636c 695d 0a20  raclients[cli]. 
+00021e90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00021ea0: 7072 696e 7428 6622 7379 6e63 696e 6720  print(f"syncing 
+00021eb0: 636c 6965 6e74 2069 6d61 6765 7320 6672  client images fr
+00021ec0: 6f6d 207b 7365 6c66 2e63 6c69 656e 747d  om {self.client}
+00021ed0: 2074 6f20 7b63 6c69 7d22 290a 2020 2020   to {cli}").    
+00021ee0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+00021ef0: 696e 6728 224e 6f74 6520 7268 656c 2069  ing("Note rhel i
+00021f00: 6d61 6765 7320 6172 6520 6375 7272 656e  mages are curren
+00021f10: 746c 7920 6e6f 7420 7379 6e63 6564 2229  tly not synced")
+00021f20: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00021f30: 2076 6f6c 2069 6e20 6b2e 766f 6c75 6d65   vol in k.volume
+00021f40: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00021f50: 2020 2020 2069 6d61 6765 203d 206f 732e       image = os.
+00021f60: 7061 7468 2e62 6173 656e 616d 6528 766f  path.basename(vo
+00021f70: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
+00021f80: 2020 2069 6620 696d 6167 6520 696e 205b     if image in [
+00021f90: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+00021fa0: 2876 2920 666f 7220 7620 696e 2064 6573  (v) for v in des
+00021fb0: 742e 766f 6c75 6d65 7328 295d 3a0a 2020  t.volumes()]:.  
+00021fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021fd0: 2020 7761 726e 696e 6728 6622 4967 6e6f    warning(f"Igno
+00021fe0: 7269 6e67 207b 696d 6167 657d 2061 7320  ring {image} as 
+00021ff0: 6974 2773 2061 6c72 6561 6479 2074 6865  it's already the
+00022000: 7265 2229 0a20 2020 2020 2020 2020 2020  re").           
+00022010: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00022020: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00022030: 2020 7572 6c20 3d20 4e6f 6e65 0a20 2020    url = None.   
+00022040: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00022050: 206e 2069 6e20 6c69 7374 2849 4d41 4745   n in list(IMAGE
+00022060: 532e 7661 6c75 6573 2829 293a 0a20 2020  S.values()):.   
 00022070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022080: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-00022090: 273a 2027 6661 696c 7572 6527 2c20 2772  ': 'failure', 'r
-000220a0: 6561 736f 6e27 3a20 224d 6973 7369 6e67  eason': "Missing
-000220b0: 2069 6d61 6765 227d 0a20 2020 2020 2020   image"}.       
-000220c0: 2020 2020 2020 2020 2063 6d64 203d 204e           cmd = N
-000220d0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-000220e0: 2020 2020 6966 2076 6f6c 2069 6e20 494d      if vol in IM
-000220f0: 4147 4553 434f 4d4d 414e 4453 3a0a 2020  AGESCOMMANDS:.  
-00022100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022110: 2020 636d 6420 3d20 494d 4147 4553 434f    cmd = IMAGESCO
-00022120: 4d4d 414e 4453 5b69 6d61 6765 5d0a 2020  MMANDS[image].  
-00022130: 2020 2020 2020 2020 2020 2020 2020 7070                pp
-00022140: 7269 6e74 2866 2247 7261 6262 696e 6720  rint(f"Grabbing 
-00022150: 696d 6167 6520 7b69 6d61 6765 7d2e 2e2e  image {image}...
-00022160: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00022170: 2020 2064 6573 742e 6164 645f 696d 6167     dest.add_imag
-00022180: 6528 7572 6c2c 2070 6f6f 6c2c 2063 6d64  e(url, pool, cmd
-00022190: 3d63 6d64 290a 2020 2020 2020 2020 7265  =cmd).        re
-000221a0: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
-000221b0: 2773 7563 6365 7373 277d 0a0a 2020 2020  'success'}..    
-000221c0: 6465 6620 6465 6c65 7465 5f6c 6f61 6462  def delete_loadb
-000221d0: 616c 616e 6365 7228 7365 6c66 2c20 6e61  alancer(self, na
-000221e0: 6d65 2c20 646f 6d61 696e 3d4e 6f6e 6529  me, domain=None)
-000221f0: 3a0a 2020 2020 2020 2020 6b20 3d20 7365  :.        k = se
-00022200: 6c66 2e6b 0a20 2020 2020 2020 2070 7072  lf.k.        ppr
-00022210: 696e 7428 6622 4465 6c65 7469 6e67 206c  int(f"Deleting l
-00022220: 6f61 6462 616c 616e 6365 7220 7b6e 616d  oadbalancer {nam
-00022230: 657d 2229 0a20 2020 2020 2020 2069 6620  e}").        if 
-00022240: 7365 6c66 2e74 7970 6520 696e 205b 2761  self.type in ['a
-00022250: 7773 272c 2027 6763 7027 2c20 2769 626d  ws', 'gcp', 'ibm
-00022260: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-00022270: 646e 7363 6c69 656e 7420 3d20 6b2e 6465  dnsclient = k.de
-00022280: 6c65 7465 5f6c 6f61 6462 616c 616e 6365  lete_loadbalance
-00022290: 7228 6e61 6d65 290a 2020 2020 2020 2020  r(name).        
-000222a0: 2020 2020 6966 2064 6f6d 6169 6e20 6973      if domain is
-000222b0: 206e 6f74 204e 6f6e 6520 616e 6420 646e   not None and dn
-000222c0: 7363 6c69 656e 7420 6973 206e 6f74 204e  sclient is not N
-000222d0: 6f6e 6520 616e 6420 6973 696e 7374 616e  one and isinstan
-000222e0: 6365 2864 6e73 636c 6965 6e74 2c20 7374  ce(dnsclient, st
-000222f0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00022300: 2020 2020 6966 2064 6e73 636c 6965 6e74      if dnsclient
-00022310: 2069 6e20 7365 6c66 2e63 6c69 656e 7473   in self.clients
-00022320: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00022330: 2020 2020 2020 7a20 3d20 4b63 6f6e 6669        z = Kconfi
-00022340: 6728 636c 6965 6e74 3d64 6e73 636c 6965  g(client=dnsclie
-00022350: 6e74 292e 6b0a 2020 2020 2020 2020 2020  nt).k.          
-00022360: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00022370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022380: 7761 726e 696e 6728 6622 436c 6965 6e74  warning(f"Client
-00022390: 207b 646e 7363 6c69 656e 747d 206e 6f74   {dnsclient} not
-000223a0: 2066 6f75 6e64 2e20 536b 6970 7069 6e67   found. Skipping
-000223b0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-000223c0: 2020 207a 2e64 656c 6574 655f 646e 7328     z.delete_dns(
-000223d0: 6e61 6d65 2e72 6570 6c61 6365 2827 5f27  name.replace('_'
-000223e0: 2c20 272d 2729 2c20 646f 6d61 696e 290a  , '-'), domain).
-000223f0: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
-00022400: 662e 7479 7065 203d 3d20 276b 766d 273a  f.type == 'kvm':
-00022410: 0a20 2020 2020 2020 2020 2020 206b 2e64  .            k.d
-00022420: 656c 6574 6528 6e61 6d65 290a 0a20 2020  elete(name)..   
-00022430: 2064 6566 2063 7265 6174 655f 6c6f 6164   def create_load
-00022440: 6261 6c61 6e63 6572 2873 656c 662c 206e  balancer(self, n
-00022450: 616d 652c 206e 6574 733d 5b27 6465 6661  ame, nets=['defa
-00022460: 756c 7427 5d2c 2070 6f72 7473 3d5b 5d2c  ult'], ports=[],
-00022470: 2063 6865 636b 7061 7468 3d27 2f27 2c20   checkpath='/', 
-00022480: 766d 733d 5b5d 2c20 646f 6d61 696e 3d4e  vms=[], domain=N
-00022490: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-000224a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000224b0: 2070 6c61 6e3d 4e6f 6e65 2c20 6368 6563   plan=None, chec
-000224c0: 6b70 6f72 743d 3830 2c20 616c 6961 733d  kport=80, alias=
-000224d0: 5b5d 2c20 696e 7465 726e 616c 3d46 616c  [], internal=Fal
-000224e0: 7365 2c20 646e 7363 6c69 656e 743d 4e6f  se, dnsclient=No
-000224f0: 6e65 2c20 7375 626e 6574 6964 3d4e 6f6e  ne, subnetid=Non
-00022500: 652c 2069 703d 4e6f 6e65 293a 0a20 2020  e, ip=None):.   
-00022510: 2020 2020 206e 616d 6520 3d20 6e61 6d65       name = name
-00022520: 7574 696c 732e 6765 745f 7261 6e64 6f6d  utils.get_random
-00022530: 5f6e 616d 6528 292e 7265 706c 6163 6528  _name().replace(
-00022540: 275f 272c 2027 2d27 2920 6966 206e 616d  '_', '-') if nam
-00022550: 6520 6973 204e 6f6e 6520 656c 7365 206e  e is None else n
-00022560: 616d 650a 2020 2020 2020 2020 7070 7269  ame.        ppri
-00022570: 6e74 2866 2244 6570 6c6f 7969 6e67 206c  nt(f"Deploying l
-00022580: 6f61 6462 616c 616e 6365 7220 7b6e 616d  oadbalancer {nam
-00022590: 657d 2229 0a20 2020 2020 2020 206b 203d  e}").        k =
-000225a0: 2073 656c 662e 6b0a 2020 2020 2020 2020   self.k.        
-000225b0: 6966 2073 656c 662e 7479 7065 2069 6e20  if self.type in 
-000225c0: 5b27 6177 7327 2c20 2767 6370 272c 2027  ['aws', 'gcp', '
-000225d0: 6962 6d27 5d3a 0a20 2020 2020 2020 2020  ibm']:.         
-000225e0: 2020 206c 625f 6970 203d 206b 2e63 7265     lb_ip = k.cre
-000225f0: 6174 655f 6c6f 6164 6261 6c61 6e63 6572  ate_loadbalancer
-00022600: 286e 616d 652c 2070 6f72 7473 3d70 6f72  (name, ports=por
-00022610: 7473 2c20 6368 6563 6b70 6174 683d 6368  ts, checkpath=ch
-00022620: 6563 6b70 6174 682c 2076 6d73 3d76 6d73  eckpath, vms=vms
-00022630: 2c20 646f 6d61 696e 3d64 6f6d 6169 6e2c  , domain=domain,
-00022640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022660: 2020 2020 2020 2020 2020 2063 6865 636b             check
-00022670: 706f 7274 3d63 6865 636b 706f 7274 2c20  port=checkport, 
-00022680: 616c 6961 733d 616c 6961 732c 2069 6e74  alias=alias, int
-00022690: 6572 6e61 6c3d 696e 7465 726e 616c 2c0a  ernal=internal,.
-000226a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000226b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000226c0: 2020 2020 2020 2020 2020 646e 7363 6c69            dnscli
-000226d0: 656e 743d 646e 7363 6c69 656e 742c 2073  ent=dnsclient, s
-000226e0: 7562 6e65 7469 643d 7375 626e 6574 6964  ubnetid=subnetid
-000226f0: 2c20 6970 3d69 7029 0a20 2020 2020 2020  , ip=ip).       
-00022700: 2020 2020 2069 6620 646e 7363 6c69 656e       if dnsclien
-00022710: 7420 6973 206e 6f74 204e 6f6e 653a 0a20  t is not None:. 
-00022720: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00022730: 6620 646e 7363 6c69 656e 7420 696e 2073  f dnsclient in s
-00022740: 656c 662e 636c 6965 6e74 733a 0a20 2020  elf.clients:.   
-00022750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022760: 207a 203d 204b 636f 6e66 6967 2863 6c69   z = Kconfig(cli
-00022770: 656e 743d 646e 7363 6c69 656e 7429 2e6b  ent=dnsclient).k
-00022780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022790: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000227a0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-000227b0: 6e67 2866 2243 6c69 656e 7420 7b64 6e73  ng(f"Client {dns
-000227c0: 636c 6965 6e74 7d20 6e6f 7420 666f 756e  client} not foun
-000227d0: 642e 2053 6b69 7070 696e 6722 290a 2020  d. Skipping").  
-000227e0: 2020 2020 2020 2020 2020 2020 2020 7a2e                z.
-000227f0: 7265 7365 7276 655f 646e 7328 6e61 6d65  reserve_dns(name
-00022800: 2e72 6570 6c61 6365 2827 5f27 2c20 272d  .replace('_', '-
-00022810: 2729 2c20 6970 3d6c 625f 6970 2c20 646f  '), ip=lb_ip, do
-00022820: 6d61 696e 3d64 6f6d 6169 6e2c 2061 6c69  main=domain, ali
-00022830: 6173 3d61 6c69 6173 290a 2020 2020 2020  as=alias).      
-00022840: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00022850: 2020 2020 766d 696e 666f 203d 205b 5d0a      vminfo = [].
-00022860: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00022870: 766d 2069 6e20 766d 733a 0a20 2020 2020  vm in vms:.     
-00022880: 2020 2020 2020 2020 2020 2069 6620 7661             if va
-00022890: 6c69 645f 6970 2876 6d29 3a0a 2020 2020  lid_ip(vm):.    
-000228a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000228b0: 766d 6e61 6d65 203d 2076 6d2e 7265 706c  vmname = vm.repl
-000228c0: 6163 6528 273a 272c 2027 2d27 292e 7265  ace(':', '-').re
-000228d0: 706c 6163 6528 272e 272c 2027 2d27 290a  place('.', '-').
-000228e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000228f0: 2020 2020 766d 696e 666f 2e61 7070 656e      vminfo.appen
-00022900: 6428 7b27 6e61 6d65 273a 2076 6d6e 616d  d({'name': vmnam
-00022910: 652c 2027 6970 273a 2076 6d7d 290a 2020  e, 'ip': vm}).  
-00022920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022930: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-00022940: 2020 2020 2020 2020 2020 2063 6f75 6e74             count
-00022950: 6572 203d 2030 0a20 2020 2020 2020 2020  er = 0.         
-00022960: 2020 2020 2020 2077 6869 6c65 2063 6f75         while cou
-00022970: 6e74 6572 2021 3d20 3130 303a 0a20 2020  nter != 100:.   
-00022980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022990: 2069 7020 3d20 6b2e 6970 2876 6d29 0a20   ip = k.ip(vm). 
+00022080: 2069 6620 6e20 6973 204e 6f6e 653a 0a20   if n is None:. 
+00022090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000220a0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+000220b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000220c0: 2020 2020 656c 6966 206e 2e73 706c 6974      elif n.split
+000220d0: 2827 2f27 295b 2d31 5d20 3d3d 2069 6d61  ('/')[-1] == ima
+000220e0: 6765 3a0a 2020 2020 2020 2020 2020 2020  ge:.            
+000220f0: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
+00022100: 3d20 6e0a 2020 2020 2020 2020 2020 2020  = n.            
+00022110: 2020 2020 6966 2075 726c 2069 7320 4e6f      if url is No
+00022120: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00022130: 2020 2020 2020 2020 7265 7475 726e 207b          return {
+00022140: 2772 6573 756c 7427 3a20 2766 6169 6c75  'result': 'failu
+00022150: 7265 272c 2027 7265 6173 6f6e 273a 2022  re', 'reason': "
+00022160: 696d 6167 6520 6e6f 7420 696e 2064 6566  image not in def
+00022170: 6175 6c74 206c 6973 7422 7d0a 2020 2020  ault list"}.    
+00022180: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00022190: 6d61 6765 2e73 7461 7274 7377 6974 6828  mage.startswith(
+000221a0: 2772 6865 6c27 293a 0a20 2020 2020 2020  'rhel'):.       
+000221b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000221c0: 2777 6562 2720 696e 2073 7973 2e61 7267  'web' in sys.arg
+000221d0: 765b 305d 3a0a 2020 2020 2020 2020 2020  v[0]:.          
+000221e0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000221f0: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+00022200: 2766 6169 6c75 7265 272c 2027 7265 6173  'failure', 'reas
+00022210: 6f6e 273a 2022 4d69 7373 696e 6720 7572  on': "Missing ur
+00022220: 6c22 7d0a 2020 2020 2020 2020 2020 2020  l"}.            
+00022230: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+00022240: 224f 7065 6e69 6e67 2075 726c 207b 7572  "Opening url {ur
+00022250: 6c7d 2066 6f72 2079 6f75 2074 6f20 6772  l} for you to gr
+00022260: 6162 2063 6f6d 706c 6574 6520 7572 6c20  ab complete url 
+00022270: 666f 7220 7b76 6f6c 7d20 6b76 6d20 6775  for {vol} kvm gu
+00022280: 6573 7420 696d 6167 6522 290a 2020 2020  est image").    
+00022290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000222a0: 7765 6262 726f 7773 6572 2e6f 7065 6e28  webbrowser.open(
+000222b0: 7572 6c2c 206e 6577 3d32 2c20 6175 746f  url, new=2, auto
+000222c0: 7261 6973 653d 5472 7565 290a 2020 2020  raise=True).    
+000222d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000222e0: 7572 6c20 3d20 696e 7075 7428 2243 6f70  url = input("Cop
+000222f0: 7920 5572 6c3a 5c6e 2229 0a20 2020 2020  y Url:\n").     
+00022300: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00022310: 6620 7572 6c2e 7374 7269 7028 2920 3d3d  f url.strip() ==
+00022320: 2027 273a 0a20 2020 2020 2020 2020 2020   '':.           
+00022330: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00022340: 6f72 2822 4d69 7373 696e 6720 7072 6f70  or("Missing prop
+00022350: 6572 2075 726c 2e4c 6561 7669 6e67 2e2e  er url.Leaving..
+00022360: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00022370: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00022380: 726e 207b 2772 6573 756c 7427 3a20 2766  rn {'result': 'f
+00022390: 6169 6c75 7265 272c 2027 7265 6173 6f6e  ailure', 'reason
+000223a0: 273a 2022 4d69 7373 696e 6720 696d 6167  ': "Missing imag
+000223b0: 6522 7d0a 2020 2020 2020 2020 2020 2020  e"}.            
+000223c0: 2020 2020 636d 6420 3d20 4e6f 6e65 0a20      cmd = None. 
+000223d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000223e0: 6620 766f 6c20 696e 2049 4d41 4745 5343  f vol in IMAGESC
+000223f0: 4f4d 4d41 4e44 533a 0a20 2020 2020 2020  OMMANDS:.       
+00022400: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
+00022410: 203d 2049 4d41 4745 5343 4f4d 4d41 4e44   = IMAGESCOMMAND
+00022420: 535b 696d 6167 655d 0a20 2020 2020 2020  S[image].       
+00022430: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00022440: 6622 4772 6162 6269 6e67 2069 6d61 6765  f"Grabbing image
+00022450: 207b 696d 6167 657d 2e2e 2e22 290a 2020   {image}...").  
+00022460: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00022470: 7374 2e61 6464 5f69 6d61 6765 2875 726c  st.add_image(url
+00022480: 2c20 706f 6f6c 2c20 636d 643d 636d 6429  , pool, cmd=cmd)
+00022490: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000224a0: 7b27 7265 7375 6c74 273a 2027 7375 6363  {'result': 'succ
+000224b0: 6573 7327 7d0a 0a20 2020 2064 6566 2064  ess'}..    def d
+000224c0: 656c 6574 655f 6c6f 6164 6261 6c61 6e63  elete_loadbalanc
+000224d0: 6572 2873 656c 662c 206e 616d 652c 2064  er(self, name, d
+000224e0: 6f6d 6169 6e3d 4e6f 6e65 293a 0a20 2020  omain=None):.   
+000224f0: 2020 2020 206b 203d 2073 656c 662e 6b0a       k = self.k.
+00022500: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+00022510: 2244 656c 6574 696e 6720 6c6f 6164 6261  "Deleting loadba
+00022520: 6c61 6e63 6572 207b 6e61 6d65 7d22 290a  lancer {name}").
+00022530: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00022540: 7479 7065 2069 6e20 5b27 6177 7327 2c20  type in ['aws', 
+00022550: 2767 6370 272c 2027 6962 6d27 5d3a 0a20  'gcp', 'ibm']:. 
+00022560: 2020 2020 2020 2020 2020 2064 6e73 636c             dnscl
+00022570: 6965 6e74 203d 206b 2e64 656c 6574 655f  ient = k.delete_
+00022580: 6c6f 6164 6261 6c61 6e63 6572 286e 616d  loadbalancer(nam
+00022590: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
+000225a0: 6620 646f 6d61 696e 2069 7320 6e6f 7420  f domain is not 
+000225b0: 4e6f 6e65 2061 6e64 2064 6e73 636c 6965  None and dnsclie
+000225c0: 6e74 2069 7320 6e6f 7420 4e6f 6e65 2061  nt is not None a
+000225d0: 6e64 2069 7369 6e73 7461 6e63 6528 646e  nd isinstance(dn
+000225e0: 7363 6c69 656e 742c 2073 7472 293a 0a20  sclient, str):. 
+000225f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00022600: 6620 646e 7363 6c69 656e 7420 696e 2073  f dnsclient in s
+00022610: 656c 662e 636c 6965 6e74 733a 0a20 2020  elf.clients:.   
+00022620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022630: 207a 203d 204b 636f 6e66 6967 2863 6c69   z = Kconfig(cli
+00022640: 656e 743d 646e 7363 6c69 656e 7429 2e6b  ent=dnsclient).k
+00022650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022660: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00022670: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+00022680: 6e67 2866 2243 6c69 656e 7420 7b64 6e73  ng(f"Client {dns
+00022690: 636c 6965 6e74 7d20 6e6f 7420 666f 756e  client} not foun
+000226a0: 642e 2053 6b69 7070 696e 6722 290a 2020  d. Skipping").  
+000226b0: 2020 2020 2020 2020 2020 2020 2020 7a2e                z.
+000226c0: 6465 6c65 7465 5f64 6e73 286e 616d 652e  delete_dns(name.
+000226d0: 7265 706c 6163 6528 275f 272c 2027 2d27  replace('_', '-'
+000226e0: 292c 2064 6f6d 6169 6e29 0a20 2020 2020  ), domain).     
+000226f0: 2020 2065 6c69 6620 7365 6c66 2e74 7970     elif self.typ
+00022700: 6520 3d3d 2027 6b76 6d27 3a0a 2020 2020  e == 'kvm':.    
+00022710: 2020 2020 2020 2020 6b2e 6465 6c65 7465          k.delete
+00022720: 286e 616d 6529 0a0a 2020 2020 6465 6620  (name)..    def 
+00022730: 6372 6561 7465 5f6c 6f61 6462 616c 616e  create_loadbalan
+00022740: 6365 7228 7365 6c66 2c20 6e61 6d65 2c20  cer(self, name, 
+00022750: 6e65 7473 3d5b 2764 6566 6175 6c74 275d  nets=['default']
+00022760: 2c20 706f 7274 733d 5b5d 2c20 6368 6563  , ports=[], chec
+00022770: 6b70 6174 683d 272f 272c 2076 6d73 3d5b  kpath='/', vms=[
+00022780: 5d2c 2064 6f6d 6169 6e3d 4e6f 6e65 2c0a  ], domain=None,.
+00022790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000227a0: 2020 2020 2020 2020 2020 2020 706c 616e              plan
+000227b0: 3d4e 6f6e 652c 2063 6865 636b 706f 7274  =None, checkport
+000227c0: 3d38 302c 2061 6c69 6173 3d5b 5d2c 2069  =80, alias=[], i
+000227d0: 6e74 6572 6e61 6c3d 4661 6c73 652c 2064  nternal=False, d
+000227e0: 6e73 636c 6965 6e74 3d4e 6f6e 652c 2073  nsclient=None, s
+000227f0: 7562 6e65 7469 643d 4e6f 6e65 2c20 6970  ubnetid=None, ip
+00022800: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00022810: 6e61 6d65 203d 206e 616d 6575 7469 6c73  name = nameutils
+00022820: 2e67 6574 5f72 616e 646f 6d5f 6e61 6d65  .get_random_name
+00022830: 2829 2e72 6570 6c61 6365 2827 5f27 2c20  ().replace('_', 
+00022840: 272d 2729 2069 6620 6e61 6d65 2069 7320  '-') if name is 
+00022850: 4e6f 6e65 2065 6c73 6520 6e61 6d65 0a20  None else name. 
+00022860: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+00022870: 4465 706c 6f79 696e 6720 6c6f 6164 6261  Deploying loadba
+00022880: 6c61 6e63 6572 207b 6e61 6d65 7d22 290a  lancer {name}").
+00022890: 2020 2020 2020 2020 6b20 3d20 7365 6c66          k = self
+000228a0: 2e6b 0a20 2020 2020 2020 2069 6620 7365  .k.        if se
+000228b0: 6c66 2e74 7970 6520 696e 205b 2761 7773  lf.type in ['aws
+000228c0: 272c 2027 6763 7027 2c20 2769 626d 275d  ', 'gcp', 'ibm']
+000228d0: 3a0a 2020 2020 2020 2020 2020 2020 6c62  :.            lb
+000228e0: 5f69 7020 3d20 6b2e 6372 6561 7465 5f6c  _ip = k.create_l
+000228f0: 6f61 6462 616c 616e 6365 7228 6e61 6d65  oadbalancer(name
+00022900: 2c20 706f 7274 733d 706f 7274 732c 2063  , ports=ports, c
+00022910: 6865 636b 7061 7468 3d63 6865 636b 7061  heckpath=checkpa
+00022920: 7468 2c20 766d 733d 766d 732c 2064 6f6d  th, vms=vms, dom
+00022930: 6169 6e3d 646f 6d61 696e 2c0a 2020 2020  ain=domain,.    
+00022940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022960: 2020 2020 2020 6368 6563 6b70 6f72 743d        checkport=
+00022970: 6368 6563 6b70 6f72 742c 2061 6c69 6173  checkport, alias
+00022980: 3d61 6c69 6173 2c20 696e 7465 726e 616c  =alias, internal
+00022990: 3d69 6e74 6572 6e61 6c2c 0a20 2020 2020  =internal,.     
 000229a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000229b0: 2020 2069 6620 6970 2069 7320 4e6f 6e65     if ip is None
-000229c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000229d0: 2020 2020 2020 2020 2020 736c 6565 7028            sleep(
-000229e0: 3529 0a20 2020 2020 2020 2020 2020 2020  5).             
-000229f0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00022a00: 2866 2257 6169 7469 6e67 2035 2073 6563  (f"Waiting 5 sec
-00022a10: 6f6e 6473 2074 6f20 6772 6162 2069 7020  onds to grab ip 
-00022a20: 666f 7220 766d 207b 766d 7d2e 2e2e 2229  for vm {vm}...")
-00022a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022a40: 2020 2020 2020 2020 2063 6f75 6e74 6572           counter
-00022a50: 202b 3d20 350a 2020 2020 2020 2020 2020   += 5.          
-00022a60: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00022a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022a80: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-00022a90: 2020 2020 2020 2020 2020 2020 2020 766d                vm
-00022aa0: 696e 666f 2e61 7070 656e 6428 7b27 6e61  info.append({'na
-00022ab0: 6d65 273a 2076 6d2c 2027 6970 273a 2069  me': vm, 'ip': i
-00022ac0: 707d 290a 2020 2020 2020 2020 2020 2020  p}).            
-00022ad0: 6f76 6572 7269 6465 7320 3d20 7b0a 2020  overrides = {.  
-00022ae0: 2020 2020 2020 2020 2020 2020 2020 226e                "n
-00022af0: 616d 6522 3a20 6e61 6d65 2c0a 2020 2020  ame": name,.    
-00022b00: 2020 2020 2020 2020 2020 2020 2276 6d73              "vms
-00022b10: 223a 2076 6d69 6e66 6f2c 0a20 2020 2020  ": vminfo,.     
-00022b20: 2020 2020 2020 2020 2020 2022 6e65 7473             "nets
-00022b30: 223a 206e 6574 732c 0a20 2020 2020 2020  ": nets,.       
-00022b40: 2020 2020 2020 2020 2022 706f 7274 7322           "ports"
-00022b50: 3a20 706f 7274 732c 0a20 2020 2020 2020  : ports,.       
-00022b60: 2020 2020 2020 2020 2022 6368 6563 6b70           "checkp
-00022b70: 6174 6822 3a20 6368 6563 6b70 6174 682c  ath": checkpath,
-00022b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022b90: 2022 646f 6d61 696e 223a 2064 6f6d 6169   "domain": domai
-00022ba0: 6e2c 0a20 2020 2020 2020 2020 2020 207d  n,.            }
-00022bb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00022bc0: 662e 706c 616e 2870 6c61 6e2c 2069 6e70  f.plan(plan, inp
-00022bd0: 7574 7374 7269 6e67 3d68 6170 726f 7879  utstring=haproxy
-00022be0: 706c 616e 2c20 6f76 6572 7269 6465 733d  plan, overrides=
-00022bf0: 6f76 6572 7269 6465 7329 0a0a 2020 2020  overrides)..    
-00022c00: 6465 6620 6c69 7374 5f6c 6f61 6462 616c  def list_loadbal
-00022c10: 616e 6365 7273 2873 656c 6629 3a0a 2020  ancers(self):.  
-00022c20: 2020 2020 2020 6b20 3d20 7365 6c66 2e6b        k = self.k
-00022c30: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00022c40: 2e74 7970 6520 6e6f 7420 696e 205b 2761  .type not in ['a
-00022c50: 7773 272c 2027 6763 7027 2c20 2769 626d  ws', 'gcp', 'ibm
-00022c60: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-00022c70: 7265 7375 6c74 7320 3d20 5b5d 0a20 2020  results = [].   
-00022c80: 2020 2020 2020 2020 2066 6f72 2076 6d20           for vm 
-00022c90: 696e 206b 2e6c 6973 7428 293a 0a20 2020  in k.list():.   
-00022ca0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00022cb0: 766d 5b27 7072 6f66 696c 6527 5d2e 7374  vm['profile'].st
-00022cc0: 6172 7473 7769 7468 2827 6c6f 6164 6261  artswith('loadba
-00022cd0: 6c61 6e63 6572 2729 2061 6e64 206c 656e  lancer') and len
-00022ce0: 2876 6d5b 2770 726f 6669 6c65 275d 2e73  (vm['profile'].s
-00022cf0: 706c 6974 2827 2d27 2929 203d 3d20 323a  plit('-')) == 2:
-00022d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022d10: 2020 2020 2070 6f72 7473 203d 2076 6d5b       ports = vm[
-00022d20: 2770 726f 6669 6c65 275d 2e73 706c 6974  'profile'].split
-00022d30: 2827 2d27 295b 315d 0a20 2020 2020 2020  ('-')[1].       
-00022d40: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00022d50: 756c 7473 2e61 7070 656e 6428 5b76 6d5b  ults.append([vm[
-00022d60: 276e 616d 6527 5d2c 2076 6d5b 2769 7027  'name'], vm['ip'
-00022d70: 5d2c 2027 7463 7027 2c20 706f 7274 732c  ], 'tcp', ports,
-00022d80: 2027 275d 290a 2020 2020 2020 2020 2020   '']).          
-00022d90: 2020 7265 7475 726e 2072 6573 756c 7473    return results
-00022da0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00022db0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00022dc0: 6e20 6b2e 6c69 7374 5f6c 6f61 6462 616c  n k.list_loadbal
-00022dd0: 616e 6365 7273 2829 0a0a 2020 2020 6465  ancers()..    de
-00022de0: 6620 7761 6974 5f66 696e 6973 6828 7365  f wait_finish(se
-00022df0: 6c66 2c20 6e61 6d65 2c20 696d 6167 653d  lf, name, image=
-00022e00: 4e6f 6e65 2c20 7175 6965 743d 4661 6c73  None, quiet=Fals
-00022e10: 652c 2077 6169 7463 6f6d 6d61 6e64 3d4e  e, waitcommand=N
-00022e20: 6f6e 652c 2077 6169 7474 696d 656f 7574  one, waittimeout
-00022e30: 3d30 2c20 6964 656e 7469 7479 6669 6c65  =0, identityfile
-00022e40: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
-00022e50: 2020 2020 2020 2020 2020 2076 6d63 6c69             vmcli
-00022e60: 656e 743d 4e6f 6e65 293a 0a20 2020 2020  ent=None):.     
-00022e70: 2020 2063 6f6e 6669 6720 3d20 4b63 6f6e     config = Kcon
-00022e80: 6669 6728 636c 6965 6e74 3d76 6d63 6c69  fig(client=vmcli
-00022e90: 656e 7429 2069 6620 766d 636c 6965 6e74  ent) if vmclient
-00022ea0: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
-00022eb0: 6520 7365 6c66 0a20 2020 2020 2020 206b  e self.        k
-00022ec0: 203d 2063 6f6e 6669 672e 6b0a 2020 2020   = config.k.    
-00022ed0: 2020 2020 6966 2069 6d61 6765 2069 7320      if image is 
-00022ee0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00022ef0: 2020 696d 6167 6520 3d20 6b2e 696e 666f    image = k.info
-00022f00: 286e 616d 6529 5b27 696d 6167 6527 5d0a  (name)['image'].
-00022f10: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00022f20: 2257 6169 7469 6e67 2066 6f72 2076 6d20  "Waiting for vm 
-00022f30: 7b6e 616d 657d 2074 6f20 6669 6e69 7368  {name} to finish
-00022f40: 2063 7573 746f 6d69 7361 7469 6f6e 2229   customisation")
-00022f50: 0a20 2020 2020 2020 2069 6620 7761 6974  .        if wait
-00022f60: 636f 6d6d 616e 6420 6973 206e 6f74 204e  command is not N
-00022f70: 6f6e 6520 616e 6420 2732 3e27 206e 6f74  one and '2>' not
-00022f80: 2069 6e20 7761 6974 636f 6d6d 616e 643a   in waitcommand:
-00022f90: 0a20 2020 2020 2020 2020 2020 2077 6169  .            wai
-00022fa0: 7463 6f6d 6d61 6e64 202b 3d20 2220 323e  tcommand += " 2>
-00022fb0: 2f64 6576 2f6e 756c 6c22 0a20 2020 2020  /dev/null".     
-00022fc0: 2020 2069 6620 636f 6d6d 6f6e 2e6e 6565     if common.nee
-00022fd0: 6473 5f69 676e 6974 696f 6e28 696d 6167  ds_ignition(imag
-00022fe0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00022ff0: 636d 6420 3d20 7761 6974 636f 6d6d 616e  cmd = waitcomman
-00023000: 6420 6f72 2027 7375 646f 206a 6f75 726e  d or 'sudo journ
-00023010: 616c 6374 6c20 2d2d 616c 6c20 2d2d 6e6f  alctl --all --no
-00023020: 2d70 6167 6572 270a 2020 2020 2020 2020  -pager'.        
-00023030: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00023040: 2020 636d 6420 3d20 7761 6974 636f 6d6d    cmd = waitcomm
-00023050: 616e 6420 6f72 2066 2273 7564 6f20 7461  and or f"sudo ta
-00023060: 696c 202d 6e20 3530 207b 636f 6d6d 6f6e  il -n 50 {common
-00023070: 2e67 6574 5f63 6c6f 7564 696e 6974 6669  .get_cloudinitfi
-00023080: 6c65 2869 6d61 6765 297d 220a 2020 2020  le(image)}".    
-00023090: 2020 2020 7573 6572 2c20 6970 2c20 766d      user, ip, vm
-000230a0: 706f 7274 203d 204e 6f6e 652c 204e 6f6e  port = None, Non
-000230b0: 652c 204e 6f6e 650a 2020 2020 2020 2020  e, None.        
-000230c0: 686f 7374 6970 203d 204e 6f6e 650a 2020  hostip = None.  
-000230d0: 2020 2020 2020 7469 6d65 6f75 7420 3d20        timeout = 
-000230e0: 300a 2020 2020 2020 2020 7768 696c 6520  0.        while 
-000230f0: 6970 2069 7320 4e6f 6e65 3a0a 2020 2020  ip is None:.    
-00023100: 2020 2020 2020 2020 696e 666f 203d 206b          info = k
-00023110: 2e69 6e66 6f28 6e61 6d65 290a 2020 2020  .info(name).    
-00023120: 2020 2020 2020 2020 6966 2063 6f6e 6669          if confi
-00023130: 672e 7479 7065 203d 3d20 2770 6163 6b65  g.type == 'packe
-00023140: 7427 2061 6e64 2069 6e66 6f2e 6765 7428  t' and info.get(
-00023150: 2773 7461 7475 7327 2920 213d 2027 6163  'status') != 'ac
-00023160: 7469 7665 273a 0a20 2020 2020 2020 2020  tive':.         
-00023170: 2020 2020 2020 2077 6172 6e69 6e67 2822         warning("
-00023180: 5761 6974 696e 6720 666f 7220 6e6f 6465  Waiting for node
-00023190: 2074 6f20 6265 2061 6374 6976 6522 290a   to be active").
-000231a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000231b0: 6970 203d 204e 6f6e 650a 2020 2020 2020  ip = None.      
-000231c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000231d0: 2020 2020 2020 2020 2020 2020 7573 6572              user
-000231e0: 2c20 6970 203d 2063 6f6e 6669 672e 766d  , ip = config.vm
-000231f0: 7573 6572 206f 7220 696e 666f 2e67 6574  user or info.get
-00023200: 2827 7573 6572 2729 2c20 696e 666f 2e67  ('user'), info.g
-00023210: 6574 2827 6970 2729 0a20 2020 2020 2020  et('ip').       
-00023220: 2020 2020 2020 2020 2069 6620 636f 6e66           if conf
-00023230: 6967 2e74 7970 6520 3d3d 2027 6b75 6265  ig.type == 'kube
-00023240: 7669 7274 273a 0a20 2020 2020 2020 2020  virt':.         
-00023250: 2020 2020 2020 2020 2020 2069 6620 6b2e             if k.
-00023260: 6163 6365 7373 5f6d 6f64 6520 3d3d 2027  access_mode == '
-00023270: 4e6f 6465 506f 7274 273a 0a20 2020 2020  NodePort':.     
-00023280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023290: 2020 2076 6d70 6f72 7420 3d20 696e 666f     vmport = info
-000232a0: 2e67 6574 2827 6e6f 6465 706f 7274 2729  .get('nodeport')
-000232b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000232c0: 2020 2020 2020 2020 2069 6620 686f 7374           if host
-000232d0: 6970 2069 7320 4e6f 6e65 3a0a 2020 2020  ip is None:.    
-000232e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000232f0: 2020 2020 2020 2020 686f 7374 6970 203d          hostip =
-00023300: 206b 2e6e 6f64 655f 686f 7374 286e 616d   k.node_host(nam
-00023310: 653d 696e 666f 2e67 6574 2827 686f 7374  e=info.get('host
-00023320: 2729 290a 2020 2020 2020 2020 2020 2020  ')).            
-00023330: 2020 2020 2020 2020 2020 2020 6970 203d              ip =
-00023340: 2068 6f73 7469 700a 2020 2020 2020 2020   hostip.        
-00023350: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00023360: 206b 2e61 6363 6573 735f 6d6f 6465 203d   k.access_mode =
-00023370: 3d20 274c 6f61 6442 616c 616e 6365 7227  = 'LoadBalancer'
-00023380: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023390: 2020 2020 2020 2020 2020 6970 203d 2069            ip = i
-000233a0: 6e66 6f2e 6765 7428 276c 6f61 6462 616c  nfo.get('loadbal
-000233b0: 616e 6365 7269 7027 290a 2020 2020 2020  ancerip').      
-000233c0: 2020 2020 2020 2020 2020 6966 2075 7365            if use
-000233d0: 7220 6973 206e 6f74 204e 6f6e 6520 616e  r is not None an
-000233e0: 6420 6970 2069 7320 6e6f 7420 4e6f 6e65  d ip is not None
-000233f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023400: 2020 2020 2020 6966 2063 6f6e 6669 672e        if config.
-00023410: 7479 7065 203d 3d20 276f 7065 6e73 7461  type == 'opensta
-00023420: 636b 2720 616e 6420 696e 666f 2e67 6574  ck' and info.get
-00023430: 2827 7072 6976 6174 6569 7027 2920 3d3d  ('privateip') ==
-00023440: 2069 7020 616e 6420 6b2e 6578 7465 726e   ip and k.extern
-00023450: 616c 5f6e 6574 776f 726b 2069 7320 6e6f  al_network is no
-00023460: 7420 4e6f 6e65 5c0a 2020 2020 2020 2020  t None\.        
-00023470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023480: 2020 2020 616e 6420 696e 666f 2e67 6574      and info.get
-00023490: 2827 6e65 7473 2729 5b30 5d5b 276e 6574  ('nets')[0]['net
-000234a0: 275d 2021 3d20 6b2e 6578 7465 726e 616c  '] != k.external
-000234b0: 5f6e 6574 776f 726b 3a0a 2020 2020 2020  _network:.      
-000234c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000234d0: 2020 7761 726e 696e 6728 2257 6169 7469    warning("Waiti
-000234e0: 6e67 2066 6f72 2066 6c6f 6174 696e 6720  ng for floating 
-000234f0: 6970 2069 6e73 7465 6164 206f 6620 6120  ip instead of a 
-00023500: 7072 6976 6174 6520 6970 2e2e 2e22 290a  private ip...").
-00023510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023520: 2020 2020 2020 2020 6970 203d 204e 6f6e          ip = Non
-00023530: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00023540: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00023550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023560: 2020 2020 7465 7374 636d 6420 3d20 636f      testcmd = co
-00023570: 6d6d 6f6e 2e73 7368 286e 616d 652c 2075  mmon.ssh(name, u
-00023580: 7365 723d 7573 6572 2c20 6970 3d69 702c  ser=user, ip=ip,
-00023590: 2074 756e 6e65 6c3d 636f 6e66 6967 2e74   tunnel=config.t
-000235a0: 756e 6e65 6c2c 2074 756e 6e65 6c68 6f73  unnel, tunnelhos
-000235b0: 743d 636f 6e66 6967 2e74 756e 6e65 6c68  t=config.tunnelh
-000235c0: 6f73 742c 0a20 2020 2020 2020 2020 2020  ost,.           
-000235d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000229b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000229c0: 2020 2020 2064 6e73 636c 6965 6e74 3d64       dnsclient=d
+000229d0: 6e73 636c 6965 6e74 2c20 7375 626e 6574  nsclient, subnet
+000229e0: 6964 3d73 7562 6e65 7469 642c 2069 703d  id=subnetid, ip=
+000229f0: 6970 290a 2020 2020 2020 2020 2020 2020  ip).            
+00022a00: 6966 2064 6e73 636c 6965 6e74 2069 7320  if dnsclient is 
+00022a10: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00022a20: 2020 2020 2020 2020 2020 6966 2064 6e73            if dns
+00022a30: 636c 6965 6e74 2069 6e20 7365 6c66 2e63  client in self.c
+00022a40: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
+00022a50: 2020 2020 2020 2020 2020 2020 7a20 3d20              z = 
+00022a60: 4b63 6f6e 6669 6728 636c 6965 6e74 3d64  Kconfig(client=d
+00022a70: 6e73 636c 6965 6e74 292e 6b0a 2020 2020  nsclient).k.    
+00022a80: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00022a90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00022aa0: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
+00022ab0: 436c 6965 6e74 207b 646e 7363 6c69 656e  Client {dnsclien
+00022ac0: 747d 206e 6f74 2066 6f75 6e64 2e20 536b  t} not found. Sk
+00022ad0: 6970 7069 6e67 2229 0a20 2020 2020 2020  ipping").       
+00022ae0: 2020 2020 2020 2020 207a 2e72 6573 6572           z.reser
+00022af0: 7665 5f64 6e73 286e 616d 652e 7265 706c  ve_dns(name.repl
+00022b00: 6163 6528 275f 272c 2027 2d27 292c 2069  ace('_', '-'), i
+00022b10: 703d 6c62 5f69 702c 2064 6f6d 6169 6e3d  p=lb_ip, domain=
+00022b20: 646f 6d61 696e 2c20 616c 6961 733d 616c  domain, alias=al
+00022b30: 6961 7329 0a20 2020 2020 2020 2065 6c73  ias).        els
+00022b40: 653a 0a20 2020 2020 2020 2020 2020 2076  e:.            v
+00022b50: 6d69 6e66 6f20 3d20 5b5d 0a20 2020 2020  minfo = [].     
+00022b60: 2020 2020 2020 2066 6f72 2076 6d20 696e         for vm in
+00022b70: 2076 6d73 3a0a 2020 2020 2020 2020 2020   vms:.          
+00022b80: 2020 2020 2020 6966 2076 616c 6964 5f69        if valid_i
+00022b90: 7028 766d 293a 0a20 2020 2020 2020 2020  p(vm):.         
+00022ba0: 2020 2020 2020 2020 2020 2076 6d6e 616d             vmnam
+00022bb0: 6520 3d20 766d 2e72 6570 6c61 6365 2827  e = vm.replace('
+00022bc0: 3a27 2c20 272d 2729 2e72 6570 6c61 6365  :', '-').replace
+00022bd0: 2827 2e27 2c20 272d 2729 0a20 2020 2020  ('.', '-').     
+00022be0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00022bf0: 6d69 6e66 6f2e 6170 7065 6e64 287b 276e  minfo.append({'n
+00022c00: 616d 6527 3a20 766d 6e61 6d65 2c20 2769  ame': vmname, 'i
+00022c10: 7027 3a20 766d 7d29 0a20 2020 2020 2020  p': vm}).       
+00022c20: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00022c30: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+00022c40: 2020 2020 2020 636f 756e 7465 7220 3d20        counter = 
+00022c50: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
+00022c60: 2020 7768 696c 6520 636f 756e 7465 7220    while counter 
+00022c70: 213d 2031 3030 3a0a 2020 2020 2020 2020  != 100:.        
+00022c80: 2020 2020 2020 2020 2020 2020 6970 203d              ip =
+00022c90: 206b 2e69 7028 766d 290a 2020 2020 2020   k.ip(vm).      
+00022ca0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00022cb0: 2069 7020 6973 204e 6f6e 653a 0a20 2020   ip is None:.   
+00022cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022cd0: 2020 2020 2073 6c65 6570 2835 290a 2020       sleep(5).  
+00022ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022cf0: 2020 2020 2020 7072 696e 7428 6622 5761        print(f"Wa
+00022d00: 6974 696e 6720 3520 7365 636f 6e64 7320  iting 5 seconds 
+00022d10: 746f 2067 7261 6220 6970 2066 6f72 2076  to grab ip for v
+00022d20: 6d20 7b76 6d7d 2e2e 2e22 290a 2020 2020  m {vm}...").    
+00022d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022d40: 2020 2020 636f 756e 7465 7220 2b3d 2035      counter += 5
+00022d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022d60: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00022d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022d80: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+00022d90: 2020 2020 2020 2020 2076 6d69 6e66 6f2e           vminfo.
+00022da0: 6170 7065 6e64 287b 276e 616d 6527 3a20  append({'name': 
+00022db0: 766d 2c20 2769 7027 3a20 6970 7d29 0a20  vm, 'ip': ip}). 
+00022dc0: 2020 2020 2020 2020 2020 206f 7665 7272             overr
+00022dd0: 6964 6573 203d 207b 0a20 2020 2020 2020  ides = {.       
+00022de0: 2020 2020 2020 2020 2022 6e61 6d65 223a           "name":
+00022df0: 206e 616d 652c 0a20 2020 2020 2020 2020   name,.         
+00022e00: 2020 2020 2020 2022 766d 7322 3a20 766d         "vms": vm
+00022e10: 696e 666f 2c0a 2020 2020 2020 2020 2020  info,.          
+00022e20: 2020 2020 2020 226e 6574 7322 3a20 6e65        "nets": ne
+00022e30: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00022e40: 2020 2020 2270 6f72 7473 223a 2070 6f72      "ports": por
+00022e50: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00022e60: 2020 2020 2263 6865 636b 7061 7468 223a      "checkpath":
+00022e70: 2063 6865 636b 7061 7468 2c0a 2020 2020   checkpath,.    
+00022e80: 2020 2020 2020 2020 2020 2020 2264 6f6d              "dom
+00022e90: 6169 6e22 3a20 646f 6d61 696e 2c0a 2020  ain": domain,.  
+00022ea0: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+00022eb0: 2020 2020 2020 2020 7365 6c66 2e70 6c61          self.pla
+00022ec0: 6e28 706c 616e 2c20 696e 7075 7473 7472  n(plan, inputstr
+00022ed0: 696e 673d 6861 7072 6f78 7970 6c61 6e2c  ing=haproxyplan,
+00022ee0: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
+00022ef0: 6964 6573 290a 0a20 2020 2064 6566 206c  ides)..    def l
+00022f00: 6973 745f 6c6f 6164 6261 6c61 6e63 6572  ist_loadbalancer
+00022f10: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+00022f20: 206b 203d 2073 656c 662e 6b0a 2020 2020   k = self.k.    
+00022f30: 2020 2020 6966 2073 656c 662e 7479 7065      if self.type
+00022f40: 206e 6f74 2069 6e20 5b27 6177 7327 2c20   not in ['aws', 
+00022f50: 2767 6370 272c 2027 6962 6d27 5d3a 0a20  'gcp', 'ibm']:. 
+00022f60: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00022f70: 7473 203d 205b 5d0a 2020 2020 2020 2020  ts = [].        
+00022f80: 2020 2020 666f 7220 766d 2069 6e20 6b2e      for vm in k.
+00022f90: 6c69 7374 2829 3a0a 2020 2020 2020 2020  list():.        
+00022fa0: 2020 2020 2020 2020 6966 2076 6d5b 2770          if vm['p
+00022fb0: 726f 6669 6c65 275d 2e73 7461 7274 7377  rofile'].startsw
+00022fc0: 6974 6828 276c 6f61 6462 616c 616e 6365  ith('loadbalance
+00022fd0: 7227 2920 616e 6420 6c65 6e28 766d 5b27  r') and len(vm['
+00022fe0: 7072 6f66 696c 6527 5d2e 7370 6c69 7428  profile'].split(
+00022ff0: 272d 2729 2920 3d3d 2032 3a0a 2020 2020  '-')) == 2:.    
+00023000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023010: 706f 7274 7320 3d20 766d 5b27 7072 6f66  ports = vm['prof
+00023020: 696c 6527 5d2e 7370 6c69 7428 272d 2729  ile'].split('-')
+00023030: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
+00023040: 2020 2020 2020 2020 7265 7375 6c74 732e          results.
+00023050: 6170 7065 6e64 285b 766d 5b27 6e61 6d65  append([vm['name
+00023060: 275d 2c20 766d 5b27 6970 275d 2c20 2774  '], vm['ip'], 't
+00023070: 6370 272c 2070 6f72 7473 2c20 2727 5d29  cp', ports, ''])
+00023080: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00023090: 7572 6e20 7265 7375 6c74 730a 2020 2020  urn results.    
+000230a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000230b0: 2020 2020 2020 7265 7475 726e 206b 2e6c        return k.l
+000230c0: 6973 745f 6c6f 6164 6261 6c61 6e63 6572  ist_loadbalancer
+000230d0: 7328 290a 0a20 2020 2064 6566 2077 6169  s()..    def wai
+000230e0: 745f 6669 6e69 7368 2873 656c 662c 206e  t_finish(self, n
+000230f0: 616d 652c 2069 6d61 6765 3d4e 6f6e 652c  ame, image=None,
+00023100: 2071 7569 6574 3d46 616c 7365 2c20 7761   quiet=False, wa
+00023110: 6974 636f 6d6d 616e 643d 4e6f 6e65 2c20  itcommand=None, 
+00023120: 7761 6974 7469 6d65 6f75 743d 302c 2069  waittimeout=0, i
+00023130: 6465 6e74 6974 7966 696c 653d 4e6f 6e65  dentityfile=None
+00023140: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00023150: 2020 2020 2020 766d 636c 6965 6e74 3d4e        vmclient=N
+00023160: 6f6e 6529 3a0a 2020 2020 2020 2020 636f  one):.        co
+00023170: 6e66 6967 203d 204b 636f 6e66 6967 2863  nfig = Kconfig(c
+00023180: 6c69 656e 743d 766d 636c 6965 6e74 2920  lient=vmclient) 
+00023190: 6966 2076 6d63 6c69 656e 7420 6973 206e  if vmclient is n
+000231a0: 6f74 204e 6f6e 6520 656c 7365 2073 656c  ot None else sel
+000231b0: 660a 2020 2020 2020 2020 6b20 3d20 636f  f.        k = co
+000231c0: 6e66 6967 2e6b 0a20 2020 2020 2020 2069  nfig.k.        i
+000231d0: 6620 696d 6167 6520 6973 204e 6f6e 653a  f image is None:
+000231e0: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
+000231f0: 6765 203d 206b 2e69 6e66 6f28 6e61 6d65  ge = k.info(name
+00023200: 295b 2769 6d61 6765 275d 0a20 2020 2020  )['image'].     
+00023210: 2020 2070 7072 696e 7428 6622 5761 6974     pprint(f"Wait
+00023220: 696e 6720 666f 7220 766d 207b 6e61 6d65  ing for vm {name
+00023230: 7d20 746f 2066 696e 6973 6820 6375 7374  } to finish cust
+00023240: 6f6d 6973 6174 696f 6e22 290a 2020 2020  omisation").    
+00023250: 2020 2020 6966 2077 6169 7463 6f6d 6d61      if waitcomma
+00023260: 6e64 2069 7320 6e6f 7420 4e6f 6e65 2061  nd is not None a
+00023270: 6e64 2027 323e 2720 6e6f 7420 696e 2077  nd '2>' not in w
+00023280: 6169 7463 6f6d 6d61 6e64 3a0a 2020 2020  aitcommand:.    
+00023290: 2020 2020 2020 2020 7761 6974 636f 6d6d          waitcomm
+000232a0: 616e 6420 2b3d 2022 2032 3e2f 6465 762f  and += " 2>/dev/
+000232b0: 6e75 6c6c 220a 2020 2020 2020 2020 6966  null".        if
+000232c0: 2063 6f6d 6d6f 6e2e 6e65 6564 735f 6967   common.needs_ig
+000232d0: 6e69 7469 6f6e 2869 6d61 6765 293a 0a20  nition(image):. 
+000232e0: 2020 2020 2020 2020 2020 2063 6d64 203d             cmd =
+000232f0: 2077 6169 7463 6f6d 6d61 6e64 206f 7220   waitcommand or 
+00023300: 2773 7564 6f20 6a6f 7572 6e61 6c63 746c  'sudo journalctl
+00023310: 202d 2d61 6c6c 202d 2d6e 6f2d 7061 6765   --all --no-page
+00023320: 7227 0a20 2020 2020 2020 2065 6c73 653a  r'.        else:
+00023330: 0a20 2020 2020 2020 2020 2020 2063 6d64  .            cmd
+00023340: 203d 2077 6169 7463 6f6d 6d61 6e64 206f   = waitcommand o
+00023350: 7220 6622 7375 646f 2074 6169 6c20 2d6e  r f"sudo tail -n
+00023360: 2035 3020 7b63 6f6d 6d6f 6e2e 6765 745f   50 {common.get_
+00023370: 636c 6f75 6469 6e69 7466 696c 6528 696d  cloudinitfile(im
+00023380: 6167 6529 7d22 0a20 2020 2020 2020 2075  age)}".        u
+00023390: 7365 722c 2069 702c 2076 6d70 6f72 7420  ser, ip, vmport 
+000233a0: 3d20 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f  = None, None, No
+000233b0: 6e65 0a20 2020 2020 2020 2068 6f73 7469  ne.        hosti
+000233c0: 7020 3d20 4e6f 6e65 0a20 2020 2020 2020  p = None.       
+000233d0: 2074 696d 656f 7574 203d 2030 0a20 2020   timeout = 0.   
+000233e0: 2020 2020 2077 6869 6c65 2069 7020 6973       while ip is
+000233f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00023400: 2020 2069 6e66 6f20 3d20 6b2e 696e 666f     info = k.info
+00023410: 286e 616d 6529 0a20 2020 2020 2020 2020  (name).         
+00023420: 2020 2069 6620 636f 6e66 6967 2e74 7970     if config.typ
+00023430: 6520 3d3d 2027 7061 636b 6574 2720 616e  e == 'packet' an
+00023440: 6420 696e 666f 2e67 6574 2827 7374 6174  d info.get('stat
+00023450: 7573 2729 2021 3d20 2761 6374 6976 6527  us') != 'active'
+00023460: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00023470: 2020 7761 726e 696e 6728 2257 6169 7469    warning("Waiti
+00023480: 6e67 2066 6f72 206e 6f64 6520 746f 2062  ng for node to b
+00023490: 6520 6163 7469 7665 2229 0a20 2020 2020  e active").     
+000234a0: 2020 2020 2020 2020 2020 2069 7020 3d20             ip = 
+000234b0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+000234c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000234d0: 2020 2020 2020 2075 7365 722c 2069 7020         user, ip 
+000234e0: 3d20 636f 6e66 6967 2e76 6d75 7365 7220  = config.vmuser 
+000234f0: 6f72 2069 6e66 6f2e 6765 7428 2775 7365  or info.get('use
+00023500: 7227 292c 2069 6e66 6f2e 6765 7428 2769  r'), info.get('i
+00023510: 7027 290a 2020 2020 2020 2020 2020 2020  p').            
+00023520: 2020 2020 6966 2063 6f6e 6669 672e 7479      if config.ty
+00023530: 7065 203d 3d20 276b 7562 6576 6972 7427  pe == 'kubevirt'
+00023540: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00023550: 2020 2020 2020 6966 206b 2e61 6363 6573        if k.acces
+00023560: 735f 6d6f 6465 203d 3d20 274e 6f64 6550  s_mode == 'NodeP
+00023570: 6f72 7427 3a0a 2020 2020 2020 2020 2020  ort':.          
+00023580: 2020 2020 2020 2020 2020 2020 2020 766d                vm
+00023590: 706f 7274 203d 2069 6e66 6f2e 6765 7428  port = info.get(
+000235a0: 276e 6f64 6570 6f72 7427 290a 2020 2020  'nodeport').    
+000235b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000235c0: 2020 2020 6966 2068 6f73 7469 7020 6973      if hostip is
+000235d0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
 000235e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000235f0: 2020 7475 6e6e 656c 706f 7274 3d63 6f6e    tunnelport=con
-00023600: 6669 672e 7475 6e6e 656c 706f 7274 2c20  fig.tunnelport, 
-00023610: 7475 6e6e 656c 7573 6572 3d63 6f6e 6669  tunneluser=confi
-00023620: 672e 7475 6e6e 656c 7573 6572 2c0a 2020  g.tunneluser,.  
-00023630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023650: 2020 2020 2020 2020 2020 2069 6e73 6563             insec
-00023660: 7572 653d 636f 6e66 6967 2e69 6e73 6563  ure=config.insec
-00023670: 7572 652c 2063 6d64 3d27 6964 202d 756e  ure, cmd='id -un
-00023680: 272c 2076 6d70 6f72 743d 766d 706f 7274  ', vmport=vmport
-00023690: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000236a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000236b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000236c0: 6465 6e74 6974 7966 696c 653d 6964 656e  dentityfile=iden
-000236d0: 7469 7479 6669 6c65 2c20 7061 7373 776f  tityfile, passwo
-000236e0: 7264 3d46 616c 7365 290a 2020 2020 2020  rd=False).      
+000235f0: 2020 2068 6f73 7469 7020 3d20 6b2e 6e6f     hostip = k.no
+00023600: 6465 5f68 6f73 7428 6e61 6d65 3d69 6e66  de_host(name=inf
+00023610: 6f2e 6765 7428 2768 6f73 7427 2929 0a20  o.get('host')). 
+00023620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023630: 2020 2020 2020 2069 7020 3d20 686f 7374         ip = host
+00023640: 6970 0a20 2020 2020 2020 2020 2020 2020  ip.             
+00023650: 2020 2020 2020 2065 6c69 6620 6b2e 6163         elif k.ac
+00023660: 6365 7373 5f6d 6f64 6520 3d3d 2027 4c6f  cess_mode == 'Lo
+00023670: 6164 4261 6c61 6e63 6572 273a 0a20 2020  adBalancer':.   
+00023680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023690: 2020 2020 2069 7020 3d20 696e 666f 2e67       ip = info.g
+000236a0: 6574 2827 6c6f 6164 6261 6c61 6e63 6572  et('loadbalancer
+000236b0: 6970 2729 0a20 2020 2020 2020 2020 2020  ip').           
+000236c0: 2020 2020 2069 6620 7573 6572 2069 7320       if user is 
+000236d0: 6e6f 7420 4e6f 6e65 2061 6e64 2069 7020  not None and ip 
+000236e0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
 000236f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023700: 2020 6966 206f 732e 706f 7065 6e28 7465    if os.popen(te
-00023710: 7374 636d 6429 2e72 6561 6428 292e 7374  stcmd).read().st
-00023720: 7269 7028 2920 213d 2075 7365 723a 0a20  rip() != user:. 
-00023730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023740: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-00023750: 6e67 2822 4761 7468 6572 6564 2069 7020  ng("Gathered ip 
-00023760: 6e6f 7420 6675 6e63 7469 6f6e 616c 2079  not functional y
-00023770: 6574 2e2e 2e22 290a 2020 2020 2020 2020  et...").        
-00023780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023790: 2020 2020 6970 203d 204e 6f6e 650a 2020      ip = None.  
-000237a0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-000237b0: 2822 5761 6974 696e 6720 666f 7220 766d  ("Waiting for vm
-000237c0: 2074 6f20 6265 2061 6363 6573 7369 626c   to be accessibl
-000237d0: 652e 2e2e 2229 0a20 2020 2020 2020 2020  e...").         
-000237e0: 2020 2073 6c65 6570 2835 290a 2020 2020     sleep(5).    
-000237f0: 2020 2020 2020 2020 7469 6d65 6f75 7420          timeout 
-00023800: 2b3d 2035 0a20 2020 2020 2020 2020 2020  += 5.           
-00023810: 2069 6620 7761 6974 7469 6d65 6f75 7420   if waittimeout 
-00023820: 3e20 3020 616e 6420 7469 6d65 6f75 7420  > 0 and timeout 
-00023830: 3e20 7761 6974 7469 6d65 6f75 743a 0a20  > waittimeout:. 
-00023840: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00023850: 7272 6f72 2822 5469 6d65 6f75 7420 7761  rror("Timeout wa
-00023860: 6974 696e 6720 666f 7220 766d 2074 6f20  iting for vm to 
-00023870: 6265 2061 6363 6573 7369 626c 652e 2e2e  be accessible...
-00023880: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00023890: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-000238a0: 2073 6c65 6570 2835 290a 2020 2020 2020   sleep(5).      
-000238b0: 2020 6f6c 646f 7574 7075 7420 3d20 2727    oldoutput = ''
-000238c0: 0a20 2020 2020 2020 2074 696d 656f 7574  .        timeout
-000238d0: 203d 2030 0a20 2020 2020 2020 2077 6869   = 0.        whi
-000238e0: 6c65 2054 7275 653a 0a20 2020 2020 2020  le True:.       
-000238f0: 2020 2020 2073 7368 636d 6420 3d20 636f       sshcmd = co
-00023900: 6d6d 6f6e 2e73 7368 286e 616d 652c 2075  mmon.ssh(name, u
-00023910: 7365 723d 2772 6f6f 7427 2c20 6970 3d69  ser='root', ip=i
-00023920: 702c 2074 756e 6e65 6c3d 636f 6e66 6967  p, tunnel=config
-00023930: 2e74 756e 6e65 6c2c 2074 756e 6e65 6c68  .tunnel, tunnelh
-00023940: 6f73 743d 636f 6e66 6967 2e74 756e 6e65  ost=config.tunne
-00023950: 6c68 6f73 742c 0a20 2020 2020 2020 2020  lhost,.         
-00023960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023970: 2020 2020 2020 2076 6d70 6f72 743d 766d         vmport=vm
-00023980: 706f 7274 2c20 7475 6e6e 656c 706f 7274  port, tunnelport
-00023990: 3d63 6f6e 6669 672e 7475 6e6e 656c 706f  =config.tunnelpo
-000239a0: 7274 2c20 7475 6e6e 656c 7573 6572 3d63  rt, tunneluser=c
-000239b0: 6f6e 6669 672e 7475 6e6e 656c 7573 6572  onfig.tunneluser
-000239c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000239d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000239e0: 2020 696e 7365 6375 7265 3d63 6f6e 6669    insecure=confi
-000239f0: 672e 696e 7365 6375 7265 2c20 636d 643d  g.insecure, cmd=
-00023a00: 636d 642c 2069 6465 6e74 6974 7966 696c  cmd, identityfil
-00023a10: 653d 6964 656e 7469 7479 6669 6c65 2c20  e=identityfile, 
-00023a20: 7061 7373 776f 7264 3d46 616c 7365 290a  password=False).
-00023a30: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
-00023a40: 7574 203d 206f 732e 706f 7065 6e28 7373  ut = os.popen(ss
-00023a50: 6863 6d64 292e 7265 6164 2829 0a20 2020  hcmd).read().   
-00023a60: 2020 2020 2020 2020 2069 6620 7761 6974           if wait
-00023a70: 636f 6d6d 616e 6420 6973 206e 6f74 204e  command is not N
-00023a80: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00023a90: 2020 2020 2069 6620 6f75 7470 7574 2021       if output !
-00023aa0: 3d20 2727 3a0a 2020 2020 2020 2020 2020  = '':.          
-00023ab0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00023ac0: 6f75 7470 7574 290a 2020 2020 2020 2020  output).        
-00023ad0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00023ae0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-00023af0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00023b00: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-00023b10: 6e74 2822 5761 6974 696e 6720 666f 7220  nt("Waiting for 
-00023b20: 7761 6974 636f 6d6d 616e 6420 746f 2073  waitcommand to s
-00023b30: 7563 6365 6564 2e2e 2e22 290a 2020 2020  ucceed...").    
-00023b40: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00023b50: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00023b60: 2027 6b63 6c69 2062 6f6f 7420 6669 6e69   'kcli boot fini
-00023b70: 7368 6564 2720 696e 206f 7574 7075 7420  shed' in output 
-00023b80: 6f72 2027 4967 6e69 7469 6f6e 2066 696e  or 'Ignition fin
-00023b90: 6973 6865 6420 7375 6363 6573 7366 756c  ished successful
-00023ba0: 6c79 2720 696e 206f 7574 7075 7420 6f72  ly' in output or
-00023bb0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00023bc0: 2020 2020 2027 4669 6e69 7368 6564 2043       'Finished C
-00023bd0: 6f6d 6275 7374 696f 6e27 2069 6e20 6f75  ombustion' in ou
-00023be0: 7470 7574 3a0a 2020 2020 2020 2020 2020  tput:.          
-00023bf0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00023c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c10: 6f75 7470 7574 203d 206f 7574 7075 742e  output = output.
-00023c20: 7265 706c 6163 6528 6f6c 646f 7574 7075  replace(oldoutpu
-00023c30: 742c 2027 2729 0a20 2020 2020 2020 2020  t, '').         
-00023c40: 2020 2020 2020 2069 6620 6e6f 7420 7175         if not qu
-00023c50: 6965 743a 0a20 2020 2020 2020 2020 2020  iet:.           
-00023c60: 2020 2020 2020 2020 2070 7269 6e74 286f           print(o
-00023c70: 7574 7075 7429 0a20 2020 2020 2020 2020  utput).         
-00023c80: 2020 2020 2020 206f 6c64 6f75 7470 7574         oldoutput
-00023c90: 203d 206f 7574 7075 740a 2020 2020 2020   = output.      
-00023ca0: 2020 2020 2020 736c 6565 7028 3229 0a20        sleep(2). 
-00023cb0: 2020 2020 2020 2020 2020 2074 696d 656f             timeo
-00023cc0: 7574 202b 3d20 320a 2020 2020 2020 2020  ut += 2.        
-00023cd0: 2020 2020 6966 2077 6169 7474 696d 656f      if waittimeo
-00023ce0: 7574 203e 2030 2061 6e64 2074 696d 656f  ut > 0 and timeo
-00023cf0: 7574 203e 2077 6169 7474 696d 656f 7574  ut > waittimeout
-00023d00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023d10: 2020 6572 726f 7228 2254 696d 656f 7574    error("Timeout
-00023d20: 2077 6169 7469 6e67 2066 6f72 2077 6169   waiting for wai
-00023d30: 7463 6f6d 6d61 6e64 2074 6f20 6578 6563  tcommand to exec
-00023d40: 7574 652e 2e2e 2229 0a20 2020 2020 2020  ute...").       
-00023d50: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-00023d60: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00023d70: 7565 0a0a 2020 2020 6465 6620 636c 6561  ue..    def clea
-00023d80: 6e5f 7465 6d70 6b65 7928 7365 6c66 2c20  n_tempkey(self, 
-00023d90: 6e61 6d65 2c20 6964 656e 7469 7479 6669  name, identityfi
-00023da0: 6c65 3d4e 6f6e 6529 3a0a 2020 2020 2020  le=None):.      
-00023db0: 2020 636d 6420 3d20 2273 6564 202d 6920    cmd = "sed -i 
-00023dc0: 272f 7465 6d70 2d6b 636c 692d 6b65 792f  '/temp-kcli-key/
-00023dd0: 6427 202f 686f 6d65 2f2a 2f2e 7373 682f  d' /home/*/.ssh/
-00023de0: 6175 7468 6f72 697a 6564 5f6b 6579 7320  authorized_keys 
-00023df0: 2f72 6f6f 742f 2e73 7368 2f61 7574 686f  /root/.ssh/autho
-00023e00: 7269 7a65 645f 6b65 7973 220a 2020 2020  rized_keys".    
-00023e10: 2020 2020 6b20 3d20 7365 6c66 2e6b 0a20      k = self.k. 
-00023e20: 2020 2020 2020 2069 6e66 6f20 3d20 6b2e         info = k.
-00023e30: 696e 666f 286e 616d 6529 0a20 2020 2020  info(name).     
-00023e40: 2020 2076 6d70 6f72 7420 3d20 4e6f 6e65     vmport = None
-00023e50: 0a20 2020 2020 2020 2069 7020 3d20 696e  .        ip = in
-00023e60: 666f 2e67 6574 2827 6970 2729 0a20 2020  fo.get('ip').   
-00023e70: 2020 2020 2069 6620 7365 6c66 2e74 7970       if self.typ
-00023e80: 6520 3d3d 2027 6b75 6265 7669 7274 273a  e == 'kubevirt':
-00023e90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00023ea0: 6b2e 6163 6365 7373 5f6d 6f64 6520 3d3d  k.access_mode ==
-00023eb0: 2027 4e6f 6465 506f 7274 273a 0a20 2020   'NodePort':.   
-00023ec0: 2020 2020 2020 2020 2020 2020 2076 6d70               vmp
-00023ed0: 6f72 7420 3d20 696e 666f 2e67 6574 2827  ort = info.get('
-00023ee0: 6e6f 6465 706f 7274 2729 0a20 2020 2020  nodeport').     
-00023ef0: 2020 2020 2020 2020 2020 2069 7020 3d20             ip = 
-00023f00: 6b2e 6e6f 6465 5f68 6f73 7428 6e61 6d65  k.node_host(name
-00023f10: 3d69 6e66 6f2e 6765 7428 2768 6f73 7427  =info.get('host'
-00023f20: 2929 0a20 2020 2020 2020 2020 2020 2065  )).            e
-00023f30: 6c69 6620 6b2e 6163 6365 7373 5f6d 6f64  lif k.access_mod
-00023f40: 6520 3d3d 2027 4c6f 6164 4261 6c61 6e63  e == 'LoadBalanc
-00023f50: 6572 273a 0a20 2020 2020 2020 2020 2020  er':.           
-00023f60: 2020 2020 2069 7020 3d20 696e 666f 2e67       ip = info.g
-00023f70: 6574 2827 6c6f 6164 6261 6c61 6e63 6572  et('loadbalancer
-00023f80: 6970 2729 0a20 2020 2020 2020 2073 7368  ip').        ssh
-00023f90: 636d 6420 3d20 636f 6d6d 6f6e 2e73 7368  cmd = common.ssh
-00023fa0: 286e 616d 652c 2075 7365 723d 2772 6f6f  (name, user='roo
-00023fb0: 7427 2c20 6970 3d69 702c 2074 756e 6e65  t', ip=ip, tunne
-00023fc0: 6c3d 7365 6c66 2e74 756e 6e65 6c2c 2074  l=self.tunnel, t
-00023fd0: 756e 6e65 6c68 6f73 743d 7365 6c66 2e74  unnelhost=self.t
-00023fe0: 756e 6e65 6c68 6f73 742c 2076 6d70 6f72  unnelhost, vmpor
-00023ff0: 743d 766d 706f 7274 2c0a 2020 2020 2020  t=vmport,.      
-00024000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024010: 2020 2020 2020 7475 6e6e 656c 706f 7274        tunnelport
-00024020: 3d73 656c 662e 7475 6e6e 656c 706f 7274  =self.tunnelport
-00024030: 2c20 7475 6e6e 656c 7573 6572 3d73 656c  , tunneluser=sel
-00024040: 662e 7475 6e6e 656c 7573 6572 2c20 696e  f.tunneluser, in
-00024050: 7365 6375 7265 3d73 656c 662e 696e 7365  secure=self.inse
-00024060: 6375 7265 2c20 636d 643d 636d 642c 0a20  cure, cmd=cmd,. 
-00024070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024080: 2020 2020 2020 2020 2020 2069 6465 6e74             ident
-00024090: 6974 7966 696c 653d 6964 656e 7469 7479  ityfile=identity
-000240a0: 6669 6c65 2c20 7061 7373 776f 7264 3d46  file, password=F
-000240b0: 616c 7365 290a 2020 2020 2020 2020 6f73  alse).        os
-000240c0: 2e70 6f70 656e 2873 7368 636d 6429 2e72  .popen(sshcmd).r
-000240d0: 6561 6428 290a 0a20 2020 2064 6566 2074  ead()..    def t
-000240e0: 6872 6561 6465 645f 6372 6561 7465 5f6b  hreaded_create_k
-000240f0: 7562 6528 7365 6c66 2c20 636c 7573 7465  ube(self, cluste
-00024100: 722c 206b 7562 6574 7970 652c 206b 7562  r, kubetype, kub
-00024110: 655f 6f76 6572 7269 6465 7329 3a0a 2020  e_overrides):.  
-00024120: 2020 2020 2020 6970 706f 6f6c 203d 206b        ippool = k
-00024130: 7562 655f 6f76 6572 7269 6465 732e 6765  ube_overrides.ge
-00024140: 7428 2769 7070 6f6f 6c27 2920 6f72 206b  t('ippool') or k
-00024150: 7562 655f 6f76 6572 7269 6465 732e 6765  ube_overrides.ge
-00024160: 7428 2763 6f6e 6670 6f6f 6c27 290a 2020  t('confpool').  
-00024170: 2020 2020 2020 6261 7265 6d65 7461 6c70        baremetalp
-00024180: 6f6f 6c20 3d20 6b75 6265 5f6f 7665 7272  ool = kube_overr
-00024190: 6964 6573 2e67 6574 2827 6970 706f 6f6c  ides.get('ippool
-000241a0: 2729 206f 7220 6b75 6265 5f6f 7665 7272  ') or kube_overr
-000241b0: 6964 6573 2e67 6574 2827 636f 6e66 706f  ides.get('confpo
-000241c0: 6f6c 2729 0a20 2020 2020 2020 2069 6620  ol').        if 
-000241d0: 6970 706f 6f6c 2069 7320 6e6f 7420 4e6f  ippool is not No
-000241e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000241f0: 7365 6c66 2e67 6574 5f76 6970 5f66 726f  self.get_vip_fro
-00024200: 6d5f 636f 6e66 706f 6f6c 2863 6c75 7374  m_confpool(clust
-00024210: 6572 2c20 6970 706f 6f6c 2c20 6f76 6572  er, ippool, over
-00024220: 7269 6465 733d 6b75 6265 5f6f 7665 7272  rides=kube_overr
-00024230: 6964 6573 290a 2020 2020 2020 2020 6966  ides).        if
-00024240: 2062 6172 656d 6574 616c 706f 6f6c 2069   baremetalpool i
-00024250: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00024260: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
-00024270: 5f62 6172 656d 6574 616c 5f68 6f73 7473  _baremetal_hosts
-00024280: 5f66 726f 6d5f 636f 6e66 706f 6f6c 2863  _from_confpool(c
-00024290: 6c75 7374 6572 2c20 6261 7265 6d65 7461  luster, baremeta
-000242a0: 6c70 6f6f 6c2c 206f 7665 7272 6964 6573  lpool, overrides
-000242b0: 3d6b 7562 655f 6f76 6572 7269 6465 7329  =kube_overrides)
-000242c0: 0a20 2020 2020 2020 2073 656c 662e 6372  .        self.cr
-000242d0: 6561 7465 5f6b 7562 6528 636c 7573 7465  eate_kube(cluste
-000242e0: 722c 206b 7562 6574 7970 652c 206b 7562  r, kubetype, kub
-000242f0: 655f 6f76 6572 7269 6465 7329 0a0a 2020  e_overrides)..  
-00024300: 2020 6465 6620 6372 6561 7465 5f6b 7562    def create_kub
-00024310: 6528 7365 6c66 2c20 636c 7573 7465 722c  e(self, cluster,
-00024320: 206b 7562 6574 7970 652c 206f 7665 7272   kubetype, overr
-00024330: 6964 6573 3d7b 7d29 3a0a 2020 2020 2020  ides={}):.      
-00024340: 2020 6966 2073 656c 662e 7479 7065 203d    if self.type =
-00024350: 3d20 2777 6562 2720 616e 6420 7365 6c66  = 'web' and self
-00024360: 2e6b 2e6c 6f63 616c 6b75 6265 3a0a 2020  .k.localkube:.  
-00024370: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00024380: 2073 656c 662e 6b2e 6372 6561 7465 5f6b   self.k.create_k
-00024390: 7562 6528 636c 7573 7465 722c 206b 7562  ube(cluster, kub
-000243a0: 6574 7970 652c 206f 7665 7272 6964 6573  etype, overrides
-000243b0: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
-000243c0: 2020 2020 6970 706f 6f6c 203d 206f 7665      ippool = ove
-000243d0: 7272 6964 6573 2e67 6574 2827 6970 706f  rrides.get('ippo
-000243e0: 6f6c 2729 206f 7220 6f76 6572 7269 6465  ol') or override
-000243f0: 732e 6765 7428 2763 6f6e 6670 6f6f 6c27  s.get('confpool'
-00024400: 290a 2020 2020 2020 2020 6261 7265 6d65  ).        bareme
-00024410: 7461 6c70 6f6f 6c20 3d20 6f76 6572 7269  talpool = overri
-00024420: 6465 732e 6765 7428 2769 7070 6f6f 6c27  des.get('ippool'
-00024430: 2920 6f72 206f 7665 7272 6964 6573 2e67  ) or overrides.g
-00024440: 6574 2827 636f 6e66 706f 6f6c 2729 0a20  et('confpool'). 
-00024450: 2020 2020 2020 2069 6620 6970 706f 6f6c         if ippool
-00024460: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00024470: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
-00024480: 6574 5f76 6970 5f66 726f 6d5f 636f 6e66  et_vip_from_conf
-00024490: 706f 6f6c 2863 6c75 7374 6572 2c20 6970  pool(cluster, ip
-000244a0: 706f 6f6c 2c20 6f76 6572 7269 6465 733d  pool, overrides=
-000244b0: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
-000244c0: 2020 2069 6620 6261 7265 6d65 7461 6c70     if baremetalp
-000244d0: 6f6f 6c20 6973 206e 6f74 204e 6f6e 653a  ool is not None:
-000244e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000244f0: 662e 6765 745f 6261 7265 6d65 7461 6c5f  f.get_baremetal_
-00024500: 686f 7374 735f 6672 6f6d 5f63 6f6e 6670  hosts_from_confp
-00024510: 6f6f 6c28 636c 7573 7465 722c 2062 6172  ool(cluster, bar
-00024520: 656d 6574 616c 706f 6f6c 2c20 6f76 6572  emetalpool, over
-00024530: 7269 6465 733d 6f76 6572 7269 6465 7329  rides=overrides)
-00024540: 0a20 2020 2020 2020 2069 6620 6b75 6265  .        if kube
-00024550: 7479 7065 203d 3d20 276f 7065 6e73 6869  type == 'openshi
-00024560: 6674 273a 0a20 2020 2020 2020 2020 2020  ft':.           
-00024570: 2072 6573 756c 7420 3d20 7365 6c66 2e63   result = self.c
-00024580: 7265 6174 655f 6b75 6265 5f6f 7065 6e73  reate_kube_opens
-00024590: 6869 6674 2863 6c75 7374 6572 2c20 6f76  hift(cluster, ov
-000245a0: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
-000245b0: 7329 0a20 2020 2020 2020 2065 6c69 6620  s).        elif 
-000245c0: 6b75 6265 7479 7065 203d 3d20 2768 7970  kubetype == 'hyp
-000245d0: 6572 7368 6966 7427 3a0a 2020 2020 2020  ershift':.      
-000245e0: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
-000245f0: 656c 662e 6372 6561 7465 5f6b 7562 655f  elf.create_kube_
-00024600: 6879 7065 7273 6869 6674 2863 6c75 7374  hypershift(clust
-00024610: 6572 2c20 6f76 6572 7269 6465 733d 6f76  er, overrides=ov
-00024620: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
-00024630: 2065 6c69 6620 6b75 6265 7479 7065 203d   elif kubetype =
-00024640: 3d20 276d 6963 726f 7368 6966 7427 3a0a  = 'microshift':.
-00024650: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00024660: 6c74 203d 2073 656c 662e 6372 6561 7465  lt = self.create
-00024670: 5f6b 7562 655f 6d69 6372 6f73 6869 6674  _kube_microshift
-00024680: 2863 6c75 7374 6572 2c20 6f76 6572 7269  (cluster, overri
-00024690: 6465 733d 6f76 6572 7269 6465 7329 0a20  des=overrides). 
-000246a0: 2020 2020 2020 2065 6c69 6620 6b75 6265         elif kube
-000246b0: 7479 7065 203d 3d20 276b 3373 273a 0a20  type == 'k3s':. 
-000246c0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-000246d0: 7420 3d20 7365 6c66 2e63 7265 6174 655f  t = self.create_
-000246e0: 6b75 6265 5f6b 3373 2863 6c75 7374 6572  kube_k3s(cluster
-000246f0: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
-00024700: 7269 6465 7329 0a20 2020 2020 2020 2065  rides).        e
-00024710: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00024720: 2072 6573 756c 7420 3d20 7365 6c66 2e63   result = self.c
-00024730: 7265 6174 655f 6b75 6265 5f67 656e 6572  reate_kube_gener
-00024740: 6963 2863 6c75 7374 6572 2c20 6f76 6572  ic(cluster, over
-00024750: 7269 6465 733d 6f76 6572 7269 6465 7329  rides=overrides)
-00024760: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00024770: 7265 7375 6c74 0a0a 2020 2020 6465 6620  result..    def 
-00024780: 6372 6561 7465 5f6b 7562 655f 6765 6e65  create_kube_gene
-00024790: 7269 6328 7365 6c66 2c20 636c 7573 7465  ric(self, cluste
-000247a0: 722c 206f 7665 7272 6964 6573 3d7b 7d29  r, overrides={})
-000247b0: 3a0a 2020 2020 2020 2020 6966 2063 6f6e  :.        if con
-000247c0: 7461 696e 6572 5f6d 6f64 6528 293a 0a20  tainer_mode():. 
-000247d0: 2020 2020 2020 2020 2020 206f 732e 656e             os.en
-000247e0: 7669 726f 6e5b 2750 4154 4827 5d20 2b3d  viron['PATH'] +=
-000247f0: 2027 3a2f 776f 726b 6469 7227 0a20 2020   ':/workdir'.   
-00024800: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00024810: 2020 2020 2020 206f 732e 656e 7669 726f         os.enviro
-00024820: 6e5b 2750 4154 4827 5d20 2b3d 2027 3a25  n['PATH'] += ':%
-00024830: 7327 2025 206f 732e 6765 7463 7764 2829  s' % os.getcwd()
-00024840: 0a20 2020 2020 2020 2070 6c61 6e64 6972  .        plandir
-00024850: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
-00024860: 6d65 286b 7562 6561 646d 2e63 7265 6174  me(kubeadm.creat
-00024870: 652e 5f5f 636f 6465 5f5f 2e63 6f5f 6669  e.__code__.co_fi
-00024880: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
-00024890: 7265 7475 726e 206b 7562 6561 646d 2e63  return kubeadm.c
-000248a0: 7265 6174 6528 7365 6c66 2c20 706c 616e  reate(self, plan
-000248b0: 6469 722c 2063 6c75 7374 6572 2c20 6f76  dir, cluster, ov
-000248c0: 6572 7269 6465 7329 0a0a 2020 2020 6465  errides)..    de
-000248d0: 6620 6372 6561 7465 5f6b 7562 655f 6d69  f create_kube_mi
-000248e0: 6372 6f73 6869 6674 2873 656c 662c 2063  croshift(self, c
-000248f0: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
-00024900: 733d 7b7d 293a 0a20 2020 2020 2020 2069  s={}):.        i
-00024910: 6620 636f 6e74 6169 6e65 725f 6d6f 6465  f container_mode
-00024920: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00024930: 6f73 2e65 6e76 6972 6f6e 5b27 5041 5448  os.environ['PATH
-00024940: 275d 202b 3d20 273a 2f77 6f72 6b64 6972  '] += ':/workdir
-00024950: 270a 2020 2020 2020 2020 656c 7365 3a0a  '.        else:.
-00024960: 2020 2020 2020 2020 2020 2020 6f73 2e65              os.e
-00024970: 6e76 6972 6f6e 5b27 5041 5448 275d 202b  nviron['PATH'] +
-00024980: 3d20 273a 2573 2720 2520 6f73 2e67 6574  = ':%s' % os.get
-00024990: 6377 6428 290a 2020 2020 2020 2020 706c  cwd().        pl
-000249a0: 616e 6469 7220 3d20 6f73 2e70 6174 682e  andir = os.path.
-000249b0: 6469 726e 616d 6528 6d69 6372 6f73 6869  dirname(microshi
-000249c0: 6674 2e63 7265 6174 652e 5f5f 636f 6465  ft.create.__code
-000249d0: 5f5f 2e63 6f5f 6669 6c65 6e61 6d65 290a  __.co_filename).
-000249e0: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-000249f0: 6963 726f 7368 6966 742e 6372 6561 7465  icroshift.create
-00024a00: 2873 656c 662c 2070 6c61 6e64 6972 2c20  (self, plandir, 
-00024a10: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
-00024a20: 6573 290a 0a20 2020 2064 6566 2063 7265  es)..    def cre
-00024a30: 6174 655f 6b75 6265 5f6b 3373 2873 656c  ate_kube_k3s(sel
-00024a40: 662c 2063 6c75 7374 6572 2c20 6f76 6572  f, cluster, over
-00024a50: 7269 6465 733d 7b7d 293a 0a20 2020 2020  rides={}):.     
-00024a60: 2020 2069 6620 636f 6e74 6169 6e65 725f     if container_
-00024a70: 6d6f 6465 2829 3a0a 2020 2020 2020 2020  mode():.        
-00024a80: 2020 2020 6f73 2e65 6e76 6972 6f6e 5b27      os.environ['
-00024a90: 5041 5448 275d 202b 3d20 273a 2f77 6f72  PATH'] += ':/wor
-00024aa0: 6b64 6972 270a 2020 2020 2020 2020 656c  kdir'.        el
-00024ab0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00024ac0: 6f73 2e65 6e76 6972 6f6e 5b27 5041 5448  os.environ['PATH
-00024ad0: 275d 202b 3d20 273a 2573 2720 2520 6f73  '] += ':%s' % os
-00024ae0: 2e67 6574 6377 6428 290a 2020 2020 2020  .getcwd().      
-00024af0: 2020 706c 616e 6469 7220 3d20 6f73 2e70    plandir = os.p
-00024b00: 6174 682e 6469 726e 616d 6528 6b33 732e  ath.dirname(k3s.
-00024b10: 6372 6561 7465 2e5f 5f63 6f64 655f 5f2e  create.__code__.
-00024b20: 636f 5f66 696c 656e 616d 6529 0a20 2020  co_filename).   
-00024b30: 2020 2020 2072 6574 7572 6e20 6b33 732e       return k3s.
-00024b40: 6372 6561 7465 2873 656c 662c 2070 6c61  create(self, pla
-00024b50: 6e64 6972 2c20 636c 7573 7465 722c 206f  ndir, cluster, o
-00024b60: 7665 7272 6964 6573 290a 0a20 2020 2064  verrides)..    d
-00024b70: 6566 2063 7265 6174 655f 6b75 6265 5f68  ef create_kube_h
-00024b80: 7970 6572 7368 6966 7428 7365 6c66 2c20  ypershift(self, 
-00024b90: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
-00024ba0: 6573 3d7b 7d29 3a0a 2020 2020 2020 2020  es={}):.        
-00024bb0: 6966 2063 6f6e 7461 696e 6572 5f6d 6f64  if container_mod
-00024bc0: 6528 293a 0a20 2020 2020 2020 2020 2020  e():.           
-00024bd0: 206f 732e 656e 7669 726f 6e5b 2750 4154   os.environ['PAT
-00024be0: 4827 5d20 2b3d 2027 3a2f 776f 726b 6469  H'] += ':/workdi
-00024bf0: 7227 0a20 2020 2020 2020 2065 6c73 653a  r'.        else:
-00024c00: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
-00024c10: 656e 7669 726f 6e5b 2750 4154 4827 5d20  environ['PATH'] 
-00024c20: 2b3d 2027 3a25 7327 2025 206f 732e 6765  += ':%s' % os.ge
-00024c30: 7463 7764 2829 0a20 2020 2020 2020 2070  tcwd().        p
-00024c40: 6c61 6e64 6972 203d 206f 732e 7061 7468  landir = os.path
-00024c50: 2e64 6972 6e61 6d65 2868 7970 6572 7368  .dirname(hypersh
-00024c60: 6966 742e 6372 6561 7465 2e5f 5f63 6f64  ift.create.__cod
-00024c70: 655f 5f2e 636f 5f66 696c 656e 616d 6529  e__.co_filename)
-00024c80: 0a20 2020 2020 2020 2023 2064 6e73 636c  .        # dnscl
-00024c90: 6965 6e74 203d 206f 7665 7272 6964 6573  ient = overrides
-00024ca0: 2e67 6574 2827 646e 7363 6c69 656e 7427  .get('dnsclient'
-00024cb0: 290a 2020 2020 2020 2020 2320 646e 7363  ).        # dnsc
-00024cc0: 6f6e 6669 6720 3d20 4b63 6f6e 6669 6728  onfig = Kconfig(
-00024cd0: 636c 6965 6e74 3d64 6e73 636c 6965 6e74  client=dnsclient
-00024ce0: 2920 6966 2064 6e73 636c 6965 6e74 2069  ) if dnsclient i
-00024cf0: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
-00024d00: 4e6f 6e65 0a20 2020 2020 2020 2072 6574  None.        ret
-00024d10: 7572 6e20 6879 7065 7273 6869 6674 2e63  urn hypershift.c
-00024d20: 7265 6174 6528 7365 6c66 2c20 706c 616e  reate(self, plan
-00024d30: 6469 722c 2063 6c75 7374 6572 2c20 6f76  dir, cluster, ov
-00024d40: 6572 7269 6465 7329 0a0a 2020 2020 6465  errides)..    de
-00024d50: 6620 6372 6561 7465 5f6b 7562 655f 6f70  f create_kube_op
-00024d60: 656e 7368 6966 7428 7365 6c66 2c20 636c  enshift(self, cl
-00024d70: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
-00024d80: 3d7b 7d29 3a0a 2020 2020 2020 2020 6966  ={}):.        if
-00024d90: 2063 6f6e 7461 696e 6572 5f6d 6f64 6528   container_mode(
-00024da0: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
-00024db0: 732e 656e 7669 726f 6e5b 2750 4154 4827  s.environ['PATH'
-00024dc0: 5d20 2b3d 2027 3a2f 776f 726b 6469 7227  ] += ':/workdir'
-00024dd0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00024de0: 2020 2020 2020 2020 2020 206f 732e 656e             os.en
-00024df0: 7669 726f 6e5b 2750 4154 4827 5d20 2b3d  viron['PATH'] +=
-00024e00: 2027 3a25 7327 2025 206f 732e 6765 7463   ':%s' % os.getc
-00024e10: 7764 2829 0a20 2020 2020 2020 2070 6c61  wd().        pla
-00024e20: 6e64 6972 203d 206f 732e 7061 7468 2e64  ndir = os.path.d
-00024e30: 6972 6e61 6d65 286f 7065 6e73 6869 6674  irname(openshift
-00024e40: 2e63 7265 6174 652e 5f5f 636f 6465 5f5f  .create.__code__
-00024e50: 2e63 6f5f 6669 6c65 6e61 6d65 290a 2020  .co_filename).  
-00024e60: 2020 2020 2020 646e 7363 6c69 656e 7420        dnsclient 
-00024e70: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
-00024e80: 2764 6e73 636c 6965 6e74 2729 0a20 2020  'dnsclient').   
-00024e90: 2020 2020 2064 6e73 636f 6e66 6967 203d       dnsconfig =
-00024ea0: 204b 636f 6e66 6967 2863 6c69 656e 743d   Kconfig(client=
-00024eb0: 646e 7363 6c69 656e 7429 2069 6620 646e  dnsclient) if dn
-00024ec0: 7363 6c69 656e 7420 6973 206e 6f74 204e  sclient is not N
-00024ed0: 6f6e 6520 656c 7365 204e 6f6e 650a 2020  one else None.  
-00024ee0: 2020 2020 2020 7265 7475 726e 206f 7065        return ope
-00024ef0: 6e73 6869 6674 2e63 7265 6174 6528 7365  nshift.create(se
-00024f00: 6c66 2c20 706c 616e 6469 722c 2063 6c75  lf, plandir, clu
-00024f10: 7374 6572 2c20 6f76 6572 7269 6465 732c  ster, overrides,
-00024f20: 2064 6e73 636f 6e66 6967 3d64 6e73 636f   dnsconfig=dnsco
-00024f30: 6e66 6967 290a 0a20 2020 2064 6566 2064  nfig)..    def d
-00024f40: 656c 6574 655f 6b75 6265 2873 656c 662c  elete_kube(self,
-00024f50: 2063 6c75 7374 6572 2c20 6f76 6572 7269   cluster, overri
-00024f60: 6465 733d 7b7d 293a 0a20 2020 2020 2020  des={}):.       
-00024f70: 2068 7970 6572 7368 6966 7420 3d20 4661   hypershift = Fa
-00024f80: 6c73 650a 2020 2020 2020 2020 6173 7369  lse.        assi
-00024f90: 7374 6564 203d 2046 616c 7365 0a20 2020  sted = False.   
-00024fa0: 2020 2020 2064 6f6d 6169 6e20 3d20 6f76       domain = ov
-00024fb0: 6572 7269 6465 732e 6765 7428 2764 6f6d  errides.get('dom
-00024fc0: 6169 6e27 2c20 276b 6172 6d61 6c61 6273  ain', 'karmalabs
-00024fd0: 2e63 6f72 7027 290a 2020 2020 2020 2020  .corp').        
-00024fe0: 6b75 6265 7479 7065 203d 206f 7665 7272  kubetype = overr
-00024ff0: 6964 6573 2e67 6574 2827 6b75 6265 7479  ides.get('kubety
-00025000: 7065 272c 2027 6765 6e65 7269 6327 290a  pe', 'generic').
-00025010: 2020 2020 2020 2020 646e 7363 6c69 656e          dnsclien
-00025020: 7420 3d20 4e6f 6e65 0a20 2020 2020 2020  t = None.       
-00025030: 206b 203d 2073 656c 662e 6b0a 2020 2020   k = self.k.    
-00025040: 2020 2020 6966 2073 656c 662e 7479 7065      if self.type
-00025050: 203d 3d20 2777 6562 2720 616e 6420 7365   == 'web' and se
-00025060: 6c66 2e6b 2e6c 6f63 616c 6b75 6265 3a0a  lf.k.localkube:.
-00025070: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00025080: 726e 206b 2e64 656c 6574 655f 6b75 6265  rn k.delete_kube
-00025090: 2863 6c75 7374 6572 2c20 6b75 6265 7479  (cluster, kubety
-000250a0: 7065 2c20 6f76 6572 7269 6465 733d 6f76  pe, overrides=ov
-000250b0: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
-000250c0: 2063 6c75 7374 6572 203d 206f 7665 7272   cluster = overr
-000250d0: 6964 6573 2e67 6574 2827 636c 7573 7465  ides.get('cluste
-000250e0: 7227 2c20 636c 7573 7465 7229 0a20 2020  r', cluster).   
-000250f0: 2020 2020 2069 6620 636c 7573 7465 7220       if cluster 
-00025100: 6973 204e 6f6e 6520 6f72 2063 6c75 7374  is None or clust
-00025110: 6572 203d 3d20 2727 3a0a 2020 2020 2020  er == '':.      
-00025120: 2020 2020 2020 6465 6661 756c 745f 636c        default_cl
-00025130: 7573 7465 7273 203d 207b 2767 656e 6572  usters = {'gener
-00025140: 6963 273a 2027 6d79 6b75 6265 272c 2027  ic': 'mykube', '
-00025150: 6879 7065 7273 6869 6674 273a 2027 6d79  hypershift': 'my
-00025160: 6879 7065 7273 6869 6674 272c 2027 6f70  hypershift', 'op
-00025170: 656e 7368 6966 7427 3a20 276d 796f 7065  enshift': 'myope
-00025180: 6e73 6869 6674 272c 0a20 2020 2020 2020  nshift',.       
-00025190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000251a0: 2020 2020 2020 2020 2027 6b33 7327 3a20           'k3s': 
-000251b0: 276d 796b 3373 272c 2027 6d69 6372 6f73  'myk3s', 'micros
-000251c0: 6869 6674 273a 2027 6d79 6d69 6372 6f73  hift': 'mymicros
-000251d0: 6869 6674 277d 0a20 2020 2020 2020 2020  hift'}.         
-000251e0: 2020 2063 6c75 7374 6572 203d 2064 6566     cluster = def
-000251f0: 6175 6c74 5f63 6c75 7374 6572 735b 6b75  ault_clusters[ku
-00025200: 6265 7479 7065 5d0a 2020 2020 2020 2020  betype].        
-00025210: 636c 7573 7465 7264 6972 203d 206f 732e  clusterdir = os.
-00025220: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
-00025230: 6622 7e2f 2e6b 636c 692f 636c 7573 7465  f"~/.kcli/cluste
-00025240: 7273 2f7b 636c 7573 7465 727d 2229 0a20  rs/{cluster}"). 
-00025250: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-00025260: 682e 6578 6973 7473 2863 6c75 7374 6572  h.exists(cluster
-00025270: 6469 7229 3a0a 2020 2020 2020 2020 2020  dir):.          
-00025280: 2020 7061 7261 6d65 7465 7273 6669 6c65    parametersfile
-00025290: 203d 2066 227b 636c 7573 7465 7264 6972   = f"{clusterdir
-000252a0: 7d2f 6b63 6c69 5f70 6172 616d 6574 6572  }/kcli_parameter
-000252b0: 732e 796d 6c22 0a20 2020 2020 2020 2020  s.yml".         
-000252c0: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
-000252d0: 6973 7473 2870 6172 616d 6574 6572 7366  ists(parametersf
-000252e0: 696c 6529 3a0a 2020 2020 2020 2020 2020  ile):.          
-000252f0: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-00025300: 7061 7261 6d65 7465 7273 6669 6c65 2920  parametersfile) 
-00025310: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
-00025320: 2020 2020 2020 2020 2020 636c 7573 7465            cluste
-00025330: 7264 6174 6120 3d20 7961 6d6c 2e73 6166  rdata = yaml.saf
-00025340: 655f 6c6f 6164 2866 290a 2020 2020 2020  e_load(f).      
-00025350: 2020 2020 2020 2020 2020 2020 2020 6b75                ku
-00025360: 6265 7479 7065 203d 2063 6c75 7374 6572  betype = cluster
-00025370: 6461 7461 2e67 6574 2827 6b75 6265 7479  data.get('kubety
-00025380: 7065 272c 2027 6765 6e65 7269 6327 290a  pe', 'generic').
-00025390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000253a0: 2020 2020 6966 206b 7562 6574 7970 6520      if kubetype 
-000253b0: 3d3d 2027 6879 7065 7273 6869 6674 273a  == 'hypershift':
-000253c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000253d0: 2020 2020 2020 2020 2068 7970 6572 7368           hypersh
-000253e0: 6966 7420 3d20 5472 7565 0a20 2020 2020  ift = True.     
-000253f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025400: 2020 2061 7373 6973 7465 6420 3d20 636c     assisted = cl
-00025410: 7573 7465 7264 6174 612e 6765 7428 2761  usterdata.get('a
-00025420: 7373 6973 7465 6427 2c20 4661 6c73 6529  ssisted', False)
-00025430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025440: 2020 2020 2064 6f6d 6169 6e20 3d20 636c       domain = cl
-00025450: 7573 7465 7264 6174 612e 6765 7428 2764  usterdata.get('d
-00025460: 6f6d 6169 6e27 2c20 646f 6d61 696e 290a  omain', domain).
-00025470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025480: 2020 2020 646e 7363 6c69 656e 7420 3d20      dnsclient = 
-00025490: 636c 7573 7465 7264 6174 612e 6765 7428  clusterdata.get(
-000254a0: 2764 6e73 636c 6965 6e74 2729 0a20 2020  'dnsclient').   
-000254b0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-000254c0: 6879 7065 7273 6869 6674 3a0a 2020 2020  hypershift:.    
-000254d0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-000254e0: 6e74 2866 2244 656c 6574 696e 6720 6469  nt(f"Deleting di
-000254f0: 7265 6374 6f72 7920 7b63 6c75 7374 6572  rectory {cluster
-00025500: 6469 727d 2229 0a20 2020 2020 2020 2020  dir}").         
-00025510: 2020 2020 2020 2072 6d74 7265 6528 636c         rmtree(cl
-00025520: 7573 7465 7264 6972 290a 2020 2020 2020  usterdir).      
-00025530: 2020 6465 6c65 7465 636c 6965 6e74 7320    deleteclients 
-00025540: 3d20 7b73 656c 662e 636c 6965 6e74 3a20  = {self.client: 
-00025550: 6b7d 0a20 2020 2020 2020 2076 6d63 6c69  k}.        vmcli
-00025560: 656e 7473 203d 205b 5d0a 2020 2020 2020  ents = [].      
-00025570: 2020 766d 636c 6965 6e74 735f 6669 6c65    vmclients_file
-00025580: 203d 206f 732e 7061 7468 2e65 7870 616e   = os.path.expan
-00025590: 6475 7365 7228 6627 7e2f 2e6b 636c 692f  duser(f'~/.kcli/
-000255a0: 766d 636c 6965 6e74 735f 7b63 6c75 7374  vmclients_{clust
-000255b0: 6572 7d27 290a 2020 2020 2020 2020 6966  er}').        if
-000255c0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-000255d0: 766d 636c 6965 6e74 735f 6669 6c65 293a  vmclients_file):
-000255e0: 0a20 2020 2020 2020 2020 2020 2076 6d63  .            vmc
-000255f0: 6c69 656e 7473 203d 2079 616d 6c2e 7361  lients = yaml.sa
-00025600: 6665 5f6c 6f61 6428 6f70 656e 2876 6d63  fe_load(open(vmc
-00025610: 6c69 656e 7473 5f66 696c 6529 290a 2020  lients_file)).  
-00025620: 2020 2020 2020 2020 2020 6f73 2e72 656d            os.rem
-00025630: 6f76 6528 766d 636c 6965 6e74 735f 6669  ove(vmclients_fi
-00025640: 6c65 290a 2020 2020 2020 2020 6966 2073  le).        if s
-00025650: 656c 662e 6578 7472 6163 6c69 656e 7473  elf.extraclients
-00025660: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
-00025670: 6c65 7465 636c 6965 6e74 732e 7570 6461  leteclients.upda
-00025680: 7465 2873 656c 662e 6578 7472 6163 6c69  te(self.extracli
-00025690: 656e 7473 290a 2020 2020 2020 2020 656c  ents).        el
-000256a0: 6966 2076 6d63 6c69 656e 7473 3a0a 2020  if vmclients:.  
-000256b0: 2020 2020 2020 2020 2020 6465 6c65 7465            delete
-000256c0: 636c 6965 6e74 732e 7570 6461 7465 287b  clients.update({
-000256d0: 636c 693a 204b 636f 6e66 6967 2863 6c69  cli: Kconfig(cli
-000256e0: 656e 743d 636c 6929 2e6b 2066 6f72 2063  ent=cli).k for c
-000256f0: 6c69 2069 6e20 766d 636c 6965 6e74 7320  li in vmclients 
-00025700: 6966 2063 6c69 2021 3d20 7365 6c66 2e63  if cli != self.c
-00025710: 6c69 656e 747d 290a 2020 2020 2020 2020  lient}).        
-00025720: 666f 7220 6879 7065 7276 6973 6f72 2069  for hypervisor i
-00025730: 6e20 6465 6c65 7465 636c 6965 6e74 733a  n deleteclients:
-00025740: 0a20 2020 2020 2020 2020 2020 2063 203d  .            c =
-00025750: 2064 656c 6574 6563 6c69 656e 7473 5b68   deleteclients[h
-00025760: 7970 6572 7669 736f 725d 0a20 2020 2020  ypervisor].     
-00025770: 2020 2020 2020 2066 6f72 2076 6d20 696e         for vm in
-00025780: 2073 6f72 7465 6428 632e 6c69 7374 2829   sorted(c.list()
-00025790: 2c20 6b65 793d 6c61 6d62 6461 2078 3a20  , key=lambda x: 
-000257a0: 785b 276e 616d 6527 5d29 3a0a 2020 2020  x['name']):.    
-000257b0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-000257c0: 203d 2076 6d5b 276e 616d 6527 5d0a 2020   = vm['name'].  
-000257d0: 2020 2020 2020 2020 2020 2020 2020 646e                dn
-000257e0: 7363 6c69 656e 7420 3d20 766d 2e67 6574  sclient = vm.get
-000257f0: 2827 646e 7363 6c69 656e 7427 2920 6f72  ('dnsclient') or
-00025800: 2064 6e73 636c 6965 6e74 0a20 2020 2020   dnsclient.     
-00025810: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-00025820: 6e74 636c 7573 7465 7220 3d20 766d 2e67  ntcluster = vm.g
-00025830: 6574 2827 6b75 6265 2729 0a20 2020 2020  et('kube').     
-00025840: 2020 2020 2020 2020 2020 2069 6620 6375             if cu
-00025850: 7272 656e 7463 6c75 7374 6572 2069 7320  rrentcluster is 
-00025860: 6e6f 7420 4e6f 6e65 2061 6e64 2063 7572  not None and cur
-00025870: 7265 6e74 636c 7573 7465 7220 3d3d 2063  rentcluster == c
-00025880: 6c75 7374 6572 3a0a 2020 2020 2020 2020  luster:.        
-00025890: 2020 2020 2020 2020 2020 2020 632e 6465              c.de
-000258a0: 6c65 7465 286e 616d 652c 2073 6e61 7073  lete(name, snaps
-000258b0: 686f 7473 3d54 7275 6529 0a20 2020 2020  hots=True).     
-000258c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000258d0: 6f6d 6d6f 6e2e 6465 6c65 7465 5f6c 6173  ommon.delete_las
-000258e0: 7476 6d28 6e61 6d65 2c20 7365 6c66 2e63  tvm(name, self.c
-000258f0: 6c69 656e 7429 0a20 2020 2020 2020 2020  lient).         
-00025900: 2020 2020 2020 2020 2020 2073 7563 6365             succe
-00025910: 7373 2866 227b 6e61 6d65 7d20 6465 6c65  ss(f"{name} dele
-00025920: 7465 6420 6f6e 207b 6879 7065 7276 6973  ted on {hypervis
-00025930: 6f72 7d21 2229 0a20 2020 2020 2020 2069  or}!").        i
-00025940: 6620 7365 6c66 2e74 7970 6520 3d3d 2027  f self.type == '
-00025950: 6b75 6265 7669 7274 273a 0a20 2020 2020  kubevirt':.     
-00025960: 2020 2020 2020 2069 6620 6622 7b63 6c75         if f"{clu
-00025970: 7374 6572 7d2d 6170 6922 2069 6e20 6b2e  ster}-api" in k.
-00025980: 6c69 7374 5f73 6572 7669 6365 7328 6b2e  list_services(k.
-00025990: 6e61 6d65 7370 6163 6529 3a0a 2020 2020  namespace):.    
-000259a0: 2020 2020 2020 2020 2020 2020 6b2e 6465              k.de
-000259b0: 6c65 7465 5f73 6572 7669 6365 2866 227b  lete_service(f"{
-000259c0: 636c 7573 7465 727d 2d61 7069 222c 206b  cluster}-api", k
-000259d0: 2e6e 616d 6573 7061 6365 290a 2020 2020  .namespace).    
-000259e0: 2020 2020 2020 2020 6966 2066 227b 636c          if f"{cl
-000259f0: 7573 7465 727d 2d69 6e67 7265 7373 2220  uster}-ingress" 
-00025a00: 696e 206b 2e6c 6973 745f 7365 7276 6963  in k.list_servic
-00025a10: 6573 286b 2e6e 616d 6573 7061 6365 293a  es(k.namespace):
-00025a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025a30: 206b 2e64 656c 6574 655f 7365 7276 6963   k.delete_servic
-00025a40: 6528 6622 7b63 6c75 7374 6572 7d2d 696e  e(f"{cluster}-in
-00025a50: 6772 6573 7322 2c20 6b2e 6e61 6d65 7370  gress", k.namesp
-00025a60: 6163 6529 0a20 2020 2020 2020 2069 6620  ace).        if 
-00025a70: 7365 6c66 2e74 7970 6520 696e 205b 2761  self.type in ['a
-00025a80: 7773 272c 2027 6763 7027 2c20 2769 626d  ws', 'gcp', 'ibm
-00025a90: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-00025aa0: 6c62 7320 3d20 5b27 6170 6927 5d0a 2020  lbs = ['api'].  
-00025ab0: 2020 2020 2020 2020 2020 6966 206b 7562            if kub
-00025ac0: 6574 7970 6520 6e6f 7420 696e 205b 276b  etype not in ['k
-00025ad0: 3373 272c 2027 6765 6e65 7269 6327 5d3a  3s', 'generic']:
-00025ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025af0: 206c 6273 2e61 7070 656e 6428 2761 7070   lbs.append('app
-00025b00: 7327 290a 2020 2020 2020 2020 2020 2020  s').            
-00025b10: 666f 7220 6c62 2069 6e20 6c62 733a 0a20  for lb in lbs:. 
-00025b20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00025b30: 656c 662e 6465 6c65 7465 5f6c 6f61 6462  elf.delete_loadb
-00025b40: 616c 616e 6365 7228 6622 7b6c 627d 2e7b  alancer(f"{lb}.{
-00025b50: 636c 7573 7465 727d 222c 2064 6f6d 6169  cluster}", domai
-00025b60: 6e3d 646f 6d61 696e 290a 2020 2020 2020  n=domain).      
-00025b70: 2020 2020 2020 6275 636b 6574 203d 2066        bucket = f
-00025b80: 227b 636c 7573 7465 727d 2d7b 646f 6d61  "{cluster}-{doma
-00025b90: 696e 7d22 0a20 2020 2020 2020 2020 2020  in}".           
-00025ba0: 2069 6620 6275 636b 6574 2069 6e20 7365   if bucket in se
-00025bb0: 6c66 2e6b 2e6c 6973 745f 6275 636b 6574  lf.k.list_bucket
-00025bc0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00025bd0: 2020 2020 2070 7072 696e 7428 6622 4465       pprint(f"De
-00025be0: 6c65 7469 6e67 2062 7563 6b65 7420 7b62  leting bucket {b
-00025bf0: 7563 6b65 747d 2229 0a20 2020 2020 2020  ucket}").       
-00025c00: 2020 2020 2020 2020 206b 2e64 656c 6574           k.delet
-00025c10: 655f 6275 636b 6574 2862 7563 6b65 7429  e_bucket(bucket)
-00025c20: 0a20 2020 2020 2020 2065 6c69 6620 646e  .        elif dn
-00025c30: 7363 6c69 656e 7420 6973 206e 6f74 204e  sclient is not N
-00025c40: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00025c50: 207a 203d 204b 636f 6e66 6967 2863 6c69   z = Kconfig(cli
-00025c60: 656e 743d 646e 7363 6c69 656e 7429 2e6b  ent=dnsclient).k
-00025c70: 0a20 2020 2020 2020 2020 2020 207a 2e64  .            z.d
-00025c80: 656c 6574 655f 646e 7328 6622 6170 692e  elete_dns(f"api.
-00025c90: 7b63 6c75 7374 6572 7d22 2c20 646f 6d61  {cluster}", doma
-00025ca0: 696e 290a 2020 2020 2020 2020 2020 2020  in).            
-00025cb0: 7a2e 6465 6c65 7465 5f64 6e73 2866 2261  z.delete_dns(f"a
-00025cc0: 7070 732e 7b63 6c75 7374 6572 7d22 2c20  pps.{cluster}", 
-00025cd0: 646f 6d61 696e 290a 2020 2020 2020 2020  domain).        
-00025ce0: 6966 2068 7970 6572 7368 6966 743a 0a20  if hypershift:. 
-00025cf0: 2020 2020 2020 2020 2020 206b 7562 6563             kubec
-00025d00: 6f6e 6669 676d 676d 7420 3d20 6622 7b63  onfigmgmt = f"{c
-00025d10: 6c75 7374 6572 6469 727d 2f6b 7562 6563  lusterdir}/kubec
-00025d20: 6f6e 6669 672e 6d67 6d74 220a 2020 2020  onfig.mgmt".    
-00025d30: 2020 2020 2020 2020 6361 6c6c 2866 274b          call(f'K
-00025d40: 5542 4543 4f4e 4649 473d 7b6b 7562 6563  UBECONFIG={kubec
-00025d50: 6f6e 6669 676d 676d 747d 206f 6320 6465  onfigmgmt} oc de
-00025d60: 6c65 7465 202d 6620 7b63 6c75 7374 6572  lete -f {cluster
-00025d70: 6469 727d 2f61 7574 6f61 7070 726f 7665  dir}/autoapprove
-00025d80: 7263 726f 6e2e 796d 6c27 2c20 7368 656c  rcron.yml', shel
-00025d90: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
-00025da0: 2020 2020 6361 6c6c 2866 274b 5542 4543      call(f'KUBEC
-00025db0: 4f4e 4649 473d 7b6b 7562 6563 6f6e 6669  ONFIG={kubeconfi
-00025dc0: 676d 676d 747d 206f 6320 6465 6c65 7465  gmgmt} oc delete
-00025dd0: 202d 6620 7b63 6c75 7374 6572 6469 727d   -f {clusterdir}
-00025de0: 2f6e 6f64 6570 6f6f 6c2e 7961 6d6c 272c  /nodepool.yaml',
-00025df0: 2073 6865 6c6c 3d54 7275 6529 0a20 2020   shell=True).   
-00025e00: 2020 2020 2020 2020 2063 616c 6c28 6627           call(f'
-00025e10: 4b55 4245 434f 4e46 4947 3d7b 6b75 6265  KUBECONFIG={kube
-00025e20: 636f 6e66 6967 6d67 6d74 7d20 6f63 2064  configmgmt} oc d
-00025e30: 656c 6574 6520 2d66 207b 636c 7573 7465  elete -f {cluste
-00025e40: 7264 6972 7d2f 686f 7374 6564 636c 7573  rdir}/hostedclus
-00025e50: 7465 722e 7961 6d6c 272c 2073 6865 6c6c  ter.yaml', shell
-00025e60: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-00025e70: 2020 2069 6620 6e6f 7420 6173 7369 7374     if not assist
-00025e80: 6564 2061 6e64 2028 2762 6172 656d 6574  ed and ('baremet
-00025e90: 616c 5f69 736f 2720 696e 2063 6c75 7374  al_iso' in clust
-00025ea0: 6572 6461 7461 206f 7220 2762 6172 656d  erdata or 'barem
-00025eb0: 6574 616c 5f68 6f73 7473 2720 696e 2063  etal_hosts' in c
-00025ec0: 6c75 7374 6572 6461 7461 293a 0a20 2020  lusterdata):.   
-00025ed0: 2020 2020 2020 2020 2020 2020 2063 616c               cal
-00025ee0: 6c28 6627 4b55 4245 434f 4e46 4947 3d7b  l(f'KUBECONFIG={
-00025ef0: 6b75 6265 636f 6e66 6967 6d67 6d74 7d20  kubeconfigmgmt} 
-00025f00: 6f63 202d 6e20 6465 6661 756c 7420 6465  oc -n default de
-00025f10: 6c65 7465 2061 6c6c 202d 6c20 6170 703d  lete all -l app=
-00025f20: 6874 7470 642d 6b63 6c69 272c 2073 6865  httpd-kcli', she
-00025f30: 6c6c 3d54 7275 6529 0a20 2020 2020 2020  ll=True).       
-00025f40: 2020 2020 2020 2020 2063 616c 6c28 6627           call(f'
-00025f50: 4b55 4245 434f 4e46 4947 3d7b 6b75 6265  KUBECONFIG={kube
-00025f60: 636f 6e66 6967 6d67 6d74 7d20 6f63 202d  configmgmt} oc -
-00025f70: 6e20 6465 6661 756c 7420 6465 6c65 7465  n default delete
-00025f80: 2070 7663 2068 7474 7064 2d6b 636c 692d   pvc httpd-kcli-
-00025f90: 7076 6327 2c20 7368 656c 6c3d 5472 7565  pvc', shell=True
-00025fa0: 290a 2020 2020 2020 2020 2020 2020 7070  ).            pp
-00025fb0: 7269 6e74 2866 2244 656c 6574 696e 6720  rint(f"Deleting 
-00025fc0: 6469 7265 6374 6f72 7920 7b63 6c75 7374  directory {clust
-00025fd0: 6572 6469 727d 2229 0a20 2020 2020 2020  erdir}").       
-00025fe0: 2020 2020 2072 6d74 7265 6528 636c 7573       rmtree(clus
-00025ff0: 7465 7264 6972 290a 2020 2020 2020 2020  terdir).        
-00026000: 666f 7220 636f 6e66 706f 6f6c 2069 6e20  for confpool in 
-00026010: 7365 6c66 2e63 6f6e 6670 6f6f 6c73 3a0a  self.confpools:.
-00026020: 2020 2020 2020 2020 2020 2020 6970 5f72              ip_r
-00026030: 6573 6572 7661 7469 6f6e 7320 3d20 7365  eservations = se
-00026040: 6c66 2e63 6f6e 6670 6f6f 6c73 5b63 6f6e  lf.confpools[con
-00026050: 6670 6f6f 6c5d 2e67 6574 2827 6970 5f72  fpool].get('ip_r
-00026060: 6573 6572 7661 7469 6f6e 7327 2c20 7b7d  eservations', {}
-00026070: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00026080: 2063 6c75 7374 6572 2069 6e20 6970 5f72   cluster in ip_r
-00026090: 6573 6572 7661 7469 6f6e 733a 0a20 2020  eservations:.   
-000260a0: 2020 2020 2020 2020 2020 2020 2064 656c               del
-000260b0: 2069 705f 7265 7365 7276 6174 696f 6e73   ip_reservations
-000260c0: 5b63 6c75 7374 6572 5d0a 2020 2020 2020  [cluster].      
-000260d0: 2020 2020 2020 2020 2020 7365 6c66 2e75            self.u
-000260e0: 7064 6174 655f 636f 6e66 706f 6f6c 2863  pdate_confpool(c
-000260f0: 6f6e 6670 6f6f 6c2c 207b 2769 705f 7265  onfpool, {'ip_re
-00026100: 7365 7276 6174 696f 6e73 273a 2069 705f  servations': ip_
-00026110: 7265 7365 7276 6174 696f 6e73 7d29 0a20  reservations}). 
-00026120: 2020 2020 2020 2020 2020 206e 616d 655f             name_
-00026130: 7265 7365 7276 6174 696f 6e73 203d 2073  reservations = s
-00026140: 656c 662e 636f 6e66 706f 6f6c 735b 636f  elf.confpools[co
-00026150: 6e66 706f 6f6c 5d2e 6765 7428 276e 616d  nfpool].get('nam
-00026160: 655f 7265 7365 7276 6174 696f 6e73 272c  e_reservations',
-00026170: 205b 5d29 0a20 2020 2020 2020 2020 2020   []).           
-00026180: 2069 6620 636c 7573 7465 7220 696e 206e   if cluster in n
-00026190: 616d 655f 7265 7365 7276 6174 696f 6e73  ame_reservations
-000261a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000261b0: 2020 6e61 6d65 5f72 6573 6572 7661 7469    name_reservati
-000261c0: 6f6e 732e 7265 6d6f 7665 2863 6c75 7374  ons.remove(clust
-000261d0: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
-000261e0: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
-000261f0: 636f 6e66 706f 6f6c 2863 6f6e 6670 6f6f  confpool(confpoo
-00026200: 6c2c 207b 276e 616d 655f 7265 7365 7276  l, {'name_reserv
-00026210: 6174 696f 6e73 273a 206e 616d 655f 7265  ations': name_re
-00026220: 7365 7276 6174 696f 6e73 7d29 0a20 2020  servations}).   
-00026230: 2020 2020 2020 2020 2063 6c75 7374 6572           cluster
-00026240: 5f62 6172 656d 6574 616c 5f72 6573 6572  _baremetal_reser
-00026250: 7661 7469 6f6e 7320 3d20 7365 6c66 2e63  vations = self.c
-00026260: 6f6e 6670 6f6f 6c73 5b63 6f6e 6670 6f6f  onfpools[confpoo
-00026270: 6c5d 2e67 6574 2827 636c 7573 7465 725f  l].get('cluster_
-00026280: 6261 7265 6d65 7461 6c5f 7265 7365 7276  baremetal_reserv
-00026290: 6174 696f 6e73 272c 207b 7d29 0a20 2020  ations', {}).   
-000262a0: 2020 2020 2020 2020 2069 6620 636c 7573           if clus
-000262b0: 7465 7220 696e 2063 6c75 7374 6572 5f62  ter in cluster_b
-000262c0: 6172 656d 6574 616c 5f72 6573 6572 7661  aremetal_reserva
-000262d0: 7469 6f6e 733a 0a20 2020 2020 2020 2020  tions:.         
-000262e0: 2020 2020 2020 2064 656c 2063 6c75 7374         del clust
-000262f0: 6572 5f62 6172 656d 6574 616c 5f72 6573  er_baremetal_res
-00026300: 6572 7661 7469 6f6e 735b 636c 7573 7465  ervations[cluste
-00026310: 725d 0a20 2020 2020 2020 2020 2020 2020  r].             
-00026320: 2020 2073 656c 662e 7570 6461 7465 5f63     self.update_c
-00026330: 6f6e 6670 6f6f 6c28 636f 6e66 706f 6f6c  onfpool(confpool
-00026340: 2c20 7b27 636c 7573 7465 725f 6261 7265  , {'cluster_bare
-00026350: 6d65 7461 6c5f 7265 7365 7276 6174 696f  metal_reservatio
-00026360: 6e73 273a 2063 6c75 7374 6572 5f62 6172  ns': cluster_bar
-00026370: 656d 6574 616c 5f72 6573 6572 7661 7469  emetal_reservati
-00026380: 6f6e 737d 290a 2020 2020 2020 2020 7265  ons}).        re
-00026390: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
-000263a0: 2773 7563 6365 7373 277d 0a0a 2020 2020  'success'}..    
-000263b0: 6465 6620 7363 616c 655f 6b75 6265 2873  def scale_kube(s
-000263c0: 656c 662c 2063 6c75 7374 6572 2c20 6b75  elf, cluster, ku
-000263d0: 6265 7479 7065 2c20 6f76 6572 7269 6465  betype, override
-000263e0: 733d 7b7d 293a 0a20 2020 2020 2020 2069  s={}):.        i
-000263f0: 6620 6b75 6265 7479 7065 203d 3d20 2767  f kubetype == 'g
-00026400: 656e 6572 6963 273a 0a20 2020 2020 2020  eneric':.       
-00026410: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
-00026420: 6c66 2e73 6361 6c65 5f6b 7562 655f 6765  lf.scale_kube_ge
-00026430: 6e65 7269 6328 636c 7573 7465 722c 206f  neric(cluster, o
-00026440: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
-00026450: 6573 290a 2020 2020 2020 2020 656c 6966  es).        elif
-00026460: 206b 7562 6574 7970 6520 3d3d 2027 6b33   kubetype == 'k3
-00026470: 7327 3a0a 2020 2020 2020 2020 2020 2020  s':.            
-00026480: 7265 7375 6c74 203d 2073 656c 662e 7363  result = self.sc
-00026490: 616c 655f 6b75 6265 5f6b 3373 2863 6c75  ale_kube_k3s(clu
-000264a0: 7374 6572 2c20 6f76 6572 7269 6465 733d  ster, overrides=
-000264b0: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
-000264c0: 2020 2065 6c69 6620 6b75 6265 7479 7065     elif kubetype
-000264d0: 203d 3d20 276f 7065 6e73 6869 6674 273a   == 'openshift':
-000264e0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-000264f0: 756c 7420 3d20 7365 6c66 2e73 6361 6c65  ult = self.scale
-00026500: 5f6b 7562 655f 6f70 656e 7368 6966 7428  _kube_openshift(
-00026510: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
-00026520: 6573 3d6f 7665 7272 6964 6573 290a 2020  es=overrides).  
-00026530: 2020 2020 2020 656c 6966 206b 7562 6574        elif kubet
-00026540: 7970 6520 3d3d 2027 6879 7065 7273 6869  ype == 'hypershi
-00026550: 6674 273a 0a20 2020 2020 2020 2020 2020  ft':.           
-00026560: 2072 6573 756c 7420 3d20 7365 6c66 2e73   result = self.s
-00026570: 6361 6c65 5f6b 7562 655f 6879 7065 7273  cale_kube_hypers
-00026580: 6869 6674 2863 6c75 7374 6572 2c20 6f76  hift(cluster, ov
-00026590: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
-000265a0: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
-000265b0: 6e20 7265 7375 6c74 0a0a 2020 2020 6465  n result..    de
-000265c0: 6620 7363 616c 655f 6b75 6265 5f67 656e  f scale_kube_gen
-000265d0: 6572 6963 2873 656c 662c 2063 6c75 7374  eric(self, clust
-000265e0: 6572 2c20 6f76 6572 7269 6465 733d 7b7d  er, overrides={}
-000265f0: 293a 0a20 2020 2020 2020 2070 6c61 6e64  ):.        pland
-00026600: 6972 203d 206f 732e 7061 7468 2e64 6972  ir = os.path.dir
-00026610: 6e61 6d65 286b 7562 6561 646d 2e63 7265  name(kubeadm.cre
-00026620: 6174 652e 5f5f 636f 6465 5f5f 2e63 6f5f  ate.__code__.co_
-00026630: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
-00026640: 2020 7265 7475 726e 206b 7562 6561 646d    return kubeadm
-00026650: 2e73 6361 6c65 2873 656c 662c 2070 6c61  .scale(self, pla
-00026660: 6e64 6972 2c20 636c 7573 7465 722c 206f  ndir, cluster, o
-00026670: 7665 7272 6964 6573 290a 0a20 2020 2064  verrides)..    d
-00026680: 6566 2073 6361 6c65 5f6b 7562 655f 6b33  ef scale_kube_k3
-00026690: 7328 7365 6c66 2c20 636c 7573 7465 722c  s(self, cluster,
-000266a0: 206f 7665 7272 6964 6573 3d7b 7d29 3a0a   overrides={}):.
-000266b0: 2020 2020 2020 2020 706c 616e 6469 7220          plandir 
-000266c0: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
-000266d0: 6528 6b33 732e 6372 6561 7465 2e5f 5f63  e(k3s.create.__c
-000266e0: 6f64 655f 5f2e 636f 5f66 696c 656e 616d  ode__.co_filenam
-000266f0: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-00026700: 6e20 6b33 732e 7363 616c 6528 7365 6c66  n k3s.scale(self
-00026710: 2c20 706c 616e 6469 722c 2063 6c75 7374  , plandir, clust
-00026720: 6572 2c20 6f76 6572 7269 6465 7329 0a0a  er, overrides)..
-00026730: 2020 2020 6465 6620 7363 616c 655f 6b75      def scale_ku
-00026740: 6265 5f68 7970 6572 7368 6966 7428 7365  be_hypershift(se
-00026750: 6c66 2c20 636c 7573 7465 722c 206f 7665  lf, cluster, ove
-00026760: 7272 6964 6573 3d7b 7d29 3a0a 2020 2020  rrides={}):.    
-00026770: 2020 2020 706c 616e 6469 7220 3d20 6f73      plandir = os
-00026780: 2e70 6174 682e 6469 726e 616d 6528 6879  .path.dirname(hy
-00026790: 7065 7273 6869 6674 2e63 7265 6174 652e  pershift.create.
-000267a0: 5f5f 636f 6465 5f5f 2e63 6f5f 6669 6c65  __code__.co_file
-000267b0: 6e61 6d65 290a 2020 2020 2020 2020 7265  name).        re
-000267c0: 7475 726e 2068 7970 6572 7368 6966 742e  turn hypershift.
-000267d0: 7363 616c 6528 7365 6c66 2c20 706c 616e  scale(self, plan
-000267e0: 6469 722c 2063 6c75 7374 6572 2c20 6f76  dir, cluster, ov
-000267f0: 6572 7269 6465 7329 0a0a 2020 2020 6465  errides)..    de
-00026800: 6620 7363 616c 655f 6b75 6265 5f6f 7065  f scale_kube_ope
-00026810: 6e73 6869 6674 2873 656c 662c 2063 6c75  nshift(self, clu
-00026820: 7374 6572 2c20 6f76 6572 7269 6465 733d  ster, overrides=
-00026830: 7b7d 293a 0a20 2020 2020 2020 2070 6c61  {}):.        pla
-00026840: 6e64 6972 203d 206f 732e 7061 7468 2e64  ndir = os.path.d
-00026850: 6972 6e61 6d65 286f 7065 6e73 6869 6674  irname(openshift
-00026860: 2e63 7265 6174 652e 5f5f 636f 6465 5f5f  .create.__code__
-00026870: 2e63 6f5f 6669 6c65 6e61 6d65 290a 2020  .co_filename).  
-00026880: 2020 2020 2020 7265 7475 726e 206f 7065        return ope
-00026890: 6e73 6869 6674 2e73 6361 6c65 2873 656c  nshift.scale(sel
-000268a0: 662c 2070 6c61 6e64 6972 2c20 636c 7573  f, plandir, clus
-000268b0: 7465 722c 206f 7665 7272 6964 6573 290a  ter, overrides).
-000268c0: 0a20 2020 2064 6566 2075 7064 6174 655f  .    def update_
-000268d0: 6b75 6265 2873 656c 662c 2063 6c75 7374  kube(self, clust
-000268e0: 6572 2c20 5f74 7970 652c 206f 7665 7272  er, _type, overr
-000268f0: 6964 6573 3d7b 7d2c 2070 6c61 6e3d 4e6f  ides={}, plan=No
-00026900: 6e65 293a 0a20 2020 2020 2020 206f 7665  ne):.        ove
-00026910: 7272 6964 6573 5b27 736b 6970 5f66 696c  rrides['skip_fil
-00026920: 6573 5f72 656d 6564 6961 7469 6f6e 275d  es_remediation']
-00026930: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00026940: 6f76 6572 7269 6465 735b 2773 6361 6c65  overrides['scale
-00026950: 275d 203d 2054 7275 650a 2020 2020 2020  '] = True.      
-00026960: 2020 636c 7573 7465 7264 6972 203d 206f    clusterdir = o
-00026970: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
-00026980: 7228 6622 7e2f 2e6b 636c 692f 636c 7573  r(f"~/.kcli/clus
-00026990: 7465 7273 2f7b 636c 7573 7465 727d 2229  ters/{cluster}")
-000269a0: 0a20 2020 2020 2020 2070 6c61 6e76 6d73  .        planvms
-000269b0: 203d 205b 5d0a 2020 2020 2020 2020 6966   = [].        if
-000269c0: 2070 6c61 6e20 6973 204e 6f6e 653a 0a20   plan is None:. 
-000269d0: 2020 2020 2020 2020 2020 2070 6c61 6e20             plan 
-000269e0: 3d20 636c 7573 7465 720a 2020 2020 2020  = cluster.      
-000269f0: 2020 6966 205f 7479 7065 203d 3d20 2767    if _type == 'g
-00026a00: 656e 6572 6963 273a 0a20 2020 2020 2020  eneric':.       
-00026a10: 2020 2020 2072 6f6c 6573 203d 205b 2763       roles = ['c
-00026a20: 746c 706c 616e 6573 272c 2027 776f 726b  tlplanes', 'work
-00026a30: 6572 7327 5d0a 2020 2020 2020 2020 2020  ers'].          
-00026a40: 2020 706c 616e 6469 7220 3d20 6f73 2e70    plandir = os.p
-00026a50: 6174 682e 6469 726e 616d 6528 6b75 6265  ath.dirname(kube
-00026a60: 6164 6d2e 6372 6561 7465 2e5f 5f63 6f64  adm.create.__cod
-00026a70: 655f 5f2e 636f 5f66 696c 656e 616d 6529  e__.co_filename)
-00026a80: 0a20 2020 2020 2020 2065 6c69 6620 5f74  .        elif _t
-00026a90: 7970 6520 3d3d 2027 6b33 7327 3a0a 2020  ype == 'k3s':.  
-00026aa0: 2020 2020 2020 2020 2020 706c 616e 6469            plandi
-00026ab0: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
-00026ac0: 616d 6528 6b33 732e 6372 6561 7465 2e5f  ame(k3s.create._
-00026ad0: 5f63 6f64 655f 5f2e 636f 5f66 696c 656e  _code__.co_filen
-00026ae0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-00026af0: 2072 6f6c 6573 203d 205b 2762 6f6f 7473   roles = ['boots
-00026b00: 7472 6170 272c 2027 776f 726b 6572 7327  trap', 'workers'
-00026b10: 5d20 6966 206f 7665 7272 6964 6573 2e67  ] if overrides.g
-00026b20: 6574 2827 6374 6c70 6c61 6e65 7327 2c20  et('ctlplanes', 
-00026b30: 3129 203d 3d20 3120 656c 7365 205b 2762  1) == 1 else ['b
-00026b40: 6f6f 7473 7472 6170 272c 2027 6374 6c70  ootstrap', 'ctlp
-00026b50: 6c61 6e65 7327 2c0a 2020 2020 2020 2020  lanes',.        
-00026b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026bb0: 2027 776f 726b 6572 7327 5d0a 2020 2020   'workers'].    
-00026bc0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00026bd0: 2020 2020 2020 706c 616e 6469 7220 3d20        plandir = 
-00026be0: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
-00026bf0: 6f70 656e 7368 6966 742e 6372 6561 7465  openshift.create
-00026c00: 2e5f 5f63 6f64 655f 5f2e 636f 5f66 696c  .__code__.co_fil
-00026c10: 656e 616d 6529 0a20 2020 2020 2020 2020  ename).         
-00026c20: 2020 2072 6f6c 6573 203d 205b 2763 6c6f     roles = ['clo
-00026c30: 7564 5f63 746c 706c 616e 6573 272c 2027  ud_ctlplanes', '
-00026c40: 636c 6f75 645f 776f 726b 6572 7327 5d20  cloud_workers'] 
-00026c50: 6966 2073 656c 662e 7479 7065 2069 6e20  if self.type in 
-00026c60: 5b27 6177 7327 2c20 2767 6370 275d 2065  ['aws', 'gcp'] e
-00026c70: 6c73 6520 5b27 6374 6c70 6c61 6e65 7327  lse ['ctlplanes'
-00026c80: 2c20 2777 6f72 6b65 7273 275d 0a20 2020  , 'workers'].   
-00026c90: 2020 2020 2069 6620 6f76 6572 7269 6465       if override
-00026ca0: 732e 6765 7428 2777 6f72 6b65 7273 272c  s.get('workers',
-00026cb0: 2030 2920 3d3d 2030 3a0a 2020 2020 2020   0) == 0:.      
-00026cc0: 2020 2020 2020 6465 6c20 726f 6c65 735b        del roles[
-00026cd0: 2d31 5d0a 2020 2020 2020 2020 6966 206f  -1].        if o
-00026ce0: 732e 7061 7468 2e65 7869 7374 7328 6622  s.path.exists(f"
-00026cf0: 7b63 6c75 7374 6572 6469 727d 2f6b 636c  {clusterdir}/kcl
-00026d00: 695f 7061 7261 6d65 7465 7273 2e79 6d6c  i_parameters.yml
-00026d10: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-00026d20: 6461 7461 203d 207b 2763 6c75 7374 6572  data = {'cluster
-00026d30: 273a 2063 6c75 7374 6572 2c20 276b 7562  ': cluster, 'kub
-00026d40: 6527 3a20 636c 7573 7465 722c 2027 6b75  e': cluster, 'ku
-00026d50: 6265 7479 7065 273a 205f 7479 7065 7d0a  betype': _type}.
-00026d60: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00026d70: 206f 7065 6e28 6622 7b63 6c75 7374 6572   open(f"{cluster
-00026d80: 6469 727d 2f6b 636c 695f 7061 7261 6d65  dir}/kcli_parame
-00026d90: 7465 7273 2e79 6d6c 222c 2027 7227 2920  ters.yml", 'r') 
-00026da0: 6173 2069 6e73 7461 6c6c 3a0a 2020 2020  as install:.    
-00026db0: 2020 2020 2020 2020 2020 2020 696e 7374              inst
-00026dc0: 616c 6c70 6172 616d 203d 2079 616d 6c2e  allparam = yaml.
-00026dd0: 7361 6665 5f6c 6f61 6428 696e 7374 616c  safe_load(instal
-00026de0: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
-00026df0: 2020 2064 6174 612e 7570 6461 7465 2869     data.update(i
-00026e00: 6e73 7461 6c6c 7061 7261 6d29 0a20 2020  nstallparam).   
-00026e10: 2020 2020 2020 2020 2020 2020 2070 6c61               pla
-00026e20: 6e20 3d20 696e 7374 616c 6c70 6172 616d  n = installparam
-00026e30: 2e67 6574 2827 706c 616e 272c 2070 6c61  .get('plan', pla
-00026e40: 6e29 0a20 2020 2020 2020 2020 2020 2064  n).            d
-00026e50: 6174 612e 7570 6461 7465 286f 7665 7272  ata.update(overr
-00026e60: 6964 6573 290a 2020 2020 2020 2020 2020  ides).          
-00026e70: 2020 7769 7468 206f 7065 6e28 6622 7b63    with open(f"{c
-00026e80: 6c75 7374 6572 6469 727d 2f6b 636c 695f  lusterdir}/kcli_
-00026e90: 7061 7261 6d65 7465 7273 2e79 6d6c 222c  parameters.yml",
-00026ea0: 2027 7727 2920 6173 2070 6172 616d 6669   'w') as paramfi
-00026eb0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-00026ec0: 2020 2020 7961 6d6c 2e73 6166 655f 6475      yaml.safe_du
-00026ed0: 6d70 2864 6174 612c 2070 6172 616d 6669  mp(data, paramfi
-00026ee0: 6c65 290a 2020 2020 2020 2020 6f73 2e63  le).        os.c
-00026ef0: 6864 6972 286f 732e 7061 7468 2e65 7870  hdir(os.path.exp
-00026f00: 616e 6475 7365 7228 227e 2f2e 6b63 6c69  anduser("~/.kcli
-00026f10: 2229 290a 2020 2020 2020 2020 666f 7220  ")).        for 
-00026f20: 726f 6c65 2069 6e20 726f 6c65 733a 0a20  role in roles:. 
-00026f30: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-00026f40: 7428 6622 5570 6461 7469 6e67 2076 6d73  t(f"Updating vms
-00026f50: 2077 6974 6820 7b72 6f6c 657d 2072 6f6c   with {role} rol
-00026f60: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
-00026f70: 706c 616e 6461 7461 203d 2073 656c 662e  plandata = self.
-00026f80: 706c 616e 2870 6c61 6e2c 2069 6e70 7574  plan(plan, input
-00026f90: 6669 6c65 3d66 277b 706c 616e 6469 727d  file=f'{plandir}
-00026fa0: 2f7b 726f 6c65 7d2e 796d 6c27 2c20 6f76  /{role}.yml', ov
-00026fb0: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
-00026fc0: 732c 2075 7064 6174 653d 5472 7565 290a  s, update=True).
-00026fd0: 2020 2020 2020 2020 2020 2020 706c 616e              plan
-00026fe0: 766d 732e 6578 7465 6e64 2870 6c61 6e64  vms.extend(pland
-00026ff0: 6174 615b 276e 6577 766d 7327 5d20 2b20  ata['newvms'] + 
-00027000: 706c 616e 6461 7461 5b27 6578 6973 7469  plandata['existi
-00027010: 6e67 766d 7327 5d29 0a20 2020 2020 2020  ngvms']).       
-00027020: 206f 732e 656e 7669 726f 6e5b 274b 5542   os.environ['KUB
-00027030: 4543 4f4e 4649 4727 5d20 3d20 6622 7b63  ECONFIG'] = f"{c
-00027040: 6c75 7374 6572 6469 727d 2f61 7574 682f  lusterdir}/auth/
-00027050: 6b75 6265 636f 6e66 6967 220a 2020 2020  kubeconfig".    
-00027060: 2020 2020 6269 6e61 7279 203d 2027 6f63      binary = 'oc
-00027070: 2720 6966 2077 6869 6368 2827 6f63 2729  ' if which('oc')
-00027080: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
-00027090: 6520 276b 7562 6563 746c 270a 2020 2020  e 'kubectl'.    
-000270a0: 2020 2020 6e6f 6465 7363 6d64 203d 2066      nodescmd = f
-000270b0: 277b 6269 6e61 7279 7d20 6765 7420 6e6f  '{binary} get no
-000270c0: 6465 202d 6f20 6e61 6d65 270a 2020 2020  de -o name'.    
-000270d0: 2020 2020 6e6f 6465 7320 3d20 5b6e 2e73      nodes = [n.s
-000270e0: 7472 6970 2829 2e72 6570 6c61 6365 2827  trip().replace('
-000270f0: 6e6f 6465 2f27 2c20 2727 2920 666f 7220  node/', '') for 
-00027100: 6e20 696e 206f 732e 706f 7065 6e28 6e6f  n in os.popen(no
-00027110: 6465 7363 6d64 292e 7265 6164 6c69 6e65  descmd).readline
-00027120: 7328 295d 0a20 2020 2020 2020 2066 6f72  s()].        for
-00027130: 2076 6d20 696e 2073 656c 662e 6b2e 6c69   vm in self.k.li
-00027140: 7374 2829 3a0a 2020 2020 2020 2020 2020  st():.          
-00027150: 2020 766d 6e61 6d65 203d 2076 6d5b 276e    vmname = vm['n
-00027160: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
-00027170: 2020 766d 706c 616e 203d 2076 6d2e 6765    vmplan = vm.ge
-00027180: 7428 2770 6c61 6e27 2c20 276b 7669 7274  t('plan', 'kvirt
-00027190: 2729 0a20 2020 2020 2020 2020 2020 2069  ').            i
-000271a0: 6620 766d 706c 616e 203d 3d20 706c 616e  f vmplan == plan
-000271b0: 2061 6e64 2076 6d6e 616d 6520 6e6f 7420   and vmname not 
-000271c0: 696e 2070 6c61 6e76 6d73 3a0a 2020 2020  in planvms:.    
-000271d0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-000271e0: 6e74 2866 2244 656c 6574 696e 6720 766d  nt(f"Deleting vm
-000271f0: 207b 766d 6e61 6d65 7d22 290a 2020 2020   {vmname}").    
-00027200: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00027210: 2e6b 2e64 656c 6574 6528 766d 6e61 6d65  .k.delete(vmname
-00027220: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00027230: 2020 666f 7220 6e6f 6465 2069 6e20 6e6f    for node in no
-00027240: 6465 733a 0a20 2020 2020 2020 2020 2020  des:.           
-00027250: 2020 2020 2020 2020 2069 6620 6e6f 6465           if node
-00027260: 2e73 706c 6974 2827 2e27 295b 305d 203d  .split('.')[0] =
-00027270: 3d20 766d 6e61 6d65 3a0a 2020 2020 2020  = vmname:.      
-00027280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027290: 2020 7070 7269 6e74 2866 2244 656c 6574    pprint(f"Delet
-000272a0: 696e 6720 6e6f 6465 207b 6e6f 6465 7d20  ing node {node} 
-000272b0: 6672 6f6d 2079 6f75 7220 636c 7573 7465  from your cluste
-000272c0: 7222 290a 2020 2020 2020 2020 2020 2020  r").            
-000272d0: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
-000272e0: 2866 277b 6269 6e61 7279 7d20 6465 6c65  (f'{binary} dele
-000272f0: 7465 206e 6f64 6520 7b6e 6f64 657d 272c  te node {node}',
-00027300: 2073 6865 6c6c 3d54 7275 6529 0a20 2020   shell=True).   
-00027310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027320: 2020 2020 2062 7265 616b 0a0a 2020 2020       break..    
-00027330: 6465 6620 6578 706f 7365 5f70 6c61 6e28  def expose_plan(
-00027340: 7365 6c66 2c20 706c 616e 2c20 696e 7075  self, plan, inpu
-00027350: 7466 696c 653d 4e6f 6e65 2c20 6f76 6572  tfile=None, over
-00027360: 7269 6465 733d 7b7d 2c20 706f 7274 3d39  rides={}, port=9
-00027370: 3030 302c 2070 666d 6f64 653d 4661 6c73  000, pfmode=Fals
-00027380: 652c 2063 6c75 7374 6572 3d46 616c 7365  e, cluster=False
-00027390: 293a 0a20 2020 2020 2020 2069 6e70 7574  ):.        input
-000273a0: 6669 6c65 203d 206f 732e 7061 7468 2e65  file = os.path.e
-000273b0: 7870 616e 6475 7365 7228 696e 7075 7466  xpanduser(inputf
-000273c0: 696c 6529 0a20 2020 2020 2020 2069 6620  ile).        if 
-000273d0: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
-000273e0: 7473 2869 6e70 7574 6669 6c65 293a 0a20  ts(inputfile):. 
-000273f0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00027400: 2822 4e6f 2069 6e70 7574 2066 696c 6520  ("No input file 
-00027410: 666f 756e 6420 6e6f 7220 6465 6661 756c  found nor defaul
-00027420: 7420 6b63 6c69 5f70 6c61 6e2e 796d 6c2e  t kcli_plan.yml.
-00027430: 4c65 6176 696e 672e 2e2e 2e22 290a 2020  Leaving....").  
-00027440: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
-00027450: 6974 2831 290a 2020 2020 2020 2020 7070  it(1).        pp
-00027460: 7269 6e74 2866 2248 616e 646c 696e 6720  rint(f"Handling 
-00027470: 6578 706f 7365 206f 6620 706c 616e 2077  expose of plan w
-00027480: 6974 6820 6e61 6d65 207b 706c 616e 7d20  ith name {plan} 
-00027490: 616e 6420 696e 7075 7466 696c 6520 7b69  and inputfile {i
-000274a0: 6e70 7574 6669 6c65 7d22 290a 2020 2020  nputfile}").    
-000274b0: 2020 2020 6b65 7870 6f73 6572 203d 204b      kexposer = K
-000274c0: 6578 706f 7365 7228 7365 6c66 2c20 706c  exposer(self, pl
-000274d0: 616e 2c20 696e 7075 7466 696c 652c 206f  an, inputfile, o
-000274e0: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
-000274f0: 6573 2c20 706f 7274 3d70 6f72 742c 2070  es, port=port, p
-00027500: 666d 6f64 653d 7066 6d6f 6465 2c20 636c  fmode=pfmode, cl
-00027510: 7573 7465 723d 636c 7573 7465 7229 0a20  uster=cluster). 
-00027520: 2020 2020 2020 206b 6578 706f 7365 722e         kexposer.
-00027530: 7275 6e28 290a 0a20 2020 2064 6566 2063  run()..    def c
-00027540: 7265 6174 655f 6f70 656e 7368 6966 745f  reate_openshift_
-00027550: 6973 6f28 7365 6c66 2c20 636c 7573 7465  iso(self, cluste
-00027560: 722c 206f 7665 7272 6964 6573 3d7b 7d2c  r, overrides={},
-00027570: 2069 676e 6974 696f 6e66 696c 653d 4e6f   ignitionfile=No
-00027580: 6e65 2c20 706f 646d 616e 3d46 616c 7365  ne, podman=False
-00027590: 2c20 696e 7374 616c 6c65 723d 4661 6c73  , installer=Fals
-000275a0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-000275b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000275c0: 6469 7265 6374 3d46 616c 7365 293a 0a20  direct=False):. 
-000275d0: 2020 2020 2020 206d 6574 616c 5f75 726c         metal_url
-000275e0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-000275f0: 6973 6f5f 7665 7273 696f 6e20 3d20 7374  iso_version = st
-00027600: 7228 6f76 6572 7269 6465 732e 6765 7428  r(overrides.get(
-00027610: 2776 6572 7369 6f6e 272c 2027 6c61 7465  'version', 'late
-00027620: 7374 2729 290a 2020 2020 2020 2020 6966  st')).        if
-00027630: 206e 6f74 2069 6e73 7461 6c6c 6572 3a0a   not installer:.
-00027640: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00027650: 736f 5f76 6572 7369 6f6e 206e 6f74 2069  so_version not i
-00027660: 6e20 5b27 6c61 7465 7374 272c 2027 7072  n ['latest', 'pr
-00027670: 652d 7265 6c65 6173 6527 5d20 616e 6420  e-release'] and 
-00027680: 6e6f 7420 6973 6f5f 7665 7273 696f 6e2e  not iso_version.
-00027690: 7374 6172 7473 7769 7468 2827 342e 2729  startswith('4.')
-000276a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000276b0: 2020 7761 726e 696e 6728 2246 6f72 6369    warning("Forci
-000276c0: 6e67 206c 6976 6520 6973 6f20 7665 7273  ng live iso vers
-000276d0: 696f 6e20 746f 206c 6174 6573 7422 290a  ion to latest").
-000276e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000276f0: 6973 6f5f 7665 7273 696f 6e20 3d20 276c  iso_version = 'l
-00027700: 6174 6573 7427 0a20 2020 2020 2020 2020  atest'.         
-00027710: 2020 2065 6c69 6620 6973 6f5f 7665 7273     elif iso_vers
-00027720: 696f 6e2e 7374 6172 7473 7769 7468 2827  ion.startswith('
-00027730: 342e 2729 3a0a 2020 2020 2020 2020 2020  4.'):.          
-00027740: 2020 2020 2020 6d69 6e6f 725f 7665 7273        minor_vers
-00027750: 696f 6e20 3d20 6973 6f5f 7665 7273 696f  ion = iso_versio
-00027760: 6e2e 7370 6c69 7428 272e 2729 5b31 5d0a  n.split('.')[1].
-00027770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027780: 6966 206d 696e 6f72 5f76 6572 7369 6f6e  if minor_version
-00027790: 2e69 7364 6967 6974 2829 2061 6e64 2069  .isdigit() and i
-000277a0: 6e74 286d 696e 6f72 5f76 6572 7369 6f6e  nt(minor_version
-000277b0: 2920 3c20 363a 0a20 2020 2020 2020 2020  ) < 6:.         
-000277c0: 2020 2020 2020 2020 2020 206d 6574 616c             metal
-000277d0: 5f75 726c 203d 2066 2268 7474 7073 3a2f  _url = f"https:/
-000277e0: 2f6d 6972 726f 722e 6f70 656e 7368 6966  /mirror.openshif
-000277f0: 742e 636f 6d2f 7075 622f 6f70 656e 7368  t.com/pub/opensh
-00027800: 6966 742d 7634 2f64 6570 656e 6465 6e63  ift-v4/dependenc
-00027810: 6965 732f 7268 636f 732f 7b69 736f 5f76  ies/rhcos/{iso_v
-00027820: 6572 7369 6f6e 7d2f 6c61 7465 7374 220a  ersion}/latest".
-00027830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027840: 2020 2020 6d65 7461 6c5f 7572 6c20 2b3d      metal_url +=
-00027850: 2022 2f72 6863 6f73 2d6d 6574 616c 2e78   "/rhcos-metal.x
-00027860: 3836 5f36 342e 7261 772e 677a 220a 2020  86_64.raw.gz".  
-00027870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027880: 2020 7761 726e 696e 6728 2245 6d62 6564    warning("Embed
-00027890: 6469 6e67 206d 6574 616c 2075 726c 2069  ding metal url i
-000278a0: 6e20 6973 6f20 666f 7220 7461 7267 6574  n iso for target
-000278b0: 2076 6572 7369 6f6e 2061 6e64 2069 6e73   version and ins
-000278c0: 7461 6c6c 696e 6720 7769 7468 2061 206d  talling with a m
-000278d0: 6f72 6520 7265 6365 6e74 2069 736f 2229  ore recent iso")
-000278e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000278f0: 2069 736f 5f76 6572 7369 6f6e 203d 2027   iso_version = '
-00027900: 6c61 7465 7374 270a 2020 2020 2020 2020  latest'.        
-00027910: 6170 695f 6970 203d 206f 7665 7272 6964  api_ip = overrid
-00027920: 6573 2e67 6574 2827 6170 695f 6970 2729  es.get('api_ip')
-00027930: 0a20 2020 2020 2020 2069 676e 6974 696f  .        ignitio
-00027940: 6e5f 7665 7273 696f 6e20 3d20 6f76 6572  n_version = over
-00027950: 7269 6465 732e 6765 7428 2769 676e 6974  rides.get('ignit
-00027960: 696f 6e5f 7665 7273 696f 6e27 2c0a 2020  ion_version',.  
-00027970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027990: 2020 2020 2020 2063 6f6d 6d6f 6e2e 6967         common.ig
-000279a0: 6e69 7469 6f6e 5f76 6572 7369 6f6e 2822  nition_version("
-000279b0: 7268 636f 732d 2573 2220 2520 6973 6f5f  rhcos-%s" % iso_
-000279c0: 7665 7273 696f 6e2e 7265 706c 6163 6528  version.replace(
-000279d0: 272e 272c 2027 2729 2929 0a20 2020 2020  '.', ''))).     
-000279e0: 2020 2072 6f6c 6520 3d20 6f76 6572 7269     role = overri
-000279f0: 6465 732e 6765 7428 2772 6f6c 6527 2c20  des.get('role', 
-00027a00: 2777 6f72 6b65 7227 290a 2020 2020 2020  'worker').      
-00027a10: 2020 6973 6f20 3d20 6f76 6572 7269 6465    iso = override
-00027a20: 732e 6765 7428 2769 736f 272c 2054 7275  s.get('iso', Tru
-00027a30: 6529 0a20 2020 2020 2020 2064 6f6d 6169  e).        domai
-00027a40: 6e20 3d20 6f76 6572 7269 6465 732e 6765  n = overrides.ge
-00027a50: 7428 2764 6f6d 6169 6e27 290a 2020 2020  t('domain').    
-00027a60: 2020 2020 6966 2027 2e27 2069 6e20 636c      if '.' in cl
-00027a70: 7573 7465 723a 0a20 2020 2020 2020 2020  uster:.         
-00027a80: 2020 2064 6f6d 6169 6e20 3d20 272e 272e     domain = '.'.
-00027a90: 6a6f 696e 2863 6c75 7374 6572 2e73 706c  join(cluster.spl
-00027aa0: 6974 2827 2e27 295b 313a 5d29 0a20 2020  it('.')[1:]).   
-00027ab0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-00027ac0: 6622 5573 696e 6720 646f 6d61 696e 207b  f"Using domain {
-00027ad0: 646f 6d61 696e 7d22 290a 2020 2020 2020  domain}").      
-00027ae0: 2020 2020 2020 636c 7573 7465 7220 3d20        cluster = 
-00027af0: 636c 7573 7465 722e 7265 706c 6163 6528  cluster.replace(
-00027b00: 6622 2e7b 646f 6d61 696e 7d22 2c20 2727  f".{domain}", ''
-00027b10: 290a 2020 2020 2020 2020 6966 2063 6c75  ).        if clu
-00027b20: 7374 6572 2e73 7461 7274 7377 6974 6828  ster.startswith(
-00027b30: 2761 7069 2e27 293a 0a20 2020 2020 2020  'api.'):.       
-00027b40: 2020 2020 2063 6c75 7374 6572 203d 2063       cluster = c
-00027b50: 6c75 7374 6572 2e72 6570 6c61 6365 2822  luster.replace("
-00027b60: 6170 692e 222c 2027 2729 0a20 2020 2020  api.", '').     
-00027b70: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-00027b80: 5573 696e 6720 636c 7573 7465 7220 7b63  Using cluster {c
-00027b90: 6c75 7374 6572 7d22 290a 2020 2020 2020  luster}").      
-00027ba0: 2020 686f 7374 735f 636f 6e74 656e 7420    hosts_content 
-00027bb0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2066  = None.        f
-00027bc0: 696e 616c 6461 7461 203d 204e 6f6e 650a  inaldata = None.
-00027bd0: 2020 2020 2020 2020 6966 2069 676e 6974          if ignit
-00027be0: 696f 6e66 696c 6520 6973 206e 6f74 204e  ionfile is not N
-00027bf0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00027c00: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
-00027c10: 6578 6973 7473 2869 676e 6974 696f 6e66  exists(ignitionf
-00027c20: 696c 6529 3a0a 2020 2020 2020 2020 2020  ile):.          
-00027c30: 2020 2020 2020 6572 726f 7228 6622 7b69        error(f"{i
-00027c40: 676e 6974 696f 6e66 696c 657d 206e 6f74  gnitionfile} not
-00027c50: 2066 6f75 6e64 2229 0a20 2020 2020 2020   found").       
-00027c60: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00027c70: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
-00027c80: 2066 696e 616c 6461 7461 203d 206f 7065   finaldata = ope
-00027c90: 6e28 6967 6e69 7469 6f6e 6669 6c65 292e  n(ignitionfile).
-00027ca0: 7265 6164 2829 0a20 2020 2020 2020 2065  read().        e
-00027cb0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00027cc0: 2069 676e 6974 696f 6e66 696c 6520 3d20   ignitionfile = 
-00027cd0: 6622 7b72 6f6c 657d 2e69 676e 220a 2020  f"{role}.ign".  
-00027ce0: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
-00027cf0: 7061 7468 2e65 7869 7374 7328 6967 6e69  path.exists(igni
-00027d00: 7469 6f6e 6669 6c65 293a 0a20 2020 2020  tionfile):.     
-00027d10: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-00027d20: 6e67 2866 2255 7369 6e67 2065 7869 7374  ng(f"Using exist
-00027d30: 696e 6720 7b69 676e 6974 696f 6e66 696c  ing {ignitionfil
-00027d40: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
-00027d50: 2020 2020 2066 696e 616c 6461 7461 203d       finaldata =
-00027d60: 206f 7065 6e28 6967 6e69 7469 6f6e 6669   open(ignitionfi
-00027d70: 6c65 292e 7265 6164 2829 0a20 2020 2020  le).read().     
-00027d80: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00027d90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00027da0: 6170 695f 6970 2069 7320 4e6f 6e65 3a0a  api_ip is None:.
-00027db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027dc0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00027dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027de0: 2061 7069 5f69 7020 3d20 736f 636b 6574   api_ip = socket
-00027df0: 2e67 6574 686f 7374 6279 6e61 6d65 2866  .gethostbyname(f
-00027e00: 2761 7069 2e7b 636c 7573 7465 727d 2e7b  'api.{cluster}.{
-00027e10: 646f 6d61 696e 7d27 290a 2020 2020 2020  domain}').      
-00027e20: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00027e30: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
-00027e40: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00027e50: 7373 0a20 2020 2020 2020 2020 2020 2020  ss.             
-00027e60: 2020 2069 6620 6170 695f 6970 2069 7320     if api_ip is 
-00027e70: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00027e80: 2020 2020 2020 2020 2020 6966 2064 6f6d            if dom
-00027e90: 6169 6e20 6973 204e 6f6e 653a 0a20 2020  ain is None:.   
-00027ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027eb0: 2020 2020 2065 7272 6f72 2822 436f 756c       error("Coul
-00027ec0: 646e 2774 2066 6967 7572 6520 6f75 7420  dn't figure out 
-00027ed0: 6170 695f 6970 206e 6f72 2072 656c 7920  api_ip nor rely 
-00027ee0: 6f6e 2064 6e73 2073 696e 6365 2064 6f6d  on dns since dom
-00027ef0: 6169 6e20 6973 206e 6f74 2073 6574 2229  ain is not set")
-00027f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027f10: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00027f20: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
-00027f30: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-00027f40: 2822 436f 756c 646e 2774 2066 6967 7572  ("Couldn't figur
-00027f50: 6520 6f75 7420 6170 695f 6970 2e20 5265  e out api_ip. Re
-00027f60: 6c79 696e 6720 6f6e 2064 6e73 2229 0a20  lying on dns"). 
-00027f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027f80: 2020 2061 7069 5f69 7020 3d20 6622 6170     api_ip = f"ap
-00027f90: 692e 7b63 6c75 7374 6572 7d2e 7b64 6f6d  i.{cluster}.{dom
-00027fa0: 6169 6e7d 220a 2020 2020 2020 2020 2020  ain}".          
-00027fb0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00027fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027fd0: 686f 7374 735f 636f 6e74 656e 7420 3d20  hosts_content = 
-00027fe0: 2231 3237 2e30 2e30 2e31 2020 206c 6f63  "127.0.0.1   loc
-00027ff0: 616c 686f 7374 206c 6f63 616c 686f 7374  alhost localhost
-00028000: 2e6c 6f63 616c 646f 6d61 696e 206c 6f63  .localdomain loc
-00028010: 616c 686f 7374 3420 6c6f 6361 6c68 6f73  alhost4 localhos
-00028020: 7434 2e6c 6f63 616c 646f 6d61 696e 345c  t4.localdomain4\
-00028030: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
-00028040: 2020 2020 2020 2068 6f73 7473 5f63 6f6e         hosts_con
-00028050: 7465 6e74 202b 3d20 223a 3a31 2020 2020  tent += "::1    
-00028060: 2020 2020 206c 6f63 616c 686f 7374 206c       localhost l
-00028070: 6f63 616c 686f 7374 2e6c 6f63 616c 646f  ocalhost.localdo
-00028080: 6d61 696e 206c 6f63 616c 686f 7374 3620  main localhost6 
-00028090: 6c6f 6361 6c68 6f73 7436 2e6c 6f63 616c  localhost6.local
-000280a0: 646f 6d61 696e 365c 6e22 0a20 2020 2020  domain6\n".     
-000280b0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-000280c0: 6f73 7473 5f63 6f6e 7465 6e74 202b 3d20  osts_content += 
-000280d0: 6622 7b61 7069 5f69 707d 2061 7069 2d69  f"{api_ip} api-i
-000280e0: 6e74 2e7b 636c 7573 7465 727d 2e7b 646f  nt.{cluster}.{do
-000280f0: 6d61 696e 7d20 6170 692e 7b63 6c75 7374  main} api.{clust
-00028100: 6572 7d2e 7b64 6f6d 6169 6e7d 220a 2020  er}.{domain}".  
-00028110: 2020 2020 2020 706c 616e 6469 7220 3d20        plandir = 
-00028120: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
-00028130: 6f70 656e 7368 6966 742e 6372 6561 7465  openshift.create
-00028140: 2e5f 5f63 6f64 655f 5f2e 636f 5f66 696c  .__code__.co_fil
-00028150: 656e 616d 6529 0a20 2020 2020 2020 2077  ename).        w
-00028160: 6974 6820 6f70 656e 2822 6973 6f2e 6967  ith open("iso.ig
-00028170: 6e22 2c20 2777 2729 2061 7320 663a 0a20  n", 'w') as f:. 
-00028180: 2020 2020 2020 2020 2020 2066 756c 6c5f             full_
-00028190: 6e61 6d65 203d 2066 277b 636c 7573 7465  name = f'{cluste
-000281a0: 727d 2e7b 646f 6d61 696e 7d27 2069 6620  r}.{domain}' if 
-000281b0: 646f 6d61 696e 2069 7320 6e6f 7420 4e6f  domain is not No
-000281c0: 6e65 2065 6c73 6520 636c 7573 7465 720a  ne else cluster.
-000281d0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-000281e0: 6e74 2866 2257 7269 7469 6e67 2066 696c  nt(f"Writing fil
-000281f0: 6520 6973 6f2e 6967 6e20 666f 7220 7b72  e iso.ign for {r
-00028200: 6f6c 657d 2069 6e20 7b66 756c 6c5f 6e61  ole} in {full_na
-00028210: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
-00028220: 2020 6973 6f64 6972 203d 206f 732e 7061    isodir = os.pa
-00028230: 7468 2e64 6972 6e61 6d65 2863 6f6d 6d6f  th.dirname(commo
-00028240: 6e2e 5f5f 6669 6c65 5f5f 290a 2020 2020  n.__file__).    
-00028250: 2020 2020 2020 2020 6966 2066 696e 616c          if final
-00028260: 6461 7461 2069 7320 4e6f 6e65 3a0a 2020  data is None:.  
-00028270: 2020 2020 2020 2020 2020 2020 2020 656e                en
-00028280: 7620 3d20 456e 7669 726f 6e6d 656e 7428  v = Environment(
-00028290: 6c6f 6164 6572 3d46 696c 6553 7973 7465  loader=FileSyste
-000282a0: 6d4c 6f61 6465 7228 6973 6f64 6972 292c  mLoader(isodir),
-000282b0: 2065 7874 656e 7369 6f6e 733d 5b27 6a69   extensions=['ji
-000282c0: 6e6a 6132 2e65 7874 2e64 6f27 5d2c 2074  nja2.ext.do'], t
-000282d0: 7269 6d5f 626c 6f63 6b73 3d54 7275 652c  rim_blocks=True,
-000282e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000282f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028300: 2020 206c 7374 7269 705f 626c 6f63 6b73     lstrip_blocks
-00028310: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-00028320: 2020 2020 2020 2074 656d 706c 203d 2065         templ = e
-00028330: 6e76 2e67 6574 5f74 656d 706c 6174 6528  nv.get_template(
-00028340: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
-00028350: 2822 6967 6e69 7469 6f6e 2e6a 3222 2929  ("ignition.j2"))
-00028360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028370: 2069 6620 686f 7374 735f 636f 6e74 656e   if hosts_conten
-00028380: 7420 6973 206e 6f74 204e 6f6e 653a 0a20  t is not None:. 
-00028390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000283a0: 2020 2068 6f73 7473 5f63 6f6e 7465 6e74     hosts_content
-000283b0: 203d 2062 6173 6536 342e 6236 3465 6e63   = base64.b64enc
-000283c0: 6f64 6528 686f 7374 735f 636f 6e74 656e  ode(hosts_conten
-000283d0: 742e 656e 636f 6465 2829 292e 6465 636f  t.encode()).deco
-000283e0: 6465 2822 5554 462d 3822 290a 2020 2020  de("UTF-8").    
-000283f0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-00028400: 3a27 2069 6e20 6170 695f 6970 3a20 2020  :' in api_ip:   
-00028410: 2320 4950 7636 2061 6464 7265 7373 0a20  # IPv6 address. 
-00028420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028430: 2020 2069 676e 6974 696f 6e5f 7572 6c20     ignition_url 
-00028440: 3d20 6622 6874 7470 3a2f 2f5b 7b61 7069  = f"http://[{api
-00028450: 5f69 707d 5d3a 3232 3632 342f 636f 6e66  _ip}]:22624/conf
-00028460: 6967 2f7b 726f 6c65 7d22 0a20 2020 2020  ig/{role}".     
-00028470: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00028480: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00028490: 2049 5076 3420 6164 6472 6573 730a 2020   IPv4 address.  
-000284a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000284b0: 2020 6967 6e69 7469 6f6e 5f75 726c 203d    ignition_url =
-000284c0: 2066 2268 7474 703a 2f2f 7b61 7069 5f69   f"http://{api_i
-000284d0: 707d 3a32 3236 3234 2f63 6f6e 6669 672f  p}:22624/config/
-000284e0: 7b72 6f6c 657d 220a 2020 2020 2020 2020  {role}".        
-000284f0: 2020 2020 2020 2020 6669 6e61 6c64 6174          finaldat
-00028500: 6120 3d20 7465 6d70 6c2e 7265 6e64 6572  a = templ.render
-00028510: 2869 676e 6974 696f 6e5f 7572 6c3d 6967  (ignition_url=ig
-00028520: 6e69 7469 6f6e 5f75 726c 2c20 686f 7374  nition_url, host
-00028530: 735f 636f 6e74 656e 743d 686f 7374 735f  s_content=hosts_
-00028540: 636f 6e74 656e 742c 0a20 2020 2020 2020  content,.       
-00028550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028570: 2020 6967 6e69 7469 6f6e 5f76 6572 7369    ignition_versi
-00028580: 6f6e 3d69 676e 6974 696f 6e5f 7665 7273  on=ignition_vers
-00028590: 696f 6e29 0a20 2020 2020 2020 2020 2020  ion).           
-000285a0: 2069 6620 6469 7265 6374 3a0a 2020 2020   if direct:.    
-000285b0: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
-000285c0: 6974 6528 6669 6e61 6c64 6174 6129 0a20  ite(finaldata). 
-000285d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000285e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000285f0: 205f 6669 6c65 7320 3d20 5b7b 2270 6174   _files = [{"pat
-00028600: 6822 3a20 222f 726f 6f74 2f63 6f6e 6669  h": "/root/confi
-00028610: 672e 6967 6e22 2c20 2263 6f6e 7465 6e74  g.ign", "content
-00028620: 223a 2066 696e 616c 6461 7461 7d5d 0a20  ": finaldata}]. 
-00028630: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00028640: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
-00028650: 2827 6973 6f2e 7368 2729 3a0a 2020 2020  ('iso.sh'):.    
-00028660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028670: 7070 7269 6e74 2822 5573 696e 6720 6c6f  pprint("Using lo
-00028680: 6361 6c20 6973 6f2e 7368 2073 6372 6970  cal iso.sh scrip
-00028690: 7422 290a 2020 2020 2020 2020 2020 2020  t").            
-000286a0: 2020 2020 2020 2020 6973 6f73 6372 6970          isoscrip
-000286b0: 7420 3d20 2769 736f 2e73 6827 0a20 2020  t = 'iso.sh'.   
-000286c0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-000286d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000286e0: 2020 2020 2020 2069 736f 7363 7269 7074         isoscript
-000286f0: 203d 2066 277b 706c 616e 6469 727d 2f69   = f'{plandir}/i
-00028700: 736f 2e73 6827 0a20 2020 2020 2020 2020  so.sh'.         
-00028710: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-00028720: 682e 6578 6973 7473 2827 6d61 6373 2e74  h.exists('macs.t
-00028730: 7874 2729 3a0a 2020 2020 2020 2020 2020  xt'):.          
-00028740: 2020 2020 2020 2020 2020 5f66 696c 6573            _files
-00028750: 2e61 7070 656e 6428 7b22 7061 7468 223a  .append({"path":
-00028760: 2022 2f72 6f6f 742f 6d61 6373 2e74 7874   "/root/macs.txt
-00028770: 222c 2022 6f72 6967 696e 223a 2027 6d61  ", "origin": 'ma
-00028780: 6373 2e74 7874 277d 290a 2020 2020 2020  cs.txt'}).      
-00028790: 2020 2020 2020 2020 2020 6973 6f5f 6f76            iso_ov
-000287a0: 6572 7269 6465 7320 3d20 7b27 7363 7269  errides = {'scri
-000287b0: 7074 7327 3a20 5b69 736f 7363 7269 7074  pts': [isoscript
-000287c0: 5d2c 2027 6669 6c65 7327 3a20 5f66 696c  ], 'files': _fil
-000287d0: 6573 2c20 276d 6574 616c 5f75 726c 273a  es, 'metal_url':
-000287e0: 206d 6574 616c 5f75 726c 2c20 276e 6f6e   metal_url, 'non
-000287f0: 616d 6527 3a20 5472 7565 2c0a 2020 2020  ame': True,.    
-00028800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028810: 2020 2020 2020 2020 2020 2020 2027 696d               'im
-00028820: 6167 6527 3a20 2772 6863 6f73 3430 3030  age': 'rhcos4000
-00028830: 277d 0a20 2020 2020 2020 2020 2020 2020  '}.             
-00028840: 2020 2069 6620 6d65 7461 6c5f 7572 6c20     if metal_url 
-00028850: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00028860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028870: 2069 736f 5f6f 7665 7272 6964 6573 5b27   iso_overrides['
-00028880: 6e65 6564 5f6e 6574 776f 726b 275d 203d  need_network'] =
-00028890: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-000288a0: 2020 2020 2020 6973 6f5f 6f76 6572 7269        iso_overri
-000288b0: 6465 732e 7570 6461 7465 286f 7665 7272  des.update(overr
-000288c0: 6964 6573 290a 2020 2020 2020 2020 2020  ides).          
-000288d0: 2020 2020 2020 6966 2027 6e61 6d65 2720        if 'name' 
-000288e0: 696e 206f 7665 7272 6964 6573 3a0a 2020  in overrides:.  
-000288f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028900: 2020 6973 6f5f 6e61 6d65 203d 206f 7665    iso_name = ove
-00028910: 7272 6964 6573 5b27 6e61 6d65 275d 0a20  rrides['name']. 
-00028920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028930: 2020 2069 736f 5f6f 7665 7272 6964 6573     iso_overrides
-00028940: 5b27 6e6f 6e61 6d65 275d 203d 2046 616c  ['noname'] = Fal
-00028950: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
-00028960: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00028970: 2020 2020 2020 2020 2020 2020 2069 736f               iso
-00028980: 5f6e 616d 6520 3d20 2761 7574 6f69 6e73  _name = 'autoins
-00028990: 7461 6c6c 6572 270a 2020 2020 2020 2020  taller'.        
-000289a0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-000289b0: 2073 656c 662e 6372 6561 7465 5f76 6d28   self.create_vm(
-000289c0: 6973 6f5f 6e61 6d65 2c20 6f76 6572 7269  iso_name, overri
-000289d0: 6465 733d 6973 6f5f 6f76 6572 7269 6465  des=iso_override
-000289e0: 732c 206f 6e6c 7961 7373 6574 733d 5472  s, onlyassets=Tr
-000289f0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00028a00: 2020 2020 6966 2027 7265 6173 6f6e 2720      if 'reason' 
-00028a10: 696e 2072 6573 756c 743a 0a20 2020 2020  in result:.     
-00028a20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00028a30: 7272 6f72 2872 6573 756c 745b 2772 6561  rror(result['rea
-00028a40: 736f 6e27 5d29 0a20 2020 2020 2020 2020  son']).         
-00028a50: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00028a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028a70: 2066 2e77 7269 7465 2872 6573 756c 745b   f.write(result[
-00028a80: 2764 6174 6127 5d29 0a20 2020 2020 2020  'data']).       
-00028a90: 2069 6620 6973 6f3a 0a20 2020 2020 2020   if iso:.       
-00028aa0: 2020 2020 2069 6620 7365 6c66 2e74 7970       if self.typ
-00028ab0: 6520 6e6f 7420 696e 205b 276b 766d 272c  e not in ['kvm',
-00028ac0: 2027 6661 6b65 272c 2027 6b75 6265 7669   'fake', 'kubevi
-00028ad0: 7274 272c 2027 7673 7068 6572 6527 2c20  rt', 'vsphere', 
-00028ae0: 276f 7065 6e73 7461 636b 275d 3a0a 2020  'openstack']:.  
-00028af0: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-00028b00: 726e 696e 6728 6622 4973 6f20 6765 6e65  rning(f"Iso gene
-00028b10: 7261 7469 6f6e 206e 6f74 2073 7570 706f  ration not suppo
-00028b20: 7274 6564 206f 6e20 7b73 656c 662e 7479  rted on {self.ty
-00028b30: 7065 7d22 290a 2020 2020 2020 2020 2020  pe}").          
-00028b40: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00028b50: 2020 2020 2020 2020 6973 6f5f 706f 6f6c          iso_pool
-00028b60: 203d 206f 7665 7272 6964 6573 2e67 6574   = overrides.get
-00028b70: 2827 706f 6f6c 2729 206f 7220 7365 6c66  ('pool') or self
-00028b80: 2e70 6f6f 6c0a 2020 2020 2020 2020 2020  .pool.          
-00028b90: 2020 2020 2020 6765 6e65 7261 7465 5f72        generate_r
-00028ba0: 6863 6f73 5f69 736f 2873 656c 662e 6b2c  hcos_iso(self.k,
-00028bb0: 2066 227b 636c 7573 7465 727d 2d7b 726f   f"{cluster}-{ro
-00028bc0: 6c65 7d22 2c20 6973 6f5f 706f 6f6c 2c20  le}", iso_pool, 
-00028bd0: 7665 7273 696f 6e3d 6973 6f5f 7665 7273  version=iso_vers
-00028be0: 696f 6e2c 2070 6f64 6d61 6e3d 706f 646d  ion, podman=podm
-00028bf0: 616e 2c0a 2020 2020 2020 2020 2020 2020  an,.            
-00028c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028c10: 2020 2020 2020 2069 6e73 7461 6c6c 6572         installer
-00028c20: 3d69 6e73 7461 6c6c 6572 290a 0a20 2020  =installer)..   
-00028c30: 2064 6566 2063 7265 6174 655f 6f70 656e   def create_open
-00028c40: 7368 6966 745f 6469 7363 6f6e 6e65 6374  shift_disconnect
-00028c50: 6564 2873 656c 662c 2070 6c61 6e2c 206f  ed(self, plan, o
-00028c60: 7665 7272 6964 6573 3d7b 7d29 3a0a 2020  verrides={}):.  
-00028c70: 2020 2020 2020 6461 7461 203d 206f 7665        data = ove
-00028c80: 7272 6964 6573 0a20 2020 2020 2020 2070  rrides.        p
-00028c90: 6c61 6e64 6972 203d 206f 732e 7061 7468  landir = os.path
-00028ca0: 2e64 6972 6e61 6d65 286f 7065 6e73 6869  .dirname(openshi
-00028cb0: 6674 2e63 7265 6174 652e 5f5f 636f 6465  ft.create.__code
-00028cc0: 5f5f 2e63 6f5f 6669 6c65 6e61 6d65 290a  __.co_filename).
-00028cd0: 2020 2020 2020 2020 636c 7573 7465 7220          cluster 
-00028ce0: 3d20 6461 7461 2e67 6574 2827 636c 7573  = data.get('clus
-00028cf0: 7465 7227 2c20 276d 796f 7065 6e73 6869  ter', 'myopenshi
-00028d00: 6674 2729 0a20 2020 2020 2020 2075 7073  ft').        ups
-00028d10: 7472 6561 6d20 3d20 6461 7461 2e67 6574  tream = data.get
-00028d20: 2827 7570 7374 7265 616d 272c 2046 616c  ('upstream', Fal
-00028d30: 7365 290a 2020 2020 2020 2020 7665 7273  se).        vers
-00028d40: 696f 6e20 3d20 6461 7461 2e67 6574 2827  ion = data.get('
-00028d50: 7665 7273 696f 6e27 2c20 2773 7461 626c  version', 'stabl
-00028d60: 6527 290a 2020 2020 2020 2020 7461 6720  e').        tag 
-00028d70: 3d20 6461 7461 2e67 6574 2827 7461 6727  = data.get('tag'
-00028d80: 2c20 4f50 454e 5348 4946 545f 5441 4729  , OPENSHIFT_TAG)
-00028d90: 0a20 2020 2020 2020 2070 7072 696e 7428  .        pprint(
-00028da0: 6622 5573 696e 6720 7665 7273 696f 6e20  f"Using version 
-00028db0: 7b76 6572 7369 6f6e 7d20 616e 6420 7461  {version} and ta
-00028dc0: 6720 7b74 6167 7d22 290a 2020 2020 2020  g {tag}").      
-00028dd0: 2020 6469 7363 6f6e 6e65 6374 6564 5f76    disconnected_v
-00028de0: 6d20 3d20 6622 7b63 6c75 7374 6572 7d2d  m = f"{cluster}-
-00028df0: 6469 7363 6f6e 6e65 6374 6564 220a 2020  disconnected".  
-00028e00: 2020 2020 2020 6469 7363 6f6e 6e65 6374        disconnect
-00028e10: 6564 5f72 6575 7365 203d 2064 6174 612e  ed_reuse = data.
-00028e20: 6765 7428 2764 6973 636f 6e6e 6563 7465  get('disconnecte
-00028e30: 645f 7265 7573 6527 2c20 4661 6c73 6529  d_reuse', False)
-00028e40: 0a20 2020 2020 2020 2064 6973 636f 6e6e  .        disconn
-00028e50: 6563 7465 645f 7379 6e63 203d 2064 6174  ected_sync = dat
-00028e60: 612e 6765 7428 2764 6973 636f 6e6e 6563  a.get('disconnec
-00028e70: 7465 645f 7379 6e63 272c 2054 7275 6529  ted_sync', True)
-00028e80: 0a20 2020 2020 2020 2070 7072 696e 7428  .        pprint(
-00028e90: 6622 4465 706c 6f79 696e 6720 6469 7363  f"Deploying disc
-00028ea0: 6f6e 6e65 6374 6564 2076 6d20 7b64 6973  onnected vm {dis
-00028eb0: 636f 6e6e 6563 7465 645f 766d 7d22 290a  connected_vm}").
-00028ec0: 2020 2020 2020 2020 6966 2064 6973 636f          if disco
-00028ed0: 6e6e 6563 7465 645f 7379 6e63 3a0a 2020  nnected_sync:.  
-00028ee0: 2020 2020 2020 2020 2020 7075 6c6c 5f73            pull_s
-00028ef0: 6563 7265 7420 3d20 7077 645f 7061 7468  ecret = pwd_path
-00028f00: 2864 6174 612e 6765 7428 2770 756c 6c5f  (data.get('pull_
-00028f10: 7365 6372 6574 2729 2920 6966 206e 6f74  secret')) if not
-00028f20: 2075 7073 7472 6561 6d20 656c 7365 2066   upstream else f
-00028f30: 227b 706c 616e 6469 727d 2f66 616b 655f  "{plandir}/fake_
-00028f40: 7075 6c6c 2e6a 736f 6e22 0a20 2020 2020  pull.json".     
-00028f50: 2020 2020 2020 2069 6620 6e6f 7420 7570         if not up
-00028f60: 7374 7265 616d 3a0a 2020 2020 2020 2020  stream:.        
-00028f70: 2020 2020 2020 2020 7075 6c6c 5f73 6563          pull_sec
-00028f80: 7265 7420 3d20 7077 645f 7061 7468 2864  ret = pwd_path(d
-00028f90: 6174 612e 6765 7428 2770 756c 6c5f 7365  ata.get('pull_se
-00028fa0: 6372 6574 272c 2027 6f70 656e 7368 6966  cret', 'openshif
-00028fb0: 745f 7075 6c6c 2e6a 736f 6e27 2929 0a20  t_pull.json')). 
-00028fc0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00028fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028fe0: 2070 756c 6c5f 7365 6372 6574 203d 2066   pull_secret = f
-00028ff0: 227b 706c 616e 6469 727d 2f66 616b 655f  "{plandir}/fake_
-00029000: 7075 6c6c 2e6a 736f 6e22 0a20 2020 2020  pull.json".     
-00029010: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-00029020: 2e70 6174 682e 6578 6973 7473 2870 756c  .path.exists(pul
-00029030: 6c5f 7365 6372 6574 293a 0a20 2020 2020  l_secret):.     
-00029040: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00029050: 2866 224d 6973 7369 6e67 2070 756c 6c20  (f"Missing pull 
-00029060: 7365 6372 6574 2066 696c 6520 7b70 756c  secret file {pul
-00029070: 6c5f 7365 6372 6574 7d22 290a 2020 2020  l_secret}").    
-00029080: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-00029090: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
-000290a0: 2020 2020 6461 7461 5b27 7075 6c6c 5f73      data['pull_s
-000290b0: 6563 7265 7427 5d20 3d20 7265 2e73 7562  ecret'] = re.sub
-000290c0: 2872 225c 7322 2c20 2222 2c20 6f70 656e  (r"\s", "", open
-000290d0: 2870 756c 6c5f 7365 6372 6574 292e 7265  (pull_secret).re
-000290e0: 6164 2829 290a 2020 2020 2020 2020 6469  ad()).        di
-000290f0: 7363 6f6e 6e65 6374 6564 5f70 6c61 6e20  sconnected_plan 
-00029100: 3d20 6622 7b70 6c61 6e7d 2d72 6575 7365  = f"{plan}-reuse
-00029110: 2220 6966 2064 6973 636f 6e6e 6563 7465  " if disconnecte
-00029120: 645f 7265 7573 6520 656c 7365 2070 6c61  d_reuse else pla
-00029130: 6e0a 2020 2020 2020 2020 6966 2076 6572  n.        if ver
-00029140: 7369 6f6e 203d 3d20 2763 6927 2061 6e64  sion == 'ci' and
-00029150: 2027 6469 7363 6f6e 6e65 6374 6564 5f6f   'disconnected_o
-00029160: 7269 6769 6e27 206e 6f74 2069 6e20 6f76  rigin' not in ov
-00029170: 6572 7269 6465 733a 0a20 2020 2020 2020  errides:.       
-00029180: 2020 2020 2072 6567 203d 2027 7265 6769       reg = 'regi
-00029190: 7374 7279 2e62 7569 6c64 3031 2e63 692e  stry.build01.ci.
-000291a0: 6f70 656e 7368 6966 742e 6f72 6727 2069  openshift.org' i
-000291b0: 6620 7374 7228 7461 6729 2e73 7461 7274  f str(tag).start
-000291c0: 7377 6974 6828 2763 692d 2729 2065 6c73  swith('ci-') els
-000291d0: 6520 2772 6567 6973 7472 792e 6369 2e6f  e 'registry.ci.o
-000291e0: 7065 6e73 6869 6674 2e6f 7267 270a 2020  penshift.org'.  
-000291f0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-00029200: 6728 6622 466f 7263 696e 6720 6469 7363  g(f"Forcing disc
-00029210: 6f6e 6e65 6374 6564 5f6f 7269 6769 6e20  onnected_origin 
-00029220: 746f 207b 7265 677d 2229 0a20 2020 2020  to {reg}").     
-00029230: 2020 2020 2020 2064 6174 615b 2764 6973         data['dis
-00029240: 636f 6e6e 6563 7465 645f 6f72 6967 696e  connected_origin
-00029250: 275d 203d 2072 6567 0a20 2020 2020 2020  '] = reg.       
-00029260: 2072 6573 756c 7420 3d20 7365 6c66 2e70   result = self.p
-00029270: 6c61 6e28 6469 7363 6f6e 6e65 6374 6564  lan(disconnected
-00029280: 5f70 6c61 6e2c 2069 6e70 7574 6669 6c65  _plan, inputfile
-00029290: 3d66 277b 706c 616e 6469 727d 2f64 6973  =f'{plandir}/dis
-000292a0: 636f 6e6e 6563 7465 642e 796d 6c27 2c20  connected.yml', 
-000292b0: 6f76 6572 7269 6465 733d 6461 7461 290a  overrides=data).
-000292c0: 2020 2020 2020 2020 6966 2072 6573 756c          if resul
-000292d0: 745b 2772 6573 756c 7427 5d20 213d 2027  t['result'] != '
-000292e0: 7375 6363 6573 7327 3a0a 2020 2020 2020  success':.      
-000292f0: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
-00029300: 290a 2020 2020 2020 2020 656c 6966 2064  ).        elif d
-00029310: 6973 636f 6e6e 6563 7465 645f 7379 6e63  isconnected_sync
-00029320: 3a0a 2020 2020 2020 2020 2020 2020 7070  :.            pp
-00029330: 7269 6e74 2822 5573 6520 7468 6520 666f  rint("Use the fo
-00029340: 6c6c 6f77 696e 6720 4f50 454e 5348 4946  llowing OPENSHIF
-00029350: 545f 494e 5354 414c 4c5f 5245 4c45 4153  T_INSTALL_RELEAS
-00029360: 455f 494d 4147 455f 4f56 4552 5249 4445  E_IMAGE_OVERRIDE
-00029370: 2229 0a20 2020 2020 2020 2020 2020 206e  ").            n
-00029380: 616d 6520 3d20 6461 7461 2e67 6574 2827  ame = data.get('
-00029390: 6469 7363 6f6e 6e65 6374 6564 5f72 6575  disconnected_reu
-000293a0: 7365 5f6e 616d 6527 2920 6f72 2063 6c75  se_name') or clu
-000293b0: 7374 6572 0a20 2020 2020 2020 2020 2020  ster.           
-000293c0: 2069 702c 2076 6d70 6f72 7420 3d20 5f73   ip, vmport = _s
-000293d0: 7368 5f63 7265 6465 6e74 6961 6c73 2873  sh_credentials(s
-000293e0: 656c 662e 6b2c 2066 277b 6e61 6d65 7d2d  elf.k, f'{name}-
-000293f0: 6469 7363 6f6e 6e65 6374 6564 2729 5b31  disconnected')[1
-00029400: 3a5d 0a20 2020 2020 2020 2020 2020 2063  :].            c
-00029410: 6d64 203d 2022 6361 7420 2f72 6f6f 742f  md = "cat /root/
-00029420: 7665 7273 696f 6e2e 7478 7422 0a20 2020  version.txt".   
-00029430: 2020 2020 2020 2020 2073 7368 636d 6420           sshcmd 
-00029440: 3d20 7373 6828 6e61 6d65 2c20 6970 3d69  = ssh(name, ip=i
-00029450: 702c 2075 7365 723d 2772 6f6f 7427 2c20  p, user='root', 
-00029460: 7475 6e6e 656c 3d73 656c 662e 7475 6e6e  tunnel=self.tunn
-00029470: 656c 2c0a 2020 2020 2020 2020 2020 2020  el,.            
-00029480: 2020 2020 2020 2020 2020 2020 2074 756e               tun
-00029490: 6e65 6c68 6f73 743d 7365 6c66 2e74 756e  nelhost=self.tun
-000294a0: 6e65 6c68 6f73 742c 2074 756e 6e65 6c70  nelhost, tunnelp
-000294b0: 6f72 743d 7365 6c66 2e74 756e 6e65 6c70  ort=self.tunnelp
-000294c0: 6f72 742c 0a20 2020 2020 2020 2020 2020  ort,.           
-000294d0: 2020 2020 2020 2020 2020 2020 2020 7475                tu
-000294e0: 6e6e 656c 7573 6572 3d73 656c 662e 7475  nneluser=self.tu
-000294f0: 6e6e 656c 7573 6572 2c20 696e 7365 6375  nneluser, insecu
-00029500: 7265 3d54 7275 652c 2063 6d64 3d63 6d64  re=True, cmd=cmd
-00029510: 2c20 766d 706f 7274 3d76 6d70 6f72 7429  , vmport=vmport)
-00029520: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
-00029530: 7379 7374 656d 2873 7368 636d 6429 0a0a  system(sshcmd)..
-00029540: 2020 2020 6465 6620 6861 6e64 6c65 5f66      def handle_f
-00029550: 696e 6973 6866 696c 6573 2873 656c 662c  inishfiles(self,
-00029560: 206e 616d 652c 2066 696e 6973 6866 696c   name, finishfil
-00029570: 6573 2c20 6964 656e 7469 7479 6669 6c65  es, identityfile
-00029580: 3d4e 6f6e 652c 2076 6d63 6c69 656e 743d  =None, vmclient=
-00029590: 4e6f 6e65 293a 0a20 2020 2020 2020 2063  None):.        c
-000295a0: 6f6e 6669 6720 3d20 4b63 6f6e 6669 6728  onfig = Kconfig(
-000295b0: 636c 6965 6e74 3d76 6d63 6c69 656e 7429  client=vmclient)
-000295c0: 2069 6620 766d 636c 6965 6e74 2069 7320   if vmclient is 
-000295d0: 6e6f 7420 4e6f 6e65 2065 6c73 6520 7365  not None else se
-000295e0: 6c66 0a20 2020 2020 2020 206b 203d 2063  lf.        k = c
-000295f0: 6f6e 6669 672e 6b0a 2020 2020 2020 2020  onfig.k.        
-00029600: 6375 7272 656e 745f 6970 203d 2063 6f6d  current_ip = com
-00029610: 6d6f 6e2e 5f73 7368 5f63 7265 6465 6e74  mon._ssh_credent
-00029620: 6961 6c73 286b 2c20 6e61 6d65 295b 315d  ials(k, name)[1]
-00029630: 0a20 2020 2020 2020 2066 6f72 2066 696e  .        for fin
-00029640: 6973 6866 696c 6520 696e 2066 696e 6973  ishfile in finis
-00029650: 6866 696c 6573 3a0a 2020 2020 2020 2020  hfiles:.        
-00029660: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00029670: 6528 6669 6e69 7368 6669 6c65 2c20 7374  e(finishfile, st
-00029680: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00029690: 2020 2020 6465 7374 696e 6174 696f 6e20      destination 
-000296a0: 3d20 272e 270a 2020 2020 2020 2020 2020  = '.'.          
-000296b0: 2020 2020 2020 736f 7572 6365 203d 2066        source = f
-000296c0: 696e 6973 6866 696c 6520 6966 2027 2f27  inishfile if '/'
-000296d0: 2069 6e20 6669 6e69 7368 6669 6c65 2065   in finishfile e
-000296e0: 6c73 6520 6627 2f72 6f6f 742f 7b66 696e  lse f'/root/{fin
-000296f0: 6973 6866 696c 657d 270a 2020 2020 2020  ishfile}'.      
-00029700: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-00029710: 7461 6e63 6528 6669 6e69 7368 6669 6c65  tance(finishfile
-00029720: 2c20 6469 6374 2920 616e 6420 276f 7269  , dict) and 'ori
-00029730: 6769 6e27 2069 6e20 6669 6e69 7368 6669  gin' in finishfi
-00029740: 6c65 2061 6e64 2027 7061 7468 2720 696e  le and 'path' in
-00029750: 2066 696e 6973 6866 696c 653a 0a20 2020   finishfile:.   
-00029760: 2020 2020 2020 2020 2020 2020 2073 6f75               sou
-00029770: 7263 652c 2064 6573 7469 6e61 7469 6f6e  rce, destination
-00029780: 203d 2066 696e 6973 6866 696c 652e 6765   = finishfile.ge
-00029790: 7428 276f 7269 6769 6e27 292c 206f 732e  t('origin'), os.
-000297a0: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
-000297b0: 6669 6e69 7368 6669 6c65 2e67 6574 2827  finishfile.get('
-000297c0: 7061 7468 272c 2027 2e27 2929 0a20 2020  path', '.')).   
-000297d0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-000297e0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-000297f0: 6172 6e69 6e67 2866 2249 6e63 6f72 7265  arning(f"Incorre
-00029800: 6374 2066 696e 6973 6866 696c 6520 656e  ct finishfile en
-00029810: 7472 7920 7b66 696e 6973 6866 696c 657d  try {finishfile}
-00029820: 2e20 536b 6970 7069 6e67 2229 0a20 2020  . Skipping").   
-00029830: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00029840: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-00029850: 2020 7363 7063 6d64 203d 2063 6f6d 6d6f    scpcmd = commo
-00029860: 6e2e 7363 7028 6e61 6d65 2c20 6970 3d63  n.scp(name, ip=c
-00029870: 7572 7265 6e74 5f69 702c 2075 7365 723d  urrent_ip, user=
-00029880: 2772 6f6f 7427 2c20 736f 7572 6365 3d73  'root', source=s
-00029890: 6f75 7263 652c 2064 6573 7469 6e61 7469  ource, destinati
-000298a0: 6f6e 3d64 6573 7469 6e61 7469 6f6e 2c0a  on=destination,.
-000298b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000298c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000298d0: 7475 6e6e 656c 3d63 6f6e 6669 672e 7475  tunnel=config.tu
-000298e0: 6e6e 656c 2c20 7475 6e6e 656c 686f 7374  nnel, tunnelhost
-000298f0: 3d63 6f6e 6669 672e 7475 6e6e 656c 686f  =config.tunnelho
-00029900: 7374 2c20 7475 6e6e 656c 706f 7274 3d63  st, tunnelport=c
-00029910: 6f6e 6669 672e 7475 6e6e 656c 706f 7274  onfig.tunnelport
-00029920: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00029930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029940: 2020 7475 6e6e 656c 7573 6572 3d73 656c    tunneluser=sel
-00029950: 662e 7475 6e6e 656c 7573 6572 2c20 646f  f.tunneluser, do
-00029960: 776e 6c6f 6164 3d54 7275 652c 2069 6e73  wnload=True, ins
-00029970: 6563 7572 653d 5472 7565 2c20 6964 656e  ecure=True, iden
-00029980: 7469 7479 6669 6c65 3d69 6465 6e74 6974  tityfile=identit
-00029990: 7966 696c 6529 0a20 2020 2020 2020 2020  yfile).         
-000299a0: 2020 206f 732e 7379 7374 656d 2873 6370     os.system(scp
-000299b0: 636d 6429 0a0a 2020 2020 6465 6620 6861  cmd)..    def ha
-000299c0: 6e64 6c65 5f6e 6f74 6966 6963 6174 696f  ndle_notificatio
-000299d0: 6e73 2873 656c 662c 206e 616d 652c 206e  ns(self, name, n
-000299e0: 6f74 6966 796d 6574 686f 6473 3d5b 5d2c  otifymethods=[],
-000299f0: 2070 7573 6862 756c 6c65 7474 6f6b 656e   pushbullettoken
-00029a00: 3d4e 6f6e 652c 206e 6f74 6966 7973 6372  =None, notifyscr
-00029a10: 6970 743d 4e6f 6e65 2c20 6e6f 7469 6679  ipt=None, notify
-00029a20: 636d 643d 4e6f 6e65 2c0a 2020 2020 2020  cmd=None,.      
-00029a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029a40: 2020 2020 2020 2073 6c61 636b 6368 616e         slackchan
-00029a50: 6e65 6c3d 4e6f 6e65 2c20 736c 6163 6b74  nel=None, slackt
-00029a60: 6f6b 656e 3d4e 6f6e 652c 206d 6169 6c73  oken=None, mails
-00029a70: 6572 7665 723d 4e6f 6e65 2c20 6d61 696c  erver=None, mail
-00029a80: 6672 6f6d 3d4e 6f6e 652c 206d 6169 6c74  from=None, mailt
-00029a90: 6f3d 4e6f 6e65 2c0a 2020 2020 2020 2020  o=None,.        
-00029aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029ab0: 2020 2020 2063 6c75 7374 6572 3d46 616c       cluster=Fal
-00029ac0: 7365 293a 0a20 2020 2020 2020 205f 7479  se):.        _ty
-00029ad0: 7065 203d 2027 436c 7573 7465 7227 2069  pe = 'Cluster' i
-00029ae0: 6620 636c 7573 7465 7220 656c 7365 2027  f cluster else '
-00029af0: 566d 270a 2020 2020 2020 2020 7469 746c  Vm'.        titl
-00029b00: 6520 3d20 6622 7b5f 7479 7065 7d20 7b6e  e = f"{_type} {n
-00029b10: 616d 657d 206f 6e20 7b73 656c 662e 636c  ame} on {self.cl
-00029b20: 6965 6e74 7d20 7265 706f 7274 220a 2020  ient} report".  
-00029b30: 2020 2020 2020 636d 6473 2c20 6d61 696c        cmds, mail
-00029b40: 636f 6e74 656e 7420 3d20 5b5d 2c20 4e6f  content = [], No
-00029b50: 6e65 0a20 2020 2020 2020 2066 6f72 206e  ne.        for n
-00029b60: 6f74 6966 796d 6574 686f 6420 696e 2073  otifymethod in s
-00029b70: 6f72 7465 6428 6e6f 7469 6679 6d65 7468  orted(notifymeth
-00029b80: 6f64 732c 2072 6576 6572 7365 3d54 7275  ods, reverse=Tru
-00029b90: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00029ba0: 6966 206e 6f74 6966 796d 6574 686f 6420  if notifymethod 
-00029bb0: 3d3d 2027 7075 7368 6275 6c6c 6574 273a  == 'pushbullet':
-00029bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029bd0: 2069 6620 7075 7368 6275 6c6c 6574 746f   if pushbulletto
-00029be0: 6b65 6e20 6973 204e 6f6e 653a 0a20 2020  ken is None:.   
-00029bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029c00: 2077 6172 6e69 6e67 2866 224e 6f74 6966   warning(f"Notif
-00029c10: 6963 6174 696f 6e20 7265 7175 6972 6564  ication required
-00029c20: 2066 6f72 207b 6e61 6d65 7d20 6275 7420   for {name} but 
-00029c30: 6d69 7373 696e 6720 7075 7368 6275 6c6c  missing pushbull
-00029c40: 6574 746f 6b65 6e22 290a 2020 2020 2020  ettoken").      
-00029c50: 2020 2020 2020 2020 2020 656c 6966 206e            elif n
-00029c60: 6f74 6966 7973 6372 6970 7420 6973 204e  otifyscript is N
-00029c70: 6f6e 6520 616e 6420 6e6f 7469 6679 636d  one and notifycm
-00029c80: 6420 6973 204e 6f6e 653a 0a20 2020 2020  d is None:.     
-00029c90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00029ca0: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-00029cb0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00029cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029cd0: 2020 746f 6b65 6e20 3d20 7075 7368 6275    token = pushbu
-00029ce0: 6c6c 6574 746f 6b65 6e0a 2020 2020 2020  llettoken.      
-00029cf0: 2020 2020 2020 2020 2020 2020 2020 7062                pb
-00029d00: 636d 6420 3d20 2763 7572 6c20 2d73 7520  cmd = 'curl -su 
-00029d10: 2225 733a 2220 2d64 2074 7970 653d 226e  "%s:" -d type="n
-00029d20: 6f74 6522 202d 6420 626f 6479 3d22 6025  ote" -d body="`%
-00029d30: 7320 323e 2631 6022 202d 6420 7469 746c  s 2>&1`" -d titl
-00029d40: 653d 2225 7322 2027 2025 2028 746f 6b65  e="%s" ' % (toke
-00029d50: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+00023700: 2069 6620 636f 6e66 6967 2e74 7970 6520   if config.type 
+00023710: 3d3d 2027 6f70 656e 7374 6163 6b27 2061  == 'openstack' a
+00023720: 6e64 2069 6e66 6f2e 6765 7428 2770 7269  nd info.get('pri
+00023730: 7661 7465 6970 2729 203d 3d20 6970 2061  vateip') == ip a
+00023740: 6e64 206b 2e65 7874 6572 6e61 6c5f 6e65  nd k.external_ne
+00023750: 7477 6f72 6b20 6973 206e 6f74 204e 6f6e  twork is not Non
+00023760: 655c 0a20 2020 2020 2020 2020 2020 2020  e\.             
+00023770: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00023780: 6e64 2069 6e66 6f2e 6765 7428 276e 6574  nd info.get('net
+00023790: 7327 295b 305d 5b27 6e65 7427 5d20 213d  s')[0]['net'] !=
+000237a0: 206b 2e65 7874 6572 6e61 6c5f 6e65 7477   k.external_netw
+000237b0: 6f72 6b3a 0a20 2020 2020 2020 2020 2020  ork:.           
+000237c0: 2020 2020 2020 2020 2020 2020 2077 6172               war
+000237d0: 6e69 6e67 2822 5761 6974 696e 6720 666f  ning("Waiting fo
+000237e0: 7220 666c 6f61 7469 6e67 2069 7020 696e  r floating ip in
+000237f0: 7374 6561 6420 6f66 2061 2070 7269 7661  stead of a priva
+00023800: 7465 2069 702e 2e2e 2229 0a20 2020 2020  te ip...").     
+00023810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023820: 2020 2069 7020 3d20 4e6f 6e65 0a20 2020     ip = None.   
+00023830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023840: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00023850: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00023860: 6573 7463 6d64 203d 2063 6f6d 6d6f 6e2e  estcmd = common.
+00023870: 7373 6828 6e61 6d65 2c20 7573 6572 3d75  ssh(name, user=u
+00023880: 7365 722c 2069 703d 6970 2c20 7475 6e6e  ser, ip=ip, tunn
+00023890: 656c 3d63 6f6e 6669 672e 7475 6e6e 656c  el=config.tunnel
+000238a0: 2c20 7475 6e6e 656c 686f 7374 3d63 6f6e  , tunnelhost=con
+000238b0: 6669 672e 7475 6e6e 656c 686f 7374 2c0a  fig.tunnelhost,.
+000238c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000238d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000238e0: 2020 2020 2020 2020 2020 2020 2074 756e               tun
+000238f0: 6e65 6c70 6f72 743d 636f 6e66 6967 2e74  nelport=config.t
+00023900: 756e 6e65 6c70 6f72 742c 2074 756e 6e65  unnelport, tunne
+00023910: 6c75 7365 723d 636f 6e66 6967 2e74 756e  luser=config.tun
+00023920: 6e65 6c75 7365 722c 0a20 2020 2020 2020  neluser,.       
+00023930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023950: 2020 2020 2020 696e 7365 6375 7265 3d63        insecure=c
+00023960: 6f6e 6669 672e 696e 7365 6375 7265 2c20  onfig.insecure, 
+00023970: 636d 643d 2769 6420 2d75 6e27 2c20 766d  cmd='id -un', vm
+00023980: 706f 7274 3d76 6d70 6f72 742c 0a20 2020  port=vmport,.   
+00023990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000239a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000239b0: 2020 2020 2020 2020 2020 6964 656e 7469            identi
+000239c0: 7479 6669 6c65 3d69 6465 6e74 6974 7966  tyfile=identityf
+000239d0: 696c 652c 2070 6173 7377 6f72 643d 4661  ile, password=Fa
+000239e0: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
+000239f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00023a00: 6f73 2e70 6f70 656e 2874 6573 7463 6d64  os.popen(testcmd
+00023a10: 292e 7265 6164 2829 2e73 7472 6970 2829  ).read().strip()
+00023a20: 2021 3d20 7573 6572 3a0a 2020 2020 2020   != user:.      
+00023a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023a40: 2020 2020 2020 7761 726e 696e 6728 2247        warning("G
+00023a50: 6174 6865 7265 6420 6970 206e 6f74 2066  athered ip not f
+00023a60: 756e 6374 696f 6e61 6c20 7965 742e 2e2e  unctional yet...
+00023a70: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00023a80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00023a90: 7020 3d20 4e6f 6e65 0a20 2020 2020 2020  p = None.       
+00023aa0: 2020 2020 2070 7072 696e 7428 2257 6169       pprint("Wai
+00023ab0: 7469 6e67 2066 6f72 2076 6d20 746f 2062  ting for vm to b
+00023ac0: 6520 6163 6365 7373 6962 6c65 2e2e 2e22  e accessible..."
+00023ad0: 290a 2020 2020 2020 2020 2020 2020 736c  ).            sl
+00023ae0: 6565 7028 3529 0a20 2020 2020 2020 2020  eep(5).         
+00023af0: 2020 2074 696d 656f 7574 202b 3d20 350a     timeout += 5.
+00023b00: 2020 2020 2020 2020 2020 2020 6966 2077              if w
+00023b10: 6169 7474 696d 656f 7574 203e 2030 2061  aittimeout > 0 a
+00023b20: 6e64 2074 696d 656f 7574 203e 2077 6169  nd timeout > wai
+00023b30: 7474 696d 656f 7574 3a0a 2020 2020 2020  ttimeout:.      
+00023b40: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+00023b50: 2254 696d 656f 7574 2077 6169 7469 6e67  "Timeout waiting
+00023b60: 2066 6f72 2076 6d20 746f 2062 6520 6163   for vm to be ac
+00023b70: 6365 7373 6962 6c65 2e2e 2e22 290a 2020  cessible...").  
+00023b80: 2020 2020 2020 2020 2020 2020 2020 6272                br
+00023b90: 6561 6b0a 2020 2020 2020 2020 736c 6565  eak.        slee
+00023ba0: 7028 3529 0a20 2020 2020 2020 206f 6c64  p(5).        old
+00023bb0: 6f75 7470 7574 203d 2027 270a 2020 2020  output = ''.    
+00023bc0: 2020 2020 7469 6d65 6f75 7420 3d20 300a      timeout = 0.
+00023bd0: 2020 2020 2020 2020 7768 696c 6520 5472          while Tr
+00023be0: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
+00023bf0: 7373 6863 6d64 203d 2063 6f6d 6d6f 6e2e  sshcmd = common.
+00023c00: 7373 6828 6e61 6d65 2c20 7573 6572 3d27  ssh(name, user='
+00023c10: 726f 6f74 272c 2069 703d 6970 2c20 7475  root', ip=ip, tu
+00023c20: 6e6e 656c 3d63 6f6e 6669 672e 7475 6e6e  nnel=config.tunn
+00023c30: 656c 2c20 7475 6e6e 656c 686f 7374 3d63  el, tunnelhost=c
+00023c40: 6f6e 6669 672e 7475 6e6e 656c 686f 7374  onfig.tunnelhost
+00023c50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00023c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023c70: 2020 766d 706f 7274 3d76 6d70 6f72 742c    vmport=vmport,
+00023c80: 2074 756e 6e65 6c70 6f72 743d 636f 6e66   tunnelport=conf
+00023c90: 6967 2e74 756e 6e65 6c70 6f72 742c 2074  ig.tunnelport, t
+00023ca0: 756e 6e65 6c75 7365 723d 636f 6e66 6967  unneluser=config
+00023cb0: 2e74 756e 6e65 6c75 7365 722c 0a20 2020  .tunneluser,.   
+00023cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023cd0: 2020 2020 2020 2020 2020 2020 2069 6e73               ins
+00023ce0: 6563 7572 653d 636f 6e66 6967 2e69 6e73  ecure=config.ins
+00023cf0: 6563 7572 652c 2063 6d64 3d63 6d64 2c20  ecure, cmd=cmd, 
+00023d00: 6964 656e 7469 7479 6669 6c65 3d69 6465  identityfile=ide
+00023d10: 6e74 6974 7966 696c 652c 2070 6173 7377  ntityfile, passw
+00023d20: 6f72 643d 4661 6c73 6529 0a20 2020 2020  ord=False).     
+00023d30: 2020 2020 2020 206f 7574 7075 7420 3d20         output = 
+00023d40: 6f73 2e70 6f70 656e 2873 7368 636d 6429  os.popen(sshcmd)
+00023d50: 2e72 6561 6428 290a 2020 2020 2020 2020  .read().        
+00023d60: 2020 2020 6966 2077 6169 7463 6f6d 6d61      if waitcomma
+00023d70: 6e64 2069 7320 6e6f 7420 4e6f 6e65 3a0a  nd is not None:.
+00023d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023d90: 6966 206f 7574 7075 7420 213d 2027 273a  if output != '':
+00023da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023db0: 2020 2020 2070 7269 6e74 286f 7574 7075       print(outpu
+00023dc0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+00023dd0: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+00023de0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00023df0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00023e00: 2020 2020 2020 2070 7072 696e 7428 2257         pprint("W
+00023e10: 6169 7469 6e67 2066 6f72 2077 6169 7463  aiting for waitc
+00023e20: 6f6d 6d61 6e64 2074 6f20 7375 6363 6565  ommand to succee
+00023e30: 642e 2e2e 2229 0a20 2020 2020 2020 2020  d...").         
+00023e40: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00023e50: 2020 2020 2020 2020 2069 6620 276b 636c           if 'kcl
+00023e60: 6920 626f 6f74 2066 696e 6973 6865 6427  i boot finished'
+00023e70: 2069 6e20 6f75 7470 7574 206f 7220 2749   in output or 'I
+00023e80: 676e 6974 696f 6e20 6669 6e69 7368 6564  gnition finished
+00023e90: 2073 7563 6365 7373 6675 6c6c 7927 2069   successfully' i
+00023ea0: 6e20 6f75 7470 7574 206f 725c 0a20 2020  n output or\.   
+00023eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ec0: 2746 696e 6973 6865 6420 436f 6d62 7573  'Finished Combus
+00023ed0: 7469 6f6e 2720 696e 206f 7574 7075 743a  tion' in output:
+00023ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023ef0: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
+00023f00: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
+00023f10: 7420 3d20 6f75 7470 7574 2e72 6570 6c61  t = output.repla
+00023f20: 6365 286f 6c64 6f75 7470 7574 2c20 2727  ce(oldoutput, ''
+00023f30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00023f40: 2020 6966 206e 6f74 2071 7569 6574 3a0a    if not quiet:.
+00023f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f60: 2020 2020 7072 696e 7428 6f75 7470 7574      print(output
+00023f70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00023f80: 2020 6f6c 646f 7574 7075 7420 3d20 6f75    oldoutput = ou
+00023f90: 7470 7574 0a20 2020 2020 2020 2020 2020  tput.           
+00023fa0: 2073 6c65 6570 2832 290a 2020 2020 2020   sleep(2).      
+00023fb0: 2020 2020 2020 7469 6d65 6f75 7420 2b3d        timeout +=
+00023fc0: 2032 0a20 2020 2020 2020 2020 2020 2069   2.            i
+00023fd0: 6620 7761 6974 7469 6d65 6f75 7420 3e20  f waittimeout > 
+00023fe0: 3020 616e 6420 7469 6d65 6f75 7420 3e20  0 and timeout > 
+00023ff0: 7761 6974 7469 6d65 6f75 743a 0a20 2020  waittimeout:.   
+00024000: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00024010: 6f72 2822 5469 6d65 6f75 7420 7761 6974  or("Timeout wait
+00024020: 696e 6720 666f 7220 7761 6974 636f 6d6d  ing for waitcomm
+00024030: 616e 6420 746f 2065 7865 6375 7465 2e2e  and to execute..
+00024040: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00024050: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
+00024060: 2020 7265 7475 726e 2054 7275 650a 0a20    return True.. 
+00024070: 2020 2064 6566 2063 6c65 616e 5f74 656d     def clean_tem
+00024080: 706b 6579 2873 656c 662c 206e 616d 652c  pkey(self, name,
+00024090: 2069 6465 6e74 6974 7966 696c 653d 4e6f   identityfile=No
+000240a0: 6e65 293a 0a20 2020 2020 2020 2063 6d64  ne):.        cmd
+000240b0: 203d 2022 7365 6420 2d69 2027 2f74 656d   = "sed -i '/tem
+000240c0: 702d 6b63 6c69 2d6b 6579 2f64 2720 2f68  p-kcli-key/d' /h
+000240d0: 6f6d 652f 2a2f 2e73 7368 2f61 7574 686f  ome/*/.ssh/autho
+000240e0: 7269 7a65 645f 6b65 7973 202f 726f 6f74  rized_keys /root
+000240f0: 2f2e 7373 682f 6175 7468 6f72 697a 6564  /.ssh/authorized
+00024100: 5f6b 6579 7322 0a20 2020 2020 2020 206b  _keys".        k
+00024110: 203d 2073 656c 662e 6b0a 2020 2020 2020   = self.k.      
+00024120: 2020 696e 666f 203d 206b 2e69 6e66 6f28    info = k.info(
+00024130: 6e61 6d65 290a 2020 2020 2020 2020 766d  name).        vm
+00024140: 706f 7274 203d 204e 6f6e 650a 2020 2020  port = None.    
+00024150: 2020 2020 6970 203d 2069 6e66 6f2e 6765      ip = info.ge
+00024160: 7428 2769 7027 290a 2020 2020 2020 2020  t('ip').        
+00024170: 6966 2073 656c 662e 7479 7065 203d 3d20  if self.type == 
+00024180: 276b 7562 6576 6972 7427 3a0a 2020 2020  'kubevirt':.    
+00024190: 2020 2020 2020 2020 6966 206b 2e61 6363          if k.acc
+000241a0: 6573 735f 6d6f 6465 203d 3d20 274e 6f64  ess_mode == 'Nod
+000241b0: 6550 6f72 7427 3a0a 2020 2020 2020 2020  ePort':.        
+000241c0: 2020 2020 2020 2020 766d 706f 7274 203d          vmport =
+000241d0: 2069 6e66 6f2e 6765 7428 276e 6f64 6570   info.get('nodep
+000241e0: 6f72 7427 290a 2020 2020 2020 2020 2020  ort').          
+000241f0: 2020 2020 2020 6970 203d 206b 2e6e 6f64        ip = k.nod
+00024200: 655f 686f 7374 286e 616d 653d 696e 666f  e_host(name=info
+00024210: 2e67 6574 2827 686f 7374 2729 290a 2020  .get('host')).  
+00024220: 2020 2020 2020 2020 2020 656c 6966 206b            elif k
+00024230: 2e61 6363 6573 735f 6d6f 6465 203d 3d20  .access_mode == 
+00024240: 274c 6f61 6442 616c 616e 6365 7227 3a0a  'LoadBalancer':.
+00024250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024260: 6970 203d 2069 6e66 6f2e 6765 7428 276c  ip = info.get('l
+00024270: 6f61 6462 616c 616e 6365 7269 7027 290a  oadbalancerip').
+00024280: 2020 2020 2020 2020 7373 6863 6d64 203d          sshcmd =
+00024290: 2063 6f6d 6d6f 6e2e 7373 6828 6e61 6d65   common.ssh(name
+000242a0: 2c20 7573 6572 3d27 726f 6f74 272c 2069  , user='root', i
+000242b0: 703d 6970 2c20 7475 6e6e 656c 3d73 656c  p=ip, tunnel=sel
+000242c0: 662e 7475 6e6e 656c 2c20 7475 6e6e 656c  f.tunnel, tunnel
+000242d0: 686f 7374 3d73 656c 662e 7475 6e6e 656c  host=self.tunnel
+000242e0: 686f 7374 2c20 766d 706f 7274 3d76 6d70  host, vmport=vmp
+000242f0: 6f72 742c 0a20 2020 2020 2020 2020 2020  ort,.           
+00024300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024310: 2074 756e 6e65 6c70 6f72 743d 7365 6c66   tunnelport=self
+00024320: 2e74 756e 6e65 6c70 6f72 742c 2074 756e  .tunnelport, tun
+00024330: 6e65 6c75 7365 723d 7365 6c66 2e74 756e  neluser=self.tun
+00024340: 6e65 6c75 7365 722c 2069 6e73 6563 7572  neluser, insecur
+00024350: 653d 7365 6c66 2e69 6e73 6563 7572 652c  e=self.insecure,
+00024360: 2063 6d64 3d63 6d64 2c0a 2020 2020 2020   cmd=cmd,.      
+00024370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024380: 2020 2020 2020 6964 656e 7469 7479 6669        identityfi
+00024390: 6c65 3d69 6465 6e74 6974 7966 696c 652c  le=identityfile,
+000243a0: 2070 6173 7377 6f72 643d 4661 6c73 6529   password=False)
+000243b0: 0a20 2020 2020 2020 206f 732e 706f 7065  .        os.pope
+000243c0: 6e28 7373 6863 6d64 292e 7265 6164 2829  n(sshcmd).read()
+000243d0: 0a0a 2020 2020 6465 6620 7468 7265 6164  ..    def thread
+000243e0: 6564 5f63 7265 6174 655f 6b75 6265 2873  ed_create_kube(s
+000243f0: 656c 662c 2063 6c75 7374 6572 2c20 6b75  elf, cluster, ku
+00024400: 6265 7479 7065 2c20 6b75 6265 5f6f 7665  betype, kube_ove
+00024410: 7272 6964 6573 293a 0a20 2020 2020 2020  rrides):.       
+00024420: 2069 7070 6f6f 6c20 3d20 6b75 6265 5f6f   ippool = kube_o
+00024430: 7665 7272 6964 6573 2e67 6574 2827 6970  verrides.get('ip
+00024440: 706f 6f6c 2729 206f 7220 6b75 6265 5f6f  pool') or kube_o
+00024450: 7665 7272 6964 6573 2e67 6574 2827 636f  verrides.get('co
+00024460: 6e66 706f 6f6c 2729 0a20 2020 2020 2020  nfpool').       
+00024470: 2062 6172 656d 6574 616c 706f 6f6c 203d   baremetalpool =
+00024480: 206b 7562 655f 6f76 6572 7269 6465 732e   kube_overrides.
+00024490: 6765 7428 2769 7070 6f6f 6c27 2920 6f72  get('ippool') or
+000244a0: 206b 7562 655f 6f76 6572 7269 6465 732e   kube_overrides.
+000244b0: 6765 7428 2763 6f6e 6670 6f6f 6c27 290a  get('confpool').
+000244c0: 2020 2020 2020 2020 6966 2069 7070 6f6f          if ippoo
+000244d0: 6c20 6973 206e 6f74 204e 6f6e 653a 0a20  l is not None:. 
+000244e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000244f0: 6765 745f 7669 705f 6672 6f6d 5f63 6f6e  get_vip_from_con
+00024500: 6670 6f6f 6c28 636c 7573 7465 722c 2069  fpool(cluster, i
+00024510: 7070 6f6f 6c2c 206f 7665 7272 6964 6573  ppool, overrides
+00024520: 3d6b 7562 655f 6f76 6572 7269 6465 7329  =kube_overrides)
+00024530: 0a20 2020 2020 2020 2069 6620 6261 7265  .        if bare
+00024540: 6d65 7461 6c70 6f6f 6c20 6973 206e 6f74  metalpool is not
+00024550: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00024560: 2020 2073 656c 662e 6765 745f 6261 7265     self.get_bare
+00024570: 6d65 7461 6c5f 686f 7374 735f 6672 6f6d  metal_hosts_from
+00024580: 5f63 6f6e 6670 6f6f 6c28 636c 7573 7465  _confpool(cluste
+00024590: 722c 2062 6172 656d 6574 616c 706f 6f6c  r, baremetalpool
+000245a0: 2c20 6f76 6572 7269 6465 733d 6b75 6265  , overrides=kube
+000245b0: 5f6f 7665 7272 6964 6573 290a 2020 2020  _overrides).    
+000245c0: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
+000245d0: 6b75 6265 2863 6c75 7374 6572 2c20 6b75  kube(cluster, ku
+000245e0: 6265 7479 7065 2c20 6b75 6265 5f6f 7665  betype, kube_ove
+000245f0: 7272 6964 6573 290a 0a20 2020 2064 6566  rrides)..    def
+00024600: 2063 7265 6174 655f 6b75 6265 2873 656c   create_kube(sel
+00024610: 662c 2063 6c75 7374 6572 2c20 6b75 6265  f, cluster, kube
+00024620: 7479 7065 2c20 6f76 6572 7269 6465 733d  type, overrides=
+00024630: 7b7d 293a 0a20 2020 2020 2020 2069 6620  {}):.        if 
+00024640: 7365 6c66 2e74 7970 6520 3d3d 2027 7765  self.type == 'we
+00024650: 6227 2061 6e64 2073 656c 662e 6b2e 6c6f  b' and self.k.lo
+00024660: 6361 6c6b 7562 653a 0a20 2020 2020 2020  calkube:.       
+00024670: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00024680: 2e6b 2e63 7265 6174 655f 6b75 6265 2863  .k.create_kube(c
+00024690: 6c75 7374 6572 2c20 6b75 6265 7479 7065  luster, kubetype
+000246a0: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
+000246b0: 7269 6465 7329 0a20 2020 2020 2020 2069  rides).        i
+000246c0: 7070 6f6f 6c20 3d20 6f76 6572 7269 6465  ppool = override
+000246d0: 732e 6765 7428 2769 7070 6f6f 6c27 2920  s.get('ippool') 
+000246e0: 6f72 206f 7665 7272 6964 6573 2e67 6574  or overrides.get
+000246f0: 2827 636f 6e66 706f 6f6c 2729 0a20 2020  ('confpool').   
+00024700: 2020 2020 2062 6172 656d 6574 616c 706f       baremetalpo
+00024710: 6f6c 203d 206f 7665 7272 6964 6573 2e67  ol = overrides.g
+00024720: 6574 2827 6970 706f 6f6c 2729 206f 7220  et('ippool') or 
+00024730: 6f76 6572 7269 6465 732e 6765 7428 2763  overrides.get('c
+00024740: 6f6e 6670 6f6f 6c27 290a 2020 2020 2020  onfpool').      
+00024750: 2020 6966 2069 7070 6f6f 6c20 6973 206e    if ippool is n
+00024760: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00024770: 2020 2020 2073 656c 662e 6765 745f 7669       self.get_vi
+00024780: 705f 6672 6f6d 5f63 6f6e 6670 6f6f 6c28  p_from_confpool(
+00024790: 636c 7573 7465 722c 2069 7070 6f6f 6c2c  cluster, ippool,
+000247a0: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
+000247b0: 6964 6573 290a 2020 2020 2020 2020 6966  ides).        if
+000247c0: 2062 6172 656d 6574 616c 706f 6f6c 2069   baremetalpool i
+000247d0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+000247e0: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
+000247f0: 5f62 6172 656d 6574 616c 5f68 6f73 7473  _baremetal_hosts
+00024800: 5f66 726f 6d5f 636f 6e66 706f 6f6c 2863  _from_confpool(c
+00024810: 6c75 7374 6572 2c20 6261 7265 6d65 7461  luster, baremeta
+00024820: 6c70 6f6f 6c2c 206f 7665 7272 6964 6573  lpool, overrides
+00024830: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
+00024840: 2020 2020 6966 206b 7562 6574 7970 6520      if kubetype 
+00024850: 3d3d 2027 6f70 656e 7368 6966 7427 3a0a  == 'openshift':.
+00024860: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00024870: 6c74 203d 2073 656c 662e 6372 6561 7465  lt = self.create
+00024880: 5f6b 7562 655f 6f70 656e 7368 6966 7428  _kube_openshift(
+00024890: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
+000248a0: 6573 3d6f 7665 7272 6964 6573 290a 2020  es=overrides).  
+000248b0: 2020 2020 2020 656c 6966 206b 7562 6574        elif kubet
+000248c0: 7970 6520 3d3d 2027 6879 7065 7273 6869  ype == 'hypershi
+000248d0: 6674 273a 0a20 2020 2020 2020 2020 2020  ft':.           
+000248e0: 2072 6573 756c 7420 3d20 7365 6c66 2e63   result = self.c
+000248f0: 7265 6174 655f 6b75 6265 5f68 7970 6572  reate_kube_hyper
+00024900: 7368 6966 7428 636c 7573 7465 722c 206f  shift(cluster, o
+00024910: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
+00024920: 6573 290a 2020 2020 2020 2020 656c 6966  es).        elif
+00024930: 206b 7562 6574 7970 6520 3d3d 2027 6d69   kubetype == 'mi
+00024940: 6372 6f73 6869 6674 273a 0a20 2020 2020  croshift':.     
+00024950: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00024960: 7365 6c66 2e63 7265 6174 655f 6b75 6265  self.create_kube
+00024970: 5f6d 6963 726f 7368 6966 7428 636c 7573  _microshift(clus
+00024980: 7465 722c 206f 7665 7272 6964 6573 3d6f  ter, overrides=o
+00024990: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
+000249a0: 2020 656c 6966 206b 7562 6574 7970 6520    elif kubetype 
+000249b0: 3d3d 2027 6b33 7327 3a0a 2020 2020 2020  == 'k3s':.      
+000249c0: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
+000249d0: 656c 662e 6372 6561 7465 5f6b 7562 655f  elf.create_kube_
+000249e0: 6b33 7328 636c 7573 7465 722c 206f 7665  k3s(cluster, ove
+000249f0: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
+00024a00: 290a 2020 2020 2020 2020 656c 6966 206b  ).        elif k
+00024a10: 7562 6574 7970 6520 3d3d 2027 676b 6527  ubetype == 'gke'
+00024a20: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00024a30: 7375 6c74 203d 2073 656c 662e 6372 6561  sult = self.crea
+00024a40: 7465 5f6b 7562 655f 676b 6528 636c 7573  te_kube_gke(clus
+00024a50: 7465 722c 206f 7665 7272 6964 6573 3d6f  ter, overrides=o
+00024a60: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
+00024a70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00024a80: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
+00024a90: 662e 6372 6561 7465 5f6b 7562 655f 6765  f.create_kube_ge
+00024aa0: 6e65 7269 6328 636c 7573 7465 722c 206f  neric(cluster, o
+00024ab0: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
+00024ac0: 6573 290a 2020 2020 2020 2020 7265 7475  es).        retu
+00024ad0: 726e 2072 6573 756c 740a 0a20 2020 2064  rn result..    d
+00024ae0: 6566 2063 7265 6174 655f 6b75 6265 5f67  ef create_kube_g
+00024af0: 656e 6572 6963 2873 656c 662c 2063 6c75  eneric(self, clu
+00024b00: 7374 6572 2c20 6f76 6572 7269 6465 733d  ster, overrides=
+00024b10: 7b7d 293a 0a20 2020 2020 2020 2069 6620  {}):.        if 
+00024b20: 636f 6e74 6169 6e65 725f 6d6f 6465 2829  container_mode()
+00024b30: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
+00024b40: 2e65 6e76 6972 6f6e 5b27 5041 5448 275d  .environ['PATH']
+00024b50: 202b 3d20 273a 2f77 6f72 6b64 6972 270a   += ':/workdir'.
+00024b60: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00024b70: 2020 2020 2020 2020 2020 6f73 2e65 6e76            os.env
+00024b80: 6972 6f6e 5b27 5041 5448 275d 202b 3d20  iron['PATH'] += 
+00024b90: 273a 2573 2720 2520 6f73 2e67 6574 6377  ':%s' % os.getcw
+00024ba0: 6428 290a 2020 2020 2020 2020 706c 616e  d().        plan
+00024bb0: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
+00024bc0: 726e 616d 6528 6b75 6265 6164 6d2e 6372  rname(kubeadm.cr
+00024bd0: 6561 7465 2e5f 5f63 6f64 655f 5f2e 636f  eate.__code__.co
+00024be0: 5f66 696c 656e 616d 6529 0a20 2020 2020  _filename).     
+00024bf0: 2020 2072 6574 7572 6e20 6b75 6265 6164     return kubead
+00024c00: 6d2e 6372 6561 7465 2873 656c 662c 2070  m.create(self, p
+00024c10: 6c61 6e64 6972 2c20 636c 7573 7465 722c  landir, cluster,
+00024c20: 206f 7665 7272 6964 6573 290a 0a20 2020   overrides)..   
+00024c30: 2064 6566 2063 7265 6174 655f 6b75 6265   def create_kube
+00024c40: 5f67 6b65 2873 656c 662c 2063 6c75 7374  _gke(self, clust
+00024c50: 6572 2c20 6f76 6572 7269 6465 733d 7b7d  er, overrides={}
+00024c60: 293a 0a20 2020 2020 2020 2066 726f 6d20  ):.        from 
+00024c70: 6b76 6972 742e 636c 7573 7465 7220 696d  kvirt.cluster im
+00024c80: 706f 7274 2067 6b65 0a20 2020 2020 2020  port gke.       
+00024c90: 2069 6620 636f 6e74 6169 6e65 725f 6d6f   if container_mo
+00024ca0: 6465 2829 3a0a 2020 2020 2020 2020 2020  de():.          
+00024cb0: 2020 6f73 2e65 6e76 6972 6f6e 5b27 5041    os.environ['PA
+00024cc0: 5448 275d 202b 3d20 273a 2f77 6f72 6b64  TH'] += ':/workd
+00024cd0: 6972 270a 2020 2020 2020 2020 656c 7365  ir'.        else
+00024ce0: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
+00024cf0: 2e65 6e76 6972 6f6e 5b27 5041 5448 275d  .environ['PATH']
+00024d00: 202b 3d20 273a 2573 2720 2520 6f73 2e67   += ':%s' % os.g
+00024d10: 6574 6377 6428 290a 2020 2020 2020 2020  etcwd().        
+00024d20: 7265 7475 726e 2067 6b65 2e63 7265 6174  return gke.creat
+00024d30: 6528 7365 6c66 2c20 636c 7573 7465 722c  e(self, cluster,
+00024d40: 206f 7665 7272 6964 6573 290a 0a20 2020   overrides)..   
+00024d50: 2064 6566 2063 7265 6174 655f 6b75 6265   def create_kube
+00024d60: 5f6d 6963 726f 7368 6966 7428 7365 6c66  _microshift(self
+00024d70: 2c20 636c 7573 7465 722c 206f 7665 7272  , cluster, overr
+00024d80: 6964 6573 3d7b 7d29 3a0a 2020 2020 2020  ides={}):.      
+00024d90: 2020 6966 2063 6f6e 7461 696e 6572 5f6d    if container_m
+00024da0: 6f64 6528 293a 0a20 2020 2020 2020 2020  ode():.         
+00024db0: 2020 206f 732e 656e 7669 726f 6e5b 2750     os.environ['P
+00024dc0: 4154 4827 5d20 2b3d 2027 3a2f 776f 726b  ATH'] += ':/work
+00024dd0: 6469 7227 0a20 2020 2020 2020 2065 6c73  dir'.        els
+00024de0: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
+00024df0: 732e 656e 7669 726f 6e5b 2750 4154 4827  s.environ['PATH'
+00024e00: 5d20 2b3d 2027 3a25 7327 2025 206f 732e  ] += ':%s' % os.
+00024e10: 6765 7463 7764 2829 0a20 2020 2020 2020  getcwd().       
+00024e20: 2070 6c61 6e64 6972 203d 206f 732e 7061   plandir = os.pa
+00024e30: 7468 2e64 6972 6e61 6d65 286d 6963 726f  th.dirname(micro
+00024e40: 7368 6966 742e 6372 6561 7465 2e5f 5f63  shift.create.__c
+00024e50: 6f64 655f 5f2e 636f 5f66 696c 656e 616d  ode__.co_filenam
+00024e60: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
+00024e70: 6e20 6d69 6372 6f73 6869 6674 2e63 7265  n microshift.cre
+00024e80: 6174 6528 7365 6c66 2c20 706c 616e 6469  ate(self, plandi
+00024e90: 722c 2063 6c75 7374 6572 2c20 6f76 6572  r, cluster, over
+00024ea0: 7269 6465 7329 0a0a 2020 2020 6465 6620  rides)..    def 
+00024eb0: 6372 6561 7465 5f6b 7562 655f 6b33 7328  create_kube_k3s(
+00024ec0: 7365 6c66 2c20 636c 7573 7465 722c 206f  self, cluster, o
+00024ed0: 7665 7272 6964 6573 3d7b 7d29 3a0a 2020  verrides={}):.  
+00024ee0: 2020 2020 2020 6966 2063 6f6e 7461 696e        if contain
+00024ef0: 6572 5f6d 6f64 6528 293a 0a20 2020 2020  er_mode():.     
+00024f00: 2020 2020 2020 206f 732e 656e 7669 726f         os.enviro
+00024f10: 6e5b 2750 4154 4827 5d20 2b3d 2027 3a2f  n['PATH'] += ':/
+00024f20: 776f 726b 6469 7227 0a20 2020 2020 2020  workdir'.       
+00024f30: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00024f40: 2020 206f 732e 656e 7669 726f 6e5b 2750     os.environ['P
+00024f50: 4154 4827 5d20 2b3d 2027 3a25 7327 2025  ATH'] += ':%s' %
+00024f60: 206f 732e 6765 7463 7764 2829 0a20 2020   os.getcwd().   
+00024f70: 2020 2020 2070 6c61 6e64 6972 203d 206f       plandir = o
+00024f80: 732e 7061 7468 2e64 6972 6e61 6d65 286b  s.path.dirname(k
+00024f90: 3373 2e63 7265 6174 652e 5f5f 636f 6465  3s.create.__code
+00024fa0: 5f5f 2e63 6f5f 6669 6c65 6e61 6d65 290a  __.co_filename).
+00024fb0: 2020 2020 2020 2020 7265 7475 726e 206b          return k
+00024fc0: 3373 2e63 7265 6174 6528 7365 6c66 2c20  3s.create(self, 
+00024fd0: 706c 616e 6469 722c 2063 6c75 7374 6572  plandir, cluster
+00024fe0: 2c20 6f76 6572 7269 6465 7329 0a0a 2020  , overrides)..  
+00024ff0: 2020 6465 6620 6372 6561 7465 5f6b 7562    def create_kub
+00025000: 655f 6879 7065 7273 6869 6674 2873 656c  e_hypershift(sel
+00025010: 662c 2063 6c75 7374 6572 2c20 6f76 6572  f, cluster, over
+00025020: 7269 6465 733d 7b7d 293a 0a20 2020 2020  rides={}):.     
+00025030: 2020 2069 6620 636f 6e74 6169 6e65 725f     if container_
+00025040: 6d6f 6465 2829 3a0a 2020 2020 2020 2020  mode():.        
+00025050: 2020 2020 6f73 2e65 6e76 6972 6f6e 5b27      os.environ['
+00025060: 5041 5448 275d 202b 3d20 273a 2f77 6f72  PATH'] += ':/wor
+00025070: 6b64 6972 270a 2020 2020 2020 2020 656c  kdir'.        el
+00025080: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00025090: 6f73 2e65 6e76 6972 6f6e 5b27 5041 5448  os.environ['PATH
+000250a0: 275d 202b 3d20 273a 2573 2720 2520 6f73  '] += ':%s' % os
+000250b0: 2e67 6574 6377 6428 290a 2020 2020 2020  .getcwd().      
+000250c0: 2020 706c 616e 6469 7220 3d20 6f73 2e70    plandir = os.p
+000250d0: 6174 682e 6469 726e 616d 6528 6879 7065  ath.dirname(hype
+000250e0: 7273 6869 6674 2e63 7265 6174 652e 5f5f  rshift.create.__
+000250f0: 636f 6465 5f5f 2e63 6f5f 6669 6c65 6e61  code__.co_filena
+00025100: 6d65 290a 2020 2020 2020 2020 2320 646e  me).        # dn
+00025110: 7363 6c69 656e 7420 3d20 6f76 6572 7269  sclient = overri
+00025120: 6465 732e 6765 7428 2764 6e73 636c 6965  des.get('dnsclie
+00025130: 6e74 2729 0a20 2020 2020 2020 2023 2064  nt').        # d
+00025140: 6e73 636f 6e66 6967 203d 204b 636f 6e66  nsconfig = Kconf
+00025150: 6967 2863 6c69 656e 743d 646e 7363 6c69  ig(client=dnscli
+00025160: 656e 7429 2069 6620 646e 7363 6c69 656e  ent) if dnsclien
+00025170: 7420 6973 206e 6f74 204e 6f6e 6520 656c  t is not None el
+00025180: 7365 204e 6f6e 650a 2020 2020 2020 2020  se None.        
+00025190: 7265 7475 726e 2068 7970 6572 7368 6966  return hypershif
+000251a0: 742e 6372 6561 7465 2873 656c 662c 2070  t.create(self, p
+000251b0: 6c61 6e64 6972 2c20 636c 7573 7465 722c  landir, cluster,
+000251c0: 206f 7665 7272 6964 6573 290a 0a20 2020   overrides)..   
+000251d0: 2064 6566 2063 7265 6174 655f 6b75 6265   def create_kube
+000251e0: 5f6f 7065 6e73 6869 6674 2873 656c 662c  _openshift(self,
+000251f0: 2063 6c75 7374 6572 2c20 6f76 6572 7269   cluster, overri
+00025200: 6465 733d 7b7d 293a 0a20 2020 2020 2020  des={}):.       
+00025210: 2069 6620 636f 6e74 6169 6e65 725f 6d6f   if container_mo
+00025220: 6465 2829 3a0a 2020 2020 2020 2020 2020  de():.          
+00025230: 2020 6f73 2e65 6e76 6972 6f6e 5b27 5041    os.environ['PA
+00025240: 5448 275d 202b 3d20 273a 2f77 6f72 6b64  TH'] += ':/workd
+00025250: 6972 270a 2020 2020 2020 2020 656c 7365  ir'.        else
+00025260: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
+00025270: 2e65 6e76 6972 6f6e 5b27 5041 5448 275d  .environ['PATH']
+00025280: 202b 3d20 273a 2573 2720 2520 6f73 2e67   += ':%s' % os.g
+00025290: 6574 6377 6428 290a 2020 2020 2020 2020  etcwd().        
+000252a0: 706c 616e 6469 7220 3d20 6f73 2e70 6174  plandir = os.pat
+000252b0: 682e 6469 726e 616d 6528 6f70 656e 7368  h.dirname(opensh
+000252c0: 6966 742e 6372 6561 7465 2e5f 5f63 6f64  ift.create.__cod
+000252d0: 655f 5f2e 636f 5f66 696c 656e 616d 6529  e__.co_filename)
+000252e0: 0a20 2020 2020 2020 2064 6e73 636c 6965  .        dnsclie
+000252f0: 6e74 203d 206f 7665 7272 6964 6573 2e67  nt = overrides.g
+00025300: 6574 2827 646e 7363 6c69 656e 7427 290a  et('dnsclient').
+00025310: 2020 2020 2020 2020 646e 7363 6f6e 6669          dnsconfi
+00025320: 6720 3d20 4b63 6f6e 6669 6728 636c 6965  g = Kconfig(clie
+00025330: 6e74 3d64 6e73 636c 6965 6e74 2920 6966  nt=dnsclient) if
+00025340: 2064 6e73 636c 6965 6e74 2069 7320 6e6f   dnsclient is no
+00025350: 7420 4e6f 6e65 2065 6c73 6520 4e6f 6e65  t None else None
+00025360: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00025370: 6f70 656e 7368 6966 742e 6372 6561 7465  openshift.create
+00025380: 2873 656c 662c 2070 6c61 6e64 6972 2c20  (self, plandir, 
+00025390: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
+000253a0: 6573 2c20 646e 7363 6f6e 6669 673d 646e  es, dnsconfig=dn
+000253b0: 7363 6f6e 6669 6729 0a0a 2020 2020 6465  sconfig)..    de
+000253c0: 6620 6465 6c65 7465 5f6b 7562 6528 7365  f delete_kube(se
+000253d0: 6c66 2c20 636c 7573 7465 722c 206f 7665  lf, cluster, ove
+000253e0: 7272 6964 6573 3d7b 7d29 3a0a 2020 2020  rrides={}):.    
+000253f0: 2020 2020 6879 7065 7273 6869 6674 203d      hypershift =
+00025400: 2046 616c 7365 0a20 2020 2020 2020 2061   False.        a
+00025410: 7373 6973 7465 6420 3d20 4661 6c73 650a  ssisted = False.
+00025420: 2020 2020 2020 2020 676b 6520 3d20 4661          gke = Fa
+00025430: 6c73 650a 2020 2020 2020 2020 646f 6d61  lse.        doma
+00025440: 696e 203d 206f 7665 7272 6964 6573 2e67  in = overrides.g
+00025450: 6574 2827 646f 6d61 696e 272c 2027 6b61  et('domain', 'ka
+00025460: 726d 616c 6162 732e 636f 7270 2729 0a20  rmalabs.corp'). 
+00025470: 2020 2020 2020 206b 7562 6574 7970 6520         kubetype 
+00025480: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+00025490: 276b 7562 6574 7970 6527 2c20 2767 656e  'kubetype', 'gen
+000254a0: 6572 6963 2729 0a20 2020 2020 2020 2064  eric').        d
+000254b0: 6e73 636c 6965 6e74 203d 204e 6f6e 650a  nsclient = None.
+000254c0: 2020 2020 2020 2020 6b20 3d20 7365 6c66          k = self
+000254d0: 2e6b 0a20 2020 2020 2020 2069 6620 7365  .k.        if se
+000254e0: 6c66 2e74 7970 6520 3d3d 2027 7765 6227  lf.type == 'web'
+000254f0: 2061 6e64 2073 656c 662e 6b2e 6c6f 6361   and self.k.loca
+00025500: 6c6b 7562 653a 0a20 2020 2020 2020 2020  lkube:.         
+00025510: 2020 2072 6574 7572 6e20 6b2e 6465 6c65     return k.dele
+00025520: 7465 5f6b 7562 6528 636c 7573 7465 722c  te_kube(cluster,
+00025530: 206b 7562 6574 7970 652c 206f 7665 7272   kubetype, overr
+00025540: 6964 6573 3d6f 7665 7272 6964 6573 290a  ides=overrides).
+00025550: 2020 2020 2020 2020 636c 7573 7465 7220          cluster 
+00025560: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+00025570: 2763 6c75 7374 6572 272c 2063 6c75 7374  'cluster', clust
+00025580: 6572 290a 2020 2020 2020 2020 6966 2063  er).        if c
+00025590: 6c75 7374 6572 2069 7320 4e6f 6e65 206f  luster is None o
+000255a0: 7220 636c 7573 7465 7220 3d3d 2027 273a  r cluster == '':
+000255b0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+000255c0: 6175 6c74 5f63 6c75 7374 6572 7320 3d20  ault_clusters = 
+000255d0: 7b27 6765 6e65 7269 6327 3a20 276d 796b  {'generic': 'myk
+000255e0: 7562 6527 2c20 2768 7970 6572 7368 6966  ube', 'hypershif
+000255f0: 7427 3a20 276d 7968 7970 6572 7368 6966  t': 'myhypershif
+00025600: 7427 2c20 276f 7065 6e73 6869 6674 273a  t', 'openshift':
+00025610: 2027 6d79 6f70 656e 7368 6966 7427 2c0a   'myopenshift',.
+00025620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025640: 276b 3373 273a 2027 6d79 6b33 7327 2c20  'k3s': 'myk3s', 
+00025650: 276d 6963 726f 7368 6966 7427 3a20 276d  'microshift': 'm
+00025660: 796d 6963 726f 7368 6966 7427 2c20 2767  ymicroshift', 'g
+00025670: 6b65 273a 2027 6d79 676b 6527 7d0a 2020  ke': 'mygke'}.  
+00025680: 2020 2020 2020 2020 2020 636c 7573 7465            cluste
+00025690: 7220 3d20 6465 6661 756c 745f 636c 7573  r = default_clus
+000256a0: 7465 7273 5b6b 7562 6574 7970 655d 0a20  ters[kubetype]. 
+000256b0: 2020 2020 2020 2063 6c75 7374 6572 6469         clusterdi
+000256c0: 7220 3d20 6f73 2e70 6174 682e 6578 7061  r = os.path.expa
+000256d0: 6e64 7573 6572 2866 227e 2f2e 6b63 6c69  nduser(f"~/.kcli
+000256e0: 2f63 6c75 7374 6572 732f 7b63 6c75 7374  /clusters/{clust
+000256f0: 6572 7d22 290a 2020 2020 2020 2020 6966  er}").        if
+00025700: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+00025710: 636c 7573 7465 7264 6972 293a 0a20 2020  clusterdir):.   
+00025720: 2020 2020 2020 2020 2070 6172 616d 6574           paramet
+00025730: 6572 7366 696c 6520 3d20 6622 7b63 6c75  ersfile = f"{clu
+00025740: 7374 6572 6469 727d 2f6b 636c 695f 7061  sterdir}/kcli_pa
+00025750: 7261 6d65 7465 7273 2e79 6d6c 220a 2020  rameters.yml".  
+00025760: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
+00025770: 7061 7468 2e65 7869 7374 7328 7061 7261  path.exists(para
+00025780: 6d65 7465 7273 6669 6c65 293a 0a20 2020  metersfile):.   
+00025790: 2020 2020 2020 2020 2020 2020 2077 6974               wit
+000257a0: 6820 6f70 656e 2870 6172 616d 6574 6572  h open(parameter
+000257b0: 7366 696c 6529 2061 7320 663a 0a20 2020  sfile) as f:.   
+000257c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000257d0: 2063 6c75 7374 6572 6461 7461 203d 2079   clusterdata = y
+000257e0: 616d 6c2e 7361 6665 5f6c 6f61 6428 6629  aml.safe_load(f)
+000257f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025800: 2020 2020 206b 7562 6574 7970 6520 3d20       kubetype = 
+00025810: 636c 7573 7465 7264 6174 612e 6765 7428  clusterdata.get(
+00025820: 276b 7562 6574 7970 6527 2c20 2767 656e  'kubetype', 'gen
+00025830: 6572 6963 2729 0a20 2020 2020 2020 2020  eric').         
+00025840: 2020 2020 2020 2020 2020 2069 6620 6b75             if ku
+00025850: 6265 7479 7065 203d 3d20 2768 7970 6572  betype == 'hyper
+00025860: 7368 6966 7427 3a0a 2020 2020 2020 2020  shift':.        
+00025870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025880: 6879 7065 7273 6869 6674 203d 2054 7275  hypershift = Tru
+00025890: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000258a0: 2020 2020 2020 2020 2020 6173 7369 7374            assist
+000258b0: 6564 203d 2063 6c75 7374 6572 6461 7461  ed = clusterdata
+000258c0: 2e67 6574 2827 6173 7369 7374 6564 272c  .get('assisted',
+000258d0: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
+000258e0: 2020 2020 2020 2020 2020 2020 646f 6d61              doma
+000258f0: 696e 203d 2063 6c75 7374 6572 6461 7461  in = clusterdata
+00025900: 2e67 6574 2827 646f 6d61 696e 272c 2064  .get('domain', d
+00025910: 6f6d 6169 6e29 0a20 2020 2020 2020 2020  omain).         
+00025920: 2020 2020 2020 2020 2020 2064 6e73 636c             dnscl
+00025930: 6965 6e74 203d 2063 6c75 7374 6572 6461  ient = clusterda
+00025940: 7461 2e67 6574 2827 646e 7363 6c69 656e  ta.get('dnsclien
+00025950: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
+00025960: 2020 2020 2020 2020 676b 6520 3d20 6b75          gke = ku
+00025970: 6265 7479 7065 203d 3d20 2767 6b65 270a  betype == 'gke'.
+00025980: 2020 2020 2020 2020 6465 6c65 7465 636c          deletecl
+00025990: 6965 6e74 7320 3d20 7b73 656c 662e 636c  ients = {self.cl
+000259a0: 6965 6e74 3a20 6b7d 0a20 2020 2020 2020  ient: k}.       
+000259b0: 2076 6d63 6c69 656e 7473 203d 205b 5d0a   vmclients = [].
+000259c0: 2020 2020 2020 2020 766d 636c 6965 6e74          vmclient
+000259d0: 735f 6669 6c65 203d 206f 732e 7061 7468  s_file = os.path
+000259e0: 2e65 7870 616e 6475 7365 7228 6627 7e2f  .expanduser(f'~/
+000259f0: 2e6b 636c 692f 766d 636c 6965 6e74 735f  .kcli/vmclients_
+00025a00: 7b63 6c75 7374 6572 7d27 290a 2020 2020  {cluster}').    
+00025a10: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+00025a20: 7869 7374 7328 766d 636c 6965 6e74 735f  xists(vmclients_
+00025a30: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
+00025a40: 2020 2076 6d63 6c69 656e 7473 203d 2079     vmclients = y
+00025a50: 616d 6c2e 7361 6665 5f6c 6f61 6428 6f70  aml.safe_load(op
+00025a60: 656e 2876 6d63 6c69 656e 7473 5f66 696c  en(vmclients_fil
+00025a70: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
+00025a80: 6f73 2e72 656d 6f76 6528 766d 636c 6965  os.remove(vmclie
+00025a90: 6e74 735f 6669 6c65 290a 2020 2020 2020  nts_file).      
+00025aa0: 2020 6966 2073 656c 662e 6578 7472 6163    if self.extrac
+00025ab0: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
+00025ac0: 2020 2020 6465 6c65 7465 636c 6965 6e74      deleteclient
+00025ad0: 732e 7570 6461 7465 2873 656c 662e 6578  s.update(self.ex
+00025ae0: 7472 6163 6c69 656e 7473 290a 2020 2020  traclients).    
+00025af0: 2020 2020 656c 6966 2076 6d63 6c69 656e      elif vmclien
+00025b00: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00025b10: 6465 6c65 7465 636c 6965 6e74 732e 7570  deleteclients.up
+00025b20: 6461 7465 287b 636c 693a 204b 636f 6e66  date({cli: Kconf
+00025b30: 6967 2863 6c69 656e 743d 636c 6929 2e6b  ig(client=cli).k
+00025b40: 2066 6f72 2063 6c69 2069 6e20 766d 636c   for cli in vmcl
+00025b50: 6965 6e74 7320 6966 2063 6c69 2021 3d20  ients if cli != 
+00025b60: 7365 6c66 2e63 6c69 656e 747d 290a 2020  self.client}).  
+00025b70: 2020 2020 2020 666f 7220 6879 7065 7276        for hyperv
+00025b80: 6973 6f72 2069 6e20 6465 6c65 7465 636c  isor in deletecl
+00025b90: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
+00025ba0: 2020 2063 203d 2064 656c 6574 6563 6c69     c = deletecli
+00025bb0: 656e 7473 5b68 7970 6572 7669 736f 725d  ents[hypervisor]
+00025bc0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00025bd0: 2076 6d20 696e 2073 6f72 7465 6428 632e   vm in sorted(c.
+00025be0: 6c69 7374 2829 2c20 6b65 793d 6c61 6d62  list(), key=lamb
+00025bf0: 6461 2078 3a20 785b 276e 616d 6527 5d29  da x: x['name'])
+00025c00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00025c10: 2020 6e61 6d65 203d 2076 6d5b 276e 616d    name = vm['nam
+00025c20: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
+00025c30: 2020 2020 646e 7363 6c69 656e 7420 3d20      dnsclient = 
+00025c40: 766d 2e67 6574 2827 646e 7363 6c69 656e  vm.get('dnsclien
+00025c50: 7427 2920 6f72 2064 6e73 636c 6965 6e74  t') or dnsclient
+00025c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025c70: 2063 7572 7265 6e74 636c 7573 7465 7220   currentcluster 
+00025c80: 3d20 766d 2e67 6574 2827 6b75 6265 2729  = vm.get('kube')
+00025c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025ca0: 206b 7562 6574 7970 6520 3d20 766d 2e67   kubetype = vm.g
+00025cb0: 6574 2827 6b75 6265 7479 7065 272c 2027  et('kubetype', '
+00025cc0: 6765 6e65 7269 6327 290a 2020 2020 2020  generic').      
+00025cd0: 2020 2020 2020 2020 2020 6966 2063 7572            if cur
+00025ce0: 7265 6e74 636c 7573 7465 7220 6973 206e  rentcluster is n
+00025cf0: 6f74 204e 6f6e 6520 616e 6420 6375 7272  ot None and curr
+00025d00: 656e 7463 6c75 7374 6572 203d 3d20 636c  entcluster == cl
+00025d10: 7573 7465 7220 616e 6420 6b75 6265 7479  uster and kubety
+00025d20: 7065 2021 3d20 2767 6b65 273a 0a20 2020  pe != 'gke':.   
+00025d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025d40: 2063 2e64 656c 6574 6528 6e61 6d65 2c20   c.delete(name, 
+00025d50: 736e 6170 7368 6f74 733d 5472 7565 290a  snapshots=True).
+00025d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025d70: 2020 2020 636f 6d6d 6f6e 2e64 656c 6574      common.delet
+00025d80: 655f 6c61 7374 766d 286e 616d 652c 2073  e_lastvm(name, s
+00025d90: 656c 662e 636c 6965 6e74 290a 2020 2020  elf.client).    
+00025da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025db0: 7375 6363 6573 7328 6622 7b6e 616d 657d  success(f"{name}
+00025dc0: 2064 656c 6574 6564 206f 6e20 7b68 7970   deleted on {hyp
+00025dd0: 6572 7669 736f 727d 2122 290a 2020 2020  ervisor}!").    
+00025de0: 2020 2020 6966 2073 656c 662e 7479 7065      if self.type
+00025df0: 203d 3d20 276b 7562 6576 6972 7427 3a0a   == 'kubevirt':.
+00025e00: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+00025e10: 227b 636c 7573 7465 727d 2d61 7069 2220  "{cluster}-api" 
+00025e20: 696e 206b 2e6c 6973 745f 7365 7276 6963  in k.list_servic
+00025e30: 6573 286b 2e6e 616d 6573 7061 6365 293a  es(k.namespace):
+00025e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025e50: 206b 2e64 656c 6574 655f 7365 7276 6963   k.delete_servic
+00025e60: 6528 6622 7b63 6c75 7374 6572 7d2d 6170  e(f"{cluster}-ap
+00025e70: 6922 2c20 6b2e 6e61 6d65 7370 6163 6529  i", k.namespace)
+00025e80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00025e90: 6622 7b63 6c75 7374 6572 7d2d 696e 6772  f"{cluster}-ingr
+00025ea0: 6573 7322 2069 6e20 6b2e 6c69 7374 5f73  ess" in k.list_s
+00025eb0: 6572 7669 6365 7328 6b2e 6e61 6d65 7370  ervices(k.namesp
+00025ec0: 6163 6529 3a0a 2020 2020 2020 2020 2020  ace):.          
+00025ed0: 2020 2020 2020 6b2e 6465 6c65 7465 5f73        k.delete_s
+00025ee0: 6572 7669 6365 2866 227b 636c 7573 7465  ervice(f"{cluste
+00025ef0: 727d 2d69 6e67 7265 7373 222c 206b 2e6e  r}-ingress", k.n
+00025f00: 616d 6573 7061 6365 290a 2020 2020 2020  amespace).      
+00025f10: 2020 6966 2073 656c 662e 7479 7065 2069    if self.type i
+00025f20: 6e20 5b27 6177 7327 2c20 2767 6370 272c  n ['aws', 'gcp',
+00025f30: 2027 6962 6d27 5d20 616e 6420 6e6f 7420   'ibm'] and not 
+00025f40: 676b 653a 0a20 2020 2020 2020 2020 2020  gke:.           
+00025f50: 206c 6273 203d 205b 2761 7069 275d 0a20   lbs = ['api']. 
+00025f60: 2020 2020 2020 2020 2020 2069 6620 6b75             if ku
+00025f70: 6265 7479 7065 206e 6f74 2069 6e20 5b27  betype not in ['
+00025f80: 6b33 7327 2c20 2767 656e 6572 6963 275d  k3s', 'generic']
+00025f90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00025fa0: 2020 6c62 732e 6170 7065 6e64 2827 6170    lbs.append('ap
+00025fb0: 7073 2729 0a20 2020 2020 2020 2020 2020  ps').           
+00025fc0: 2066 6f72 206c 6220 696e 206c 6273 3a0a   for lb in lbs:.
+00025fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025fe0: 7365 6c66 2e64 656c 6574 655f 6c6f 6164  self.delete_load
+00025ff0: 6261 6c61 6e63 6572 2866 227b 6c62 7d2e  balancer(f"{lb}.
+00026000: 7b63 6c75 7374 6572 7d22 2c20 646f 6d61  {cluster}", doma
+00026010: 696e 3d64 6f6d 6169 6e29 0a20 2020 2020  in=domain).     
+00026020: 2020 2020 2020 2062 7563 6b65 7420 3d20         bucket = 
+00026030: 6622 7b63 6c75 7374 6572 7d2d 7b64 6f6d  f"{cluster}-{dom
+00026040: 6169 6e7d 220a 2020 2020 2020 2020 2020  ain}".          
+00026050: 2020 6966 2062 7563 6b65 7420 696e 2073    if bucket in s
+00026060: 656c 662e 6b2e 6c69 7374 5f62 7563 6b65  elf.k.list_bucke
+00026070: 7473 2829 3a0a 2020 2020 2020 2020 2020  ts():.          
+00026080: 2020 2020 2020 7070 7269 6e74 2866 2244        pprint(f"D
+00026090: 656c 6574 696e 6720 6275 636b 6574 207b  eleting bucket {
+000260a0: 6275 636b 6574 7d22 290a 2020 2020 2020  bucket}").      
+000260b0: 2020 2020 2020 2020 2020 6b2e 6465 6c65            k.dele
+000260c0: 7465 5f62 7563 6b65 7428 6275 636b 6574  te_bucket(bucket
+000260d0: 290a 2020 2020 2020 2020 656c 6966 2064  ).        elif d
+000260e0: 6e73 636c 6965 6e74 2069 7320 6e6f 7420  nsclient is not 
+000260f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00026100: 2020 7a20 3d20 4b63 6f6e 6669 6728 636c    z = Kconfig(cl
+00026110: 6965 6e74 3d64 6e73 636c 6965 6e74 292e  ient=dnsclient).
+00026120: 6b0a 2020 2020 2020 2020 2020 2020 7a2e  k.            z.
+00026130: 6465 6c65 7465 5f64 6e73 2866 2261 7069  delete_dns(f"api
+00026140: 2e7b 636c 7573 7465 727d 222c 2064 6f6d  .{cluster}", dom
+00026150: 6169 6e29 0a20 2020 2020 2020 2020 2020  ain).           
+00026160: 207a 2e64 656c 6574 655f 646e 7328 6622   z.delete_dns(f"
+00026170: 6170 7073 2e7b 636c 7573 7465 727d 222c  apps.{cluster}",
+00026180: 2064 6f6d 6169 6e29 0a20 2020 2020 2020   domain).       
+00026190: 2069 6620 6879 7065 7273 6869 6674 3a0a   if hypershift:.
+000261a0: 2020 2020 2020 2020 2020 2020 6b75 6265              kube
+000261b0: 636f 6e66 6967 6d67 6d74 203d 2066 227b  configmgmt = f"{
+000261c0: 636c 7573 7465 7264 6972 7d2f 6b75 6265  clusterdir}/kube
+000261d0: 636f 6e66 6967 2e6d 676d 7422 0a20 2020  config.mgmt".   
+000261e0: 2020 2020 2020 2020 2063 616c 6c28 6627           call(f'
+000261f0: 4b55 4245 434f 4e46 4947 3d7b 6b75 6265  KUBECONFIG={kube
+00026200: 636f 6e66 6967 6d67 6d74 7d20 6f63 2064  configmgmt} oc d
+00026210: 656c 6574 6520 2d66 207b 636c 7573 7465  elete -f {cluste
+00026220: 7264 6972 7d2f 6175 746f 6170 7072 6f76  rdir}/autoapprov
+00026230: 6572 6372 6f6e 2e79 6d6c 272c 2073 6865  ercron.yml', she
+00026240: 6c6c 3d54 7275 6529 0a20 2020 2020 2020  ll=True).       
+00026250: 2020 2020 2063 616c 6c28 6627 4b55 4245       call(f'KUBE
+00026260: 434f 4e46 4947 3d7b 6b75 6265 636f 6e66  CONFIG={kubeconf
+00026270: 6967 6d67 6d74 7d20 6f63 2064 656c 6574  igmgmt} oc delet
+00026280: 6520 2d66 207b 636c 7573 7465 7264 6972  e -f {clusterdir
+00026290: 7d2f 6e6f 6465 706f 6f6c 2e79 616d 6c27  }/nodepool.yaml'
+000262a0: 2c20 7368 656c 6c3d 5472 7565 290a 2020  , shell=True).  
+000262b0: 2020 2020 2020 2020 2020 6361 6c6c 2866            call(f
+000262c0: 274b 5542 4543 4f4e 4649 473d 7b6b 7562  'KUBECONFIG={kub
+000262d0: 6563 6f6e 6669 676d 676d 747d 206f 6320  econfigmgmt} oc 
+000262e0: 6465 6c65 7465 202d 6620 7b63 6c75 7374  delete -f {clust
+000262f0: 6572 6469 727d 2f68 6f73 7465 6463 6c75  erdir}/hostedclu
+00026300: 7374 6572 2e79 616d 6c27 2c20 7368 656c  ster.yaml', shel
+00026310: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
+00026320: 2020 2020 6966 206e 6f74 2061 7373 6973      if not assis
+00026330: 7465 6420 616e 6420 2827 6261 7265 6d65  ted and ('bareme
+00026340: 7461 6c5f 6973 6f27 2069 6e20 636c 7573  tal_iso' in clus
+00026350: 7465 7264 6174 6120 6f72 2027 6261 7265  terdata or 'bare
+00026360: 6d65 7461 6c5f 686f 7374 7327 2069 6e20  metal_hosts' in 
+00026370: 636c 7573 7465 7264 6174 6129 3a0a 2020  clusterdata):.  
+00026380: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+00026390: 6c6c 2866 274b 5542 4543 4f4e 4649 473d  ll(f'KUBECONFIG=
+000263a0: 7b6b 7562 6563 6f6e 6669 676d 676d 747d  {kubeconfigmgmt}
+000263b0: 206f 6320 2d6e 2064 6566 6175 6c74 2064   oc -n default d
+000263c0: 656c 6574 6520 616c 6c20 2d6c 2061 7070  elete all -l app
+000263d0: 3d68 7474 7064 2d6b 636c 6927 2c20 7368  =httpd-kcli', sh
+000263e0: 656c 6c3d 5472 7565 290a 2020 2020 2020  ell=True).      
+000263f0: 2020 2020 2020 2020 2020 6361 6c6c 2866            call(f
+00026400: 274b 5542 4543 4f4e 4649 473d 7b6b 7562  'KUBECONFIG={kub
+00026410: 6563 6f6e 6669 676d 676d 747d 206f 6320  econfigmgmt} oc 
+00026420: 2d6e 2064 6566 6175 6c74 2064 656c 6574  -n default delet
+00026430: 6520 7076 6320 6874 7470 642d 6b63 6c69  e pvc httpd-kcli
+00026440: 2d70 7663 272c 2073 6865 6c6c 3d54 7275  -pvc', shell=Tru
+00026450: 6529 0a20 2020 2020 2020 2069 6620 676b  e).        if gk
+00026460: 653a 0a20 2020 2020 2020 2020 2020 2067  e:.            g
+00026470: 6370 636c 6965 6e74 203d 204e 6f6e 650a  cpclient = None.
+00026480: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00026490: 636c 6965 6e74 2720 696e 2063 6c75 7374  client' in clust
+000264a0: 6572 6461 7461 3a0a 2020 2020 2020 2020  erdata:.        
+000264b0: 2020 2020 2020 2020 6763 7063 6c69 656e          gcpclien
+000264c0: 7420 3d20 636c 7573 7465 7264 6174 615b  t = clusterdata[
+000264d0: 2763 6c69 656e 7427 5d0a 2020 2020 2020  'client'].      
+000264e0: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
+000264f0: 7479 7065 203d 3d20 2767 6370 273a 0a20  type == 'gcp':. 
+00026500: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00026510: 6370 636c 6965 6e74 203d 2073 656c 662e  cpclient = self.
+00026520: 636c 6965 6e74 0a20 2020 2020 2020 2020  client.         
+00026530: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00026540: 2020 2020 2020 2020 206d 7367 203d 2022           msg = "
+00026550: 4465 6c65 7469 6e67 2067 6b65 2063 6c75  Deleting gke clu
+00026560: 7374 6572 2072 6571 7569 7265 7320 746f  ster requires to
+00026570: 2069 6e73 7461 6e74 6961 7465 2067 6370   instantiate gcp
+00026580: 2070 726f 7669 6465 7222 0a20 2020 2020   provider".     
+00026590: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+000265a0: 286d 7367 290a 2020 2020 2020 2020 2020  (msg).          
+000265b0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
+000265c0: 6573 756c 7427 3a20 2766 6169 6c75 7265  esult': 'failure
+000265d0: 272c 2027 7265 6173 6f6e 273a 206d 7367  ', 'reason': msg
+000265e0: 7d0a 2020 2020 2020 2020 2020 2020 6672  }.            fr
+000265f0: 6f6d 206b 7669 7274 2e63 6c75 7374 6572  om kvirt.cluster
+00026600: 2069 6d70 6f72 7420 676b 650a 2020 2020   import gke.    
+00026610: 2020 2020 2020 2020 6375 7272 656e 7463          currentc
+00026620: 6f6e 6669 6720 3d20 4b63 6f6e 6669 6728  onfig = Kconfig(
+00026630: 636c 6965 6e74 3d67 6370 636c 6965 6e74  client=gcpclient
+00026640: 292e 6b20 6966 2067 6370 636c 6965 6e74  ).k if gcpclient
+00026650: 2021 3d20 7365 6c66 2e63 6c69 656e 7420   != self.client 
+00026660: 656c 7365 2073 656c 660a 2020 2020 2020  else self.      
+00026670: 2020 2020 2020 7a6f 6e61 6c20 3d20 636c        zonal = cl
+00026680: 7573 7465 7264 6174 612e 6765 7428 277a  usterdata.get('z
+00026690: 6f6e 616c 272c 2054 7275 6529 0a20 2020  onal', True).   
+000266a0: 2020 2020 2020 2020 2067 6b65 2e64 656c           gke.del
+000266b0: 6574 6528 6375 7272 656e 7463 6f6e 6669  ete(currentconfi
+000266c0: 672c 2063 6c75 7374 6572 2c20 7a6f 6e61  g, cluster, zona
+000266d0: 6c29 0a20 2020 2020 2020 2066 6f72 2063  l).        for c
+000266e0: 6f6e 6670 6f6f 6c20 696e 2073 656c 662e  onfpool in self.
+000266f0: 636f 6e66 706f 6f6c 733a 0a20 2020 2020  confpools:.     
+00026700: 2020 2020 2020 2069 705f 7265 7365 7276         ip_reserv
+00026710: 6174 696f 6e73 203d 2073 656c 662e 636f  ations = self.co
+00026720: 6e66 706f 6f6c 735b 636f 6e66 706f 6f6c  nfpools[confpool
+00026730: 5d2e 6765 7428 2769 705f 7265 7365 7276  ].get('ip_reserv
+00026740: 6174 696f 6e73 272c 207b 7d29 0a20 2020  ations', {}).   
+00026750: 2020 2020 2020 2020 2069 6620 636c 7573           if clus
+00026760: 7465 7220 696e 2069 705f 7265 7365 7276  ter in ip_reserv
+00026770: 6174 696f 6e73 3a0a 2020 2020 2020 2020  ations:.        
+00026780: 2020 2020 2020 2020 6465 6c20 6970 5f72          del ip_r
+00026790: 6573 6572 7661 7469 6f6e 735b 636c 7573  eservations[clus
+000267a0: 7465 725d 0a20 2020 2020 2020 2020 2020  ter].           
+000267b0: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
+000267c0: 5f63 6f6e 6670 6f6f 6c28 636f 6e66 706f  _confpool(confpo
+000267d0: 6f6c 2c20 7b27 6970 5f72 6573 6572 7661  ol, {'ip_reserva
+000267e0: 7469 6f6e 7327 3a20 6970 5f72 6573 6572  tions': ip_reser
+000267f0: 7661 7469 6f6e 737d 290a 2020 2020 2020  vations}).      
+00026800: 2020 2020 2020 6e61 6d65 5f72 6573 6572        name_reser
+00026810: 7661 7469 6f6e 7320 3d20 7365 6c66 2e63  vations = self.c
+00026820: 6f6e 6670 6f6f 6c73 5b63 6f6e 6670 6f6f  onfpools[confpoo
+00026830: 6c5d 2e67 6574 2827 6e61 6d65 5f72 6573  l].get('name_res
+00026840: 6572 7661 7469 6f6e 7327 2c20 5b5d 290a  ervations', []).
+00026850: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00026860: 6c75 7374 6572 2069 6e20 6e61 6d65 5f72  luster in name_r
+00026870: 6573 6572 7661 7469 6f6e 733a 0a20 2020  eservations:.   
+00026880: 2020 2020 2020 2020 2020 2020 206e 616d               nam
+00026890: 655f 7265 7365 7276 6174 696f 6e73 2e72  e_reservations.r
+000268a0: 656d 6f76 6528 636c 7573 7465 7229 0a20  emove(cluster). 
+000268b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000268c0: 656c 662e 7570 6461 7465 5f63 6f6e 6670  elf.update_confp
+000268d0: 6f6f 6c28 636f 6e66 706f 6f6c 2c20 7b27  ool(confpool, {'
+000268e0: 6e61 6d65 5f72 6573 6572 7661 7469 6f6e  name_reservation
+000268f0: 7327 3a20 6e61 6d65 5f72 6573 6572 7661  s': name_reserva
+00026900: 7469 6f6e 737d 290a 2020 2020 2020 2020  tions}).        
+00026910: 2020 2020 636c 7573 7465 725f 6261 7265      cluster_bare
+00026920: 6d65 7461 6c5f 7265 7365 7276 6174 696f  metal_reservatio
+00026930: 6e73 203d 2073 656c 662e 636f 6e66 706f  ns = self.confpo
+00026940: 6f6c 735b 636f 6e66 706f 6f6c 5d2e 6765  ols[confpool].ge
+00026950: 7428 2763 6c75 7374 6572 5f62 6172 656d  t('cluster_barem
+00026960: 6574 616c 5f72 6573 6572 7661 7469 6f6e  etal_reservation
+00026970: 7327 2c20 7b7d 290a 2020 2020 2020 2020  s', {}).        
+00026980: 2020 2020 6966 2063 6c75 7374 6572 2069      if cluster i
+00026990: 6e20 636c 7573 7465 725f 6261 7265 6d65  n cluster_bareme
+000269a0: 7461 6c5f 7265 7365 7276 6174 696f 6e73  tal_reservations
+000269b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000269c0: 2020 6465 6c20 636c 7573 7465 725f 6261    del cluster_ba
+000269d0: 7265 6d65 7461 6c5f 7265 7365 7276 6174  remetal_reservat
+000269e0: 696f 6e73 5b63 6c75 7374 6572 5d0a 2020  ions[cluster].  
+000269f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00026a00: 6c66 2e75 7064 6174 655f 636f 6e66 706f  lf.update_confpo
+00026a10: 6f6c 2863 6f6e 6670 6f6f 6c2c 207b 2763  ol(confpool, {'c
+00026a20: 6c75 7374 6572 5f62 6172 656d 6574 616c  luster_baremetal
+00026a30: 5f72 6573 6572 7661 7469 6f6e 7327 3a20  _reservations': 
+00026a40: 636c 7573 7465 725f 6261 7265 6d65 7461  cluster_baremeta
+00026a50: 6c5f 7265 7365 7276 6174 696f 6e73 7d29  l_reservations})
+00026a60: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
+00026a70: 6174 682e 6578 6973 7473 2863 6c75 7374  ath.exists(clust
+00026a80: 6572 6469 7229 3a0a 2020 2020 2020 2020  erdir):.        
+00026a90: 2020 2020 7070 7269 6e74 2866 2244 656c      pprint(f"Del
+00026aa0: 6574 696e 6720 6469 7265 6374 6f72 7920  eting directory 
+00026ab0: 7b63 6c75 7374 6572 6469 727d 2229 0a20  {clusterdir}"). 
+00026ac0: 2020 2020 2020 2020 2020 2072 6d74 7265             rmtre
+00026ad0: 6528 636c 7573 7465 7264 6972 290a 2020  e(clusterdir).  
+00026ae0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
+00026af0: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
+00026b00: 277d 0a0a 2020 2020 6465 6620 7363 616c  '}..    def scal
+00026b10: 655f 6b75 6265 2873 656c 662c 2063 6c75  e_kube(self, clu
+00026b20: 7374 6572 2c20 6b75 6265 7479 7065 2c20  ster, kubetype, 
+00026b30: 6f76 6572 7269 6465 733d 7b7d 293a 0a20  overrides={}):. 
+00026b40: 2020 2020 2020 2069 6620 6b75 6265 7479         if kubety
+00026b50: 7065 203d 3d20 2767 656e 6572 6963 273a  pe == 'generic':
+00026b60: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00026b70: 756c 7420 3d20 7365 6c66 2e73 6361 6c65  ult = self.scale
+00026b80: 5f6b 7562 655f 6765 6e65 7269 6328 636c  _kube_generic(cl
+00026b90: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
+00026ba0: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
+00026bb0: 2020 2020 656c 6966 206b 7562 6574 7970      elif kubetyp
+00026bc0: 6520 3d3d 2027 6b33 7327 3a0a 2020 2020  e == 'k3s':.    
+00026bd0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00026be0: 2073 656c 662e 7363 616c 655f 6b75 6265   self.scale_kube
+00026bf0: 5f6b 3373 2863 6c75 7374 6572 2c20 6f76  _k3s(cluster, ov
+00026c00: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
+00026c10: 7329 0a20 2020 2020 2020 2065 6c69 6620  s).        elif 
+00026c20: 6b75 6265 7479 7065 203d 3d20 276f 7065  kubetype == 'ope
+00026c30: 6e73 6869 6674 273a 0a20 2020 2020 2020  nshift':.       
+00026c40: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
+00026c50: 6c66 2e73 6361 6c65 5f6b 7562 655f 6f70  lf.scale_kube_op
+00026c60: 656e 7368 6966 7428 636c 7573 7465 722c  enshift(cluster,
+00026c70: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
+00026c80: 6964 6573 290a 2020 2020 2020 2020 656c  ides).        el
+00026c90: 6966 206b 7562 6574 7970 6520 3d3d 2027  if kubetype == '
+00026ca0: 6879 7065 7273 6869 6674 273a 0a20 2020  hypershift':.   
+00026cb0: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+00026cc0: 3d20 7365 6c66 2e73 6361 6c65 5f6b 7562  = self.scale_kub
+00026cd0: 655f 6879 7065 7273 6869 6674 2863 6c75  e_hypershift(clu
+00026ce0: 7374 6572 2c20 6f76 6572 7269 6465 733d  ster, overrides=
+00026cf0: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
+00026d00: 2020 2065 6c69 6620 6b75 6265 7479 7065     elif kubetype
+00026d10: 203d 3d20 2767 6b65 273a 0a20 2020 2020   == 'gke':.     
+00026d20: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00026d30: 7365 6c66 2e73 6361 6c65 5f6b 7562 655f  self.scale_kube_
+00026d40: 676b 6528 636c 7573 7465 722c 206f 7665  gke(cluster, ove
+00026d50: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
+00026d60: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00026d70: 2072 6573 756c 740a 0a20 2020 2064 6566   result..    def
+00026d80: 2073 6361 6c65 5f6b 7562 655f 6765 6e65   scale_kube_gene
+00026d90: 7269 6328 7365 6c66 2c20 636c 7573 7465  ric(self, cluste
+00026da0: 722c 206f 7665 7272 6964 6573 3d7b 7d29  r, overrides={})
+00026db0: 3a0a 2020 2020 2020 2020 706c 616e 6469  :.        plandi
+00026dc0: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
+00026dd0: 616d 6528 6b75 6265 6164 6d2e 6372 6561  ame(kubeadm.crea
+00026de0: 7465 2e5f 5f63 6f64 655f 5f2e 636f 5f66  te.__code__.co_f
+00026df0: 696c 656e 616d 6529 0a20 2020 2020 2020  ilename).       
+00026e00: 2072 6574 7572 6e20 6b75 6265 6164 6d2e   return kubeadm.
+00026e10: 7363 616c 6528 7365 6c66 2c20 706c 616e  scale(self, plan
+00026e20: 6469 722c 2063 6c75 7374 6572 2c20 6f76  dir, cluster, ov
+00026e30: 6572 7269 6465 7329 0a0a 2020 2020 6465  errides)..    de
+00026e40: 6620 7363 616c 655f 6b75 6265 5f67 6b65  f scale_kube_gke
+00026e50: 2873 656c 662c 2063 6c75 7374 6572 2c20  (self, cluster, 
+00026e60: 6f76 6572 7269 6465 733d 7b7d 293a 0a20  overrides={}):. 
+00026e70: 2020 2020 2020 2066 726f 6d20 6b76 6972         from kvir
+00026e80: 742e 636c 7573 7465 7220 696d 706f 7274  t.cluster import
+00026e90: 2067 6b65 0a20 2020 2020 2020 2070 6c61   gke.        pla
+00026ea0: 6e64 6972 203d 206f 732e 7061 7468 2e64  ndir = os.path.d
+00026eb0: 6972 6e61 6d65 2867 6b65 2e63 7265 6174  irname(gke.creat
+00026ec0: 652e 5f5f 636f 6465 5f5f 2e63 6f5f 6669  e.__code__.co_fi
+00026ed0: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
+00026ee0: 7265 7475 726e 2067 6b65 2e73 6361 6c65  return gke.scale
+00026ef0: 2873 656c 662c 2070 6c61 6e64 6972 2c20  (self, plandir, 
+00026f00: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
+00026f10: 6573 290a 0a20 2020 2064 6566 2073 6361  es)..    def sca
+00026f20: 6c65 5f6b 7562 655f 6879 7065 7273 6869  le_kube_hypershi
+00026f30: 6674 2873 656c 662c 2063 6c75 7374 6572  ft(self, cluster
+00026f40: 2c20 6f76 6572 7269 6465 733d 7b7d 293a  , overrides={}):
+00026f50: 0a20 2020 2020 2020 2070 6c61 6e64 6972  .        plandir
+00026f60: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
+00026f70: 6d65 2868 7970 6572 7368 6966 742e 6372  me(hypershift.cr
+00026f80: 6561 7465 2e5f 5f63 6f64 655f 5f2e 636f  eate.__code__.co
+00026f90: 5f66 696c 656e 616d 6529 0a20 2020 2020  _filename).     
+00026fa0: 2020 2072 6574 7572 6e20 6879 7065 7273     return hypers
+00026fb0: 6869 6674 2e73 6361 6c65 2873 656c 662c  hift.scale(self,
+00026fc0: 2070 6c61 6e64 6972 2c20 636c 7573 7465   plandir, cluste
+00026fd0: 722c 206f 7665 7272 6964 6573 290a 0a20  r, overrides).. 
+00026fe0: 2020 2064 6566 2073 6361 6c65 5f6b 7562     def scale_kub
+00026ff0: 655f 6b33 7328 7365 6c66 2c20 636c 7573  e_k3s(self, clus
+00027000: 7465 722c 206f 7665 7272 6964 6573 3d7b  ter, overrides={
+00027010: 7d29 3a0a 2020 2020 2020 2020 706c 616e  }):.        plan
+00027020: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
+00027030: 726e 616d 6528 6b33 732e 6372 6561 7465  rname(k3s.create
+00027040: 2e5f 5f63 6f64 655f 5f2e 636f 5f66 696c  .__code__.co_fil
+00027050: 656e 616d 6529 0a20 2020 2020 2020 2072  ename).        r
+00027060: 6574 7572 6e20 6b33 732e 7363 616c 6528  eturn k3s.scale(
+00027070: 7365 6c66 2c20 706c 616e 6469 722c 2063  self, plandir, c
+00027080: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
+00027090: 7329 0a0a 2020 2020 6465 6620 7363 616c  s)..    def scal
+000270a0: 655f 6b75 6265 5f6f 7065 6e73 6869 6674  e_kube_openshift
+000270b0: 2873 656c 662c 2063 6c75 7374 6572 2c20  (self, cluster, 
+000270c0: 6f76 6572 7269 6465 733d 7b7d 293a 0a20  overrides={}):. 
+000270d0: 2020 2020 2020 2070 6c61 6e64 6972 203d         plandir =
+000270e0: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
+000270f0: 286f 7065 6e73 6869 6674 2e63 7265 6174  (openshift.creat
+00027100: 652e 5f5f 636f 6465 5f5f 2e63 6f5f 6669  e.__code__.co_fi
+00027110: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
+00027120: 7265 7475 726e 206f 7065 6e73 6869 6674  return openshift
+00027130: 2e73 6361 6c65 2873 656c 662c 2070 6c61  .scale(self, pla
+00027140: 6e64 6972 2c20 636c 7573 7465 722c 206f  ndir, cluster, o
+00027150: 7665 7272 6964 6573 290a 0a20 2020 2064  verrides)..    d
+00027160: 6566 2075 7064 6174 655f 6b75 6265 2873  ef update_kube(s
+00027170: 656c 662c 2063 6c75 7374 6572 2c20 5f74  elf, cluster, _t
+00027180: 7970 652c 206f 7665 7272 6964 6573 3d7b  ype, overrides={
+00027190: 7d2c 2070 6c61 6e3d 4e6f 6e65 293a 0a20  }, plan=None):. 
+000271a0: 2020 2020 2020 206f 7665 7272 6964 6573         overrides
+000271b0: 5b27 736b 6970 5f66 696c 6573 5f72 656d  ['skip_files_rem
+000271c0: 6564 6961 7469 6f6e 275d 203d 2054 7275  ediation'] = Tru
+000271d0: 650a 2020 2020 2020 2020 6f76 6572 7269  e.        overri
+000271e0: 6465 735b 2773 6361 6c65 275d 203d 2054  des['scale'] = T
+000271f0: 7275 650a 2020 2020 2020 2020 636c 7573  rue.        clus
+00027200: 7465 7264 6972 203d 206f 732e 7061 7468  terdir = os.path
+00027210: 2e65 7870 616e 6475 7365 7228 6622 7e2f  .expanduser(f"~/
+00027220: 2e6b 636c 692f 636c 7573 7465 7273 2f7b  .kcli/clusters/{
+00027230: 636c 7573 7465 727d 2229 0a20 2020 2020  cluster}").     
+00027240: 2020 2070 6c61 6e76 6d73 203d 205b 5d0a     planvms = [].
+00027250: 2020 2020 2020 2020 6966 2070 6c61 6e20          if plan 
+00027260: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00027270: 2020 2020 2070 6c61 6e20 3d20 636c 7573       plan = clus
+00027280: 7465 720a 2020 2020 2020 2020 6966 205f  ter.        if _
+00027290: 7479 7065 203d 3d20 2767 656e 6572 6963  type == 'generic
+000272a0: 273a 0a20 2020 2020 2020 2020 2020 2072  ':.            r
+000272b0: 6f6c 6573 203d 205b 2763 746c 706c 616e  oles = ['ctlplan
+000272c0: 6573 272c 2027 776f 726b 6572 7327 5d0a  es', 'workers'].
+000272d0: 2020 2020 2020 2020 2020 2020 706c 616e              plan
+000272e0: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
+000272f0: 726e 616d 6528 6b75 6265 6164 6d2e 6372  rname(kubeadm.cr
+00027300: 6561 7465 2e5f 5f63 6f64 655f 5f2e 636f  eate.__code__.co
+00027310: 5f66 696c 656e 616d 6529 0a20 2020 2020  _filename).     
+00027320: 2020 2065 6c69 6620 5f74 7970 6520 3d3d     elif _type ==
+00027330: 2027 6b33 7327 3a0a 2020 2020 2020 2020   'k3s':.        
+00027340: 2020 2020 706c 616e 6469 7220 3d20 6f73      plandir = os
+00027350: 2e70 6174 682e 6469 726e 616d 6528 6b33  .path.dirname(k3
+00027360: 732e 6372 6561 7465 2e5f 5f63 6f64 655f  s.create.__code_
+00027370: 5f2e 636f 5f66 696c 656e 616d 6529 0a20  _.co_filename). 
+00027380: 2020 2020 2020 2020 2020 2072 6f6c 6573             roles
+00027390: 203d 205b 2762 6f6f 7473 7472 6170 272c   = ['bootstrap',
+000273a0: 2027 776f 726b 6572 7327 5d20 6966 206f   'workers'] if o
+000273b0: 7665 7272 6964 6573 2e67 6574 2827 6374  verrides.get('ct
+000273c0: 6c70 6c61 6e65 7327 2c20 3129 203d 3d20  lplanes', 1) == 
+000273d0: 3120 656c 7365 205b 2762 6f6f 7473 7472  1 else ['bootstr
+000273e0: 6170 272c 2027 6374 6c70 6c61 6e65 7327  ap', 'ctlplanes'
+000273f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00027400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027440: 2020 2020 2020 2020 2020 2027 776f 726b             'work
+00027450: 6572 7327 5d0a 2020 2020 2020 2020 656c  ers'].        el
+00027460: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00027470: 706c 616e 6469 7220 3d20 6f73 2e70 6174  plandir = os.pat
+00027480: 682e 6469 726e 616d 6528 6f70 656e 7368  h.dirname(opensh
+00027490: 6966 742e 6372 6561 7465 2e5f 5f63 6f64  ift.create.__cod
+000274a0: 655f 5f2e 636f 5f66 696c 656e 616d 6529  e__.co_filename)
+000274b0: 0a20 2020 2020 2020 2020 2020 2072 6f6c  .            rol
+000274c0: 6573 203d 205b 2763 6c6f 7564 5f63 746c  es = ['cloud_ctl
+000274d0: 706c 616e 6573 272c 2027 636c 6f75 645f  planes', 'cloud_
+000274e0: 776f 726b 6572 7327 5d20 6966 2073 656c  workers'] if sel
+000274f0: 662e 7479 7065 2069 6e20 5b27 6177 7327  f.type in ['aws'
+00027500: 2c20 2767 6370 275d 2065 6c73 6520 5b27  , 'gcp'] else ['
+00027510: 6374 6c70 6c61 6e65 7327 2c20 2777 6f72  ctlplanes', 'wor
+00027520: 6b65 7273 275d 0a20 2020 2020 2020 2069  kers'].        i
+00027530: 6620 6f76 6572 7269 6465 732e 6765 7428  f overrides.get(
+00027540: 2777 6f72 6b65 7273 272c 2030 2920 3d3d  'workers', 0) ==
+00027550: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00027560: 6465 6c20 726f 6c65 735b 2d31 5d0a 2020  del roles[-1].  
+00027570: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
+00027580: 2e65 7869 7374 7328 6622 7b63 6c75 7374  .exists(f"{clust
+00027590: 6572 6469 727d 2f6b 636c 695f 7061 7261  erdir}/kcli_para
+000275a0: 6d65 7465 7273 2e79 6d6c 2229 3a0a 2020  meters.yml"):.  
+000275b0: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+000275c0: 207b 2763 6c75 7374 6572 273a 2063 6c75   {'cluster': clu
+000275d0: 7374 6572 2c20 276b 7562 6527 3a20 636c  ster, 'kube': cl
+000275e0: 7573 7465 722c 2027 6b75 6265 7479 7065  uster, 'kubetype
+000275f0: 273a 205f 7479 7065 7d0a 2020 2020 2020  ': _type}.      
+00027600: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+00027610: 6622 7b63 6c75 7374 6572 6469 727d 2f6b  f"{clusterdir}/k
+00027620: 636c 695f 7061 7261 6d65 7465 7273 2e79  cli_parameters.y
+00027630: 6d6c 222c 2027 7227 2920 6173 2069 6e73  ml", 'r') as ins
+00027640: 7461 6c6c 3a0a 2020 2020 2020 2020 2020  tall:.          
+00027650: 2020 2020 2020 696e 7374 616c 6c70 6172        installpar
+00027660: 616d 203d 2079 616d 6c2e 7361 6665 5f6c  am = yaml.safe_l
+00027670: 6f61 6428 696e 7374 616c 6c29 0a20 2020  oad(install).   
+00027680: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00027690: 612e 7570 6461 7465 2869 6e73 7461 6c6c  a.update(install
+000276a0: 7061 7261 6d29 0a20 2020 2020 2020 2020  param).         
+000276b0: 2020 2020 2020 2070 6c61 6e20 3d20 696e         plan = in
+000276c0: 7374 616c 6c70 6172 616d 2e67 6574 2827  stallparam.get('
+000276d0: 706c 616e 272c 2070 6c61 6e29 0a20 2020  plan', plan).   
+000276e0: 2020 2020 2020 2020 2064 6174 612e 7570           data.up
+000276f0: 6461 7465 286f 7665 7272 6964 6573 290a  date(overrides).
+00027700: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00027710: 206f 7065 6e28 6622 7b63 6c75 7374 6572   open(f"{cluster
+00027720: 6469 727d 2f6b 636c 695f 7061 7261 6d65  dir}/kcli_parame
+00027730: 7465 7273 2e79 6d6c 222c 2027 7727 2920  ters.yml", 'w') 
+00027740: 6173 2070 6172 616d 6669 6c65 3a0a 2020  as paramfile:.  
+00027750: 2020 2020 2020 2020 2020 2020 2020 7961                ya
+00027760: 6d6c 2e73 6166 655f 6475 6d70 2864 6174  ml.safe_dump(dat
+00027770: 612c 2070 6172 616d 6669 6c65 290a 2020  a, paramfile).  
+00027780: 2020 2020 2020 6f73 2e63 6864 6972 286f        os.chdir(o
+00027790: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
+000277a0: 7228 227e 2f2e 6b63 6c69 2229 290a 2020  r("~/.kcli")).  
+000277b0: 2020 2020 2020 666f 7220 726f 6c65 2069        for role i
+000277c0: 6e20 726f 6c65 733a 0a20 2020 2020 2020  n roles:.       
+000277d0: 2020 2020 2070 7072 696e 7428 6622 5570       pprint(f"Up
+000277e0: 6461 7469 6e67 2076 6d73 2077 6974 6820  dating vms with 
+000277f0: 7b72 6f6c 657d 2072 6f6c 6522 290a 2020  {role} role").  
+00027800: 2020 2020 2020 2020 2020 706c 616e 6461            planda
+00027810: 7461 203d 2073 656c 662e 706c 616e 2870  ta = self.plan(p
+00027820: 6c61 6e2c 2069 6e70 7574 6669 6c65 3d66  lan, inputfile=f
+00027830: 277b 706c 616e 6469 727d 2f7b 726f 6c65  '{plandir}/{role
+00027840: 7d2e 796d 6c27 2c20 6f76 6572 7269 6465  }.yml', override
+00027850: 733d 6f76 6572 7269 6465 732c 2075 7064  s=overrides, upd
+00027860: 6174 653d 5472 7565 290a 2020 2020 2020  ate=True).      
+00027870: 2020 2020 2020 706c 616e 766d 732e 6578        planvms.ex
+00027880: 7465 6e64 2870 6c61 6e64 6174 615b 276e  tend(plandata['n
+00027890: 6577 766d 7327 5d20 2b20 706c 616e 6461  ewvms'] + planda
+000278a0: 7461 5b27 6578 6973 7469 6e67 766d 7327  ta['existingvms'
+000278b0: 5d29 0a20 2020 2020 2020 206f 732e 656e  ]).        os.en
+000278c0: 7669 726f 6e5b 274b 5542 4543 4f4e 4649  viron['KUBECONFI
+000278d0: 4727 5d20 3d20 6622 7b63 6c75 7374 6572  G'] = f"{cluster
+000278e0: 6469 727d 2f61 7574 682f 6b75 6265 636f  dir}/auth/kubeco
+000278f0: 6e66 6967 220a 2020 2020 2020 2020 6269  nfig".        bi
+00027900: 6e61 7279 203d 2027 6f63 2720 6966 2077  nary = 'oc' if w
+00027910: 6869 6368 2827 6f63 2729 2069 7320 6e6f  hich('oc') is no
+00027920: 7420 4e6f 6e65 2065 6c73 6520 276b 7562  t None else 'kub
+00027930: 6563 746c 270a 2020 2020 2020 2020 6e6f  ectl'.        no
+00027940: 6465 7363 6d64 203d 2066 277b 6269 6e61  descmd = f'{bina
+00027950: 7279 7d20 6765 7420 6e6f 6465 202d 6f20  ry} get node -o 
+00027960: 6e61 6d65 270a 2020 2020 2020 2020 6e6f  name'.        no
+00027970: 6465 7320 3d20 5b6e 2e73 7472 6970 2829  des = [n.strip()
+00027980: 2e72 6570 6c61 6365 2827 6e6f 6465 2f27  .replace('node/'
+00027990: 2c20 2727 2920 666f 7220 6e20 696e 206f  , '') for n in o
+000279a0: 732e 706f 7065 6e28 6e6f 6465 7363 6d64  s.popen(nodescmd
+000279b0: 292e 7265 6164 6c69 6e65 7328 295d 0a20  ).readlines()]. 
+000279c0: 2020 2020 2020 2066 6f72 2076 6d20 696e         for vm in
+000279d0: 2073 656c 662e 6b2e 6c69 7374 2829 3a0a   self.k.list():.
+000279e0: 2020 2020 2020 2020 2020 2020 766d 6e61              vmna
+000279f0: 6d65 203d 2076 6d5b 276e 616d 6527 5d0a  me = vm['name'].
+00027a00: 2020 2020 2020 2020 2020 2020 766d 706c              vmpl
+00027a10: 616e 203d 2076 6d2e 6765 7428 2770 6c61  an = vm.get('pla
+00027a20: 6e27 2c20 276b 7669 7274 2729 0a20 2020  n', 'kvirt').   
+00027a30: 2020 2020 2020 2020 2069 6620 766d 706c           if vmpl
+00027a40: 616e 203d 3d20 706c 616e 2061 6e64 2076  an == plan and v
+00027a50: 6d6e 616d 6520 6e6f 7420 696e 2070 6c61  mname not in pla
+00027a60: 6e76 6d73 3a0a 2020 2020 2020 2020 2020  nvms:.          
+00027a70: 2020 2020 2020 7070 7269 6e74 2866 2244        pprint(f"D
+00027a80: 656c 6574 696e 6720 766d 207b 766d 6e61  eleting vm {vmna
+00027a90: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
+00027aa0: 2020 2020 2020 7365 6c66 2e6b 2e64 656c        self.k.del
+00027ab0: 6574 6528 766d 6e61 6d65 290a 2020 2020  ete(vmname).    
+00027ac0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00027ad0: 6e6f 6465 2069 6e20 6e6f 6465 733a 0a20  node in nodes:. 
+00027ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027af0: 2020 2069 6620 6e6f 6465 2e73 706c 6974     if node.split
+00027b00: 2827 2e27 295b 305d 203d 3d20 766d 6e61  ('.')[0] == vmna
+00027b10: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+00027b20: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00027b30: 6e74 2866 2244 656c 6574 696e 6720 6e6f  nt(f"Deleting no
+00027b40: 6465 207b 6e6f 6465 7d20 6672 6f6d 2079  de {node} from y
+00027b50: 6f75 7220 636c 7573 7465 7222 290a 2020  our cluster").  
+00027b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027b70: 2020 2020 2020 6361 6c6c 2866 277b 6269        call(f'{bi
+00027b80: 6e61 7279 7d20 6465 6c65 7465 206e 6f64  nary} delete nod
+00027b90: 6520 7b6e 6f64 657d 272c 2073 6865 6c6c  e {node}', shell
+00027ba0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00027bb0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00027bc0: 7265 616b 0a0a 2020 2020 6465 6620 6578  reak..    def ex
+00027bd0: 706f 7365 5f70 6c61 6e28 7365 6c66 2c20  pose_plan(self, 
+00027be0: 706c 616e 2c20 696e 7075 7466 696c 653d  plan, inputfile=
+00027bf0: 4e6f 6e65 2c20 6f76 6572 7269 6465 733d  None, overrides=
+00027c00: 7b7d 2c20 706f 7274 3d39 3030 302c 2070  {}, port=9000, p
+00027c10: 666d 6f64 653d 4661 6c73 652c 2063 6c75  fmode=False, clu
+00027c20: 7374 6572 3d46 616c 7365 293a 0a20 2020  ster=False):.   
+00027c30: 2020 2020 2069 6e70 7574 6669 6c65 203d       inputfile =
+00027c40: 206f 732e 7061 7468 2e65 7870 616e 6475   os.path.expandu
+00027c50: 7365 7228 696e 7075 7466 696c 6529 0a20  ser(inputfile). 
+00027c60: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
+00027c70: 2e70 6174 682e 6578 6973 7473 2869 6e70  .path.exists(inp
+00027c80: 7574 6669 6c65 293a 0a20 2020 2020 2020  utfile):.       
+00027c90: 2020 2020 2065 7272 6f72 2822 4e6f 2069       error("No i
+00027ca0: 6e70 7574 2066 696c 6520 666f 756e 6420  nput file found 
+00027cb0: 6e6f 7220 6465 6661 756c 7420 6b63 6c69  nor default kcli
+00027cc0: 5f70 6c61 6e2e 796d 6c2e 4c65 6176 696e  _plan.yml.Leavin
+00027cd0: 672e 2e2e 2e22 290a 2020 2020 2020 2020  g....").        
+00027ce0: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
+00027cf0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+00027d00: 2248 616e 646c 696e 6720 6578 706f 7365  "Handling expose
+00027d10: 206f 6620 706c 616e 2077 6974 6820 6e61   of plan with na
+00027d20: 6d65 207b 706c 616e 7d20 616e 6420 696e  me {plan} and in
+00027d30: 7075 7466 696c 6520 7b69 6e70 7574 6669  putfile {inputfi
+00027d40: 6c65 7d22 290a 2020 2020 2020 2020 6b65  le}").        ke
+00027d50: 7870 6f73 6572 203d 204b 6578 706f 7365  xposer = Kexpose
+00027d60: 7228 7365 6c66 2c20 706c 616e 2c20 696e  r(self, plan, in
+00027d70: 7075 7466 696c 652c 206f 7665 7272 6964  putfile, overrid
+00027d80: 6573 3d6f 7665 7272 6964 6573 2c20 706f  es=overrides, po
+00027d90: 7274 3d70 6f72 742c 2070 666d 6f64 653d  rt=port, pfmode=
+00027da0: 7066 6d6f 6465 2c20 636c 7573 7465 723d  pfmode, cluster=
+00027db0: 636c 7573 7465 7229 0a20 2020 2020 2020  cluster).       
+00027dc0: 206b 6578 706f 7365 722e 7275 6e28 290a   kexposer.run().
+00027dd0: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
+00027de0: 6f70 656e 7368 6966 745f 6973 6f28 7365  openshift_iso(se
+00027df0: 6c66 2c20 636c 7573 7465 722c 206f 7665  lf, cluster, ove
+00027e00: 7272 6964 6573 3d7b 7d2c 2069 676e 6974  rrides={}, ignit
+00027e10: 696f 6e66 696c 653d 4e6f 6e65 2c20 706f  ionfile=None, po
+00027e20: 646d 616e 3d46 616c 7365 2c20 696e 7374  dman=False, inst
+00027e30: 616c 6c65 723d 4661 6c73 652c 0a20 2020  aller=False,.   
+00027e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027e50: 2020 2020 2020 2020 2020 6469 7265 6374            direct
+00027e60: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+00027e70: 206d 6574 616c 5f75 726c 203d 204e 6f6e   metal_url = Non
+00027e80: 650a 2020 2020 2020 2020 6973 6f5f 7665  e.        iso_ve
+00027e90: 7273 696f 6e20 3d20 7374 7228 6f76 6572  rsion = str(over
+00027ea0: 7269 6465 732e 6765 7428 2776 6572 7369  rides.get('versi
+00027eb0: 6f6e 272c 2027 6c61 7465 7374 2729 290a  on', 'latest')).
+00027ec0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00027ed0: 6e73 7461 6c6c 6572 3a0a 2020 2020 2020  nstaller:.      
+00027ee0: 2020 2020 2020 6966 2069 736f 5f76 6572        if iso_ver
+00027ef0: 7369 6f6e 206e 6f74 2069 6e20 5b27 6c61  sion not in ['la
+00027f00: 7465 7374 272c 2027 7072 652d 7265 6c65  test', 'pre-rele
+00027f10: 6173 6527 5d20 616e 6420 6e6f 7420 6973  ase'] and not is
+00027f20: 6f5f 7665 7273 696f 6e2e 7374 6172 7473  o_version.starts
+00027f30: 7769 7468 2827 342e 2729 3a0a 2020 2020  with('4.'):.    
+00027f40: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+00027f50: 696e 6728 2246 6f72 6369 6e67 206c 6976  ing("Forcing liv
+00027f60: 6520 6973 6f20 7665 7273 696f 6e20 746f  e iso version to
+00027f70: 206c 6174 6573 7422 290a 2020 2020 2020   latest").      
+00027f80: 2020 2020 2020 2020 2020 6973 6f5f 7665            iso_ve
+00027f90: 7273 696f 6e20 3d20 276c 6174 6573 7427  rsion = 'latest'
+00027fa0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00027fb0: 6620 6973 6f5f 7665 7273 696f 6e2e 7374  f iso_version.st
+00027fc0: 6172 7473 7769 7468 2827 342e 2729 3a0a  artswith('4.'):.
+00027fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027fe0: 6d69 6e6f 725f 7665 7273 696f 6e20 3d20  minor_version = 
+00027ff0: 6973 6f5f 7665 7273 696f 6e2e 7370 6c69  iso_version.spli
+00028000: 7428 272e 2729 5b31 5d0a 2020 2020 2020  t('.')[1].      
+00028010: 2020 2020 2020 2020 2020 6966 206d 696e            if min
+00028020: 6f72 5f76 6572 7369 6f6e 2e69 7364 6967  or_version.isdig
+00028030: 6974 2829 2061 6e64 2069 6e74 286d 696e  it() and int(min
+00028040: 6f72 5f76 6572 7369 6f6e 2920 3c20 363a  or_version) < 6:
+00028050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028060: 2020 2020 206d 6574 616c 5f75 726c 203d       metal_url =
+00028070: 2066 2268 7474 7073 3a2f 2f6d 6972 726f   f"https://mirro
+00028080: 722e 6f70 656e 7368 6966 742e 636f 6d2f  r.openshift.com/
+00028090: 7075 622f 6f70 656e 7368 6966 742d 7634  pub/openshift-v4
+000280a0: 2f64 6570 656e 6465 6e63 6965 732f 7268  /dependencies/rh
+000280b0: 636f 732f 7b69 736f 5f76 6572 7369 6f6e  cos/{iso_version
+000280c0: 7d2f 6c61 7465 7374 220a 2020 2020 2020  }/latest".      
+000280d0: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+000280e0: 7461 6c5f 7572 6c20 2b3d 2022 2f72 6863  tal_url += "/rhc
+000280f0: 6f73 2d6d 6574 616c 2e78 3836 5f36 342e  os-metal.x86_64.
+00028100: 7261 772e 677a 220a 2020 2020 2020 2020  raw.gz".        
+00028110: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+00028120: 696e 6728 2245 6d62 6564 6469 6e67 206d  ing("Embedding m
+00028130: 6574 616c 2075 726c 2069 6e20 6973 6f20  etal url in iso 
+00028140: 666f 7220 7461 7267 6574 2076 6572 7369  for target versi
+00028150: 6f6e 2061 6e64 2069 6e73 7461 6c6c 696e  on and installin
+00028160: 6720 7769 7468 2061 206d 6f72 6520 7265  g with a more re
+00028170: 6365 6e74 2069 736f 2229 0a20 2020 2020  cent iso").     
+00028180: 2020 2020 2020 2020 2020 2069 736f 5f76             iso_v
+00028190: 6572 7369 6f6e 203d 2027 6c61 7465 7374  ersion = 'latest
+000281a0: 270a 2020 2020 2020 2020 6170 695f 6970  '.        api_ip
+000281b0: 203d 206f 7665 7272 6964 6573 2e67 6574   = overrides.get
+000281c0: 2827 6170 695f 6970 2729 0a20 2020 2020  ('api_ip').     
+000281d0: 2020 2069 676e 6974 696f 6e5f 7665 7273     ignition_vers
+000281e0: 696f 6e20 3d20 6f76 6572 7269 6465 732e  ion = overrides.
+000281f0: 6765 7428 2769 676e 6974 696f 6e5f 7665  get('ignition_ve
+00028200: 7273 696f 6e27 2c0a 2020 2020 2020 2020  rsion',.        
+00028210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028230: 2063 6f6d 6d6f 6e2e 6967 6e69 7469 6f6e   common.ignition
+00028240: 5f76 6572 7369 6f6e 2822 7268 636f 732d  _version("rhcos-
+00028250: 2573 2220 2520 6973 6f5f 7665 7273 696f  %s" % iso_versio
+00028260: 6e2e 7265 706c 6163 6528 272e 272c 2027  n.replace('.', '
+00028270: 2729 2929 0a20 2020 2020 2020 2072 6f6c  '))).        rol
+00028280: 6520 3d20 6f76 6572 7269 6465 732e 6765  e = overrides.ge
+00028290: 7428 2772 6f6c 6527 2c20 2777 6f72 6b65  t('role', 'worke
+000282a0: 7227 290a 2020 2020 2020 2020 6973 6f20  r').        iso 
+000282b0: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+000282c0: 2769 736f 272c 2054 7275 6529 0a20 2020  'iso', True).   
+000282d0: 2020 2020 2064 6f6d 6169 6e20 3d20 6f76       domain = ov
+000282e0: 6572 7269 6465 732e 6765 7428 2764 6f6d  errides.get('dom
+000282f0: 6169 6e27 290a 2020 2020 2020 2020 6966  ain').        if
+00028300: 2027 2e27 2069 6e20 636c 7573 7465 723a   '.' in cluster:
+00028310: 0a20 2020 2020 2020 2020 2020 2064 6f6d  .            dom
+00028320: 6169 6e20 3d20 272e 272e 6a6f 696e 2863  ain = '.'.join(c
+00028330: 6c75 7374 6572 2e73 706c 6974 2827 2e27  luster.split('.'
+00028340: 295b 313a 5d29 0a20 2020 2020 2020 2020  )[1:]).         
+00028350: 2020 2070 7072 696e 7428 6622 5573 696e     pprint(f"Usin
+00028360: 6720 646f 6d61 696e 207b 646f 6d61 696e  g domain {domain
+00028370: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00028380: 636c 7573 7465 7220 3d20 636c 7573 7465  cluster = cluste
+00028390: 722e 7265 706c 6163 6528 6622 2e7b 646f  r.replace(f".{do
+000283a0: 6d61 696e 7d22 2c20 2727 290a 2020 2020  main}", '').    
+000283b0: 2020 2020 6966 2063 6c75 7374 6572 2e73      if cluster.s
+000283c0: 7461 7274 7377 6974 6828 2761 7069 2e27  tartswith('api.'
+000283d0: 293a 0a20 2020 2020 2020 2020 2020 2063  ):.            c
+000283e0: 6c75 7374 6572 203d 2063 6c75 7374 6572  luster = cluster
+000283f0: 2e72 6570 6c61 6365 2822 6170 692e 222c  .replace("api.",
+00028400: 2027 2729 0a20 2020 2020 2020 2020 2020   '').           
+00028410: 2070 7072 696e 7428 6622 5573 696e 6720   pprint(f"Using 
+00028420: 636c 7573 7465 7220 7b63 6c75 7374 6572  cluster {cluster
+00028430: 7d22 290a 2020 2020 2020 2020 686f 7374  }").        host
+00028440: 735f 636f 6e74 656e 7420 3d20 4e6f 6e65  s_content = None
+00028450: 0a20 2020 2020 2020 2066 696e 616c 6461  .        finalda
+00028460: 7461 203d 204e 6f6e 650a 2020 2020 2020  ta = None.      
+00028470: 2020 6966 2069 676e 6974 696f 6e66 696c    if ignitionfil
+00028480: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+00028490: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+000284a0: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
+000284b0: 2869 676e 6974 696f 6e66 696c 6529 3a0a  (ignitionfile):.
+000284c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000284d0: 6572 726f 7228 6622 7b69 676e 6974 696f  error(f"{ignitio
+000284e0: 6e66 696c 657d 206e 6f74 2066 6f75 6e64  nfile} not found
+000284f0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00028500: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
+00028510: 2020 2020 2020 2020 2020 2066 696e 616c             final
+00028520: 6461 7461 203d 206f 7065 6e28 6967 6e69  data = open(igni
+00028530: 7469 6f6e 6669 6c65 292e 7265 6164 2829  tionfile).read()
+00028540: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00028550: 2020 2020 2020 2020 2020 2069 676e 6974             ignit
+00028560: 696f 6e66 696c 6520 3d20 6622 7b72 6f6c  ionfile = f"{rol
+00028570: 657d 2e69 676e 220a 2020 2020 2020 2020  e}.ign".        
+00028580: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+00028590: 7869 7374 7328 6967 6e69 7469 6f6e 6669  xists(ignitionfi
+000285a0: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+000285b0: 2020 2020 2077 6172 6e69 6e67 2866 2255       warning(f"U
+000285c0: 7369 6e67 2065 7869 7374 696e 6720 7b69  sing existing {i
+000285d0: 676e 6974 696f 6e66 696c 657d 2229 0a20  gnitionfile}"). 
+000285e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000285f0: 696e 616c 6461 7461 203d 206f 7065 6e28  inaldata = open(
+00028600: 6967 6e69 7469 6f6e 6669 6c65 292e 7265  ignitionfile).re
+00028610: 6164 2829 0a20 2020 2020 2020 2020 2020  ad().           
+00028620: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00028630: 2020 2020 2020 2069 6620 6170 695f 6970         if api_ip
+00028640: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00028650: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00028660: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00028670: 2020 2020 2020 2020 2020 2061 7069 5f69             api_i
+00028680: 7020 3d20 736f 636b 6574 2e67 6574 686f  p = socket.getho
+00028690: 7374 6279 6e61 6d65 2866 2761 7069 2e7b  stbyname(f'api.{
+000286a0: 636c 7573 7465 727d 2e7b 646f 6d61 696e  cluster}.{domain
+000286b0: 7d27 290a 2020 2020 2020 2020 2020 2020  }').            
+000286c0: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
+000286d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000286e0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+000286f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00028700: 6170 695f 6970 2069 7320 4e6f 6e65 3a0a  api_ip is None:.
+00028710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028720: 2020 2020 6966 2064 6f6d 6169 6e20 6973      if domain is
+00028730: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00028740: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00028750: 7272 6f72 2822 436f 756c 646e 2774 2066  rror("Couldn't f
+00028760: 6967 7572 6520 6f75 7420 6170 695f 6970  igure out api_ip
+00028770: 206e 6f72 2072 656c 7920 6f6e 2064 6e73   nor rely on dns
+00028780: 2073 696e 6365 2064 6f6d 6169 6e20 6973   since domain is
+00028790: 206e 6f74 2073 6574 2229 0a20 2020 2020   not set").     
+000287a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000287b0: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
+000287c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000287d0: 2020 2077 6172 6e69 6e67 2822 436f 756c     warning("Coul
+000287e0: 646e 2774 2066 6967 7572 6520 6f75 7420  dn't figure out 
+000287f0: 6170 695f 6970 2e20 5265 6c79 696e 6720  api_ip. Relying 
+00028800: 6f6e 2064 6e73 2229 0a20 2020 2020 2020  on dns").       
+00028810: 2020 2020 2020 2020 2020 2020 2061 7069               api
+00028820: 5f69 7020 3d20 6622 6170 692e 7b63 6c75  _ip = f"api.{clu
+00028830: 7374 6572 7d2e 7b64 6f6d 6169 6e7d 220a  ster}.{domain}".
+00028840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028850: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00028860: 2020 2020 2020 2020 2020 686f 7374 735f            hosts_
+00028870: 636f 6e74 656e 7420 3d20 2231 3237 2e30  content = "127.0
+00028880: 2e30 2e31 2020 206c 6f63 616c 686f 7374  .0.1   localhost
+00028890: 206c 6f63 616c 686f 7374 2e6c 6f63 616c   localhost.local
+000288a0: 646f 6d61 696e 206c 6f63 616c 686f 7374  domain localhost
+000288b0: 3420 6c6f 6361 6c68 6f73 7434 2e6c 6f63  4 localhost4.loc
+000288c0: 616c 646f 6d61 696e 345c 6e22 0a20 2020  aldomain4\n".   
+000288d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000288e0: 2068 6f73 7473 5f63 6f6e 7465 6e74 202b   hosts_content +
+000288f0: 3d20 223a 3a31 2020 2020 2020 2020 206c  = "::1         l
+00028900: 6f63 616c 686f 7374 206c 6f63 616c 686f  ocalhost localho
+00028910: 7374 2e6c 6f63 616c 646f 6d61 696e 206c  st.localdomain l
+00028920: 6f63 616c 686f 7374 3620 6c6f 6361 6c68  ocalhost6 localh
+00028930: 6f73 7436 2e6c 6f63 616c 646f 6d61 696e  ost6.localdomain
+00028940: 365c 6e22 0a20 2020 2020 2020 2020 2020  6\n".           
+00028950: 2020 2020 2020 2020 2068 6f73 7473 5f63           hosts_c
+00028960: 6f6e 7465 6e74 202b 3d20 6622 7b61 7069  ontent += f"{api
+00028970: 5f69 707d 2061 7069 2d69 6e74 2e7b 636c  _ip} api-int.{cl
+00028980: 7573 7465 727d 2e7b 646f 6d61 696e 7d20  uster}.{domain} 
+00028990: 6170 692e 7b63 6c75 7374 6572 7d2e 7b64  api.{cluster}.{d
+000289a0: 6f6d 6169 6e7d 220a 2020 2020 2020 2020  omain}".        
+000289b0: 706c 616e 6469 7220 3d20 6f73 2e70 6174  plandir = os.pat
+000289c0: 682e 6469 726e 616d 6528 6f70 656e 7368  h.dirname(opensh
+000289d0: 6966 742e 6372 6561 7465 2e5f 5f63 6f64  ift.create.__cod
+000289e0: 655f 5f2e 636f 5f66 696c 656e 616d 6529  e__.co_filename)
+000289f0: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
+00028a00: 656e 2822 6973 6f2e 6967 6e22 2c20 2777  en("iso.ign", 'w
+00028a10: 2729 2061 7320 663a 0a20 2020 2020 2020  ') as f:.       
+00028a20: 2020 2020 2066 756c 6c5f 6e61 6d65 203d       full_name =
+00028a30: 2066 277b 636c 7573 7465 727d 2e7b 646f   f'{cluster}.{do
+00028a40: 6d61 696e 7d27 2069 6620 646f 6d61 696e  main}' if domain
+00028a50: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+00028a60: 6520 636c 7573 7465 720a 2020 2020 2020  e cluster.      
+00028a70: 2020 2020 2020 7070 7269 6e74 2866 2257        pprint(f"W
+00028a80: 7269 7469 6e67 2066 696c 6520 6973 6f2e  riting file iso.
+00028a90: 6967 6e20 666f 7220 7b72 6f6c 657d 2069  ign for {role} i
+00028aa0: 6e20 7b66 756c 6c5f 6e61 6d65 7d22 290a  n {full_name}").
+00028ab0: 2020 2020 2020 2020 2020 2020 6973 6f64              isod
+00028ac0: 6972 203d 206f 732e 7061 7468 2e64 6972  ir = os.path.dir
+00028ad0: 6e61 6d65 2863 6f6d 6d6f 6e2e 5f5f 6669  name(common.__fi
+00028ae0: 6c65 5f5f 290a 2020 2020 2020 2020 2020  le__).          
+00028af0: 2020 6966 2066 696e 616c 6461 7461 2069    if finaldata i
+00028b00: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00028b10: 2020 2020 2020 2020 656e 7620 3d20 456e          env = En
+00028b20: 7669 726f 6e6d 656e 7428 6c6f 6164 6572  vironment(loader
+00028b30: 3d46 696c 6553 7973 7465 6d4c 6f61 6465  =FileSystemLoade
+00028b40: 7228 6973 6f64 6972 292c 2065 7874 656e  r(isodir), exten
+00028b50: 7369 6f6e 733d 5b27 6a69 6e6a 6132 2e65  sions=['jinja2.e
+00028b60: 7874 2e64 6f27 5d2c 2074 7269 6d5f 626c  xt.do'], trim_bl
+00028b70: 6f63 6b73 3d54 7275 652c 0a20 2020 2020  ocks=True,.     
+00028b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028b90: 2020 2020 2020 2020 2020 2020 206c 7374               lst
+00028ba0: 7269 705f 626c 6f63 6b73 3d54 7275 6529  rip_blocks=True)
+00028bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028bc0: 2074 656d 706c 203d 2065 6e76 2e67 6574   templ = env.get
+00028bd0: 5f74 656d 706c 6174 6528 6f73 2e70 6174  _template(os.pat
+00028be0: 682e 6261 7365 6e61 6d65 2822 6967 6e69  h.basename("igni
+00028bf0: 7469 6f6e 2e6a 3222 2929 0a20 2020 2020  tion.j2")).     
+00028c00: 2020 2020 2020 2020 2020 2069 6620 686f             if ho
+00028c10: 7374 735f 636f 6e74 656e 7420 6973 206e  sts_content is n
+00028c20: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00028c30: 2020 2020 2020 2020 2020 2020 2068 6f73               hos
+00028c40: 7473 5f63 6f6e 7465 6e74 203d 2062 6173  ts_content = bas
+00028c50: 6536 342e 6236 3465 6e63 6f64 6528 686f  e64.b64encode(ho
+00028c60: 7374 735f 636f 6e74 656e 742e 656e 636f  sts_content.enco
+00028c70: 6465 2829 292e 6465 636f 6465 2822 5554  de()).decode("UT
+00028c80: 462d 3822 290a 2020 2020 2020 2020 2020  F-8").          
+00028c90: 2020 2020 2020 6966 2027 3a27 2069 6e20        if ':' in 
+00028ca0: 6170 695f 6970 3a20 2020 2320 4950 7636  api_ip:   # IPv6
+00028cb0: 2061 6464 7265 7373 0a20 2020 2020 2020   address.       
+00028cc0: 2020 2020 2020 2020 2020 2020 2069 676e               ign
+00028cd0: 6974 696f 6e5f 7572 6c20 3d20 6622 6874  ition_url = f"ht
+00028ce0: 7470 3a2f 2f5b 7b61 7069 5f69 707d 5d3a  tp://[{api_ip}]:
+00028cf0: 3232 3632 342f 636f 6e66 6967 2f7b 726f  22624/config/{ro
+00028d00: 6c65 7d22 0a20 2020 2020 2020 2020 2020  le}".           
+00028d10: 2020 2020 2065 6c73 653a 2020 2020 2020       else:      
+00028d20: 2020 2020 2020 2020 2023 2049 5076 3420           # IPv4 
+00028d30: 6164 6472 6573 730a 2020 2020 2020 2020  address.        
+00028d40: 2020 2020 2020 2020 2020 2020 6967 6e69              igni
+00028d50: 7469 6f6e 5f75 726c 203d 2066 2268 7474  tion_url = f"htt
+00028d60: 703a 2f2f 7b61 7069 5f69 707d 3a32 3236  p://{api_ip}:226
+00028d70: 3234 2f63 6f6e 6669 672f 7b72 6f6c 657d  24/config/{role}
+00028d80: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00028d90: 2020 6669 6e61 6c64 6174 6120 3d20 7465    finaldata = te
+00028da0: 6d70 6c2e 7265 6e64 6572 2869 676e 6974  mpl.render(ignit
+00028db0: 696f 6e5f 7572 6c3d 6967 6e69 7469 6f6e  ion_url=ignition
+00028dc0: 5f75 726c 2c20 686f 7374 735f 636f 6e74  _url, hosts_cont
+00028dd0: 656e 743d 686f 7374 735f 636f 6e74 656e  ent=hosts_conten
+00028de0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+00028df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028e00: 2020 2020 2020 2020 2020 2020 6967 6e69              igni
+00028e10: 7469 6f6e 5f76 6572 7369 6f6e 3d69 676e  tion_version=ign
+00028e20: 6974 696f 6e5f 7665 7273 696f 6e29 0a20  ition_version). 
+00028e30: 2020 2020 2020 2020 2020 2069 6620 6469             if di
+00028e40: 7265 6374 3a0a 2020 2020 2020 2020 2020  rect:.          
+00028e50: 2020 2020 2020 662e 7772 6974 6528 6669        f.write(fi
+00028e60: 6e61 6c64 6174 6129 0a20 2020 2020 2020  naldata).       
+00028e70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00028e80: 2020 2020 2020 2020 2020 205f 6669 6c65             _file
+00028e90: 7320 3d20 5b7b 2270 6174 6822 3a20 222f  s = [{"path": "/
+00028ea0: 726f 6f74 2f63 6f6e 6669 672e 6967 6e22  root/config.ign"
+00028eb0: 2c20 2263 6f6e 7465 6e74 223a 2066 696e  , "content": fin
+00028ec0: 616c 6461 7461 7d5d 0a20 2020 2020 2020  aldata}].       
+00028ed0: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
+00028ee0: 6174 682e 6578 6973 7473 2827 6973 6f2e  ath.exists('iso.
+00028ef0: 7368 2729 3a0a 2020 2020 2020 2020 2020  sh'):.          
+00028f00: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00028f10: 2822 5573 696e 6720 6c6f 6361 6c20 6973  ("Using local is
+00028f20: 6f2e 7368 2073 6372 6970 7422 290a 2020  o.sh script").  
+00028f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028f40: 2020 6973 6f73 6372 6970 7420 3d20 2769    isoscript = 'i
+00028f50: 736f 2e73 6827 0a20 2020 2020 2020 2020  so.sh'.         
+00028f60: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00028f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028f80: 2069 736f 7363 7269 7074 203d 2066 277b   isoscript = f'{
+00028f90: 706c 616e 6469 727d 2f69 736f 2e73 6827  plandir}/iso.sh'
+00028fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028fb0: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
+00028fc0: 7473 2827 6d61 6373 2e74 7874 2729 3a0a  ts('macs.txt'):.
+00028fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028fe0: 2020 2020 5f66 696c 6573 2e61 7070 656e      _files.appen
+00028ff0: 6428 7b22 7061 7468 223a 2022 2f72 6f6f  d({"path": "/roo
+00029000: 742f 6d61 6373 2e74 7874 222c 2022 6f72  t/macs.txt", "or
+00029010: 6967 696e 223a 2027 6d61 6373 2e74 7874  igin": 'macs.txt
+00029020: 277d 290a 2020 2020 2020 2020 2020 2020  '}).            
+00029030: 2020 2020 6973 6f5f 6f76 6572 7269 6465      iso_override
+00029040: 7320 3d20 7b27 7363 7269 7074 7327 3a20  s = {'scripts': 
+00029050: 5b69 736f 7363 7269 7074 5d2c 2027 6669  [isoscript], 'fi
+00029060: 6c65 7327 3a20 5f66 696c 6573 2c20 276d  les': _files, 'm
+00029070: 6574 616c 5f75 726c 273a 206d 6574 616c  etal_url': metal
+00029080: 5f75 726c 2c20 276e 6f6e 616d 6527 3a20  _url, 'noname': 
+00029090: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+000290a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000290b0: 2020 2020 2020 2027 696d 6167 6527 3a20         'image': 
+000290c0: 2772 6863 6f73 3430 3030 277d 0a20 2020  'rhcos4000'}.   
+000290d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000290e0: 6d65 7461 6c5f 7572 6c20 6973 206e 6f74  metal_url is not
+000290f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00029100: 2020 2020 2020 2020 2020 2069 736f 5f6f             iso_o
+00029110: 7665 7272 6964 6573 5b27 6e65 6564 5f6e  verrides['need_n
+00029120: 6574 776f 726b 275d 203d 2054 7275 650a  etwork'] = True.
+00029130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029140: 6973 6f5f 6f76 6572 7269 6465 732e 7570  iso_overrides.up
+00029150: 6461 7465 286f 7665 7272 6964 6573 290a  date(overrides).
+00029160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029170: 6966 2027 6e61 6d65 2720 696e 206f 7665  if 'name' in ove
+00029180: 7272 6964 6573 3a0a 2020 2020 2020 2020  rrides:.        
+00029190: 2020 2020 2020 2020 2020 2020 6973 6f5f              iso_
+000291a0: 6e61 6d65 203d 206f 7665 7272 6964 6573  name = overrides
+000291b0: 5b27 6e61 6d65 275d 0a20 2020 2020 2020  ['name'].       
+000291c0: 2020 2020 2020 2020 2020 2020 2069 736f               iso
+000291d0: 5f6f 7665 7272 6964 6573 5b27 6e6f 6e61  _overrides['nona
+000291e0: 6d65 275d 203d 2046 616c 7365 0a20 2020  me'] = False.   
+000291f0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00029200: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00029210: 2020 2020 2020 2069 736f 5f6e 616d 6520         iso_name 
+00029220: 3d20 2761 7574 6f69 6e73 7461 6c6c 6572  = 'autoinstaller
+00029230: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00029240: 2020 7265 7375 6c74 203d 2073 656c 662e    result = self.
+00029250: 6372 6561 7465 5f76 6d28 6973 6f5f 6e61  create_vm(iso_na
+00029260: 6d65 2c20 6f76 6572 7269 6465 733d 6973  me, overrides=is
+00029270: 6f5f 6f76 6572 7269 6465 732c 206f 6e6c  o_overrides, onl
+00029280: 7961 7373 6574 733d 5472 7565 290a 2020  yassets=True).  
+00029290: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000292a0: 2027 7265 6173 6f6e 2720 696e 2072 6573   'reason' in res
+000292b0: 756c 743a 0a20 2020 2020 2020 2020 2020  ult:.           
+000292c0: 2020 2020 2020 2020 2065 7272 6f72 2872           error(r
+000292d0: 6573 756c 745b 2772 6561 736f 6e27 5d29  esult['reason'])
+000292e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000292f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00029300: 2020 2020 2020 2020 2020 2066 2e77 7269             f.wri
+00029310: 7465 2872 6573 756c 745b 2764 6174 6127  te(result['data'
+00029320: 5d29 0a20 2020 2020 2020 2069 6620 6973  ]).        if is
+00029330: 6f3a 0a20 2020 2020 2020 2020 2020 2069  o:.            i
+00029340: 6620 7365 6c66 2e74 7970 6520 6e6f 7420  f self.type not 
+00029350: 696e 205b 276b 766d 272c 2027 6661 6b65  in ['kvm', 'fake
+00029360: 272c 2027 6b75 6265 7669 7274 272c 2027  ', 'kubevirt', '
+00029370: 7673 7068 6572 6527 2c20 276f 7065 6e73  vsphere', 'opens
+00029380: 7461 636b 275d 3a0a 2020 2020 2020 2020  tack']:.        
+00029390: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+000293a0: 6622 4973 6f20 6765 6e65 7261 7469 6f6e  f"Iso generation
+000293b0: 206e 6f74 2073 7570 706f 7274 6564 206f   not supported o
+000293c0: 6e20 7b73 656c 662e 7479 7065 7d22 290a  n {self.type}").
+000293d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000293e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000293f0: 2020 6973 6f5f 706f 6f6c 203d 206f 7665    iso_pool = ove
+00029400: 7272 6964 6573 2e67 6574 2827 706f 6f6c  rrides.get('pool
+00029410: 2729 206f 7220 7365 6c66 2e70 6f6f 6c0a  ') or self.pool.
+00029420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029430: 6765 6e65 7261 7465 5f72 6863 6f73 5f69  generate_rhcos_i
+00029440: 736f 2873 656c 662e 6b2c 2066 227b 636c  so(self.k, f"{cl
+00029450: 7573 7465 727d 2d7b 726f 6c65 7d22 2c20  uster}-{role}", 
+00029460: 6973 6f5f 706f 6f6c 2c20 7665 7273 696f  iso_pool, versio
+00029470: 6e3d 6973 6f5f 7665 7273 696f 6e2c 2070  n=iso_version, p
+00029480: 6f64 6d61 6e3d 706f 646d 616e 2c0a 2020  odman=podman,.  
+00029490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000294a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000294b0: 2069 6e73 7461 6c6c 6572 3d69 6e73 7461   installer=insta
+000294c0: 6c6c 6572 290a 0a20 2020 2064 6566 2063  ller)..    def c
+000294d0: 7265 6174 655f 6f70 656e 7368 6966 745f  reate_openshift_
+000294e0: 6469 7363 6f6e 6e65 6374 6564 2873 656c  disconnected(sel
+000294f0: 662c 2070 6c61 6e2c 206f 7665 7272 6964  f, plan, overrid
+00029500: 6573 3d7b 7d29 3a0a 2020 2020 2020 2020  es={}):.        
+00029510: 6461 7461 203d 206f 7665 7272 6964 6573  data = overrides
+00029520: 0a20 2020 2020 2020 2070 6c61 6e64 6972  .        plandir
+00029530: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
+00029540: 6d65 286f 7065 6e73 6869 6674 2e63 7265  me(openshift.cre
+00029550: 6174 652e 5f5f 636f 6465 5f5f 2e63 6f5f  ate.__code__.co_
+00029560: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
+00029570: 2020 636c 7573 7465 7220 3d20 6461 7461    cluster = data
+00029580: 2e67 6574 2827 636c 7573 7465 7227 2c20  .get('cluster', 
+00029590: 276d 796f 7065 6e73 6869 6674 2729 0a20  'myopenshift'). 
+000295a0: 2020 2020 2020 2075 7073 7472 6561 6d20         upstream 
+000295b0: 3d20 6461 7461 2e67 6574 2827 7570 7374  = data.get('upst
+000295c0: 7265 616d 272c 2046 616c 7365 290a 2020  ream', False).  
+000295d0: 2020 2020 2020 7665 7273 696f 6e20 3d20        version = 
+000295e0: 6461 7461 2e67 6574 2827 7665 7273 696f  data.get('versio
+000295f0: 6e27 2c20 2773 7461 626c 6527 290a 2020  n', 'stable').  
+00029600: 2020 2020 2020 7461 6720 3d20 6461 7461        tag = data
+00029610: 2e67 6574 2827 7461 6727 2c20 4f50 454e  .get('tag', OPEN
+00029620: 5348 4946 545f 5441 4729 0a20 2020 2020  SHIFT_TAG).     
+00029630: 2020 2070 7072 696e 7428 6622 5573 696e     pprint(f"Usin
+00029640: 6720 7665 7273 696f 6e20 7b76 6572 7369  g version {versi
+00029650: 6f6e 7d20 616e 6420 7461 6720 7b74 6167  on} and tag {tag
+00029660: 7d22 290a 2020 2020 2020 2020 6469 7363  }").        disc
+00029670: 6f6e 6e65 6374 6564 5f76 6d20 3d20 6622  onnected_vm = f"
+00029680: 7b63 6c75 7374 6572 7d2d 6469 7363 6f6e  {cluster}-discon
+00029690: 6e65 6374 6564 220a 2020 2020 2020 2020  nected".        
+000296a0: 6469 7363 6f6e 6e65 6374 6564 5f72 6575  disconnected_reu
+000296b0: 7365 203d 2064 6174 612e 6765 7428 2764  se = data.get('d
+000296c0: 6973 636f 6e6e 6563 7465 645f 7265 7573  isconnected_reus
+000296d0: 6527 2c20 4661 6c73 6529 0a20 2020 2020  e', False).     
+000296e0: 2020 2064 6973 636f 6e6e 6563 7465 645f     disconnected_
+000296f0: 7379 6e63 203d 2064 6174 612e 6765 7428  sync = data.get(
+00029700: 2764 6973 636f 6e6e 6563 7465 645f 7379  'disconnected_sy
+00029710: 6e63 272c 2054 7275 6529 0a20 2020 2020  nc', True).     
+00029720: 2020 2070 7072 696e 7428 6622 4465 706c     pprint(f"Depl
+00029730: 6f79 696e 6720 6469 7363 6f6e 6e65 6374  oying disconnect
+00029740: 6564 2076 6d20 7b64 6973 636f 6e6e 6563  ed vm {disconnec
+00029750: 7465 645f 766d 7d22 290a 2020 2020 2020  ted_vm}").      
+00029760: 2020 6966 2064 6973 636f 6e6e 6563 7465    if disconnecte
+00029770: 645f 7379 6e63 3a0a 2020 2020 2020 2020  d_sync:.        
+00029780: 2020 2020 7075 6c6c 5f73 6563 7265 7420      pull_secret 
+00029790: 3d20 7077 645f 7061 7468 2864 6174 612e  = pwd_path(data.
+000297a0: 6765 7428 2770 756c 6c5f 7365 6372 6574  get('pull_secret
+000297b0: 2729 2920 6966 206e 6f74 2075 7073 7472  ')) if not upstr
+000297c0: 6561 6d20 656c 7365 2066 227b 706c 616e  eam else f"{plan
+000297d0: 6469 727d 2f66 616b 655f 7075 6c6c 2e6a  dir}/fake_pull.j
+000297e0: 736f 6e22 0a20 2020 2020 2020 2020 2020  son".           
+000297f0: 2069 6620 6e6f 7420 7570 7374 7265 616d   if not upstream
+00029800: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00029810: 2020 7075 6c6c 5f73 6563 7265 7420 3d20    pull_secret = 
+00029820: 7077 645f 7061 7468 2864 6174 612e 6765  pwd_path(data.ge
+00029830: 7428 2770 756c 6c5f 7365 6372 6574 272c  t('pull_secret',
+00029840: 2027 6f70 656e 7368 6966 745f 7075 6c6c   'openshift_pull
+00029850: 2e6a 736f 6e27 2929 0a20 2020 2020 2020  .json')).       
+00029860: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00029870: 2020 2020 2020 2020 2020 2070 756c 6c5f             pull_
+00029880: 7365 6372 6574 203d 2066 227b 706c 616e  secret = f"{plan
+00029890: 6469 727d 2f66 616b 655f 7075 6c6c 2e6a  dir}/fake_pull.j
+000298a0: 736f 6e22 0a20 2020 2020 2020 2020 2020  son".           
+000298b0: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
+000298c0: 6578 6973 7473 2870 756c 6c5f 7365 6372  exists(pull_secr
+000298d0: 6574 293a 0a20 2020 2020 2020 2020 2020  et):.           
+000298e0: 2020 2020 2065 7272 6f72 2866 224d 6973       error(f"Mis
+000298f0: 7369 6e67 2070 756c 6c20 7365 6372 6574  sing pull secret
+00029900: 2066 696c 6520 7b70 756c 6c5f 7365 6372   file {pull_secr
+00029910: 6574 7d22 290a 2020 2020 2020 2020 2020  et}").          
+00029920: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
+00029930: 290a 2020 2020 2020 2020 2020 2020 6461  ).            da
+00029940: 7461 5b27 7075 6c6c 5f73 6563 7265 7427  ta['pull_secret'
+00029950: 5d20 3d20 7265 2e73 7562 2872 225c 7322  ] = re.sub(r"\s"
+00029960: 2c20 2222 2c20 6f70 656e 2870 756c 6c5f  , "", open(pull_
+00029970: 7365 6372 6574 292e 7265 6164 2829 290a  secret).read()).
+00029980: 2020 2020 2020 2020 6469 7363 6f6e 6e65          disconne
+00029990: 6374 6564 5f70 6c61 6e20 3d20 6622 7b70  cted_plan = f"{p
+000299a0: 6c61 6e7d 2d72 6575 7365 2220 6966 2064  lan}-reuse" if d
+000299b0: 6973 636f 6e6e 6563 7465 645f 7265 7573  isconnected_reus
+000299c0: 6520 656c 7365 2070 6c61 6e0a 2020 2020  e else plan.    
+000299d0: 2020 2020 6966 2076 6572 7369 6f6e 203d      if version =
+000299e0: 3d20 2763 6927 2061 6e64 2027 6469 7363  = 'ci' and 'disc
+000299f0: 6f6e 6e65 6374 6564 5f6f 7269 6769 6e27  onnected_origin'
+00029a00: 206e 6f74 2069 6e20 6f76 6572 7269 6465   not in override
+00029a10: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+00029a20: 6567 203d 2027 7265 6769 7374 7279 2e62  eg = 'registry.b
+00029a30: 7569 6c64 3031 2e63 692e 6f70 656e 7368  uild01.ci.opensh
+00029a40: 6966 742e 6f72 6727 2069 6620 7374 7228  ift.org' if str(
+00029a50: 7461 6729 2e73 7461 7274 7377 6974 6828  tag).startswith(
+00029a60: 2763 692d 2729 2065 6c73 6520 2772 6567  'ci-') else 'reg
+00029a70: 6973 7472 792e 6369 2e6f 7065 6e73 6869  istry.ci.openshi
+00029a80: 6674 2e6f 7267 270a 2020 2020 2020 2020  ft.org'.        
+00029a90: 2020 2020 7761 726e 696e 6728 6622 466f      warning(f"Fo
+00029aa0: 7263 696e 6720 6469 7363 6f6e 6e65 6374  rcing disconnect
+00029ab0: 6564 5f6f 7269 6769 6e20 746f 207b 7265  ed_origin to {re
+00029ac0: 677d 2229 0a20 2020 2020 2020 2020 2020  g}").           
+00029ad0: 2064 6174 615b 2764 6973 636f 6e6e 6563   data['disconnec
+00029ae0: 7465 645f 6f72 6967 696e 275d 203d 2072  ted_origin'] = r
+00029af0: 6567 0a20 2020 2020 2020 2072 6573 756c  eg.        resul
+00029b00: 7420 3d20 7365 6c66 2e70 6c61 6e28 6469  t = self.plan(di
+00029b10: 7363 6f6e 6e65 6374 6564 5f70 6c61 6e2c  sconnected_plan,
+00029b20: 2069 6e70 7574 6669 6c65 3d66 277b 706c   inputfile=f'{pl
+00029b30: 616e 6469 727d 2f64 6973 636f 6e6e 6563  andir}/disconnec
+00029b40: 7465 642e 796d 6c27 2c20 6f76 6572 7269  ted.yml', overri
+00029b50: 6465 733d 6461 7461 290a 2020 2020 2020  des=data).      
+00029b60: 2020 6966 2072 6573 756c 745b 2772 6573    if result['res
+00029b70: 756c 7427 5d20 213d 2027 7375 6363 6573  ult'] != 'succes
+00029b80: 7327 3a0a 2020 2020 2020 2020 2020 2020  s':.            
+00029b90: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
+00029ba0: 2020 2020 656c 6966 2064 6973 636f 6e6e      elif disconn
+00029bb0: 6563 7465 645f 7379 6e63 3a0a 2020 2020  ected_sync:.    
+00029bc0: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
+00029bd0: 5573 6520 7468 6520 666f 6c6c 6f77 696e  Use the followin
+00029be0: 6720 4f50 454e 5348 4946 545f 494e 5354  g OPENSHIFT_INST
+00029bf0: 414c 4c5f 5245 4c45 4153 455f 494d 4147  ALL_RELEASE_IMAG
+00029c00: 455f 4f56 4552 5249 4445 2229 0a20 2020  E_OVERRIDE").   
+00029c10: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
+00029c20: 6461 7461 2e67 6574 2827 6469 7363 6f6e  data.get('discon
+00029c30: 6e65 6374 6564 5f72 6575 7365 5f6e 616d  nected_reuse_nam
+00029c40: 6527 2920 6f72 2063 6c75 7374 6572 0a20  e') or cluster. 
+00029c50: 2020 2020 2020 2020 2020 2069 702c 2076             ip, v
+00029c60: 6d70 6f72 7420 3d20 5f73 7368 5f63 7265  mport = _ssh_cre
+00029c70: 6465 6e74 6961 6c73 2873 656c 662e 6b2c  dentials(self.k,
+00029c80: 2066 277b 6e61 6d65 7d2d 6469 7363 6f6e   f'{name}-discon
+00029c90: 6e65 6374 6564 2729 5b31 3a5d 0a20 2020  nected')[1:].   
+00029ca0: 2020 2020 2020 2020 2063 6d64 203d 2022           cmd = "
+00029cb0: 6361 7420 2f72 6f6f 742f 7665 7273 696f  cat /root/versio
+00029cc0: 6e2e 7478 7422 0a20 2020 2020 2020 2020  n.txt".         
+00029cd0: 2020 2073 7368 636d 6420 3d20 7373 6828     sshcmd = ssh(
+00029ce0: 6e61 6d65 2c20 6970 3d69 702c 2075 7365  name, ip=ip, use
+00029cf0: 723d 2772 6f6f 7427 2c20 7475 6e6e 656c  r='root', tunnel
+00029d00: 3d73 656c 662e 7475 6e6e 656c 2c0a 2020  =self.tunnel,.  
+00029d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029d20: 2020 2020 2020 2074 756e 6e65 6c68 6f73         tunnelhos
+00029d30: 743d 7365 6c66 2e74 756e 6e65 6c68 6f73  t=self.tunnelhos
+00029d40: 742c 2074 756e 6e65 6c70 6f72 743d 7365  t, tunnelport=se
+00029d50: 6c66 2e74 756e 6e65 6c70 6f72 742c 0a20  lf.tunnelport,. 
 00029d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029db0: 2020 2020 206e 6f74 6966 7963 6d64 2c0a       notifycmd,.
-00029dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029e20: 2020 7469 746c 6529 0a20 2020 2020 2020    title).       
-00029e30: 2020 2020 2020 2020 2020 2020 2070 6263               pbc
-00029e40: 6d64 202b 3d20 2768 7474 7073 3a2f 2f61  md += 'https://a
-00029e50: 7069 2e70 7573 6862 756c 6c65 742e 636f  pi.pushbullet.co
-00029e60: 6d2f 7632 2f70 7573 6865 7327 0a20 2020  m/v2/pushes'.   
-00029e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029e80: 2063 6d64 732e 6170 7065 6e64 2870 6263   cmds.append(pbc
-00029e90: 6d64 290a 2020 2020 2020 2020 2020 2020  md).            
-00029ea0: 656c 6966 206e 6f74 6966 796d 6574 686f  elif notifymetho
-00029eb0: 6420 3d3d 2027 736c 6163 6b27 3a0a 2020  d == 'slack':.  
-00029ec0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00029ed0: 2073 6c61 636b 6368 616e 6e65 6c20 6973   slackchannel is
-00029ee0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00029ef0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-00029f00: 6e67 2866 224e 6f74 6966 6963 6174 696f  ng(f"Notificatio
-00029f10: 6e20 7265 7175 6972 6564 2066 6f72 207b  n required for {
-00029f20: 6e61 6d65 7d20 6275 7420 6d69 7373 696e  name} but missin
-00029f30: 6720 736c 6163 6b20 6368 616e 6e65 6c22  g slack channel"
-00029f40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00029f50: 2020 656c 6966 2073 6c61 636b 746f 6b65    elif slacktoke
-00029f60: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
-00029f70: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00029f80: 6172 6e69 6e67 2866 224e 6f74 6966 6963  arning(f"Notific
-00029f90: 6174 696f 6e20 7265 7175 6972 6564 2066  ation required f
-00029fa0: 6f72 207b 6e61 6d65 7d20 6275 7420 6d69  or {name} but mi
-00029fb0: 7373 696e 6720 736c 6163 6b74 6f6b 656e  ssing slacktoken
-00029fc0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00029fd0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00029fe0: 2020 2020 2020 2020 2020 2020 2073 6c61               sla
-00029ff0: 636b 636d 6420 3d20 6622 696e 666f 3d60  ckcmd = f"info=`
-0002a000: 7b6e 6f74 6966 7963 6d64 7d20 323e 2631  {notifycmd} 2>&1
-0002a010: 207c 2073 6564 2027 732f 5c5c 7832 2f20   | sed 's/\\x2/ 
-0002a020: 2f67 2760 3b22 0a20 2020 2020 2020 2020  /g'`;".         
-0002a030: 2020 2020 2020 2020 2020 2073 6c61 636b             slack
-0002a040: 636d 6420 2b3d 2022 2222 6375 726c 202d  cmd += """curl -
-0002a050: 5820 504f 5354 202d 4820 2741 7574 686f  X POST -H 'Autho
-0002a060: 7269 7a61 7469 6f6e 3a20 4265 6172 6572  rization: Bearer
-0002a070: 2025 7327 0a20 2d48 2027 436f 6e74 656e   %s'. -H 'Conten
-0002a080: 742d 7479 7065 3a20 6170 706c 6963 6174  t-type: applicat
-0002a090: 696f 6e2f 6a73 6f6e 3b20 6368 6172 7365  ion/json; charse
-0002a0a0: 743d 7574 662d 3827 0a20 2d2d 6461 7461  t=utf-8'. --data
-0002a0b0: 2027 7b22 6368 616e 6e65 6c22 3a22 2573   '{"channel":"%s
-0002a0c0: 222c 2274 6578 7422 3a22 2573 222c 2261  ","text":"%s","a
-0002a0d0: 7474 6163 686d 656e 7473 223a 205b 7b22  ttachments": [{"
-0002a0e0: 7465 7874 223a 2227 2224 696e 666f 2227  text":"'"$info"'
-0002a0f0: 222c 2266 616c 6c62 6163 6b22 3a22 6e6f  ","fallback":"no
-0002a100: 7468 696e 6722 2c0a 2263 6f6c 6f72 223a  thing",."color":
-0002a110: 2223 3341 4133 4533 222c 2261 7474 6163  "#3AA3E3","attac
-0002a120: 686d 656e 745f 7479 7065 223a 2264 6566  hment_type":"def
-0002a130: 6175 6c74 227d 5d7d 2720 6874 7470 733a  ault"}]}' https:
-0002a140: 2f2f 736c 6163 6b2e 636f 6d2f 6170 692f  //slack.com/api/
-0002a150: 6368 6174 2e70 6f73 744d 6573 7361 6765  chat.postMessage
-0002a160: 2222 2220 2520 2873 6c61 636b 746f 6b65  """ % (slacktoke
-0002a170: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-0002a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029d70: 2020 2020 2020 2020 7475 6e6e 656c 7573          tunnelus
+00029d80: 6572 3d73 656c 662e 7475 6e6e 656c 7573  er=self.tunnelus
+00029d90: 6572 2c20 696e 7365 6375 7265 3d54 7275  er, insecure=Tru
+00029da0: 652c 2063 6d64 3d63 6d64 2c20 766d 706f  e, cmd=cmd, vmpo
+00029db0: 7274 3d76 6d70 6f72 7429 0a20 2020 2020  rt=vmport).     
+00029dc0: 2020 2020 2020 206f 732e 7379 7374 656d         os.system
+00029dd0: 2873 7368 636d 6429 0a0a 2020 2020 6465  (sshcmd)..    de
+00029de0: 6620 6861 6e64 6c65 5f66 696e 6973 6866  f handle_finishf
+00029df0: 696c 6573 2873 656c 662c 206e 616d 652c  iles(self, name,
+00029e00: 2066 696e 6973 6866 696c 6573 2c20 6964   finishfiles, id
+00029e10: 656e 7469 7479 6669 6c65 3d4e 6f6e 652c  entityfile=None,
+00029e20: 2076 6d63 6c69 656e 743d 4e6f 6e65 293a   vmclient=None):
+00029e30: 0a20 2020 2020 2020 2063 6f6e 6669 6720  .        config 
+00029e40: 3d20 4b63 6f6e 6669 6728 636c 6965 6e74  = Kconfig(client
+00029e50: 3d76 6d63 6c69 656e 7429 2069 6620 766d  =vmclient) if vm
+00029e60: 636c 6965 6e74 2069 7320 6e6f 7420 4e6f  client is not No
+00029e70: 6e65 2065 6c73 6520 7365 6c66 0a20 2020  ne else self.   
+00029e80: 2020 2020 206b 203d 2063 6f6e 6669 672e       k = config.
+00029e90: 6b0a 2020 2020 2020 2020 6375 7272 656e  k.        curren
+00029ea0: 745f 6970 203d 2063 6f6d 6d6f 6e2e 5f73  t_ip = common._s
+00029eb0: 7368 5f63 7265 6465 6e74 6961 6c73 286b  sh_credentials(k
+00029ec0: 2c20 6e61 6d65 295b 315d 0a20 2020 2020  , name)[1].     
+00029ed0: 2020 2066 6f72 2066 696e 6973 6866 696c     for finishfil
+00029ee0: 6520 696e 2066 696e 6973 6866 696c 6573  e in finishfiles
+00029ef0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00029f00: 2069 7369 6e73 7461 6e63 6528 6669 6e69   isinstance(fini
+00029f10: 7368 6669 6c65 2c20 7374 7229 3a0a 2020  shfile, str):.  
+00029f20: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00029f30: 7374 696e 6174 696f 6e20 3d20 272e 270a  stination = '.'.
+00029f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029f50: 736f 7572 6365 203d 2066 696e 6973 6866  source = finishf
+00029f60: 696c 6520 6966 2027 2f27 2069 6e20 6669  ile if '/' in fi
+00029f70: 6e69 7368 6669 6c65 2065 6c73 6520 6627  nishfile else f'
+00029f80: 2f72 6f6f 742f 7b66 696e 6973 6866 696c  /root/{finishfil
+00029f90: 657d 270a 2020 2020 2020 2020 2020 2020  e}'.            
+00029fa0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+00029fb0: 6669 6e69 7368 6669 6c65 2c20 6469 6374  finishfile, dict
+00029fc0: 2920 616e 6420 276f 7269 6769 6e27 2069  ) and 'origin' i
+00029fd0: 6e20 6669 6e69 7368 6669 6c65 2061 6e64  n finishfile and
+00029fe0: 2027 7061 7468 2720 696e 2066 696e 6973   'path' in finis
+00029ff0: 6866 696c 653a 0a20 2020 2020 2020 2020  hfile:.         
+0002a000: 2020 2020 2020 2073 6f75 7263 652c 2064         source, d
+0002a010: 6573 7469 6e61 7469 6f6e 203d 2066 696e  estination = fin
+0002a020: 6973 6866 696c 652e 6765 7428 276f 7269  ishfile.get('ori
+0002a030: 6769 6e27 292c 206f 732e 7061 7468 2e65  gin'), os.path.e
+0002a040: 7870 616e 6475 7365 7228 6669 6e69 7368  xpanduser(finish
+0002a050: 6669 6c65 2e67 6574 2827 7061 7468 272c  file.get('path',
+0002a060: 2027 2e27 2929 0a20 2020 2020 2020 2020   '.')).         
+0002a070: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0002a080: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0002a090: 2866 2249 6e63 6f72 7265 6374 2066 696e  (f"Incorrect fin
+0002a0a0: 6973 6866 696c 6520 656e 7472 7920 7b66  ishfile entry {f
+0002a0b0: 696e 6973 6866 696c 657d 2e20 536b 6970  inishfile}. Skip
+0002a0c0: 7069 6e67 2229 0a20 2020 2020 2020 2020  ping").         
+0002a0d0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+0002a0e0: 2020 2020 2020 2020 2020 2020 7363 7063              scpc
+0002a0f0: 6d64 203d 2063 6f6d 6d6f 6e2e 7363 7028  md = common.scp(
+0002a100: 6e61 6d65 2c20 6970 3d63 7572 7265 6e74  name, ip=current
+0002a110: 5f69 702c 2075 7365 723d 2772 6f6f 7427  _ip, user='root'
+0002a120: 2c20 736f 7572 6365 3d73 6f75 7263 652c  , source=source,
+0002a130: 2064 6573 7469 6e61 7469 6f6e 3d64 6573   destination=des
+0002a140: 7469 6e61 7469 6f6e 2c0a 2020 2020 2020  tination,.      
+0002a150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a160: 2020 2020 2020 2020 2020 7475 6e6e 656c            tunnel
+0002a170: 3d63 6f6e 6669 672e 7475 6e6e 656c 2c20  =config.tunnel, 
+0002a180: 7475 6e6e 656c 686f 7374 3d63 6f6e 6669  tunnelhost=confi
+0002a190: 672e 7475 6e6e 656c 686f 7374 2c20 7475  g.tunnelhost, tu
+0002a1a0: 6e6e 656c 706f 7274 3d63 6f6e 6669 672e  nnelport=config.
+0002a1b0: 7475 6e6e 656c 706f 7274 2c0a 2020 2020  tunnelport,.    
 0002a1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a1d0: 2020 736c 6163 6b63 6861 6e6e 656c 2c20    slackchannel, 
-0002a1e0: 7469 746c 6529 0a20 2020 2020 2020 2020  title).         
-0002a1f0: 2020 2020 2020 2020 2020 2073 6c61 636b             slack
-0002a200: 636d 6420 3d20 736c 6163 6b63 6d64 2e72  cmd = slackcmd.r
-0002a210: 6570 6c61 6365 2827 5c6e 272c 2027 2729  eplace('\n', '')
-0002a220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a230: 2020 2020 2063 6d64 732e 6170 7065 6e64       cmds.append
-0002a240: 2873 6c61 636b 636d 6429 0a20 2020 2020  (slackcmd).     
-0002a250: 2020 2020 2020 2065 6c69 6620 6e6f 7469         elif noti
-0002a260: 6679 6d65 7468 6f64 203d 3d20 276d 6169  fymethod == 'mai
-0002a270: 6c27 3a0a 2020 2020 2020 2020 2020 2020  l':.            
-0002a280: 2020 2020 6966 206d 6169 6c73 6572 7665      if mailserve
-0002a290: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
-0002a2a0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0002a2b0: 6172 6e69 6e67 2866 224e 6f74 6966 6963  arning(f"Notific
-0002a2c0: 6174 696f 6e20 7265 7175 6972 6564 2066  ation required f
-0002a2d0: 6f72 207b 6e61 6d65 7d20 6275 7420 6d69  or {name} but mi
-0002a2e0: 7373 696e 6720 6d61 696c 7365 7276 6572  ssing mailserver
-0002a2f0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0002a300: 2020 2065 6c69 6620 6d61 696c 6672 6f6d     elif mailfrom
-0002a310: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0002a320: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-0002a330: 726e 696e 6728 6622 4e6f 7469 6669 6361  rning(f"Notifica
-0002a340: 7469 6f6e 2072 6571 7569 7265 6420 666f  tion required fo
-0002a350: 7220 7b6e 616d 657d 2062 7574 206d 6973  r {name} but mis
-0002a360: 7369 6e67 206d 6169 6c66 726f 6d22 290a  sing mailfrom").
-0002a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a380: 656c 6966 206e 6f74 206d 6169 6c74 6f3a  elif not mailto:
-0002a390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a3a0: 2020 2020 2077 6172 6e69 6e67 2866 224e       warning(f"N
-0002a3b0: 6f74 6966 6963 6174 696f 6e20 7265 7175  otification requ
-0002a3c0: 6972 6564 2066 6f72 207b 6e61 6d65 7d20  ired for {name} 
-0002a3d0: 6275 7420 6d69 7373 696e 6720 6d61 696c  but missing mail
-0002a3e0: 746f 2229 0a20 2020 2020 2020 2020 2020  to").           
-0002a3f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0002a400: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0002a410: 6f77 203d 2064 6174 6574 696d 652e 6e6f  ow = datetime.no
-0002a420: 7728 290a 2020 2020 2020 2020 2020 2020  w().            
-0002a430: 2020 2020 2020 2020 6e6f 7720 3d20 6e6f          now = no
-0002a440: 772e 2073 7472 6674 696d 6528 2225 612c  w. strftime("%a,
-0002a450: 2564 2025 6220 2559 2025 483a 254d 3a25  %d %b %Y %H:%M:%
-0002a460: 5322 290a 2020 2020 2020 2020 2020 2020  S").            
-0002a470: 2020 2020 2020 2020 746f 7320 3d20 272c          tos = ',
-0002a480: 272e 6a6f 696e 285b 6622 3c7b 746f 7d3e  '.join([f"<{to}>
-0002a490: 2220 666f 7220 746f 2069 6e20 6d61 696c  " for to in mail
-0002a4a0: 746f 5d29 0a20 2020 2020 2020 2020 2020  to]).           
-0002a4b0: 2020 2020 2020 2020 206d 6169 6c63 6f6e           mailcon
-0002a4c0: 7465 6e74 203d 2066 2246 726f 6d3a 207b  tent = f"From: {
-0002a4d0: 6d61 696c 6672 6f6d 7d20 3c7b 6d61 696c  mailfrom} <{mail
-0002a4e0: 6672 6f6d 7d3e 5c6e 546f 3a20 7b74 6f73  from}>\nTo: {tos
-0002a4f0: 7d5c 6e44 6174 653a 207b 6e6f 777d 5c6e  }\nDate: {now}\n
-0002a500: 5375 626a 6563 743a 207b 7469 746c 657d  Subject: {title}
-0002a510: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0002a520: 2020 2020 2020 6d61 696c 636d 6420 3d20        mailcmd = 
-0002a530: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
-0002a540: 2020 2020 2020 2069 6620 6e6f 7420 636c         if not cl
-0002a550: 7573 7465 723a 0a20 2020 2020 2020 2020  uster:.         
-0002a560: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0002a570: 6169 6c63 6d64 2e61 7070 656e 6428 2774  ailcmd.append('t
-0002a580: 6573 7420 2d66 202f 6574 632f 6465 6269  est -f /etc/debi
-0002a590: 616e 5f76 6572 7369 6f6e 2026 2620 6170  an_version && ap
-0002a5a0: 742d 6765 7420 2d79 2069 6e73 7461 6c6c  t-get -y install
-0002a5b0: 2063 7572 6c27 290a 2020 2020 2020 2020   curl').        
-0002a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a5d0: 6d61 696c 636d 642e 6170 7065 6e64 2827  mailcmd.append('
-0002a5e0: 6563 686f 2022 2220 3e3e 202f 7661 722f  echo "" >> /var/
-0002a5f0: 746d 702f 6d61 696c 2e74 7874 2729 0a20  tmp/mail.txt'). 
+0002a1d0: 2020 2020 2020 2020 2020 2020 7475 6e6e              tunn
+0002a1e0: 656c 7573 6572 3d73 656c 662e 7475 6e6e  eluser=self.tunn
+0002a1f0: 656c 7573 6572 2c20 646f 776e 6c6f 6164  eluser, download
+0002a200: 3d54 7275 652c 2069 6e73 6563 7572 653d  =True, insecure=
+0002a210: 5472 7565 2c20 6964 656e 7469 7479 6669  True, identityfi
+0002a220: 6c65 3d69 6465 6e74 6974 7966 696c 6529  le=identityfile)
+0002a230: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
+0002a240: 7379 7374 656d 2873 6370 636d 6429 0a0a  system(scpcmd)..
+0002a250: 2020 2020 6465 6620 6861 6e64 6c65 5f6e      def handle_n
+0002a260: 6f74 6966 6963 6174 696f 6e73 2873 656c  otifications(sel
+0002a270: 662c 206e 616d 652c 206e 6f74 6966 796d  f, name, notifym
+0002a280: 6574 686f 6473 3d5b 5d2c 2070 7573 6862  ethods=[], pushb
+0002a290: 756c 6c65 7474 6f6b 656e 3d4e 6f6e 652c  ullettoken=None,
+0002a2a0: 206e 6f74 6966 7973 6372 6970 743d 4e6f   notifyscript=No
+0002a2b0: 6e65 2c20 6e6f 7469 6679 636d 643d 4e6f  ne, notifycmd=No
+0002a2c0: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+0002a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a2e0: 2073 6c61 636b 6368 616e 6e65 6c3d 4e6f   slackchannel=No
+0002a2f0: 6e65 2c20 736c 6163 6b74 6f6b 656e 3d4e  ne, slacktoken=N
+0002a300: 6f6e 652c 206d 6169 6c73 6572 7665 723d  one, mailserver=
+0002a310: 4e6f 6e65 2c20 6d61 696c 6672 6f6d 3d4e  None, mailfrom=N
+0002a320: 6f6e 652c 206d 6169 6c74 6f3d 4e6f 6e65  one, mailto=None
+0002a330: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002a340: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0002a350: 6c75 7374 6572 3d46 616c 7365 293a 0a20  luster=False):. 
+0002a360: 2020 2020 2020 205f 7479 7065 203d 2027         _type = '
+0002a370: 436c 7573 7465 7227 2069 6620 636c 7573  Cluster' if clus
+0002a380: 7465 7220 656c 7365 2027 566d 270a 2020  ter else 'Vm'.  
+0002a390: 2020 2020 2020 7469 746c 6520 3d20 6622        title = f"
+0002a3a0: 7b5f 7479 7065 7d20 7b6e 616d 657d 206f  {_type} {name} o
+0002a3b0: 6e20 7b73 656c 662e 636c 6965 6e74 7d20  n {self.client} 
+0002a3c0: 7265 706f 7274 220a 2020 2020 2020 2020  report".        
+0002a3d0: 636d 6473 2c20 6d61 696c 636f 6e74 656e  cmds, mailconten
+0002a3e0: 7420 3d20 5b5d 2c20 4e6f 6e65 0a20 2020  t = [], None.   
+0002a3f0: 2020 2020 2066 6f72 206e 6f74 6966 796d       for notifym
+0002a400: 6574 686f 6420 696e 2073 6f72 7465 6428  ethod in sorted(
+0002a410: 6e6f 7469 6679 6d65 7468 6f64 732c 2072  notifymethods, r
+0002a420: 6576 6572 7365 3d54 7275 6529 3a0a 2020  everse=True):.  
+0002a430: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0002a440: 6966 796d 6574 686f 6420 3d3d 2027 7075  ifymethod == 'pu
+0002a450: 7368 6275 6c6c 6574 273a 0a20 2020 2020  shbullet':.     
+0002a460: 2020 2020 2020 2020 2020 2069 6620 7075             if pu
+0002a470: 7368 6275 6c6c 6574 746f 6b65 6e20 6973  shbullettoken is
+0002a480: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0002a490: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+0002a4a0: 6e67 2866 224e 6f74 6966 6963 6174 696f  ng(f"Notificatio
+0002a4b0: 6e20 7265 7175 6972 6564 2066 6f72 207b  n required for {
+0002a4c0: 6e61 6d65 7d20 6275 7420 6d69 7373 696e  name} but missin
+0002a4d0: 6720 7075 7368 6275 6c6c 6574 746f 6b65  g pushbullettoke
+0002a4e0: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
+0002a4f0: 2020 2020 656c 6966 206e 6f74 6966 7973      elif notifys
+0002a500: 6372 6970 7420 6973 204e 6f6e 6520 616e  cript is None an
+0002a510: 6420 6e6f 7469 6679 636d 6420 6973 204e  d notifycmd is N
+0002a520: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0002a530: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+0002a540: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0002a550: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002a560: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
+0002a570: 6e20 3d20 7075 7368 6275 6c6c 6574 746f  n = pushbulletto
+0002a580: 6b65 6e0a 2020 2020 2020 2020 2020 2020  ken.            
+0002a590: 2020 2020 2020 2020 7062 636d 6420 3d20          pbcmd = 
+0002a5a0: 2763 7572 6c20 2d73 7520 2225 733a 2220  'curl -su "%s:" 
+0002a5b0: 2d64 2074 7970 653d 226e 6f74 6522 202d  -d type="note" -
+0002a5c0: 6420 626f 6479 3d22 6025 7320 323e 2631  d body="`%s 2>&1
+0002a5d0: 6022 202d 6420 7469 746c 653d 2225 7322  `" -d title="%s"
+0002a5e0: 2027 2025 2028 746f 6b65 6e2c 0a20 2020   ' % (token,.   
+0002a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0002a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a610: 2020 206d 6169 6c63 6d64 2e61 7070 656e     mailcmd.appen
-0002a620: 6428 6627 7b6e 6f74 6966 7963 6d64 7d20  d(f'{notifycmd} 
-0002a630: 323e 2631 203e 3e20 2f76 6172 2f74 6d70  2>&1 >> /var/tmp
-0002a640: 2f6d 6169 6c2e 7478 7427 290a 2020 2020  /mail.txt').    
-0002a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a660: 6375 726c 636d 6420 3d20 6622 6375 726c  curlcmd = f"curl
-0002a670: 202d 2d73 696c 656e 7420 2d2d 7572 6c20   --silent --url 
-0002a680: 736d 7470 3a2f 2f7b 6d61 696c 7365 7276  smtp://{mailserv
-0002a690: 6572 7d3a 3235 202d 2d6d 6169 6c2d 6672  er}:25 --mail-fr
-0002a6a0: 6f6d 207b 6d61 696c 6672 6f6d 7d22 0a20  om {mailfrom}". 
-0002a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a6c0: 2020 2066 6f72 2061 6464 7265 7373 2069     for address i
-0002a6d0: 6e20 6d61 696c 746f 3a0a 2020 2020 2020  n mailto:.      
-0002a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a6f0: 2020 6375 726c 636d 6420 2b3d 2066 2220    curlcmd += f" 
-0002a700: 2d2d 6d61 696c 2d72 6370 7420 7b61 6464  --mail-rcpt {add
-0002a710: 7265 7373 7d20 220a 2020 2020 2020 2020  ress} ".        
-0002a720: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0002a730: 6c75 7374 6572 3a0a 2020 2020 2020 2020  luster:.        
-0002a740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a750: 6d61 696c 636f 6e74 656e 7420 3d20 2222  mailcontent = ""
-0002a760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a770: 2020 2020 2020 2020 206b 7562 6563 6f6e           kubecon
-0002a780: 6669 6720 3d20 6627 2f65 7463 2f6b 7562  fig = f'/etc/kub
-0002a790: 6572 6e65 7465 732f 6b75 6265 636f 6e66  ernetes/kubeconf
-0002a7a0: 6967 2e7b 6e61 6d65 7d27 0a20 2020 2020  ig.{name}'.     
-0002a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a7c0: 2020 2063 7572 6c63 6d64 202b 3d20 6627     curlcmd += f'
-0002a7d0: 202d 4820 2253 7562 6a65 6374 3a20 7b74   -H "Subject: {t
-0002a7e0: 6974 6c65 7d22 202d 4820 2246 726f 6d3a  itle}" -H "From:
-0002a7f0: 207b 6d61 696c 6672 6f6d 7d20 3c7b 6d61   {mailfrom} <{ma
-0002a800: 696c 6672 6f6d 7d3e 2227 0a20 2020 2020  ilfrom}>"'.     
-0002a810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a820: 2020 2066 6f72 2061 6464 7265 7373 2069     for address i
-0002a830: 6e20 6d61 696c 746f 3a0a 2020 2020 2020  n mailto:.      
-0002a840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a850: 2020 2020 2020 6375 726c 636d 6420 2b3d        curlcmd +=
-0002a860: 2066 2720 2d48 2022 546f 3a20 7b61 6464   f' -H "To: {add
-0002a870: 7265 7373 7d20 3c7b 6164 6472 6573 737d  ress} <{address}
-0002a880: 3e22 270a 2020 2020 2020 2020 2020 2020  >"'.            
-0002a890: 2020 2020 2020 2020 2020 2020 6375 726c              curl
-0002a8a0: 636d 6420 2b3d 2027 202d 4620 223d 283b  cmd += ' -F "=(;
-0002a8b0: 7479 7065 3d6d 756c 7469 7061 7274 2f6d  type=multipart/m
-0002a8c0: 6978 6564 2220 2d46 2022 3d24 2863 6174  ixed" -F "=$(cat
-0002a8d0: 202f 7661 722f 746d 702f 6d61 696c 2e74   /var/tmp/mail.t
-0002a8e0: 7874 293b 7479 7065 3d74 6578 742f 706c  xt);type=text/pl
-0002a8f0: 6169 6e22 270a 2020 2020 2020 2020 2020  ain"'.          
-0002a900: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0002a910: 726c 636d 6420 2b3d 2066 2720 2d46 2022  rlcmd += f' -F "
-0002a920: 6669 6c65 3d40 7b6b 7562 6563 6f6e 6669  file=@{kubeconfi
-0002a930: 677d 3b74 7970 653d 7465 7874 2f70 6c61  g};type=text/pla
-0002a940: 696e 3b65 6e63 6f64 6572 3d62 6173 6536  in;encoder=base6
-0002a950: 3422 202d 4620 223d 2922 270a 2020 2020  4" -F "=)"'.    
-0002a960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a970: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0002a980: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0002a990: 726c 636d 6420 2b3d 2022 202d 2d75 706c  rlcmd += " --upl
-0002a9a0: 6f61 642d 6669 6c65 202f 7661 722f 746d  oad-file /var/tm
-0002a9b0: 702f 6d61 696c 2e74 7874 220a 2020 2020  p/mail.txt".    
-0002a9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a9d0: 6d61 696c 636d 642e 6170 7065 6e64 2863  mailcmd.append(c
-0002a9e0: 7572 6c63 6d64 290a 2020 2020 2020 2020  urlcmd).        
-0002a9f0: 2020 2020 2020 2020 2020 2020 636d 6473              cmds
-0002aa00: 2e65 7874 656e 6428 6d61 696c 636d 6429  .extend(mailcmd)
-0002aa10: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0002aa20: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002aa30: 2020 2065 7272 6f72 2866 2249 6e76 616c     error(f"Inval
-0002aa40: 6964 206d 6574 686f 6420 7b6e 6f74 6966  id method {notif
-0002aa50: 796d 6574 686f 647d 2229 0a20 2020 2020  ymethod}").     
-0002aa60: 2020 2072 6574 7572 6e20 636d 6473 2c20     return cmds, 
-0002aa70: 6d61 696c 636f 6e74 656e 740a 0a20 2020  mailcontent..   
-0002aa80: 2064 6566 2068 616e 646c 655f 766d 5f72   def handle_vm_r
-0002aa90: 6573 756c 7428 7365 6c66 2c20 6e61 6d65  esult(self, name
-0002aaa0: 2c20 7072 6f66 696c 652c 2072 6573 756c  , profile, resul
-0002aab0: 742c 206e 6577 766d 732c 2066 6169 6c65  t, newvms, faile
-0002aac0: 6476 6d73 2c20 6173 796e 6377 6169 7476  dvms, asyncwaitv
-0002aad0: 6d73 2c20 6f6e 6c79 6173 7365 7473 3d46  ms, onlyassets=F
-0002aae0: 616c 7365 2c20 6e65 7761 7373 6574 733d  alse, newassets=
-0002aaf0: 5b5d 2c0a 2020 2020 2020 2020 2020 2020  [],.            
-0002ab00: 2020 2020 2020 2020 2020 2020 2076 6d63               vmc
-0002ab10: 6c69 656e 743d 4e6f 6e65 293a 0a20 2020  lient=None):.   
-0002ab20: 2020 2020 2069 6620 2772 6573 756c 7427       if 'result'
-0002ab30: 2069 6e20 7265 7375 6c74 2061 6e64 2072   in result and r
-0002ab40: 6573 756c 745b 2772 6573 756c 7427 5d20  esult['result'] 
-0002ab50: 3d3d 2027 7375 6363 6573 7327 3a0a 2020  == 'success':.  
-0002ab60: 2020 2020 2020 2020 2020 6e65 7776 6d73            newvms
-0002ab70: 2e61 7070 656e 6428 6e61 6d65 290a 2020  .append(name).  
-0002ab80: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0002ab90: 2020 2020 2020 2020 6661 696c 6564 766d          failedvm
-0002aba0: 732e 6170 7065 6e64 287b 276e 616d 6527  s.append({'name'
-0002abb0: 3a20 6e61 6d65 2c20 2772 6561 736f 6e27  : name, 'reason'
-0002abc0: 3a20 7265 7375 6c74 5b27 7265 6173 6f6e  : result['reason
-0002abd0: 275d 7d29 0a20 2020 2020 2020 2073 7461  ']}).        sta
-0002abe0: 7274 203d 2070 726f 6669 6c65 2e67 6574  rt = profile.get
-0002abf0: 2827 7374 6172 7427 2c20 5472 7565 290a  ('start', True).
-0002ac00: 2020 2020 2020 2020 636c 6f75 6469 6e69          cloudini
-0002ac10: 7420 3d20 7072 6f66 696c 652e 6765 7428  t = profile.get(
-0002ac20: 2763 6c6f 7564 696e 6974 272c 2054 7275  'cloudinit', Tru
-0002ac30: 6529 0a20 2020 2020 2020 2061 7379 6e63  e).        async
-0002ac40: 7761 6974 203d 2070 726f 6669 6c65 2e67  wait = profile.g
-0002ac50: 6574 2827 6173 796e 6377 6169 7427 2c20  et('asyncwait', 
-0002ac60: 4661 6c73 6529 0a20 2020 2020 2020 2066  False).        f
-0002ac70: 696e 6973 6866 696c 6573 203d 2070 726f  inishfiles = pro
-0002ac80: 6669 6c65 2e67 6574 2827 6669 6e69 7368  file.get('finish
-0002ac90: 6669 6c65 7327 2c20 5b5d 290a 2020 2020  files', []).    
-0002aca0: 2020 2020 6966 206f 6e6c 7961 7373 6574      if onlyasset
-0002acb0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-0002acc0: 6620 2764 6174 6127 2069 6e20 7265 7375  f 'data' in resu
-0002acd0: 6c74 3a0a 2020 2020 2020 2020 2020 2020  lt:.            
-0002ace0: 2020 2020 6e65 7761 7373 6574 732e 6170      newassets.ap
-0002acf0: 7065 6e64 2872 6573 756c 745b 2764 6174  pend(result['dat
-0002ad00: 6127 5d29 0a20 2020 2020 2020 2020 2020  a']).           
-0002ad10: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0002ad20: 2020 2020 2020 2065 7272 6f72 2872 6573         error(res
-0002ad30: 756c 745b 2772 6561 736f 6e27 5d29 0a20  ult['reason']). 
-0002ad40: 2020 2020 2020 2069 6620 6e6f 7420 6173         if not as
-0002ad50: 796e 6377 6169 743a 0a20 2020 2020 2020  yncwait:.       
-0002ad60: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-0002ad70: 2020 2020 656c 6966 206e 6f74 2073 7461      elif not sta
-0002ad80: 7274 206f 7220 6e6f 7420 636c 6f75 6469  rt or not cloudi
-0002ad90: 6e69 7420 6f72 2070 726f 6669 6c65 2e67  nit or profile.g
-0002ada0: 6574 2827 696d 6167 6527 2920 6973 204e  et('image') is N
-0002adb0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0002adc0: 2070 7072 696e 7428 6622 536b 6970 7069   pprint(f"Skippi
-0002add0: 6e67 2077 6169 7420 6f6e 207b 6e61 6d65  ng wait on {name
-0002ade0: 7d22 290a 2020 2020 2020 2020 656c 7365  }").        else
-0002adf0: 3a0a 2020 2020 2020 2020 2020 2020 7761  :.            wa
-0002ae00: 6974 636f 6d6d 616e 6420 3d20 7072 6f66  itcommand = prof
-0002ae10: 696c 652e 6765 7428 2777 6169 7463 6f6d  ile.get('waitcom
-0002ae20: 6d61 6e64 2729 0a20 2020 2020 2020 2020  mand').         
-0002ae30: 2020 2077 6169 7474 696d 656f 7574 203d     waittimeout =
-0002ae40: 2070 726f 6669 6c65 2e67 6574 2827 7761   profile.get('wa
-0002ae50: 6974 7469 6d65 6f75 7427 2c20 3029 0a20  ittimeout', 0). 
-0002ae60: 2020 2020 2020 2020 2020 2061 7379 6e63             async
-0002ae70: 7761 6974 766d 203d 207b 276e 616d 6527  waitvm = {'name'
-0002ae80: 3a20 6e61 6d65 2c20 2766 696e 6973 6866  : name, 'finishf
-0002ae90: 696c 6573 273a 2066 696e 6973 6866 696c  iles': finishfil
-0002aea0: 6573 2c20 2777 6169 7463 6f6d 6d61 6e64  es, 'waitcommand
-0002aeb0: 273a 2077 6169 7463 6f6d 6d61 6e64 2c0a  ': waitcommand,.
-0002aec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002aed0: 2020 2020 2020 2020 2020 2027 7761 6974             'wait
-0002aee0: 7469 6d65 6f75 7427 3a20 7761 6974 7469  timeout': waitti
-0002aef0: 6d65 6f75 742c 2027 766d 636c 6965 6e74  meout, 'vmclient
-0002af00: 273a 2076 6d63 6c69 656e 747d 0a20 2020  ': vmclient}.   
-0002af10: 2020 2020 2020 2020 2061 7379 6e63 7761           asyncwa
-0002af20: 6974 766d 732e 6170 7065 6e64 2861 7379  itvms.append(asy
-0002af30: 6e63 7761 6974 766d 290a 0a20 2020 2064  ncwaitvm)..    d
-0002af40: 6566 2074 6872 6561 6465 645f 6372 6561  ef threaded_crea
-0002af50: 7465 5f76 6d28 7365 6c66 2c20 6e61 6d65  te_vm(self, name
-0002af60: 2c20 7072 6f66 696c 656e 616d 652c 2063  , profilename, c
-0002af70: 7572 7265 6e74 6f76 6572 7269 6465 732c  urrentoverrides,
-0002af80: 2070 726f 6669 6c65 2c20 7a2c 2070 6c61   profile, z, pla
-0002af90: 6e2c 2063 7572 7265 6e74 706c 616e 6469  n, currentplandi
-0002afa0: 722c 2076 6d63 6c69 656e 742c 0a20 2020  r, vmclient,.   
-0002afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002afc0: 2020 2020 2020 2020 6f6e 666c 792c 206f          onfly, o
-0002afd0: 6e6c 7961 7373 6574 732c 206e 6577 766d  nlyassets, newvm
-0002afe0: 732c 2066 6169 6c65 6476 6d73 2c20 6173  s, failedvms, as
-0002aff0: 796e 6377 6169 7476 6d73 2c20 6e65 7761  yncwaitvms, newa
-0002b000: 7373 6574 7329 3a0a 2020 2020 2020 2020  ssets):.        
-0002b010: 7265 7375 6c74 203d 2073 656c 662e 6372  result = self.cr
-0002b020: 6561 7465 5f76 6d28 6e61 6d65 2c20 7072  eate_vm(name, pr
-0002b030: 6f66 696c 656e 616d 652c 206f 7665 7272  ofilename, overr
-0002b040: 6964 6573 3d63 7572 7265 6e74 6f76 6572  ides=currentover
-0002b050: 7269 6465 732c 2063 7573 746f 6d70 726f  rides, custompro
-0002b060: 6669 6c65 3d70 726f 6669 6c65 2c20 6b3d  file=profile, k=
-0002b070: 7a2c 0a20 2020 2020 2020 2020 2020 2020  z,.             
-0002b080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b090: 2020 2070 6c61 6e3d 706c 616e 2c20 6261     plan=plan, ba
-0002b0a0: 7365 6469 723d 6375 7272 656e 7470 6c61  sedir=currentpla
-0002b0b0: 6e64 6972 2c20 636c 6965 6e74 3d76 6d63  ndir, client=vmc
-0002b0c0: 6c69 656e 742c 206f 6e66 6c79 3d6f 6e66  lient, onfly=onf
-0002b0d0: 6c79 2c0a 2020 2020 2020 2020 2020 2020  ly,.            
+0002a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a640: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0002a650: 6f74 6966 7963 6d64 2c0a 2020 2020 2020  otifycmd,.      
+0002a660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a6b0: 2020 2020 2020 2020 2020 2020 7469 746c              titl
+0002a6c0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0002a6d0: 2020 2020 2020 2070 6263 6d64 202b 3d20         pbcmd += 
+0002a6e0: 2768 7474 7073 3a2f 2f61 7069 2e70 7573  'https://api.pus
+0002a6f0: 6862 756c 6c65 742e 636f 6d2f 7632 2f70  hbullet.com/v2/p
+0002a700: 7573 6865 7327 0a20 2020 2020 2020 2020  ushes'.         
+0002a710: 2020 2020 2020 2020 2020 2063 6d64 732e             cmds.
+0002a720: 6170 7065 6e64 2870 6263 6d64 290a 2020  append(pbcmd).  
+0002a730: 2020 2020 2020 2020 2020 656c 6966 206e            elif n
+0002a740: 6f74 6966 796d 6574 686f 6420 3d3d 2027  otifymethod == '
+0002a750: 736c 6163 6b27 3a0a 2020 2020 2020 2020  slack':.        
+0002a760: 2020 2020 2020 2020 6966 2073 6c61 636b          if slack
+0002a770: 6368 616e 6e65 6c20 6973 204e 6f6e 653a  channel is None:
+0002a780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a790: 2020 2020 2077 6172 6e69 6e67 2866 224e       warning(f"N
+0002a7a0: 6f74 6966 6963 6174 696f 6e20 7265 7175  otification requ
+0002a7b0: 6972 6564 2066 6f72 207b 6e61 6d65 7d20  ired for {name} 
+0002a7c0: 6275 7420 6d69 7373 696e 6720 736c 6163  but missing slac
+0002a7d0: 6b20 6368 616e 6e65 6c22 290a 2020 2020  k channel").    
+0002a7e0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0002a7f0: 2073 6c61 636b 746f 6b65 6e20 6973 204e   slacktoken is N
+0002a800: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0002a810: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0002a820: 2866 224e 6f74 6966 6963 6174 696f 6e20  (f"Notification 
+0002a830: 7265 7175 6972 6564 2066 6f72 207b 6e61  required for {na
+0002a840: 6d65 7d20 6275 7420 6d69 7373 696e 6720  me} but missing 
+0002a850: 736c 6163 6b74 6f6b 656e 2229 0a20 2020  slacktoken").   
+0002a860: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0002a870: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002a880: 2020 2020 2020 2073 6c61 636b 636d 6420         slackcmd 
+0002a890: 3d20 6622 696e 666f 3d60 7b6e 6f74 6966  = f"info=`{notif
+0002a8a0: 7963 6d64 7d20 323e 2631 207c 2073 6564  ycmd} 2>&1 | sed
+0002a8b0: 2027 732f 5c5c 7832 2f20 2f67 2760 3b22   's/\\x2/ /g'`;"
+0002a8c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a8d0: 2020 2020 2073 6c61 636b 636d 6420 2b3d       slackcmd +=
+0002a8e0: 2022 2222 6375 726c 202d 5820 504f 5354   """curl -X POST
+0002a8f0: 202d 4820 2741 7574 686f 7269 7a61 7469   -H 'Authorizati
+0002a900: 6f6e 3a20 4265 6172 6572 2025 7327 0a20  on: Bearer %s'. 
+0002a910: 2d48 2027 436f 6e74 656e 742d 7479 7065  -H 'Content-type
+0002a920: 3a20 6170 706c 6963 6174 696f 6e2f 6a73  : application/js
+0002a930: 6f6e 3b20 6368 6172 7365 743d 7574 662d  on; charset=utf-
+0002a940: 3827 0a20 2d2d 6461 7461 2027 7b22 6368  8'. --data '{"ch
+0002a950: 616e 6e65 6c22 3a22 2573 222c 2274 6578  annel":"%s","tex
+0002a960: 7422 3a22 2573 222c 2261 7474 6163 686d  t":"%s","attachm
+0002a970: 656e 7473 223a 205b 7b22 7465 7874 223a  ents": [{"text":
+0002a980: 2227 2224 696e 666f 2227 222c 2266 616c  "'"$info"'","fal
+0002a990: 6c62 6163 6b22 3a22 6e6f 7468 696e 6722  lback":"nothing"
+0002a9a0: 2c0a 2263 6f6c 6f72 223a 2223 3341 4133  ,."color":"#3AA3
+0002a9b0: 4533 222c 2261 7474 6163 686d 656e 745f  E3","attachment_
+0002a9c0: 7479 7065 223a 2264 6566 6175 6c74 227d  type":"default"}
+0002a9d0: 5d7d 2720 6874 7470 733a 2f2f 736c 6163  ]}' https://slac
+0002a9e0: 6b2e 636f 6d2f 6170 692f 6368 6174 2e70  k.com/api/chat.p
+0002a9f0: 6f73 744d 6573 7361 6765 2222 2220 2520  ostMessage""" % 
+0002aa00: 2873 6c61 636b 746f 6b65 6e2c 0a20 2020  (slacktoken,.   
+0002aa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aa60: 2020 2020 2020 2020 2020 2020 736c 6163              slac
+0002aa70: 6b63 6861 6e6e 656c 2c20 7469 746c 6529  kchannel, title)
+0002aa80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002aa90: 2020 2020 2073 6c61 636b 636d 6420 3d20       slackcmd = 
+0002aaa0: 736c 6163 6b63 6d64 2e72 6570 6c61 6365  slackcmd.replace
+0002aab0: 2827 5c6e 272c 2027 2729 0a20 2020 2020  ('\n', '').     
+0002aac0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0002aad0: 6d64 732e 6170 7065 6e64 2873 6c61 636b  mds.append(slack
+0002aae0: 636d 6429 0a20 2020 2020 2020 2020 2020  cmd).           
+0002aaf0: 2065 6c69 6620 6e6f 7469 6679 6d65 7468   elif notifymeth
+0002ab00: 6f64 203d 3d20 276d 6169 6c27 3a0a 2020  od == 'mail':.  
+0002ab10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0002ab20: 206d 6169 6c73 6572 7665 7220 6973 204e   mailserver is N
+0002ab30: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0002ab40: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0002ab50: 2866 224e 6f74 6966 6963 6174 696f 6e20  (f"Notification 
+0002ab60: 7265 7175 6972 6564 2066 6f72 207b 6e61  required for {na
+0002ab70: 6d65 7d20 6275 7420 6d69 7373 696e 6720  me} but missing 
+0002ab80: 6d61 696c 7365 7276 6572 2229 0a20 2020  mailserver").   
+0002ab90: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+0002aba0: 6620 6d61 696c 6672 6f6d 2069 7320 4e6f  f mailfrom is No
+0002abb0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0002abc0: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+0002abd0: 6622 4e6f 7469 6669 6361 7469 6f6e 2072  f"Notification r
+0002abe0: 6571 7569 7265 6420 666f 7220 7b6e 616d  equired for {nam
+0002abf0: 657d 2062 7574 206d 6973 7369 6e67 206d  e} but missing m
+0002ac00: 6169 6c66 726f 6d22 290a 2020 2020 2020  ailfrom").      
+0002ac10: 2020 2020 2020 2020 2020 656c 6966 206e            elif n
+0002ac20: 6f74 206d 6169 6c74 6f3a 0a20 2020 2020  ot mailto:.     
+0002ac30: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0002ac40: 6172 6e69 6e67 2866 224e 6f74 6966 6963  arning(f"Notific
+0002ac50: 6174 696f 6e20 7265 7175 6972 6564 2066  ation required f
+0002ac60: 6f72 207b 6e61 6d65 7d20 6275 7420 6d69  or {name} but mi
+0002ac70: 7373 696e 6720 6d61 696c 746f 2229 0a20  ssing mailto"). 
+0002ac80: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0002ac90: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0002aca0: 2020 2020 2020 2020 206e 6f77 203d 2064           now = d
+0002acb0: 6174 6574 696d 652e 6e6f 7728 290a 2020  atetime.now().  
+0002acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002acd0: 2020 6e6f 7720 3d20 6e6f 772e 2073 7472    now = now. str
+0002ace0: 6674 696d 6528 2225 612c 2564 2025 6220  ftime("%a,%d %b 
+0002acf0: 2559 2025 483a 254d 3a25 5322 290a 2020  %Y %H:%M:%S").  
+0002ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ad10: 2020 746f 7320 3d20 272c 272e 6a6f 696e    tos = ','.join
+0002ad20: 285b 6622 3c7b 746f 7d3e 2220 666f 7220  ([f"<{to}>" for 
+0002ad30: 746f 2069 6e20 6d61 696c 746f 5d29 0a20  to in mailto]). 
+0002ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ad50: 2020 206d 6169 6c63 6f6e 7465 6e74 203d     mailcontent =
+0002ad60: 2066 2246 726f 6d3a 207b 6d61 696c 6672   f"From: {mailfr
+0002ad70: 6f6d 7d20 3c7b 6d61 696c 6672 6f6d 7d3e  om} <{mailfrom}>
+0002ad80: 5c6e 546f 3a20 7b74 6f73 7d5c 6e44 6174  \nTo: {tos}\nDat
+0002ad90: 653a 207b 6e6f 777d 5c6e 5375 626a 6563  e: {now}\nSubjec
+0002ada0: 743a 207b 7469 746c 657d 220a 2020 2020  t: {title}".    
+0002adb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002adc0: 6d61 696c 636d 6420 3d20 5b5d 0a20 2020  mailcmd = [].   
+0002add0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ade0: 2069 6620 6e6f 7420 636c 7573 7465 723a   if not cluster:
+0002adf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002ae00: 2020 2020 2020 2020 206d 6169 6c63 6d64           mailcmd
+0002ae10: 2e61 7070 656e 6428 2774 6573 7420 2d66  .append('test -f
+0002ae20: 202f 6574 632f 6465 6269 616e 5f76 6572   /etc/debian_ver
+0002ae30: 7369 6f6e 2026 2620 6170 742d 6765 7420  sion && apt-get 
+0002ae40: 2d79 2069 6e73 7461 6c6c 2063 7572 6c27  -y install curl'
+0002ae50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002ae60: 2020 2020 2020 2020 2020 6d61 696c 636d            mailcm
+0002ae70: 642e 6170 7065 6e64 2827 6563 686f 2022  d.append('echo "
+0002ae80: 2220 3e3e 202f 7661 722f 746d 702f 6d61  " >> /var/tmp/ma
+0002ae90: 696c 2e74 7874 2729 0a20 2020 2020 2020  il.txt').       
+0002aea0: 2020 2020 2020 2020 2020 2020 206d 6169               mai
+0002aeb0: 6c63 6d64 2e61 7070 656e 6428 6627 7b6e  lcmd.append(f'{n
+0002aec0: 6f74 6966 7963 6d64 7d20 323e 2631 203e  otifycmd} 2>&1 >
+0002aed0: 3e20 2f76 6172 2f74 6d70 2f6d 6169 6c2e  > /var/tmp/mail.
+0002aee0: 7478 7427 290a 2020 2020 2020 2020 2020  txt').          
+0002aef0: 2020 2020 2020 2020 2020 6375 726c 636d            curlcm
+0002af00: 6420 3d20 6622 6375 726c 202d 2d73 696c  d = f"curl --sil
+0002af10: 656e 7420 2d2d 7572 6c20 736d 7470 3a2f  ent --url smtp:/
+0002af20: 2f7b 6d61 696c 7365 7276 6572 7d3a 3235  /{mailserver}:25
+0002af30: 202d 2d6d 6169 6c2d 6672 6f6d 207b 6d61   --mail-from {ma
+0002af40: 696c 6672 6f6d 7d22 0a20 2020 2020 2020  ilfrom}".       
+0002af50: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0002af60: 2061 6464 7265 7373 2069 6e20 6d61 696c   address in mail
+0002af70: 746f 3a0a 2020 2020 2020 2020 2020 2020  to:.            
+0002af80: 2020 2020 2020 2020 2020 2020 6375 726c              curl
+0002af90: 636d 6420 2b3d 2066 2220 2d2d 6d61 696c  cmd += f" --mail
+0002afa0: 2d72 6370 7420 7b61 6464 7265 7373 7d20  -rcpt {address} 
+0002afb0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0002afc0: 2020 2020 2020 6966 2063 6c75 7374 6572        if cluster
+0002afd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002afe0: 2020 2020 2020 2020 2020 6d61 696c 636f            mailco
+0002aff0: 6e74 656e 7420 3d20 2222 0a20 2020 2020  ntent = "".     
+0002b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b010: 2020 206b 7562 6563 6f6e 6669 6720 3d20     kubeconfig = 
+0002b020: 6627 2f65 7463 2f6b 7562 6572 6e65 7465  f'/etc/kubernete
+0002b030: 732f 6b75 6265 636f 6e66 6967 2e7b 6e61  s/kubeconfig.{na
+0002b040: 6d65 7d27 0a20 2020 2020 2020 2020 2020  me}'.           
+0002b050: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+0002b060: 6c63 6d64 202b 3d20 6627 202d 4820 2253  lcmd += f' -H "S
+0002b070: 7562 6a65 6374 3a20 7b74 6974 6c65 7d22  ubject: {title}"
+0002b080: 202d 4820 2246 726f 6d3a 207b 6d61 696c   -H "From: {mail
+0002b090: 6672 6f6d 7d20 3c7b 6d61 696c 6672 6f6d  from} <{mailfrom
+0002b0a0: 7d3e 2227 0a20 2020 2020 2020 2020 2020  }>"'.           
+0002b0b0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0002b0c0: 2061 6464 7265 7373 2069 6e20 6d61 696c   address in mail
+0002b0d0: 746f 3a0a 2020 2020 2020 2020 2020 2020  to:.            
 0002b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b0f0: 2020 2020 6f6e 6c79 6173 7365 7473 3d6f      onlyassets=o
-0002b100: 6e6c 7961 7373 6574 7329 0a20 2020 2020  nlyassets).     
-0002b110: 2020 2069 6620 6e6f 7420 6f6e 6c79 6173     if not onlyas
-0002b120: 7365 7473 3a0a 2020 2020 2020 2020 2020  sets:.          
-0002b130: 2020 636f 6d6d 6f6e 2e68 616e 646c 655f    common.handle_
-0002b140: 7265 7370 6f6e 7365 2872 6573 756c 742c  response(result,
-0002b150: 206e 616d 652c 2063 6c69 656e 743d 766d   name, client=vm
-0002b160: 636c 6965 6e74 290a 2020 2020 2020 2020  client).        
-0002b170: 7365 6c66 2e68 616e 646c 655f 766d 5f72  self.handle_vm_r
-0002b180: 6573 756c 7428 6e61 6d65 2c20 7072 6f66  esult(name, prof
-0002b190: 696c 652c 2072 6573 756c 743d 7265 7375  ile, result=resu
-0002b1a0: 6c74 2c20 6e65 7776 6d73 3d6e 6577 766d  lt, newvms=newvm
-0002b1b0: 732c 2066 6169 6c65 6476 6d73 3d66 6169  s, failedvms=fai
-0002b1c0: 6c65 6476 6d73 2c0a 2020 2020 2020 2020  ledvms,.        
-0002b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b1e0: 2020 2020 2020 6173 796e 6377 6169 7476        asyncwaitv
-0002b1f0: 6d73 3d61 7379 6e63 7761 6974 766d 732c  ms=asyncwaitvms,
-0002b200: 206f 6e6c 7961 7373 6574 733d 6f6e 6c79   onlyassets=only
-0002b210: 6173 7365 7473 2c20 6e65 7761 7373 6574  assets, newasset
-0002b220: 733d 6e65 7761 7373 6574 732c 2076 6d63  s=newassets, vmc
-0002b230: 6c69 656e 743d 766d 636c 6965 6e74 290a  lient=vmclient).
-0002b240: 0a20 2020 2064 6566 2070 6172 7365 5f66  .    def parse_f
-0002b250: 696c 6573 2873 656c 662c 206e 616d 652c  iles(self, name,
-0002b260: 2066 696c 6573 2c20 6261 7365 6469 723d   files, basedir=
-0002b270: 272e 272c 206f 6e66 6c79 3d4e 6f6e 6529  '.', onfly=None)
-0002b280: 3a0a 2020 2020 2020 2020 6966 206e 6f74  :.        if not
-0002b290: 2066 696c 6573 3a0a 2020 2020 2020 2020   files:.        
-0002b2a0: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-0002b2b0: 2020 2066 6f72 2069 6e64 6578 2c20 6669     for index, fi
-0002b2c0: 6c20 696e 2065 6e75 6d65 7261 7465 2866  l in enumerate(f
-0002b2d0: 696c 6573 293a 0a20 2020 2020 2020 2020  iles):.         
-0002b2e0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0002b2f0: 2866 696c 2c20 7374 7229 3a0a 2020 2020  (fil, str):.    
-0002b300: 2020 2020 2020 2020 2020 2020 7061 7468              path
-0002b310: 203d 2066 222f 726f 6f74 2f7b 6669 6c7d   = f"/root/{fil}
-0002b320: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0002b330: 2020 6966 2062 6173 6564 6972 2021 3d20    if basedir != 
-0002b340: 272e 273a 0a20 2020 2020 2020 2020 2020  '.':.           
-0002b350: 2020 2020 2020 2020 206f 7269 6769 6e20           origin 
-0002b360: 3d20 6622 7b62 6173 6564 6972 7d2f 7b70  = f"{basedir}/{p
-0002b370: 6174 687d 220a 2020 2020 2020 2020 2020  ath}".          
-0002b380: 2020 2020 2020 6f72 6967 696e 203d 2066        origin = f
-0002b390: 696c 0a20 2020 2020 2020 2020 2020 2020  il.             
-0002b3a0: 2020 2063 6f6e 7465 6e74 203d 204e 6f6e     content = Non
-0002b3b0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0002b3c0: 2020 6669 6c65 735b 696e 6465 785d 203d    files[index] =
-0002b3d0: 207b 2770 6174 6827 3a20 7061 7468 2c20   {'path': path, 
-0002b3e0: 276f 7269 6769 6e27 3a20 6f72 6967 696e  'origin': origin
-0002b3f0: 7d0a 2020 2020 2020 2020 2020 2020 656c  }.            el
-0002b400: 6966 2069 7369 6e73 7461 6e63 6528 6669  if isinstance(fi
-0002b410: 6c2c 2064 6963 7429 3a0a 2020 2020 2020  l, dict):.      
-0002b420: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
-0002b430: 203d 2066 696c 2e67 6574 2827 6f72 6967   = fil.get('orig
-0002b440: 696e 2729 0a20 2020 2020 2020 2020 2020  in').           
-0002b450: 2020 2020 2063 6f6e 7465 6e74 203d 2066       content = f
-0002b460: 696c 2e67 6574 2827 636f 6e74 656e 7427  il.get('content'
-0002b470: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002b480: 2020 7061 7468 203d 2066 696c 2e67 6574    path = fil.get
-0002b490: 2827 7061 7468 2729 0a20 2020 2020 2020  ('path').       
-0002b4a0: 2020 2020 2020 2020 2069 6620 7061 7468           if path
-0002b4b0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0002b4c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0002b4d0: 206f 7269 6769 6e20 6973 206e 6f74 204e   origin is not N
-0002b4e0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0002b4f0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0002b500: 6573 5b69 6e64 6578 5d5b 2770 6174 6827  es[index]['path'
-0002b510: 5d20 3d20 6622 2f72 6f6f 742f 7b6f 7269  ] = f"/root/{ori
-0002b520: 6769 6e7d 220a 2020 2020 2020 2020 2020  gin}".          
-0002b530: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0002b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b550: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
-0002b560: 496e 636f 7272 6563 7420 656e 7472 7920  Incorrect entry 
-0002b570: 7b66 696c 7d2e 4c65 6176 696e 672e 2e2e  {fil}.Leaving...
-0002b580: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0002b590: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-0002b5a0: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
-0002b5b0: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
-0002b5c0: 7061 7468 2e73 7461 7274 7377 6974 6828  path.startswith(
-0002b5d0: 272f 2729 3a0a 2020 2020 2020 2020 2020  '/'):.          
-0002b5e0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-0002b5f0: 6622 496e 636f 7272 6563 7420 7061 7468  f"Incorrect path
-0002b600: 207b 7061 7468 7d2e 4c65 6176 696e 672e   {path}.Leaving.
-0002b610: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
-0002b620: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-0002b630: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
-0002b640: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0002b650: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-0002b660: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
-0002b670: 6527 2c20 2772 6561 736f 6e27 3a20 2249  e', 'reason': "I
-0002b680: 6e63 6f72 7265 6374 2066 696c 6520 656e  ncorrect file en
-0002b690: 7472 7922 7d0a 2020 2020 2020 2020 2020  try"}.          
-0002b6a0: 2020 6966 206f 7269 6769 6e20 6973 206e    if origin is n
-0002b6b0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0002b6c0: 2020 2020 2020 2020 2069 6620 6f6e 666c           if onfl
-0002b6d0: 7920 6973 206e 6f74 204e 6f6e 6520 616e  y is not None an
-0002b6e0: 6420 277e 2720 6e6f 7420 696e 206f 7269  d '~' not in ori
-0002b6f0: 6769 6e3a 0a20 2020 2020 2020 2020 2020  gin:.           
-0002b700: 2020 2020 2020 2020 2064 6573 7464 6972           destdir
-0002b710: 203d 2062 6173 6564 6972 0a20 2020 2020   = basedir.     
-0002b720: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0002b730: 6620 272f 2720 696e 206f 7269 6769 6e3a  f '/' in origin:
-0002b740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002b750: 2020 2020 2020 2020 2064 6573 7464 6972           destdir
-0002b760: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
-0002b770: 6d65 286f 7269 6769 6e29 0a20 2020 2020  me(origin).     
-0002b780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b790: 2020 206f 732e 6d61 6b65 6469 7273 2864     os.makedirs(d
-0002b7a0: 6573 7464 6972 2c20 6578 6973 745f 6f6b  estdir, exist_ok
-0002b7b0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-0002b7c0: 2020 2020 2020 2020 2020 2063 6f6d 6d6f             commo
-0002b7d0: 6e2e 6665 7463 6828 6622 7b6f 6e66 6c79  n.fetch(f"{onfly
-0002b7e0: 7d2f 7b6f 7269 6769 6e7d 222c 2064 6573  }/{origin}", des
-0002b7f0: 7464 6972 290a 2020 2020 2020 2020 2020  tdir).          
-0002b800: 2020 2020 2020 6f72 6967 696e 203d 206f        origin = o
-0002b810: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
-0002b820: 7228 6f72 6967 696e 290a 2020 2020 2020  r(origin).      
-0002b830: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0002b840: 206f 732e 7061 7468 2e69 7361 6273 286f   os.path.isabs(o
-0002b850: 7269 6769 6e29 3a0a 2020 2020 2020 2020  rigin):.        
-0002b860: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0002b870: 7369 6e73 7461 6e63 6528 6669 6c2c 2064  sinstance(fil, d
-0002b880: 6963 7429 2061 6e64 2066 696c 2e67 6574  ict) and fil.get
-0002b890: 2827 6375 7272 656e 7464 6972 272c 2046  ('currentdir', F
-0002b8a0: 616c 7365 293a 0a20 2020 2020 2020 2020  alse):.         
-0002b8b0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0002b8c0: 7269 6769 6e20 3d20 6622 7b6f 732e 6765  rigin = f"{os.ge
-0002b8d0: 7463 7764 2829 7d2f 7b6f 7269 6769 6e7d  tcwd()}/{origin}
-0002b8e0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0002b8f0: 2020 2020 2020 2020 2020 6669 6c65 735b            files[
-0002b900: 696e 6465 785d 5b27 6f72 6967 696e 275d  index]['origin']
-0002b910: 203d 206f 7269 6769 6e0a 2020 2020 2020   = origin.      
-0002b920: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0002b930: 6966 2062 6173 6564 6972 2021 3d20 272e  if basedir != '.
-0002b940: 2720 616e 6420 6e6f 7420 6f72 6967 696e  ' and not origin
-0002b950: 2e73 7461 7274 7377 6974 6828 272e 2f27  .startswith('./'
-0002b960: 2920 616e 6420 6e6f 7420 6f72 6967 696e  ) and not origin
-0002b970: 2e73 7461 7274 7377 6974 6828 272f 776f  .startswith('/wo
-0002b980: 726b 6469 722f 2729 3a0a 2020 2020 2020  rkdir/'):.      
-0002b990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b9a0: 2020 6f72 6967 696e 203d 2066 227b 6261    origin = f"{ba
-0002b9b0: 7365 6469 727d 2f7b 6f72 6967 696e 7d22  sedir}/{origin}"
-0002b9c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002b9d0: 2020 2020 2020 2020 2066 696c 6573 5b69           files[i
-0002b9e0: 6e64 6578 5d5b 276f 7269 6769 6e27 5d20  ndex]['origin'] 
-0002b9f0: 3d20 6f72 6967 696e 0a20 2020 2020 2020  = origin.       
-0002ba00: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0002ba10: 6f73 2e70 6174 682e 6578 6973 7473 286f  os.path.exists(o
-0002ba20: 7269 6769 6e29 3a0a 2020 2020 2020 2020  rigin):.        
-0002ba30: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0002ba40: 726e 207b 2772 6573 756c 7427 3a20 2766  rn {'result': 'f
-0002ba50: 6169 6c75 7265 272c 2027 7265 6173 6f6e  ailure', 'reason
-0002ba60: 273a 2066 224f 7269 6769 6e20 6669 6c65  ': f"Origin file
-0002ba70: 207b 6f72 6967 696e 7d20 6e6f 7420 666f   {origin} not fo
-0002ba80: 756e 6420 666f 7220 7b6e 616d 657d 227d  und for {name}"}
-0002ba90: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0002baa0: 6620 636f 6e74 656e 7420 6973 204e 6f6e  f content is Non
-0002bab0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002bac0: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
-0002bad0: 6c74 273a 2027 6661 696c 7572 6527 2c20  lt': 'failure', 
-0002bae0: 2772 6561 736f 6e27 3a20 6622 436f 6e74  'reason': f"Cont
-0002baf0: 656e 7420 6f66 2066 696c 6520 7b70 6174  ent of file {pat
-0002bb00: 687d 206e 6f74 2066 6f75 6e64 2066 6f72  h} not found for
-0002bb10: 207b 6e61 6d65 7d22 7d0a 0a20 2020 2064   {name}"}..    d
-0002bb20: 6566 2070 7265 7065 6e64 5f69 6e70 7574  ef prepend_input
-0002bb30: 5f64 6972 2873 656c 662c 206e 6577 6669  _dir(self, newfi
-0002bb40: 6c65 732c 2069 6e70 7574 6469 7229 3a0a  les, inputdir):.
-0002bb50: 2020 2020 2020 2020 7265 7375 6c74 7320          results 
-0002bb60: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-0002bb70: 2066 6963 2069 6e20 6e65 7766 696c 6573   fic in newfiles
-0002bb80: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0002bb90: 2069 7369 6e73 7461 6e63 6528 6669 632c   isinstance(fic,
-0002bba0: 2073 7472 2920 616e 6420 6e6f 7420 6f73   str) and not os
-0002bbb0: 2e70 6174 682e 6973 6162 7328 6669 6329  .path.isabs(fic)
-0002bbc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002bbd0: 2020 6e65 775f 6669 6320 3d20 6622 7b69    new_fic = f"{i
-0002bbe0: 6e70 7574 6469 727d 2f7b 6669 637d 220a  nputdir}/{fic}".
-0002bbf0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0002bc00: 2069 7369 6e73 7461 6e63 6528 6669 632c   isinstance(fic,
-0002bc10: 2064 6963 7429 2061 6e64 2027 6f72 6967   dict) and 'orig
-0002bc20: 696e 2720 696e 2066 6963 2061 6e64 206e  in' in fic and n
-0002bc30: 6f74 206f 732e 7061 7468 2e69 7361 6273  ot os.path.isabs
-0002bc40: 286f 732e 7061 7468 2e65 7870 616e 6475  (os.path.expandu
-0002bc50: 7365 7228 6669 635b 276f 7269 6769 6e27  ser(fic['origin'
-0002bc60: 5d29 293a 0a20 2020 2020 2020 2020 2020  ])):.           
-0002bc70: 2020 2020 206e 6577 5f66 6963 203d 2066       new_fic = f
-0002bc80: 6963 2e63 6f70 7928 290a 2020 2020 2020  ic.copy().      
-0002bc90: 2020 2020 2020 2020 2020 6e65 775f 6669            new_fi
-0002bca0: 635b 276f 7269 6769 6e27 5d20 3d20 6622  c['origin'] = f"
-0002bcb0: 7b69 6e70 7574 6469 727d 2f7b 6669 635b  {inputdir}/{fic[
-0002bcc0: 276f 7269 6769 6e27 5d7d 220a 2020 2020  'origin']}".    
-0002bcd0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002bce0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0002bcf0: 775f 6669 6320 3d20 6669 630a 2020 2020  w_fic = fic.    
-0002bd00: 2020 2020 2020 2020 7265 7375 6c74 732e          results.
-0002bd10: 6170 7065 6e64 286e 6577 5f66 6963 290a  append(new_fic).
-0002bd20: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-0002bd30: 6573 756c 7473 0a0a 2020 2020 6465 6620  esults..    def 
-0002bd40: 7265 6d65 6469 6174 655f 6669 6c65 7328  remediate_files(
-0002bd50: 7365 6c66 2c20 6e61 6d65 2c20 6e65 7766  self, name, newf
-0002bd60: 696c 6573 2c20 6f76 6572 7269 6465 733d  iles, overrides=
-0002bd70: 7b7d 2c20 696e 7075 7464 6972 3d27 2e27  {}, inputdir='.'
-0002bd80: 293a 0a20 2020 2020 2020 2075 7064 6174  ):.        updat
-0002bd90: 6564 5f66 696c 6573 203d 205b 5d0a 2020  ed_files = [].  
-0002bda0: 2020 2020 2020 6970 2c20 766d 706f 7274        ip, vmport
-0002bdb0: 203d 205f 7373 685f 6372 6564 656e 7469   = _ssh_credenti
-0002bdc0: 616c 7328 7365 6c66 2e6b 2c20 6e61 6d65  als(self.k, name
-0002bdd0: 295b 313a 5d0a 2020 2020 2020 2020 6966  )[1:].        if
-0002bde0: 2069 6e70 7574 6469 7220 213d 2027 2e27   inputdir != '.'
-0002bdf0: 3a0a 2020 2020 2020 2020 2020 2020 6e65  :.            ne
-0002be00: 7766 696c 6573 203d 2073 656c 662e 7072  wfiles = self.pr
-0002be10: 6570 656e 645f 696e 7075 745f 6469 7228  epend_input_dir(
-0002be20: 6e65 7766 696c 6573 2c20 696e 7075 7464  newfiles, inputd
-0002be30: 6972 290a 2020 2020 2020 2020 7365 6c66  ir).        self
-0002be40: 2e70 6172 7365 5f66 696c 6573 286e 616d  .parse_files(nam
-0002be50: 652c 206e 6577 6669 6c65 7329 0a20 2020  e, newfiles).   
-0002be60: 2020 2020 206f 7665 7272 6964 6573 5f66       overrides_f
-0002be70: 696c 6573 203d 206f 7665 7272 6964 6573  iles = overrides
-0002be80: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
-0002be90: 6f76 6572 7269 6465 735f 6669 6c65 735b  overrides_files[
-0002bea0: 276e 616d 6527 5d20 3d20 6e61 6d65 0a20  'name'] = name. 
-0002beb0: 2020 2020 2020 2064 6174 6120 3d20 7072         data = pr
-0002bec0: 6f63 6573 735f 6669 6c65 7328 6669 6c65  ocess_files(file
-0002bed0: 733d 6e65 7766 696c 6573 2c20 6f76 6572  s=newfiles, over
-0002bee0: 7269 6465 733d 6f76 6572 7269 6465 735f  rides=overrides_
-0002bef0: 6669 6c65 732c 2072 656d 6564 6961 7465  files, remediate
-0002bf00: 3d54 7275 6529 0a20 2020 2020 2020 2064  =True).        d
-0002bf10: 6174 6164 6972 7320 3d20 7b7d 0a20 2020  atadirs = {}.   
-0002bf20: 2020 2020 2077 6974 6820 5465 6d70 6f72       with Tempor
-0002bf30: 6172 7944 6972 6563 746f 7279 2829 2061  aryDirectory() a
-0002bf40: 7320 746d 7064 6972 3a0a 2020 2020 2020  s tmpdir:.      
-0002bf50: 2020 2020 2020 666f 7220 696e 6465 782c        for index,
-0002bf60: 2065 6e74 7279 2069 6e20 656e 756d 6572   entry in enumer
-0002bf70: 6174 6528 6461 7461 293a 0a20 2020 2020  ate(data):.     
-0002bf80: 2020 2020 2020 2020 2020 2064 6573 7469             desti
-0002bf90: 6e61 7469 6f6e 203d 2065 6e74 7279 5b27  nation = entry['
-0002bfa0: 7061 7468 275d 0a20 2020 2020 2020 2020  path'].         
-0002bfb0: 2020 2020 2020 2070 6174 6864 6972 203d         pathdir =
-0002bfc0: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
-0002bfd0: 2864 6573 7469 6e61 7469 6f6e 290a 2020  (destination).  
-0002bfe0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0002bff0: 2070 6174 6864 6972 206e 6f74 2069 6e20   pathdir not in 
-0002c000: 6461 7461 6469 7273 3a0a 2020 2020 2020  datadirs:.      
-0002c010: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0002c020: 7468 6469 7263 6d64 203d 2066 276c 7320  thdircmd = f'ls 
-0002c030: 2d61 207b 7061 7468 6469 727d 2032 3e26  -a {pathdir} 2>&
-0002c040: 3127 0a20 2020 2020 2020 2020 2020 2020  1'.             
-0002c050: 2020 2020 2020 2070 6174 6864 6972 636d         pathdircm
-0002c060: 6420 3d20 7373 6828 6e61 6d65 2c20 6970  d = ssh(name, ip
-0002c070: 3d69 702c 2075 7365 723d 2772 6f6f 7427  =ip, user='root'
-0002c080: 2c20 7475 6e6e 656c 3d73 656c 662e 7475  , tunnel=self.tu
-0002c090: 6e6e 656c 2c20 7475 6e6e 656c 686f 7374  nnel, tunnelhost
-0002c0a0: 3d73 656c 662e 7475 6e6e 656c 686f 7374  =self.tunnelhost
-0002c0b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002c0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c0d0: 2020 2020 2020 2074 756e 6e65 6c70 6f72         tunnelpor
-0002c0e0: 743d 7365 6c66 2e74 756e 6e65 6c70 6f72  t=self.tunnelpor
-0002c0f0: 742c 2074 756e 6e65 6c75 7365 723d 7365  t, tunneluser=se
-0002c100: 6c66 2e74 756e 6e65 6c75 7365 722c 2069  lf.tunneluser, i
-0002c110: 6e73 6563 7572 653d 5472 7565 2c0a 2020  nsecure=True,.  
-0002c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c140: 2020 2063 6d64 3d70 6174 6864 6972 636d     cmd=pathdircm
-0002c150: 642c 2076 6d70 6f72 743d 766d 706f 7274  d, vmport=vmport
-0002c160: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002c170: 2020 2020 2020 7061 7468 6469 7266 696c        pathdirfil
-0002c180: 6573 203d 206f 732e 706f 7065 6e28 7061  es = os.popen(pa
-0002c190: 7468 6469 7263 6d64 292e 7265 6164 6c69  thdircmd).readli
-0002c1a0: 6e65 7328 290a 2020 2020 2020 2020 2020  nes().          
-0002c1b0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0002c1c0: 2870 6174 6864 6972 6669 6c65 7329 203d  (pathdirfiles) =
-0002c1d0: 3d20 3120 616e 6420 274e 6f20 7375 6368  = 1 and 'No such
-0002c1e0: 2066 696c 6520 6f72 2064 6972 6563 746f   file or directo
-0002c1f0: 7279 2720 696e 2070 6174 6864 6972 6669  ry' in pathdirfi
-0002c200: 6c65 735b 305d 3a0a 2020 2020 2020 2020  les[0]:.        
-0002c210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c220: 6372 6561 7465 6469 7263 6d64 203d 2066  createdircmd = f
-0002c230: 276d 6b64 6972 202d 7020 7b70 6174 6864  'mkdir -p {pathd
-0002c240: 6972 7d27 0a20 2020 2020 2020 2020 2020  ir}'.           
-0002c250: 2020 2020 2020 2020 2020 2020 2063 7265               cre
-0002c260: 6174 6564 6972 636d 6420 3d20 7373 6828  atedircmd = ssh(
-0002c270: 6e61 6d65 2c20 6970 3d69 702c 2075 7365  name, ip=ip, use
-0002c280: 723d 2772 6f6f 7427 2c20 7475 6e6e 656c  r='root', tunnel
-0002c290: 3d73 656c 662e 7475 6e6e 656c 2c20 7475  =self.tunnel, tu
-0002c2a0: 6e6e 656c 686f 7374 3d73 656c 662e 7475  nnelhost=self.tu
-0002c2b0: 6e6e 656c 686f 7374 2c0a 2020 2020 2020  nnelhost,.      
-0002c2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c2e0: 2020 2020 2074 756e 6e65 6c70 6f72 743d       tunnelport=
-0002c2f0: 7365 6c66 2e74 756e 6e65 6c70 6f72 742c  self.tunnelport,
-0002c300: 2074 756e 6e65 6c75 7365 723d 7365 6c66   tunneluser=self
-0002c310: 2e74 756e 6e65 6c75 7365 722c 2069 6e73  .tunneluser, ins
-0002c320: 6563 7572 653d 5472 7565 2c0a 2020 2020  ecure=True,.    
-0002c330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c350: 2020 2020 2020 2063 6d64 3d63 7265 6174         cmd=creat
-0002c360: 6564 6972 636d 642c 2076 6d70 6f72 743d  edircmd, vmport=
-0002c370: 766d 706f 7274 290a 2020 2020 2020 2020  vmport).        
-0002c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c390: 6f73 2e70 6f70 656e 2863 7265 6174 6564  os.popen(created
-0002c3a0: 6972 636d 6429 0a20 2020 2020 2020 2020  ircmd).         
-0002c3b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0002c3c0: 6174 6864 6972 6669 6c65 7320 3d20 5b5d  athdirfiles = []
-0002c3d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002c3e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0002c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c400: 2020 2070 6174 6864 6972 6669 6c65 7320     pathdirfiles 
-0002c410: 3d20 5b78 2e73 7472 6970 2829 2066 6f72  = [x.strip() for
-0002c420: 2078 2069 6e20 7061 7468 6469 7266 696c   x in pathdirfil
-0002c430: 6573 5d0a 2020 2020 2020 2020 2020 2020  es].            
-0002c440: 2020 2020 2020 2020 6461 7461 6469 7273          datadirs
-0002c450: 5b70 6174 6864 6972 5d20 3d20 7061 7468  [pathdir] = path
-0002c460: 6469 7266 696c 6573 0a20 2020 2020 2020  dirfiles.       
-0002c470: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
-0002c480: 6174 682e 6261 7365 6e61 6d65 2864 6573  ath.basename(des
-0002c490: 7469 6e61 7469 6f6e 2920 6e6f 7420 696e  tination) not in
-0002c4a0: 2064 6174 6164 6972 735b 7061 7468 6469   datadirs[pathdi
-0002c4b0: 725d 3a0a 2020 2020 2020 2020 2020 2020  r]:.            
-0002c4c0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-0002c4d0: 2255 7064 6174 696e 6720 7b64 6573 7469  "Updating {desti
-0002c4e0: 6e61 7469 6f6e 7d20 696e 207b 6e61 6d65  nation} in {name
-0002c4f0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0002c500: 2020 2020 2020 2020 736f 7572 6365 203d          source =
-0002c510: 2066 227b 746d 7064 6972 7d2f 6669 637b   f"{tmpdir}/fic{
-0002c520: 696e 6465 787d 220a 2020 2020 2020 2020  index}".        
-0002c530: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0002c540: 206f 7065 6e28 736f 7572 6365 2c20 2777   open(source, 'w
-0002c550: 2729 2061 7320 663a 0a20 2020 2020 2020  ') as f:.       
-0002c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c570: 2066 2e77 7269 7465 2865 6e74 7279 5b27   f.write(entry['
-0002c580: 636f 6e74 656e 7427 5d29 0a20 2020 2020  content']).     
-0002c590: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0002c5a0: 6370 636d 6420 3d20 7363 7028 6e61 6d65  cpcmd = scp(name
-0002c5b0: 2c20 6970 3d69 702c 2075 7365 723d 2772  , ip=ip, user='r
-0002c5c0: 6f6f 7427 2c20 736f 7572 6365 3d73 6f75  oot', source=sou
-0002c5d0: 7263 652c 2064 6573 7469 6e61 7469 6f6e  rce, destination
-0002c5e0: 3d64 6573 7469 6e61 7469 6f6e 2c20 7475  =destination, tu
-0002c5f0: 6e6e 656c 3d73 656c 662e 7475 6e6e 656c  nnel=self.tunnel
-0002c600: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002c610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c620: 2020 2074 756e 6e65 6c68 6f73 743d 7365     tunnelhost=se
-0002c630: 6c66 2e74 756e 6e65 6c68 6f73 742c 2074  lf.tunnelhost, t
-0002c640: 756e 6e65 6c70 6f72 743d 7365 6c66 2e74  unnelport=self.t
-0002c650: 756e 6e65 6c70 6f72 742c 2074 756e 6e65  unnelport, tunne
-0002c660: 6c75 7365 723d 7365 6c66 2e74 756e 6e65  luser=self.tunne
-0002c670: 6c75 7365 722c 0a20 2020 2020 2020 2020  luser,.         
-0002c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c690: 2020 2020 2020 2020 646f 776e 6c6f 6164          download
-0002c6a0: 3d46 616c 7365 2c20 696e 7365 6375 7265  =False, insecure
-0002c6b0: 3d54 7275 652c 2076 6d70 6f72 743d 766d  =True, vmport=vm
-0002c6c0: 706f 7274 290a 2020 2020 2020 2020 2020  port).          
-0002c6d0: 2020 2020 2020 2020 2020 6f73 2e73 7973            os.sys
-0002c6e0: 7465 6d28 7363 7063 6d64 290a 2020 2020  tem(scpcmd).    
-0002c6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c700: 7570 6461 7465 645f 6669 6c65 732e 6170  updated_files.ap
-0002c710: 7065 6e64 2864 6573 7469 6e61 7469 6f6e  pend(destination
-0002c720: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0002c730: 2075 7064 6174 6564 5f66 696c 6573 0a0a   updated_files..
-0002c740: 2020 2020 6465 6620 696e 666f 5f73 7065      def info_spe
-0002c750: 6369 6669 635f 706c 616e 2873 656c 662c  cific_plan(self,
-0002c760: 2070 6c61 6e29 3a0a 2020 2020 2020 2020   plan):.        
-0002c770: 7070 7269 6e74 2866 2250 726f 7669 6469  pprint(f"Providi
-0002c780: 6e67 2069 6e66 6f72 6d61 7469 6f6e 2061  ng information a
-0002c790: 626f 7574 2070 6c61 6e20 7b70 6c61 6e7d  bout plan {plan}
-0002c7a0: 2229 0a20 2020 2020 2020 206b 203d 2073  ").        k = s
-0002c7b0: 656c 662e 6b0a 2020 2020 2020 2020 7265  elf.k.        re
-0002c7c0: 7375 6c74 7320 3d20 5b5d 0a20 2020 2020  sults = [].     
-0002c7d0: 2020 2066 6f72 2076 6d20 696e 206b 2e6c     for vm in k.l
-0002c7e0: 6973 7428 293a 0a20 2020 2020 2020 2020  ist():.         
-0002c7f0: 2020 2069 6620 766d 2e67 6574 2827 706c     if vm.get('pl
-0002c800: 616e 272c 2027 2729 203d 3d20 706c 616e  an', '') == plan
-0002c810: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002c820: 2020 7265 7375 6c74 732e 6170 7065 6e64    results.append
-0002c830: 2876 6d29 0a20 2020 2020 2020 2072 6574  (vm).        ret
-0002c840: 7572 6e20 7265 7375 6c74 730a 0a20 2020  urn results..   
-0002c850: 2064 6566 2061 7574 6f73 6361 6c65 5f63   def autoscale_c
-0002c860: 6c75 7374 6572 2873 656c 662c 206b 7562  luster(self, kub
-0002c870: 652c 206b 7562 6574 7970 652c 2077 6f72  e, kubetype, wor
-0002c880: 6b65 7273 2c20 7468 7265 7368 6f6c 642c  kers, threshold,
-0002c890: 2069 646c 6529 3a0a 2020 2020 2020 2020   idle):.        
-0002c8a0: 6966 2074 6872 6573 686f 6c64 203e 2039  if threshold > 9
-0002c8b0: 3939 393a 0a20 2020 2020 2020 2020 2020  999:.           
-0002c8c0: 2070 7072 696e 7428 6622 536b 6970 7069   pprint(f"Skippi
-0002c8d0: 6e67 2061 7574 6f73 6361 6c69 6e67 2075  ng autoscaling u
-0002c8e0: 7020 6368 6563 6b73 2066 6f72 2063 6c75  p checks for clu
-0002c8f0: 7374 6572 207b 6b75 6265 7d20 6173 2070  ster {kube} as p
-0002c900: 6572 2074 6872 6573 686f 6c64 207b 7468  er threshold {th
-0002c910: 7265 7368 6f6c 647d 2229 0a20 2020 2020  reshold}").     
-0002c920: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-0002c930: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
-0002c940: 7327 2c20 2777 6f72 6b65 7273 273a 2077  s', 'workers': w
-0002c950: 6f72 6b65 7273 7d0a 2020 2020 2020 2020  orkers}.        
-0002c960: 6966 2069 646c 6520 3c20 313a 0a20 2020  if idle < 1:.   
-0002c970: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-0002c980: 6622 536b 6970 7069 6e67 2061 7574 6f73  f"Skipping autos
-0002c990: 6361 6c69 6e67 2064 6f77 6e20 6368 6563  caling down chec
-0002c9a0: 6b73 2066 6f72 2063 6c75 7374 6572 207b  ks for cluster {
-0002c9b0: 6b75 6265 7d20 6173 2070 6572 2069 646c  kube} as per idl
-0002c9c0: 6520 7b69 646c 657d 2229 0a20 2020 2020  e {idle}").     
-0002c9d0: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-0002c9e0: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
-0002c9f0: 7327 2c20 2777 6f72 6b65 7273 273a 2077  s', 'workers': w
-0002ca00: 6f72 6b65 7273 7d0a 2020 2020 2020 2020  orkers}.        
-0002ca10: 7070 7269 6e74 2866 2243 6865 636b 696e  pprint(f"Checkin
-0002ca20: 6720 6e6f 6e20 7363 6865 6475 6c65 6420  g non scheduled 
-0002ca30: 706f 6473 2063 6f75 6e74 206f 6e20 636c  pods count on cl
-0002ca40: 7573 7465 7220 7b6b 7562 657d 2229 0a20  uster {kube}"). 
-0002ca50: 2020 2020 2020 2073 656c 6563 746f 7220         selector 
-0002ca60: 3d20 2221 6e6f 6465 2d72 6f6c 652e 6b75  = "!node-role.ku
-0002ca70: 6265 726e 6574 6573 2e69 6f2f 636f 6e74  bernetes.io/cont
-0002ca80: 726f 6c2d 706c 616e 652c 6e6f 6465 2d72  rol-plane,node-r
-0002ca90: 6f6c 652e 6b75 6265 726e 6574 6573 2e69  ole.kubernetes.i
-0002caa0: 6f2f 776f 726b 6572 220a 2020 2020 2020  o/worker".      
-0002cab0: 2020 6375 7272 656e 7463 6d64 203d 2066    currentcmd = f
-0002cac0: 226b 7562 6563 746c 2067 6574 206e 6f64  "kubectl get nod
-0002cad0: 6520 2d2d 7365 6c65 6374 6f72 3d27 7b73  e --selector='{s
-0002cae0: 656c 6563 746f 727d 2722 0a20 2020 2020  elector}'".     
-0002caf0: 2020 2063 7572 7265 6e74 636d 6420 2b3d     currentcmd +=
-0002cb00: 2022 207c 2067 7265 7020 2720 5265 6164   " | grep ' Read
-0002cb10: 7927 220a 2020 2020 2020 2020 776f 726b  y'".        work
-0002cb20: 6572 7320 3d20 6c65 6e28 6f73 2e70 6f70  ers = len(os.pop
-0002cb30: 656e 2863 7572 7265 6e74 636d 6429 2e72  en(currentcmd).r
-0002cb40: 6561 646c 696e 6573 2829 290a 2020 2020  eadlines()).    
-0002cb50: 2020 2020 7065 6e64 696e 6763 6d64 203d      pendingcmd =
-0002cb60: 2022 6b75 6265 6374 6c20 6765 7420 706f   "kubectl get po
-0002cb70: 6473 202d 4120 2d2d 6669 656c 642d 7365  ds -A --field-se
-0002cb80: 6c65 6374 6f72 3d73 7461 7475 732e 7068  lector=status.ph
-0002cb90: 6173 653d 5065 6e64 696e 6720 2d6f 2079  ase=Pending -o y
-0002cba0: 616d 6c22 0a20 2020 2020 2020 2070 656e  aml".        pen
-0002cbb0: 6469 6e67 5f70 6f64 7320 3d20 7961 6d6c  ding_pods = yaml
-0002cbc0: 2e73 6166 655f 6c6f 6164 286f 732e 706f  .safe_load(os.po
-0002cbd0: 7065 6e28 7065 6e64 696e 6763 6d64 292e  pen(pendingcmd).
-0002cbe0: 7265 6164 2829 295b 2769 7465 6d73 275d  read())['items']
-0002cbf0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-0002cc00: 7065 6e64 696e 675f 706f 6473 2920 3e20  pending_pods) > 
-0002cc10: 7468 7265 7368 6f6c 643a 0a20 2020 2020  threshold:.     
-0002cc20: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-0002cc30: 5472 6967 6765 7269 6e67 2073 6361 6c69  Triggering scali
-0002cc40: 6e67 2075 7020 666f 7220 636c 7573 7465  ng up for cluste
-0002cc50: 7220 7b6b 7562 657d 2061 7320 7468 6572  r {kube} as ther
-0002cc60: 6520 6172 6520 7b6c 656e 2870 656e 6469  e are {len(pendi
-0002cc70: 6e67 5f70 6f64 7329 7d20 7065 6e64 696e  ng_pods)} pendin
-0002cc80: 6720 706f 6473 2229 0a20 2020 2020 2020  g pods").       
-0002cc90: 2020 2020 2077 6f72 6b65 7273 202b 3d20       workers += 
-0002cca0: 310a 2020 2020 2020 2020 2020 2020 7070  1.            pp
-0002ccb0: 7269 6e74 2822 5363 616c 696e 6720 7570  rint("Scaling up
-0002ccc0: 2063 6c75 7374 6572 207b 6b75 6265 7d20   cluster {kube} 
-0002ccd0: 746f 207b 776f 726b 6572 737d 2077 6f72  to {workers} wor
-0002cce0: 6b65 7273 2229 0a20 2020 2020 2020 2020  kers").         
-0002ccf0: 2020 2072 6573 756c 7420 3d20 7365 6c66     result = self
-0002cd00: 2e73 6361 6c65 5f6b 7562 6528 6b75 6265  .scale_kube(kube
-0002cd10: 2c20 6b75 6265 7479 7065 2c20 6f76 6572  , kubetype, over
-0002cd20: 7269 6465 733d 7b27 776f 726b 6572 7327  rides={'workers'
-0002cd30: 3a20 776f 726b 6572 737d 290a 2020 2020  : workers}).    
-0002cd40: 2020 2020 2020 2020 7265 7375 6c74 5b27          result['
-0002cd50: 776f 726b 6572 7327 5d20 3d20 776f 726b  workers'] = work
-0002cd60: 6572 730a 2020 2020 2020 2020 2020 2020  ers.            
-0002cd70: 7265 7475 726e 2072 6573 756c 740a 2020  return result.  
-0002cd80: 2020 2020 2020 6e6f 6465 7320 3d20 7b7d        nodes = {}
-0002cd90: 0a20 2020 2020 2020 2063 7572 7265 6e74  .        current
-0002cda0: 636d 6420 3d20 226b 7562 6563 746c 2067  cmd = "kubectl g
-0002cdb0: 6574 2070 6f64 202d 4120 2d6f 2079 616d  et pod -A -o yam
-0002cdc0: 6c22 0a20 2020 2020 2020 2061 6c6c 706f  l".        allpo
-0002cdd0: 6473 203d 2079 616d 6c2e 7361 6665 5f6c  ds = yaml.safe_l
-0002cde0: 6f61 6428 6f73 2e70 6f70 656e 2863 7572  oad(os.popen(cur
-0002cdf0: 7265 6e74 636d 6429 2e72 6561 6428 2929  rentcmd).read())
-0002ce00: 5b27 6974 656d 7327 5d0a 2020 2020 2020  ['items'].      
-0002ce10: 2020 666f 7220 706f 6420 696e 2061 6c6c    for pod in all
-0002ce20: 706f 6473 3a0a 2020 2020 2020 2020 2020  pods:.          
-0002ce30: 2020 6e6f 6465 6e61 6d65 203d 2070 6f64    nodename = pod
-0002ce40: 5b27 7370 6563 275d 5b27 6e6f 6465 4e61  ['spec']['nodeNa
-0002ce50: 6d65 275d 0a20 2020 2020 2020 2020 2020  me'].           
-0002ce60: 2073 7461 7475 7320 3d20 706f 645b 2773   status = pod['s
-0002ce70: 7461 7475 7327 5d5b 2770 6861 7365 275d  tatus']['phase']
-0002ce80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002ce90: 7374 6174 7573 2021 3d20 2752 756e 6e69  status != 'Runni
-0002cea0: 6e67 273a 0a20 2020 2020 2020 2020 2020  ng':.           
-0002ceb0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-0002cec0: 2020 2020 2020 2020 2020 6966 206e 6f64            if nod
-0002ced0: 656e 616d 6520 6e6f 7420 696e 206e 6f64  ename not in nod
-0002cee0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0002cef0: 2020 2020 6e6f 6465 735b 6e6f 6465 6e61      nodes[nodena
-0002cf00: 6d65 5d20 3d20 310a 2020 2020 2020 2020  me] = 1.        
-0002cf10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0002cf20: 2020 2020 2020 2020 2020 6e6f 6465 735b            nodes[
-0002cf30: 6e6f 6465 6e61 6d65 5d20 2b3d 2031 0a20  nodename] += 1. 
-0002cf40: 2020 2020 2020 2074 6f64 656c 6574 6520         todelete 
-0002cf50: 3d20 300a 2020 2020 2020 2020 666f 7220  = 0.        for 
-0002cf60: 6e6f 6465 2069 6e20 6e6f 6465 733a 0a20  node in nodes:. 
-0002cf70: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0002cf80: 6465 735b 6e6f 6465 5d20 3c20 6964 6c65  des[node] < idle
-0002cf90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002cfa0: 2020 7070 7269 6e74 2866 226e 6f64 6520    pprint(f"node 
-0002cfb0: 7b6e 6f64 657d 2074 6f20 6265 2072 656d  {node} to be rem
-0002cfc0: 6f76 6564 2073 696e 6365 2069 7420 6f6e  oved since it on
-0002cfd0: 6c79 2068 6173 2074 6865 2066 6f6c 6c6f  ly has the follo
-0002cfe0: 7769 6e67 2070 6f64 733a 207b 6e6f 6465  wing pods: {node
-0002cff0: 735b 6e6f 6465 5d7d 2229 0a20 2020 2020  s[node]}").     
-0002d000: 2020 2020 2020 2020 2020 2074 6f64 656c             todel
-0002d010: 6574 6520 2b3d 2031 0a20 2020 2020 2020  ete += 1.       
-0002d020: 2069 6620 746f 6465 6c65 7465 203e 2030   if todelete > 0
-0002d030: 3a0a 2020 2020 2020 2020 2020 2020 7070  :.            pp
-0002d040: 7269 6e74 2866 2254 7269 6767 6572 696e  rint(f"Triggerin
-0002d050: 6720 7363 616c 696e 6720 646f 776e 2066  g scaling down f
-0002d060: 6f72 2063 6c75 7374 6572 207b 6b75 6265  or cluster {kube
-0002d070: 7d20 6173 2074 6865 7265 2061 7265 207b  } as there are {
-0002d080: 746f 6465 6c65 7465 7d20 6964 6c65 206e  todelete} idle n
-0002d090: 6f64 6573 2229 0a20 2020 2020 2020 2020  odes").         
-0002d0a0: 2020 2077 6f72 6b65 7273 203d 2077 6f72     workers = wor
-0002d0b0: 6b65 7273 202d 2074 6f64 656c 6574 650a  kers - todelete.
-0002d0c0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-0002d0d0: 6e74 2866 2253 6361 6c69 6e67 2064 6f77  nt(f"Scaling dow
-0002d0e0: 6e20 636c 7573 7465 7220 7b6b 7562 657d  n cluster {kube}
-0002d0f0: 2074 6f20 7b77 6f72 6b65 7273 7d20 776f   to {workers} wo
-0002d100: 726b 6572 7322 290a 2020 2020 2020 2020  rkers").        
-0002d110: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
-0002d120: 662e 7363 616c 655f 6b75 6265 286b 7562  f.scale_kube(kub
-0002d130: 652c 206b 7562 6574 7970 652c 206f 7665  e, kubetype, ove
-0002d140: 7272 6964 6573 3d7b 2777 6f72 6b65 7273  rrides={'workers
-0002d150: 273a 2077 6f72 6b65 7273 7d29 0a20 2020  ': workers}).   
-0002d160: 2020 2020 2020 2020 2072 6573 756c 745b           result[
-0002d170: 2777 6f72 6b65 7273 275d 203d 2077 6f72  'workers'] = wor
-0002d180: 6b65 7273 0a20 2020 2020 2020 2020 2020  kers.           
-0002d190: 2072 6574 7572 6e20 7265 7375 6c74 0a20   return result. 
-0002d1a0: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-0002d1b0: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
-0002d1c0: 7327 2c20 2777 6f72 6b65 7273 273a 2077  s', 'workers': w
-0002d1d0: 6f72 6b65 7273 7d0a 0a20 2020 2064 6566  orkers}..    def
-0002d1e0: 206c 6f6f 705f 6175 746f 7363 616c 655f   loop_autoscale_
-0002d1f0: 636c 7573 7465 7228 7365 6c66 2c20 6b75  cluster(self, ku
-0002d200: 6265 2c20 6b75 6265 7479 7065 2c20 776f  be, kubetype, wo
-0002d210: 726b 6572 732c 2074 6872 6573 686f 6c64  rkers, threshold
-0002d220: 2c20 6964 6c65 293a 0a20 2020 2020 2020  , idle):.       
-0002d230: 2070 7072 696e 7428 6622 5374 6172 7469   pprint(f"Starti
-0002d240: 6e67 2077 6974 6820 7b77 6f72 6b65 7273  ng with {workers
-0002d250: 7d20 776f 726b 6572 7322 290a 2020 2020  } workers").    
-0002d260: 2020 2020 6966 2077 6869 6368 2827 6b75      if which('ku
-0002d270: 6265 6374 6c27 2920 6973 204e 6f6e 653a  bectl') is None:
-0002d280: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
-0002d290: 6d6f 6e2e 6765 745f 6b75 6265 6374 6c28  mon.get_kubectl(
-0002d2a0: 290a 2020 2020 2020 2020 2020 2020 6f73  ).            os
-0002d2b0: 2e65 6e76 6972 6f6e 5b27 5041 5448 275d  .environ['PATH']
-0002d2c0: 202b 3d20 273a 2e27 0a20 2020 2020 2020   += ':.'.       
-0002d2d0: 2077 6869 6c65 2054 7275 653a 0a20 2020   while True:.   
-0002d2e0: 2020 2020 2020 2020 2073 656c 6563 746f           selecto
-0002d2f0: 7220 3d20 2221 6e6f 6465 2d72 6f6c 652e  r = "!node-role.
-0002d300: 6b75 6265 726e 6574 6573 2e69 6f2f 636f  kubernetes.io/co
-0002d310: 6e74 726f 6c2d 706c 616e 652c 6e6f 6465  ntrol-plane,node
-0002d320: 2d72 6f6c 652e 6b75 6265 726e 6574 6573  -role.kubernetes
-0002d330: 2e69 6f2f 776f 726b 6572 220a 2020 2020  .io/worker".    
-0002d340: 2020 2020 2020 2020 6375 7272 656e 7463          currentc
-0002d350: 6d64 203d 2066 226b 7562 6563 746c 2067  md = f"kubectl g
-0002d360: 6574 206e 6f64 6520 2d2d 7365 6c65 6374  et node --select
-0002d370: 6f72 3d27 7b73 656c 6563 746f 727d 2722  or='{selector}'"
-0002d380: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
+0002b0f0: 6375 726c 636d 6420 2b3d 2066 2720 2d48  curlcmd += f' -H
+0002b100: 2022 546f 3a20 7b61 6464 7265 7373 7d20   "To: {address} 
+0002b110: 3c7b 6164 6472 6573 737d 3e22 270a 2020  <{address}>"'.  
+0002b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b130: 2020 2020 2020 6375 726c 636d 6420 2b3d        curlcmd +=
+0002b140: 2027 202d 4620 223d 283b 7479 7065 3d6d   ' -F "=(;type=m
+0002b150: 756c 7469 7061 7274 2f6d 6978 6564 2220  ultipart/mixed" 
+0002b160: 2d46 2022 3d24 2863 6174 202f 7661 722f  -F "=$(cat /var/
+0002b170: 746d 702f 6d61 696c 2e74 7874 293b 7479  tmp/mail.txt);ty
+0002b180: 7065 3d74 6578 742f 706c 6169 6e22 270a  pe=text/plain"'.
+0002b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b1a0: 2020 2020 2020 2020 6375 726c 636d 6420          curlcmd 
+0002b1b0: 2b3d 2066 2720 2d46 2022 6669 6c65 3d40  += f' -F "file=@
+0002b1c0: 7b6b 7562 6563 6f6e 6669 677d 3b74 7970  {kubeconfig};typ
+0002b1d0: 653d 7465 7874 2f70 6c61 696e 3b65 6e63  e=text/plain;enc
+0002b1e0: 6f64 6572 3d62 6173 6536 3422 202d 4620  oder=base64" -F 
+0002b1f0: 223d 2922 270a 2020 2020 2020 2020 2020  "=)"'.          
+0002b200: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0002b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b220: 2020 2020 2020 2020 6375 726c 636d 6420          curlcmd 
+0002b230: 2b3d 2022 202d 2d75 706c 6f61 642d 6669  += " --upload-fi
+0002b240: 6c65 202f 7661 722f 746d 702f 6d61 696c  le /var/tmp/mail
+0002b250: 2e74 7874 220a 2020 2020 2020 2020 2020  .txt".          
+0002b260: 2020 2020 2020 2020 2020 6d61 696c 636d            mailcm
+0002b270: 642e 6170 7065 6e64 2863 7572 6c63 6d64  d.append(curlcmd
+0002b280: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002b290: 2020 2020 2020 636d 6473 2e65 7874 656e        cmds.exten
+0002b2a0: 6428 6d61 696c 636d 6429 0a20 2020 2020  d(mailcmd).     
+0002b2b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0002b2c0: 2020 2020 2020 2020 2020 2020 2065 7272               err
+0002b2d0: 6f72 2866 2249 6e76 616c 6964 206d 6574  or(f"Invalid met
+0002b2e0: 686f 6420 7b6e 6f74 6966 796d 6574 686f  hod {notifymetho
+0002b2f0: 647d 2229 0a20 2020 2020 2020 2072 6574  d}").        ret
+0002b300: 7572 6e20 636d 6473 2c20 6d61 696c 636f  urn cmds, mailco
+0002b310: 6e74 656e 740a 0a20 2020 2064 6566 2068  ntent..    def h
+0002b320: 616e 646c 655f 766d 5f72 6573 756c 7428  andle_vm_result(
+0002b330: 7365 6c66 2c20 6e61 6d65 2c20 7072 6f66  self, name, prof
+0002b340: 696c 652c 2072 6573 756c 742c 206e 6577  ile, result, new
+0002b350: 766d 732c 2066 6169 6c65 6476 6d73 2c20  vms, failedvms, 
+0002b360: 6173 796e 6377 6169 7476 6d73 2c20 6f6e  asyncwaitvms, on
+0002b370: 6c79 6173 7365 7473 3d46 616c 7365 2c20  lyassets=False, 
+0002b380: 6e65 7761 7373 6574 733d 5b5d 2c0a 2020  newassets=[],.  
+0002b390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b3a0: 2020 2020 2020 2076 6d63 6c69 656e 743d         vmclient=
+0002b3b0: 4e6f 6e65 293a 0a20 2020 2020 2020 2069  None):.        i
+0002b3c0: 6620 2772 6573 756c 7427 2069 6e20 7265  f 'result' in re
+0002b3d0: 7375 6c74 2061 6e64 2072 6573 756c 745b  sult and result[
+0002b3e0: 2772 6573 756c 7427 5d20 3d3d 2027 7375  'result'] == 'su
+0002b3f0: 6363 6573 7327 3a0a 2020 2020 2020 2020  ccess':.        
+0002b400: 2020 2020 6e65 7776 6d73 2e61 7070 656e      newvms.appen
+0002b410: 6428 6e61 6d65 290a 2020 2020 2020 2020  d(name).        
+0002b420: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0002b430: 2020 6661 696c 6564 766d 732e 6170 7065    failedvms.appe
+0002b440: 6e64 287b 276e 616d 6527 3a20 6e61 6d65  nd({'name': name
+0002b450: 2c20 2772 6561 736f 6e27 3a20 7265 7375  , 'reason': resu
+0002b460: 6c74 5b27 7265 6173 6f6e 275d 7d29 0a20  lt['reason']}). 
+0002b470: 2020 2020 2020 2073 7461 7274 203d 2070         start = p
+0002b480: 726f 6669 6c65 2e67 6574 2827 7374 6172  rofile.get('star
+0002b490: 7427 2c20 5472 7565 290a 2020 2020 2020  t', True).      
+0002b4a0: 2020 636c 6f75 6469 6e69 7420 3d20 7072    cloudinit = pr
+0002b4b0: 6f66 696c 652e 6765 7428 2763 6c6f 7564  ofile.get('cloud
+0002b4c0: 696e 6974 272c 2054 7275 6529 0a20 2020  init', True).   
+0002b4d0: 2020 2020 2061 7379 6e63 7761 6974 203d       asyncwait =
+0002b4e0: 2070 726f 6669 6c65 2e67 6574 2827 6173   profile.get('as
+0002b4f0: 796e 6377 6169 7427 2c20 4661 6c73 6529  yncwait', False)
+0002b500: 0a20 2020 2020 2020 2066 696e 6973 6866  .        finishf
+0002b510: 696c 6573 203d 2070 726f 6669 6c65 2e67  iles = profile.g
+0002b520: 6574 2827 6669 6e69 7368 6669 6c65 7327  et('finishfiles'
+0002b530: 2c20 5b5d 290a 2020 2020 2020 2020 6966  , []).        if
+0002b540: 206f 6e6c 7961 7373 6574 733a 0a20 2020   onlyassets:.   
+0002b550: 2020 2020 2020 2020 2069 6620 2764 6174           if 'dat
+0002b560: 6127 2069 6e20 7265 7375 6c74 3a0a 2020  a' in result:.  
+0002b570: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0002b580: 7761 7373 6574 732e 6170 7065 6e64 2872  wassets.append(r
+0002b590: 6573 756c 745b 2764 6174 6127 5d29 0a20  esult['data']). 
+0002b5a0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0002b5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b5c0: 2065 7272 6f72 2872 6573 756c 745b 2772   error(result['r
+0002b5d0: 6561 736f 6e27 5d29 0a20 2020 2020 2020  eason']).       
+0002b5e0: 2069 6620 6e6f 7420 6173 796e 6377 6169   if not asyncwai
+0002b5f0: 743a 0a20 2020 2020 2020 2020 2020 2072  t:.            r
+0002b600: 6574 7572 6e0a 2020 2020 2020 2020 656c  eturn.        el
+0002b610: 6966 206e 6f74 2073 7461 7274 206f 7220  if not start or 
+0002b620: 6e6f 7420 636c 6f75 6469 6e69 7420 6f72  not cloudinit or
+0002b630: 2070 726f 6669 6c65 2e67 6574 2827 696d   profile.get('im
+0002b640: 6167 6527 2920 6973 204e 6f6e 653a 0a20  age') is None:. 
+0002b650: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+0002b660: 7428 6622 536b 6970 7069 6e67 2077 6169  t(f"Skipping wai
+0002b670: 7420 6f6e 207b 6e61 6d65 7d22 290a 2020  t on {name}").  
+0002b680: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0002b690: 2020 2020 2020 2020 7761 6974 636f 6d6d          waitcomm
+0002b6a0: 616e 6420 3d20 7072 6f66 696c 652e 6765  and = profile.ge
+0002b6b0: 7428 2777 6169 7463 6f6d 6d61 6e64 2729  t('waitcommand')
+0002b6c0: 0a20 2020 2020 2020 2020 2020 2077 6169  .            wai
+0002b6d0: 7474 696d 656f 7574 203d 2070 726f 6669  ttimeout = profi
+0002b6e0: 6c65 2e67 6574 2827 7761 6974 7469 6d65  le.get('waittime
+0002b6f0: 6f75 7427 2c20 3029 0a20 2020 2020 2020  out', 0).       
+0002b700: 2020 2020 2061 7379 6e63 7761 6974 766d       asyncwaitvm
+0002b710: 203d 207b 276e 616d 6527 3a20 6e61 6d65   = {'name': name
+0002b720: 2c20 2766 696e 6973 6866 696c 6573 273a  , 'finishfiles':
+0002b730: 2066 696e 6973 6866 696c 6573 2c20 2777   finishfiles, 'w
+0002b740: 6169 7463 6f6d 6d61 6e64 273a 2077 6169  aitcommand': wai
+0002b750: 7463 6f6d 6d61 6e64 2c0a 2020 2020 2020  tcommand,.      
+0002b760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b770: 2020 2020 2027 7761 6974 7469 6d65 6f75       'waittimeou
+0002b780: 7427 3a20 7761 6974 7469 6d65 6f75 742c  t': waittimeout,
+0002b790: 2027 766d 636c 6965 6e74 273a 2076 6d63   'vmclient': vmc
+0002b7a0: 6c69 656e 747d 0a20 2020 2020 2020 2020  lient}.         
+0002b7b0: 2020 2061 7379 6e63 7761 6974 766d 732e     asyncwaitvms.
+0002b7c0: 6170 7065 6e64 2861 7379 6e63 7761 6974  append(asyncwait
+0002b7d0: 766d 290a 0a20 2020 2064 6566 2074 6872  vm)..    def thr
+0002b7e0: 6561 6465 645f 6372 6561 7465 5f76 6d28  eaded_create_vm(
+0002b7f0: 7365 6c66 2c20 6e61 6d65 2c20 7072 6f66  self, name, prof
+0002b800: 696c 656e 616d 652c 2063 7572 7265 6e74  ilename, current
+0002b810: 6f76 6572 7269 6465 732c 2070 726f 6669  overrides, profi
+0002b820: 6c65 2c20 7a2c 2070 6c61 6e2c 2063 7572  le, z, plan, cur
+0002b830: 7265 6e74 706c 616e 6469 722c 2076 6d63  rentplandir, vmc
+0002b840: 6c69 656e 742c 0a20 2020 2020 2020 2020  lient,.         
+0002b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b860: 2020 6f6e 666c 792c 206f 6e6c 7961 7373    onfly, onlyass
+0002b870: 6574 732c 206e 6577 766d 732c 2066 6169  ets, newvms, fai
+0002b880: 6c65 6476 6d73 2c20 6173 796e 6377 6169  ledvms, asyncwai
+0002b890: 7476 6d73 2c20 6e65 7761 7373 6574 7329  tvms, newassets)
+0002b8a0: 3a0a 2020 2020 2020 2020 7265 7375 6c74  :.        result
+0002b8b0: 203d 2073 656c 662e 6372 6561 7465 5f76   = self.create_v
+0002b8c0: 6d28 6e61 6d65 2c20 7072 6f66 696c 656e  m(name, profilen
+0002b8d0: 616d 652c 206f 7665 7272 6964 6573 3d63  ame, overrides=c
+0002b8e0: 7572 7265 6e74 6f76 6572 7269 6465 732c  urrentoverrides,
+0002b8f0: 2063 7573 746f 6d70 726f 6669 6c65 3d70   customprofile=p
+0002b900: 726f 6669 6c65 2c20 6b3d 7a2c 0a20 2020  rofile, k=z,.   
+0002b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b920: 2020 2020 2020 2020 2020 2020 2070 6c61               pla
+0002b930: 6e3d 706c 616e 2c20 6261 7365 6469 723d  n=plan, basedir=
+0002b940: 6375 7272 656e 7470 6c61 6e64 6972 2c20  currentplandir, 
+0002b950: 636c 6965 6e74 3d76 6d63 6c69 656e 742c  client=vmclient,
+0002b960: 206f 6e66 6c79 3d6f 6e66 6c79 2c0a 2020   onfly=onfly,.  
+0002b970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b980: 2020 2020 2020 2020 2020 2020 2020 6f6e                on
+0002b990: 6c79 6173 7365 7473 3d6f 6e6c 7961 7373  lyassets=onlyass
+0002b9a0: 6574 7329 0a20 2020 2020 2020 2069 6620  ets).        if 
+0002b9b0: 6e6f 7420 6f6e 6c79 6173 7365 7473 3a0a  not onlyassets:.
+0002b9c0: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
+0002b9d0: 6f6e 2e68 616e 646c 655f 7265 7370 6f6e  on.handle_respon
+0002b9e0: 7365 2872 6573 756c 742c 206e 616d 652c  se(result, name,
+0002b9f0: 2063 6c69 656e 743d 766d 636c 6965 6e74   client=vmclient
+0002ba00: 290a 2020 2020 2020 2020 7365 6c66 2e68  ).        self.h
+0002ba10: 616e 646c 655f 766d 5f72 6573 756c 7428  andle_vm_result(
+0002ba20: 6e61 6d65 2c20 7072 6f66 696c 652c 2072  name, profile, r
+0002ba30: 6573 756c 743d 7265 7375 6c74 2c20 6e65  esult=result, ne
+0002ba40: 7776 6d73 3d6e 6577 766d 732c 2066 6169  wvms=newvms, fai
+0002ba50: 6c65 6476 6d73 3d66 6169 6c65 6476 6d73  ledvms=failedvms
+0002ba60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ba80: 6173 796e 6377 6169 7476 6d73 3d61 7379  asyncwaitvms=asy
+0002ba90: 6e63 7761 6974 766d 732c 206f 6e6c 7961  ncwaitvms, onlya
+0002baa0: 7373 6574 733d 6f6e 6c79 6173 7365 7473  ssets=onlyassets
+0002bab0: 2c20 6e65 7761 7373 6574 733d 6e65 7761  , newassets=newa
+0002bac0: 7373 6574 732c 2076 6d63 6c69 656e 743d  ssets, vmclient=
+0002bad0: 766d 636c 6965 6e74 290a 0a20 2020 2064  vmclient)..    d
+0002bae0: 6566 2070 6172 7365 5f66 696c 6573 2873  ef parse_files(s
+0002baf0: 656c 662c 206e 616d 652c 2066 696c 6573  elf, name, files
+0002bb00: 2c20 6261 7365 6469 723d 272e 272c 206f  , basedir='.', o
+0002bb10: 6e66 6c79 3d4e 6f6e 6529 3a0a 2020 2020  nfly=None):.    
+0002bb20: 2020 2020 6966 206e 6f74 2066 696c 6573      if not files
+0002bb30: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0002bb40: 7475 726e 0a20 2020 2020 2020 2066 6f72  turn.        for
+0002bb50: 2069 6e64 6578 2c20 6669 6c20 696e 2065   index, fil in e
+0002bb60: 6e75 6d65 7261 7465 2866 696c 6573 293a  numerate(files):
+0002bb70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0002bb80: 6973 696e 7374 616e 6365 2866 696c 2c20  isinstance(fil, 
+0002bb90: 7374 7229 3a0a 2020 2020 2020 2020 2020  str):.          
+0002bba0: 2020 2020 2020 7061 7468 203d 2066 222f        path = f"/
+0002bbb0: 726f 6f74 2f7b 6669 6c7d 220a 2020 2020  root/{fil}".    
+0002bbc0: 2020 2020 2020 2020 2020 2020 6966 2062              if b
+0002bbd0: 6173 6564 6972 2021 3d20 272e 273a 0a20  asedir != '.':. 
+0002bbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bbf0: 2020 206f 7269 6769 6e20 3d20 6622 7b62     origin = f"{b
+0002bc00: 6173 6564 6972 7d2f 7b70 6174 687d 220a  asedir}/{path}".
+0002bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bc20: 6f72 6967 696e 203d 2066 696c 0a20 2020  origin = fil.   
+0002bc30: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0002bc40: 7465 6e74 203d 204e 6f6e 650a 2020 2020  tent = None.    
+0002bc50: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0002bc60: 735b 696e 6465 785d 203d 207b 2770 6174  s[index] = {'pat
+0002bc70: 6827 3a20 7061 7468 2c20 276f 7269 6769  h': path, 'origi
+0002bc80: 6e27 3a20 6f72 6967 696e 7d0a 2020 2020  n': origin}.    
+0002bc90: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
+0002bca0: 6e73 7461 6e63 6528 6669 6c2c 2064 6963  nstance(fil, dic
+0002bcb0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0002bcc0: 2020 2020 6f72 6967 696e 203d 2066 696c      origin = fil
+0002bcd0: 2e67 6574 2827 6f72 6967 696e 2729 0a20  .get('origin'). 
+0002bce0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0002bcf0: 6f6e 7465 6e74 203d 2066 696c 2e67 6574  ontent = fil.get
+0002bd00: 2827 636f 6e74 656e 7427 290a 2020 2020  ('content').    
+0002bd10: 2020 2020 2020 2020 2020 2020 7061 7468              path
+0002bd20: 203d 2066 696c 2e67 6574 2827 7061 7468   = fil.get('path
+0002bd30: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0002bd40: 2020 2069 6620 7061 7468 2069 7320 4e6f     if path is No
+0002bd50: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0002bd60: 2020 2020 2020 2020 6966 206f 7269 6769          if origi
+0002bd70: 6e20 6973 206e 6f74 204e 6f6e 653a 0a20  n is not None:. 
+0002bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bd90: 2020 2020 2020 2066 696c 6573 5b69 6e64         files[ind
+0002bda0: 6578 5d5b 2770 6174 6827 5d20 3d20 6622  ex]['path'] = f"
+0002bdb0: 2f72 6f6f 742f 7b6f 7269 6769 6e7d 220a  /root/{origin}".
+0002bdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bdd0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0002bde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bdf0: 2020 6572 726f 7228 6622 496e 636f 7272    error(f"Incorr
+0002be00: 6563 7420 656e 7472 7920 7b66 696c 7d2e  ect entry {fil}.
+0002be10: 4c65 6176 696e 672e 2e2e 2229 0a20 2020  Leaving...").   
+0002be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002be30: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+0002be40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002be50: 2065 6c69 6620 6e6f 7420 7061 7468 2e73   elif not path.s
+0002be60: 7461 7274 7377 6974 6828 272f 2729 3a0a  tartswith('/'):.
+0002be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002be80: 2020 2020 6572 726f 7228 6622 496e 636f      error(f"Inco
+0002be90: 7272 6563 7420 7061 7468 207b 7061 7468  rrect path {path
+0002bea0: 7d2e 4c65 6176 696e 672e 2e2e 2229 0a20  }.Leaving..."). 
+0002beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bec0: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
+0002bed0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0002bee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002bef0: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
+0002bf00: 273a 2027 6661 696c 7572 6527 2c20 2772  ': 'failure', 'r
+0002bf10: 6561 736f 6e27 3a20 2249 6e63 6f72 7265  eason': "Incorre
+0002bf20: 6374 2066 696c 6520 656e 7472 7922 7d0a  ct file entry"}.
+0002bf30: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+0002bf40: 7269 6769 6e20 6973 206e 6f74 204e 6f6e  rigin is not Non
+0002bf50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002bf60: 2020 2069 6620 6f6e 666c 7920 6973 206e     if onfly is n
+0002bf70: 6f74 204e 6f6e 6520 616e 6420 277e 2720  ot None and '~' 
+0002bf80: 6e6f 7420 696e 206f 7269 6769 6e3a 0a20  not in origin:. 
+0002bf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bfa0: 2020 2064 6573 7464 6972 203d 2062 6173     destdir = bas
+0002bfb0: 6564 6972 0a20 2020 2020 2020 2020 2020  edir.           
+0002bfc0: 2020 2020 2020 2020 2069 6620 272f 2720           if '/' 
+0002bfd0: 696e 206f 7269 6769 6e3a 0a20 2020 2020  in origin:.     
+0002bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bff0: 2020 2064 6573 7464 6972 203d 206f 732e     destdir = os.
+0002c000: 7061 7468 2e64 6972 6e61 6d65 286f 7269  path.dirname(ori
+0002c010: 6769 6e29 0a20 2020 2020 2020 2020 2020  gin).           
+0002c020: 2020 2020 2020 2020 2020 2020 206f 732e               os.
+0002c030: 6d61 6b65 6469 7273 2864 6573 7464 6972  makedirs(destdir
+0002c040: 2c20 6578 6973 745f 6f6b 3d54 7275 6529  , exist_ok=True)
+0002c050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c060: 2020 2020 2063 6f6d 6d6f 6e2e 6665 7463       common.fetc
+0002c070: 6828 6622 7b6f 6e66 6c79 7d2f 7b6f 7269  h(f"{onfly}/{ori
+0002c080: 6769 6e7d 222c 2064 6573 7464 6972 290a  gin}", destdir).
+0002c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c0a0: 6f72 6967 696e 203d 206f 732e 7061 7468  origin = os.path
+0002c0b0: 2e65 7870 616e 6475 7365 7228 6f72 6967  .expanduser(orig
+0002c0c0: 696e 290a 2020 2020 2020 2020 2020 2020  in).            
+0002c0d0: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
+0002c0e0: 7468 2e69 7361 6273 286f 7269 6769 6e29  th.isabs(origin)
+0002c0f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002c100: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0002c110: 6e63 6528 6669 6c2c 2064 6963 7429 2061  nce(fil, dict) a
+0002c120: 6e64 2066 696c 2e67 6574 2827 6375 7272  nd fil.get('curr
+0002c130: 656e 7464 6972 272c 2046 616c 7365 293a  entdir', False):
+0002c140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c150: 2020 2020 2020 2020 206f 7269 6769 6e20           origin 
+0002c160: 3d20 6622 7b6f 732e 6765 7463 7764 2829  = f"{os.getcwd()
+0002c170: 7d2f 7b6f 7269 6769 6e7d 220a 2020 2020  }/{origin}".    
+0002c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c190: 2020 2020 6669 6c65 735b 696e 6465 785d      files[index]
+0002c1a0: 5b27 6f72 6967 696e 275d 203d 206f 7269  ['origin'] = ori
+0002c1b0: 6769 6e0a 2020 2020 2020 2020 2020 2020  gin.            
+0002c1c0: 2020 2020 2020 2020 656c 6966 2062 6173          elif bas
+0002c1d0: 6564 6972 2021 3d20 272e 2720 616e 6420  edir != '.' and 
+0002c1e0: 6e6f 7420 6f72 6967 696e 2e73 7461 7274  not origin.start
+0002c1f0: 7377 6974 6828 272e 2f27 2920 616e 6420  swith('./') and 
+0002c200: 6e6f 7420 6f72 6967 696e 2e73 7461 7274  not origin.start
+0002c210: 7377 6974 6828 272f 776f 726b 6469 722f  swith('/workdir/
+0002c220: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
+0002c230: 2020 2020 2020 2020 2020 2020 6f72 6967              orig
+0002c240: 696e 203d 2066 227b 6261 7365 6469 727d  in = f"{basedir}
+0002c250: 2f7b 6f72 6967 696e 7d22 0a20 2020 2020  /{origin}".     
+0002c260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c270: 2020 2066 696c 6573 5b69 6e64 6578 5d5b     files[index][
+0002c280: 276f 7269 6769 6e27 5d20 3d20 6f72 6967  'origin'] = orig
+0002c290: 696e 0a20 2020 2020 2020 2020 2020 2020  in.             
+0002c2a0: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
+0002c2b0: 682e 6578 6973 7473 286f 7269 6769 6e29  h.exists(origin)
+0002c2c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002c2d0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
+0002c2e0: 6573 756c 7427 3a20 2766 6169 6c75 7265  esult': 'failure
+0002c2f0: 272c 2027 7265 6173 6f6e 273a 2066 224f  ', 'reason': f"O
+0002c300: 7269 6769 6e20 6669 6c65 207b 6f72 6967  rigin file {orig
+0002c310: 696e 7d20 6e6f 7420 666f 756e 6420 666f  in} not found fo
+0002c320: 7220 7b6e 616d 657d 227d 0a20 2020 2020  r {name}"}.     
+0002c330: 2020 2020 2020 2065 6c69 6620 636f 6e74         elif cont
+0002c340: 656e 7420 6973 204e 6f6e 653a 0a20 2020  ent is None:.   
+0002c350: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0002c360: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
+0002c370: 6661 696c 7572 6527 2c20 2772 6561 736f  failure', 'reaso
+0002c380: 6e27 3a20 6622 436f 6e74 656e 7420 6f66  n': f"Content of
+0002c390: 2066 696c 6520 7b70 6174 687d 206e 6f74   file {path} not
+0002c3a0: 2066 6f75 6e64 2066 6f72 207b 6e61 6d65   found for {name
+0002c3b0: 7d22 7d0a 0a20 2020 2064 6566 2070 7265  }"}..    def pre
+0002c3c0: 7065 6e64 5f69 6e70 7574 5f64 6972 2873  pend_input_dir(s
+0002c3d0: 656c 662c 206e 6577 6669 6c65 732c 2069  elf, newfiles, i
+0002c3e0: 6e70 7574 6469 7229 3a0a 2020 2020 2020  nputdir):.      
+0002c3f0: 2020 7265 7375 6c74 7320 3d20 5b5d 0a20    results = []. 
+0002c400: 2020 2020 2020 2066 6f72 2066 6963 2069         for fic i
+0002c410: 6e20 6e65 7766 696c 6573 3a0a 2020 2020  n newfiles:.    
+0002c420: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0002c430: 7461 6e63 6528 6669 632c 2073 7472 2920  tance(fic, str) 
+0002c440: 616e 6420 6e6f 7420 6f73 2e70 6174 682e  and not os.path.
+0002c450: 6973 6162 7328 6669 6329 3a0a 2020 2020  isabs(fic):.    
+0002c460: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0002c470: 6669 6320 3d20 6622 7b69 6e70 7574 6469  fic = f"{inputdi
+0002c480: 727d 2f7b 6669 637d 220a 2020 2020 2020  r}/{fic}".      
+0002c490: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+0002c4a0: 7461 6e63 6528 6669 632c 2064 6963 7429  tance(fic, dict)
+0002c4b0: 2061 6e64 2027 6f72 6967 696e 2720 696e   and 'origin' in
+0002c4c0: 2066 6963 2061 6e64 206e 6f74 206f 732e   fic and not os.
+0002c4d0: 7061 7468 2e69 7361 6273 286f 732e 7061  path.isabs(os.pa
+0002c4e0: 7468 2e65 7870 616e 6475 7365 7228 6669  th.expanduser(fi
+0002c4f0: 635b 276f 7269 6769 6e27 5d29 293a 0a20  c['origin'])):. 
+0002c500: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0002c510: 6577 5f66 6963 203d 2066 6963 2e63 6f70  ew_fic = fic.cop
+0002c520: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
+0002c530: 2020 2020 6e65 775f 6669 635b 276f 7269      new_fic['ori
+0002c540: 6769 6e27 5d20 3d20 6622 7b69 6e70 7574  gin'] = f"{input
+0002c550: 6469 727d 2f7b 6669 635b 276f 7269 6769  dir}/{fic['origi
+0002c560: 6e27 5d7d 220a 2020 2020 2020 2020 2020  n']}".          
+0002c570: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002c580: 2020 2020 2020 2020 6e65 775f 6669 6320          new_fic 
+0002c590: 3d20 6669 630a 2020 2020 2020 2020 2020  = fic.          
+0002c5a0: 2020 7265 7375 6c74 732e 6170 7065 6e64    results.append
+0002c5b0: 286e 6577 5f66 6963 290a 2020 2020 2020  (new_fic).      
+0002c5c0: 2020 7265 7475 726e 2072 6573 756c 7473    return results
+0002c5d0: 0a0a 2020 2020 6465 6620 7265 6d65 6469  ..    def remedi
+0002c5e0: 6174 655f 6669 6c65 7328 7365 6c66 2c20  ate_files(self, 
+0002c5f0: 6e61 6d65 2c20 6e65 7766 696c 6573 2c20  name, newfiles, 
+0002c600: 6f76 6572 7269 6465 733d 7b7d 2c20 696e  overrides={}, in
+0002c610: 7075 7464 6972 3d27 2e27 293a 0a20 2020  putdir='.'):.   
+0002c620: 2020 2020 2075 7064 6174 6564 5f66 696c       updated_fil
+0002c630: 6573 203d 205b 5d0a 2020 2020 2020 2020  es = [].        
+0002c640: 6970 2c20 766d 706f 7274 203d 205f 7373  ip, vmport = _ss
+0002c650: 685f 6372 6564 656e 7469 616c 7328 7365  h_credentials(se
+0002c660: 6c66 2e6b 2c20 6e61 6d65 295b 313a 5d0a  lf.k, name)[1:].
+0002c670: 2020 2020 2020 2020 6966 2069 6e70 7574          if input
+0002c680: 6469 7220 213d 2027 2e27 3a0a 2020 2020  dir != '.':.    
+0002c690: 2020 2020 2020 2020 6e65 7766 696c 6573          newfiles
+0002c6a0: 203d 2073 656c 662e 7072 6570 656e 645f   = self.prepend_
+0002c6b0: 696e 7075 745f 6469 7228 6e65 7766 696c  input_dir(newfil
+0002c6c0: 6573 2c20 696e 7075 7464 6972 290a 2020  es, inputdir).  
+0002c6d0: 2020 2020 2020 7365 6c66 2e70 6172 7365        self.parse
+0002c6e0: 5f66 696c 6573 286e 616d 652c 206e 6577  _files(name, new
+0002c6f0: 6669 6c65 7329 0a20 2020 2020 2020 206f  files).        o
+0002c700: 7665 7272 6964 6573 5f66 696c 6573 203d  verrides_files =
+0002c710: 206f 7665 7272 6964 6573 2e63 6f70 7928   overrides.copy(
+0002c720: 290a 2020 2020 2020 2020 6f76 6572 7269  ).        overri
+0002c730: 6465 735f 6669 6c65 735b 276e 616d 6527  des_files['name'
+0002c740: 5d20 3d20 6e61 6d65 0a20 2020 2020 2020  ] = name.       
+0002c750: 2064 6174 6120 3d20 7072 6f63 6573 735f   data = process_
+0002c760: 6669 6c65 7328 6669 6c65 733d 6e65 7766  files(files=newf
+0002c770: 696c 6573 2c20 6f76 6572 7269 6465 733d  iles, overrides=
+0002c780: 6f76 6572 7269 6465 735f 6669 6c65 732c  overrides_files,
+0002c790: 2072 656d 6564 6961 7465 3d54 7275 6529   remediate=True)
+0002c7a0: 0a20 2020 2020 2020 2064 6174 6164 6972  .        datadir
+0002c7b0: 7320 3d20 7b7d 0a20 2020 2020 2020 2077  s = {}.        w
+0002c7c0: 6974 6820 5465 6d70 6f72 6172 7944 6972  ith TemporaryDir
+0002c7d0: 6563 746f 7279 2829 2061 7320 746d 7064  ectory() as tmpd
+0002c7e0: 6972 3a0a 2020 2020 2020 2020 2020 2020  ir:.            
+0002c7f0: 666f 7220 696e 6465 782c 2065 6e74 7279  for index, entry
+0002c800: 2069 6e20 656e 756d 6572 6174 6528 6461   in enumerate(da
+0002c810: 7461 293a 0a20 2020 2020 2020 2020 2020  ta):.           
+0002c820: 2020 2020 2064 6573 7469 6e61 7469 6f6e       destination
+0002c830: 203d 2065 6e74 7279 5b27 7061 7468 275d   = entry['path']
+0002c840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c850: 2070 6174 6864 6972 203d 206f 732e 7061   pathdir = os.pa
+0002c860: 7468 2e64 6972 6e61 6d65 2864 6573 7469  th.dirname(desti
+0002c870: 6e61 7469 6f6e 290a 2020 2020 2020 2020  nation).        
+0002c880: 2020 2020 2020 2020 6966 2070 6174 6864          if pathd
+0002c890: 6972 206e 6f74 2069 6e20 6461 7461 6469  ir not in datadi
+0002c8a0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+0002c8b0: 2020 2020 2020 2020 7061 7468 6469 7263          pathdirc
+0002c8c0: 6d64 203d 2066 276c 7320 2d61 207b 7061  md = f'ls -a {pa
+0002c8d0: 7468 6469 727d 2032 3e26 3127 0a20 2020  thdir} 2>&1'.   
+0002c8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c8f0: 2070 6174 6864 6972 636d 6420 3d20 7373   pathdircmd = ss
+0002c900: 6828 6e61 6d65 2c20 6970 3d69 702c 2075  h(name, ip=ip, u
+0002c910: 7365 723d 2772 6f6f 7427 2c20 7475 6e6e  ser='root', tunn
+0002c920: 656c 3d73 656c 662e 7475 6e6e 656c 2c20  el=self.tunnel, 
+0002c930: 7475 6e6e 656c 686f 7374 3d73 656c 662e  tunnelhost=self.
+0002c940: 7475 6e6e 656c 686f 7374 2c0a 2020 2020  tunnelhost,.    
+0002c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c970: 2074 756e 6e65 6c70 6f72 743d 7365 6c66   tunnelport=self
+0002c980: 2e74 756e 6e65 6c70 6f72 742c 2074 756e  .tunnelport, tun
+0002c990: 6e65 6c75 7365 723d 7365 6c66 2e74 756e  neluser=self.tun
+0002c9a0: 6e65 6c75 7365 722c 2069 6e73 6563 7572  neluser, insecur
+0002c9b0: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
+0002c9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c9d0: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
+0002c9e0: 3d70 6174 6864 6972 636d 642c 2076 6d70  =pathdircmd, vmp
+0002c9f0: 6f72 743d 766d 706f 7274 290a 2020 2020  ort=vmport).    
+0002ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ca10: 7061 7468 6469 7266 696c 6573 203d 206f  pathdirfiles = o
+0002ca20: 732e 706f 7065 6e28 7061 7468 6469 7263  s.popen(pathdirc
+0002ca30: 6d64 292e 7265 6164 6c69 6e65 7328 290a  md).readlines().
+0002ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ca50: 2020 2020 6966 206c 656e 2870 6174 6864      if len(pathd
+0002ca60: 6972 6669 6c65 7329 203d 3d20 3120 616e  irfiles) == 1 an
+0002ca70: 6420 274e 6f20 7375 6368 2066 696c 6520  d 'No such file 
+0002ca80: 6f72 2064 6972 6563 746f 7279 2720 696e  or directory' in
+0002ca90: 2070 6174 6864 6972 6669 6c65 735b 305d   pathdirfiles[0]
+0002caa0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002cab0: 2020 2020 2020 2020 2020 6372 6561 7465            create
+0002cac0: 6469 7263 6d64 203d 2066 276d 6b64 6972  dircmd = f'mkdir
+0002cad0: 202d 7020 7b70 6174 6864 6972 7d27 0a20   -p {pathdir}'. 
+0002cae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002caf0: 2020 2020 2020 2063 7265 6174 6564 6972         createdir
+0002cb00: 636d 6420 3d20 7373 6828 6e61 6d65 2c20  cmd = ssh(name, 
+0002cb10: 6970 3d69 702c 2075 7365 723d 2772 6f6f  ip=ip, user='roo
+0002cb20: 7427 2c20 7475 6e6e 656c 3d73 656c 662e  t', tunnel=self.
+0002cb30: 7475 6e6e 656c 2c20 7475 6e6e 656c 686f  tunnel, tunnelho
+0002cb40: 7374 3d73 656c 662e 7475 6e6e 656c 686f  st=self.tunnelho
+0002cb50: 7374 2c0a 2020 2020 2020 2020 2020 2020  st,.            
+0002cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cb70: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0002cb80: 756e 6e65 6c70 6f72 743d 7365 6c66 2e74  unnelport=self.t
+0002cb90: 756e 6e65 6c70 6f72 742c 2074 756e 6e65  unnelport, tunne
+0002cba0: 6c75 7365 723d 7365 6c66 2e74 756e 6e65  luser=self.tunne
+0002cbb0: 6c75 7365 722c 2069 6e73 6563 7572 653d  luser, insecure=
+0002cbc0: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+0002cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cbf0: 2063 6d64 3d63 7265 6174 6564 6972 636d   cmd=createdircm
+0002cc00: 642c 2076 6d70 6f72 743d 766d 706f 7274  d, vmport=vmport
+0002cc10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002cc20: 2020 2020 2020 2020 2020 6f73 2e70 6f70            os.pop
+0002cc30: 656e 2863 7265 6174 6564 6972 636d 6429  en(createdircmd)
+0002cc40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002cc50: 2020 2020 2020 2020 2070 6174 6864 6972           pathdir
+0002cc60: 6669 6c65 7320 3d20 5b5d 0a20 2020 2020  files = [].     
+0002cc70: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0002cc80: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0002cc90: 2020 2020 2020 2020 2020 2020 2070 6174               pat
+0002cca0: 6864 6972 6669 6c65 7320 3d20 5b78 2e73  hdirfiles = [x.s
+0002ccb0: 7472 6970 2829 2066 6f72 2078 2069 6e20  trip() for x in 
+0002ccc0: 7061 7468 6469 7266 696c 6573 5d0a 2020  pathdirfiles].  
+0002ccd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cce0: 2020 6461 7461 6469 7273 5b70 6174 6864    datadirs[pathd
+0002ccf0: 6972 5d20 3d20 7061 7468 6469 7266 696c  ir] = pathdirfil
+0002cd00: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+0002cd10: 2020 2069 6620 6f73 2e70 6174 682e 6261     if os.path.ba
+0002cd20: 7365 6e61 6d65 2864 6573 7469 6e61 7469  sename(destinati
+0002cd30: 6f6e 2920 6e6f 7420 696e 2064 6174 6164  on) not in datad
+0002cd40: 6972 735b 7061 7468 6469 725d 3a0a 2020  irs[pathdir]:.  
+0002cd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cd60: 2020 7070 7269 6e74 2866 2255 7064 6174    pprint(f"Updat
+0002cd70: 696e 6720 7b64 6573 7469 6e61 7469 6f6e  ing {destination
+0002cd80: 7d20 696e 207b 6e61 6d65 7d22 290a 2020  } in {name}").  
+0002cd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cda0: 2020 736f 7572 6365 203d 2066 227b 746d    source = f"{tm
+0002cdb0: 7064 6972 7d2f 6669 637b 696e 6465 787d  pdir}/fic{index}
+0002cdc0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0002cdd0: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+0002cde0: 736f 7572 6365 2c20 2777 2729 2061 7320  source, 'w') as 
+0002cdf0: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
+0002ce00: 2020 2020 2020 2020 2020 2066 2e77 7269             f.wri
+0002ce10: 7465 2865 6e74 7279 5b27 636f 6e74 656e  te(entry['conten
+0002ce20: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
+0002ce30: 2020 2020 2020 2020 2073 6370 636d 6420           scpcmd 
+0002ce40: 3d20 7363 7028 6e61 6d65 2c20 6970 3d69  = scp(name, ip=i
+0002ce50: 702c 2075 7365 723d 2772 6f6f 7427 2c20  p, user='root', 
+0002ce60: 736f 7572 6365 3d73 6f75 7263 652c 2064  source=source, d
+0002ce70: 6573 7469 6e61 7469 6f6e 3d64 6573 7469  estination=desti
+0002ce80: 6e61 7469 6f6e 2c20 7475 6e6e 656c 3d73  nation, tunnel=s
+0002ce90: 656c 662e 7475 6e6e 656c 2c0a 2020 2020  elf.tunnel,.    
+0002cea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ceb0: 2020 2020 2020 2020 2020 2020 2074 756e               tun
+0002cec0: 6e65 6c68 6f73 743d 7365 6c66 2e74 756e  nelhost=self.tun
+0002ced0: 6e65 6c68 6f73 742c 2074 756e 6e65 6c70  nelhost, tunnelp
+0002cee0: 6f72 743d 7365 6c66 2e74 756e 6e65 6c70  ort=self.tunnelp
+0002cef0: 6f72 742c 2074 756e 6e65 6c75 7365 723d  ort, tunneluser=
+0002cf00: 7365 6c66 2e74 756e 6e65 6c75 7365 722c  self.tunneluser,
+0002cf10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cf30: 2020 646f 776e 6c6f 6164 3d46 616c 7365    download=False
+0002cf40: 2c20 696e 7365 6375 7265 3d54 7275 652c  , insecure=True,
+0002cf50: 2076 6d70 6f72 743d 766d 706f 7274 290a   vmport=vmport).
+0002cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cf70: 2020 2020 6f73 2e73 7973 7465 6d28 7363      os.system(sc
+0002cf80: 7063 6d64 290a 2020 2020 2020 2020 2020  pcmd).          
+0002cf90: 2020 2020 2020 2020 2020 7570 6461 7465            update
+0002cfa0: 645f 6669 6c65 732e 6170 7065 6e64 2864  d_files.append(d
+0002cfb0: 6573 7469 6e61 7469 6f6e 290a 2020 2020  estination).    
+0002cfc0: 2020 2020 7265 7475 726e 2075 7064 6174      return updat
+0002cfd0: 6564 5f66 696c 6573 0a0a 2020 2020 6465  ed_files..    de
+0002cfe0: 6620 696e 666f 5f73 7065 6369 6669 635f  f info_specific_
+0002cff0: 706c 616e 2873 656c 662c 2070 6c61 6e29  plan(self, plan)
+0002d000: 3a0a 2020 2020 2020 2020 7070 7269 6e74  :.        pprint
+0002d010: 2866 2250 726f 7669 6469 6e67 2069 6e66  (f"Providing inf
+0002d020: 6f72 6d61 7469 6f6e 2061 626f 7574 2070  ormation about p
+0002d030: 6c61 6e20 7b70 6c61 6e7d 2229 0a20 2020  lan {plan}").   
+0002d040: 2020 2020 206b 203d 2073 656c 662e 6b0a       k = self.k.
+0002d050: 2020 2020 2020 2020 7265 7375 6c74 7320          results 
+0002d060: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+0002d070: 2076 6d20 696e 206b 2e6c 6973 7428 293a   vm in k.list():
+0002d080: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0002d090: 766d 2e67 6574 2827 706c 616e 272c 2027  vm.get('plan', '
+0002d0a0: 2729 203d 3d20 706c 616e 3a0a 2020 2020  ') == plan:.    
+0002d0b0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+0002d0c0: 6c74 732e 6170 7065 6e64 2876 6d29 0a20  lts.append(vm). 
+0002d0d0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0002d0e0: 7375 6c74 730a 0a20 2020 2064 6566 2061  sults..    def a
+0002d0f0: 7574 6f73 6361 6c65 5f63 6c75 7374 6572  utoscale_cluster
+0002d100: 2873 656c 662c 206b 7562 652c 206b 7562  (self, kube, kub
+0002d110: 6574 7970 652c 2077 6f72 6b65 7273 2c20  etype, workers, 
+0002d120: 7468 7265 7368 6f6c 642c 2069 646c 6529  threshold, idle)
+0002d130: 3a0a 2020 2020 2020 2020 6966 2074 6872  :.        if thr
+0002d140: 6573 686f 6c64 203e 2039 3939 393a 0a20  eshold > 9999:. 
+0002d150: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+0002d160: 7428 6622 536b 6970 7069 6e67 2061 7574  t(f"Skipping aut
+0002d170: 6f73 6361 6c69 6e67 2075 7020 6368 6563  oscaling up chec
+0002d180: 6b73 2066 6f72 2063 6c75 7374 6572 207b  ks for cluster {
+0002d190: 6b75 6265 7d20 6173 2070 6572 2074 6872  kube} as per thr
+0002d1a0: 6573 686f 6c64 207b 7468 7265 7368 6f6c  eshold {threshol
+0002d1b0: 647d 2229 0a20 2020 2020 2020 2020 2020  d}").           
+0002d1c0: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
+0002d1d0: 273a 2027 7375 6363 6573 7327 2c20 2777  ': 'success', 'w
+0002d1e0: 6f72 6b65 7273 273a 2077 6f72 6b65 7273  orkers': workers
+0002d1f0: 7d0a 2020 2020 2020 2020 6966 2069 646c  }.        if idl
+0002d200: 6520 3c20 313a 0a20 2020 2020 2020 2020  e < 1:.         
+0002d210: 2020 2070 7072 696e 7428 6622 536b 6970     pprint(f"Skip
+0002d220: 7069 6e67 2061 7574 6f73 6361 6c69 6e67  ping autoscaling
+0002d230: 2064 6f77 6e20 6368 6563 6b73 2066 6f72   down checks for
+0002d240: 2063 6c75 7374 6572 207b 6b75 6265 7d20   cluster {kube} 
+0002d250: 6173 2070 6572 2069 646c 6520 7b69 646c  as per idle {idl
+0002d260: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+0002d270: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
+0002d280: 273a 2027 7375 6363 6573 7327 2c20 2777  ': 'success', 'w
+0002d290: 6f72 6b65 7273 273a 2077 6f72 6b65 7273  orkers': workers
+0002d2a0: 7d0a 2020 2020 2020 2020 7070 7269 6e74  }.        pprint
+0002d2b0: 2866 2243 6865 636b 696e 6720 6e6f 6e20  (f"Checking non 
+0002d2c0: 7363 6865 6475 6c65 6420 706f 6473 2063  scheduled pods c
+0002d2d0: 6f75 6e74 206f 6e20 636c 7573 7465 7220  ount on cluster 
+0002d2e0: 7b6b 7562 657d 2229 0a20 2020 2020 2020  {kube}").       
+0002d2f0: 2073 656c 6563 746f 7220 3d20 2221 6e6f   selector = "!no
+0002d300: 6465 2d72 6f6c 652e 6b75 6265 726e 6574  de-role.kubernet
+0002d310: 6573 2e69 6f2f 636f 6e74 726f 6c2d 706c  es.io/control-pl
+0002d320: 616e 652c 6e6f 6465 2d72 6f6c 652e 6b75  ane,node-role.ku
+0002d330: 6265 726e 6574 6573 2e69 6f2f 776f 726b  bernetes.io/work
+0002d340: 6572 220a 2020 2020 2020 2020 6375 7272  er".        curr
+0002d350: 656e 7463 6d64 203d 2066 226b 7562 6563  entcmd = f"kubec
+0002d360: 746c 2067 6574 206e 6f64 6520 2d2d 7365  tl get node --se
+0002d370: 6c65 6374 6f72 3d27 7b73 656c 6563 746f  lector='{selecto
+0002d380: 727d 2722 0a20 2020 2020 2020 2063 7572  r}'".        cur
 0002d390: 7265 6e74 636d 6420 2b3d 2022 207c 2067  rentcmd += " | g
 0002d3a0: 7265 7020 2720 5265 6164 7927 220a 2020  rep ' Ready'".  
-0002d3b0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-0002d3c0: 746e 6f64 6573 203d 206f 732e 706f 7065  tnodes = os.pope
-0002d3d0: 6e28 6375 7272 656e 7463 6d64 292e 7265  n(currentcmd).re
-0002d3e0: 6164 6c69 6e65 7328 290a 2020 2020 2020  adlines().      
-0002d3f0: 2020 2020 2020 6966 206c 656e 2863 7572        if len(cur
-0002d400: 7265 6e74 6e6f 6465 7329 2021 3d20 776f  rentnodes) != wo
-0002d410: 726b 6572 733a 0a20 2020 2020 2020 2020  rkers:.         
-0002d420: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-0002d430: 4f6e 676f 696e 6720 7363 616c 696e 6720  Ongoing scaling 
-0002d440: 6f70 6572 6174 696f 6e20 6f6e 2063 6c75  operation on clu
-0002d450: 7374 6572 207b 6b75 6265 7d22 290a 2020  ster {kube}").  
-0002d460: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0002d470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d480: 7265 7375 6c74 203d 2073 656c 662e 6175  result = self.au
-0002d490: 746f 7363 616c 655f 636c 7573 7465 7228  toscale_cluster(
-0002d4a0: 6b75 6265 2c20 6b75 6265 7479 7065 2c20  kube, kubetype, 
-0002d4b0: 776f 726b 6572 732c 2074 6872 6573 686f  workers, thresho
-0002d4c0: 6c64 2c20 6964 6c65 290a 2020 2020 2020  ld, idle).      
-0002d4d0: 2020 2020 2020 2020 2020 6966 2072 6573            if res
-0002d4e0: 756c 745b 2772 6573 756c 7427 5d20 213d  ult['result'] !=
-0002d4f0: 2027 7375 6363 6573 7327 3a0a 2020 2020   'success':.    
-0002d500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d510: 7265 7475 726e 2072 6573 756c 740a 2020  return result.  
-0002d520: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0002d530: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002d540: 2020 2020 2020 2020 776f 726b 6572 7320          workers 
-0002d550: 3d20 7265 7375 6c74 5b27 776f 726b 6572  = result['worker
-0002d560: 7327 5d0a 2020 2020 2020 2020 2020 2020  s'].            
-0002d570: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-0002d580: 2243 7572 7265 6e74 2077 6f72 6b65 7273  "Current workers
-0002d590: 206e 756d 6265 7220 6465 7369 7265 643a   number desired:
-0002d5a0: 207b 776f 726b 6572 737d 2229 0a20 2020   {workers}").   
-0002d5b0: 2020 2020 2020 2020 2073 6c65 6570 2836           sleep(6
-0002d5c0: 3029 0a0a 2020 2020 6465 6620 7468 7265  0)..    def thre
-0002d5d0: 6164 6564 5f77 6562 5f63 6f6e 736f 6c65  aded_web_console
-0002d5e0: 2873 656c 662c 2070 6f72 742c 206e 616d  (self, port, nam
-0002d5f0: 6529 3a0a 2020 2020 2020 2020 636f 6e73  e):.        cons
-0002d600: 6f6c 6520 3d20 4b6d 696e 6963 6f6e 736f  ole = Kminiconso
-0002d610: 6c65 2863 6f6e 6669 673d 7365 6c66 2c20  le(config=self, 
-0002d620: 706f 7274 3d70 6f72 742c 206e 616d 653d  port=port, name=
-0002d630: 6e61 6d65 290a 2020 2020 2020 2020 636f  name).        co
-0002d640: 6e73 6f6c 652e 7275 6e28 290a 0a20 2020  nsole.run()..   
-0002d650: 2064 6566 2077 6562 636f 6e73 6f6c 6528   def webconsole(
-0002d660: 7365 6c66 2c20 6e61 6d65 293a 0a20 2020  self, name):.   
-0002d670: 2020 2020 2070 6f72 7420 3d20 6765 745f       port = get_
-0002d680: 6672 6565 5f70 6f72 7428 290a 2020 2020  free_port().    
-0002d690: 2020 2020 7420 3d20 7468 7265 6164 696e      t = threadin
-0002d6a0: 672e 5468 7265 6164 2874 6172 6765 743d  g.Thread(target=
-0002d6b0: 7365 6c66 2e74 6872 6561 6465 645f 7765  self.threaded_we
-0002d6c0: 625f 636f 6e73 6f6c 652c 2061 7267 733d  b_console, args=
-0002d6d0: 2870 6f72 742c 206e 616d 652c 2929 0a20  (port, name,)). 
-0002d6e0: 2020 2020 2020 2074 2e73 7461 7274 2829         t.start()
-0002d6f0: 0a20 2020 2020 2020 2077 6562 6272 6f77  .        webbrow
-0002d700: 7365 722e 6f70 656e 2866 2268 7474 703a  ser.open(f"http:
-0002d710: 2f2f 3132 372e 302e 302e 313a 7b70 6f72  //127.0.0.1:{por
-0002d720: 747d 222c 206e 6577 3d32 2c20 6175 746f  t}", new=2, auto
-0002d730: 7261 6973 653d 5472 7565 290a            raise=True).
+0002d3b0: 2020 2020 2020 776f 726b 6572 7320 3d20        workers = 
+0002d3c0: 6c65 6e28 6f73 2e70 6f70 656e 2863 7572  len(os.popen(cur
+0002d3d0: 7265 6e74 636d 6429 2e72 6561 646c 696e  rentcmd).readlin
+0002d3e0: 6573 2829 290a 2020 2020 2020 2020 7065  es()).        pe
+0002d3f0: 6e64 696e 6763 6d64 203d 2022 6b75 6265  ndingcmd = "kube
+0002d400: 6374 6c20 6765 7420 706f 6473 202d 4120  ctl get pods -A 
+0002d410: 2d2d 6669 656c 642d 7365 6c65 6374 6f72  --field-selector
+0002d420: 3d73 7461 7475 732e 7068 6173 653d 5065  =status.phase=Pe
+0002d430: 6e64 696e 6720 2d6f 2079 616d 6c22 0a20  nding -o yaml". 
+0002d440: 2020 2020 2020 2070 656e 6469 6e67 5f70         pending_p
+0002d450: 6f64 7320 3d20 7961 6d6c 2e73 6166 655f  ods = yaml.safe_
+0002d460: 6c6f 6164 286f 732e 706f 7065 6e28 7065  load(os.popen(pe
+0002d470: 6e64 696e 6763 6d64 292e 7265 6164 2829  ndingcmd).read()
+0002d480: 295b 2769 7465 6d73 275d 0a20 2020 2020  )['items'].     
+0002d490: 2020 2069 6620 6c65 6e28 7065 6e64 696e     if len(pendin
+0002d4a0: 675f 706f 6473 2920 3e20 7468 7265 7368  g_pods) > thresh
+0002d4b0: 6f6c 643a 0a20 2020 2020 2020 2020 2020  old:.           
+0002d4c0: 2070 7072 696e 7428 6622 5472 6967 6765   pprint(f"Trigge
+0002d4d0: 7269 6e67 2073 6361 6c69 6e67 2075 7020  ring scaling up 
+0002d4e0: 666f 7220 636c 7573 7465 7220 7b6b 7562  for cluster {kub
+0002d4f0: 657d 2061 7320 7468 6572 6520 6172 6520  e} as there are 
+0002d500: 7b6c 656e 2870 656e 6469 6e67 5f70 6f64  {len(pending_pod
+0002d510: 7329 7d20 7065 6e64 696e 6720 706f 6473  s)} pending pods
+0002d520: 2229 0a20 2020 2020 2020 2020 2020 2077  ").            w
+0002d530: 6f72 6b65 7273 202b 3d20 310a 2020 2020  orkers += 1.    
+0002d540: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
+0002d550: 5363 616c 696e 6720 7570 2063 6c75 7374  Scaling up clust
+0002d560: 6572 207b 6b75 6265 7d20 746f 207b 776f  er {kube} to {wo
+0002d570: 726b 6572 737d 2077 6f72 6b65 7273 2229  rkers} workers")
+0002d580: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+0002d590: 756c 7420 3d20 7365 6c66 2e73 6361 6c65  ult = self.scale
+0002d5a0: 5f6b 7562 6528 6b75 6265 2c20 6b75 6265  _kube(kube, kube
+0002d5b0: 7479 7065 2c20 6f76 6572 7269 6465 733d  type, overrides=
+0002d5c0: 7b27 776f 726b 6572 7327 3a20 776f 726b  {'workers': work
+0002d5d0: 6572 737d 290a 2020 2020 2020 2020 2020  ers}).          
+0002d5e0: 2020 7265 7375 6c74 5b27 776f 726b 6572    result['worker
+0002d5f0: 7327 5d20 3d20 776f 726b 6572 730a 2020  s'] = workers.  
+0002d600: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0002d610: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
+0002d620: 6e6f 6465 7320 3d20 7b7d 0a20 2020 2020  nodes = {}.     
+0002d630: 2020 2063 7572 7265 6e74 636d 6420 3d20     currentcmd = 
+0002d640: 226b 7562 6563 746c 2067 6574 2070 6f64  "kubectl get pod
+0002d650: 202d 4120 2d6f 2079 616d 6c22 0a20 2020   -A -o yaml".   
+0002d660: 2020 2020 2061 6c6c 706f 6473 203d 2079       allpods = y
+0002d670: 616d 6c2e 7361 6665 5f6c 6f61 6428 6f73  aml.safe_load(os
+0002d680: 2e70 6f70 656e 2863 7572 7265 6e74 636d  .popen(currentcm
+0002d690: 6429 2e72 6561 6428 2929 5b27 6974 656d  d).read())['item
+0002d6a0: 7327 5d0a 2020 2020 2020 2020 666f 7220  s'].        for 
+0002d6b0: 706f 6420 696e 2061 6c6c 706f 6473 3a0a  pod in allpods:.
+0002d6c0: 2020 2020 2020 2020 2020 2020 6e6f 6465              node
+0002d6d0: 6e61 6d65 203d 2070 6f64 5b27 7370 6563  name = pod['spec
+0002d6e0: 275d 5b27 6e6f 6465 4e61 6d65 275d 0a20  ']['nodeName']. 
+0002d6f0: 2020 2020 2020 2020 2020 2073 7461 7475             statu
+0002d700: 7320 3d20 706f 645b 2773 7461 7475 7327  s = pod['status'
+0002d710: 5d5b 2770 6861 7365 275d 0a20 2020 2020  ]['phase'].     
+0002d720: 2020 2020 2020 2069 6620 7374 6174 7573         if status
+0002d730: 2021 3d20 2752 756e 6e69 6e67 273a 0a20   != 'Running':. 
+0002d740: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0002d750: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+0002d760: 2020 2020 6966 206e 6f64 656e 616d 6520      if nodename 
+0002d770: 6e6f 7420 696e 206e 6f64 6573 3a0a 2020  not in nodes:.  
+0002d780: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+0002d790: 6465 735b 6e6f 6465 6e61 6d65 5d20 3d20  des[nodename] = 
+0002d7a0: 310a 2020 2020 2020 2020 2020 2020 656c  1.            el
+0002d7b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0002d7c0: 2020 2020 6e6f 6465 735b 6e6f 6465 6e61      nodes[nodena
+0002d7d0: 6d65 5d20 2b3d 2031 0a20 2020 2020 2020  me] += 1.       
+0002d7e0: 2074 6f64 656c 6574 6520 3d20 300a 2020   todelete = 0.  
+0002d7f0: 2020 2020 2020 666f 7220 6e6f 6465 2069        for node i
+0002d800: 6e20 6e6f 6465 733a 0a20 2020 2020 2020  n nodes:.       
+0002d810: 2020 2020 2069 6620 6e6f 6465 735b 6e6f       if nodes[no
+0002d820: 6465 5d20 3c20 6964 6c65 3a0a 2020 2020  de] < idle:.    
+0002d830: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+0002d840: 6e74 2866 226e 6f64 6520 7b6e 6f64 657d  nt(f"node {node}
+0002d850: 2074 6f20 6265 2072 656d 6f76 6564 2073   to be removed s
+0002d860: 696e 6365 2069 7420 6f6e 6c79 2068 6173  ince it only has
+0002d870: 2074 6865 2066 6f6c 6c6f 7769 6e67 2070   the following p
+0002d880: 6f64 733a 207b 6e6f 6465 735b 6e6f 6465  ods: {nodes[node
+0002d890: 5d7d 2229 0a20 2020 2020 2020 2020 2020  ]}").           
+0002d8a0: 2020 2020 2074 6f64 656c 6574 6520 2b3d       todelete +=
+0002d8b0: 2031 0a20 2020 2020 2020 2069 6620 746f   1.        if to
+0002d8c0: 6465 6c65 7465 203e 2030 3a0a 2020 2020  delete > 0:.    
+0002d8d0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0002d8e0: 2254 7269 6767 6572 696e 6720 7363 616c  "Triggering scal
+0002d8f0: 696e 6720 646f 776e 2066 6f72 2063 6c75  ing down for clu
+0002d900: 7374 6572 207b 6b75 6265 7d20 6173 2074  ster {kube} as t
+0002d910: 6865 7265 2061 7265 207b 746f 6465 6c65  here are {todele
+0002d920: 7465 7d20 6964 6c65 206e 6f64 6573 2229  te} idle nodes")
+0002d930: 0a20 2020 2020 2020 2020 2020 2077 6f72  .            wor
+0002d940: 6b65 7273 203d 2077 6f72 6b65 7273 202d  kers = workers -
+0002d950: 2074 6f64 656c 6574 650a 2020 2020 2020   todelete.      
+0002d960: 2020 2020 2020 7070 7269 6e74 2866 2253        pprint(f"S
+0002d970: 6361 6c69 6e67 2064 6f77 6e20 636c 7573  caling down clus
+0002d980: 7465 7220 7b6b 7562 657d 2074 6f20 7b77  ter {kube} to {w
+0002d990: 6f72 6b65 7273 7d20 776f 726b 6572 7322  orkers} workers"
+0002d9a0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0002d9b0: 7375 6c74 203d 2073 656c 662e 7363 616c  sult = self.scal
+0002d9c0: 655f 6b75 6265 286b 7562 652c 206b 7562  e_kube(kube, kub
+0002d9d0: 6574 7970 652c 206f 7665 7272 6964 6573  etype, overrides
+0002d9e0: 3d7b 2777 6f72 6b65 7273 273a 2077 6f72  ={'workers': wor
+0002d9f0: 6b65 7273 7d29 0a20 2020 2020 2020 2020  kers}).         
+0002da00: 2020 2072 6573 756c 745b 2777 6f72 6b65     result['worke
+0002da10: 7273 275d 203d 2077 6f72 6b65 7273 0a20  rs'] = workers. 
+0002da20: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0002da30: 6e20 7265 7375 6c74 0a20 2020 2020 2020  n result.       
+0002da40: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
+0002da50: 273a 2027 7375 6363 6573 7327 2c20 2777  ': 'success', 'w
+0002da60: 6f72 6b65 7273 273a 2077 6f72 6b65 7273  orkers': workers
+0002da70: 7d0a 0a20 2020 2064 6566 206c 6f6f 705f  }..    def loop_
+0002da80: 6175 746f 7363 616c 655f 636c 7573 7465  autoscale_cluste
+0002da90: 7228 7365 6c66 2c20 6b75 6265 2c20 6b75  r(self, kube, ku
+0002daa0: 6265 7479 7065 2c20 776f 726b 6572 732c  betype, workers,
+0002dab0: 2074 6872 6573 686f 6c64 2c20 6964 6c65   threshold, idle
+0002dac0: 293a 0a20 2020 2020 2020 2070 7072 696e  ):.        pprin
+0002dad0: 7428 6622 5374 6172 7469 6e67 2077 6974  t(f"Starting wit
+0002dae0: 6820 7b77 6f72 6b65 7273 7d20 776f 726b  h {workers} work
+0002daf0: 6572 7322 290a 2020 2020 2020 2020 6966  ers").        if
+0002db00: 2077 6869 6368 2827 6b75 6265 6374 6c27   which('kubectl'
+0002db10: 2920 6973 204e 6f6e 653a 0a20 2020 2020  ) is None:.     
+0002db20: 2020 2020 2020 2063 6f6d 6d6f 6e2e 6765         common.ge
+0002db30: 745f 6b75 6265 6374 6c28 290a 2020 2020  t_kubectl().    
+0002db40: 2020 2020 2020 2020 6f73 2e65 6e76 6972          os.envir
+0002db50: 6f6e 5b27 5041 5448 275d 202b 3d20 273a  on['PATH'] += ':
+0002db60: 2e27 0a20 2020 2020 2020 2077 6869 6c65  .'.        while
+0002db70: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
+0002db80: 2020 2073 656c 6563 746f 7220 3d20 2221     selector = "!
+0002db90: 6e6f 6465 2d72 6f6c 652e 6b75 6265 726e  node-role.kubern
+0002dba0: 6574 6573 2e69 6f2f 636f 6e74 726f 6c2d  etes.io/control-
+0002dbb0: 706c 616e 652c 6e6f 6465 2d72 6f6c 652e  plane,node-role.
+0002dbc0: 6b75 6265 726e 6574 6573 2e69 6f2f 776f  kubernetes.io/wo
+0002dbd0: 726b 6572 220a 2020 2020 2020 2020 2020  rker".          
+0002dbe0: 2020 6375 7272 656e 7463 6d64 203d 2066    currentcmd = f
+0002dbf0: 226b 7562 6563 746c 2067 6574 206e 6f64  "kubectl get nod
+0002dc00: 6520 2d2d 7365 6c65 6374 6f72 3d27 7b73  e --selector='{s
+0002dc10: 656c 6563 746f 727d 2722 0a20 2020 2020  elector}'".     
+0002dc20: 2020 2020 2020 2063 7572 7265 6e74 636d         currentcm
+0002dc30: 6420 2b3d 2022 207c 2067 7265 7020 2720  d += " | grep ' 
+0002dc40: 5265 6164 7927 220a 2020 2020 2020 2020  Ready'".        
+0002dc50: 2020 2020 6375 7272 656e 746e 6f64 6573      currentnodes
+0002dc60: 203d 206f 732e 706f 7065 6e28 6375 7272   = os.popen(curr
+0002dc70: 656e 7463 6d64 292e 7265 6164 6c69 6e65  entcmd).readline
+0002dc80: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+0002dc90: 6966 206c 656e 2863 7572 7265 6e74 6e6f  if len(currentno
+0002dca0: 6465 7329 2021 3d20 776f 726b 6572 733a  des) != workers:
+0002dcb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002dcc0: 2070 7072 696e 7428 6622 4f6e 676f 696e   pprint(f"Ongoin
+0002dcd0: 6720 7363 616c 696e 6720 6f70 6572 6174  g scaling operat
+0002dce0: 696f 6e20 6f6e 2063 6c75 7374 6572 207b  ion on cluster {
+0002dcf0: 6b75 6265 7d22 290a 2020 2020 2020 2020  kube}").        
+0002dd00: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0002dd10: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+0002dd20: 203d 2073 656c 662e 6175 746f 7363 616c   = self.autoscal
+0002dd30: 655f 636c 7573 7465 7228 6b75 6265 2c20  e_cluster(kube, 
+0002dd40: 6b75 6265 7479 7065 2c20 776f 726b 6572  kubetype, worker
+0002dd50: 732c 2074 6872 6573 686f 6c64 2c20 6964  s, threshold, id
+0002dd60: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
+0002dd70: 2020 2020 6966 2072 6573 756c 745b 2772      if result['r
+0002dd80: 6573 756c 7427 5d20 213d 2027 7375 6363  esult'] != 'succ
+0002dd90: 6573 7327 3a0a 2020 2020 2020 2020 2020  ess':.          
+0002dda0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0002ddb0: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
+0002ddc0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002ddd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dde0: 2020 776f 726b 6572 7320 3d20 7265 7375    workers = resu
+0002ddf0: 6c74 5b27 776f 726b 6572 7327 5d0a 2020  lt['workers'].  
+0002de00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002de10: 2020 7070 7269 6e74 2866 2243 7572 7265    pprint(f"Curre
+0002de20: 6e74 2077 6f72 6b65 7273 206e 756d 6265  nt workers numbe
+0002de30: 7220 6465 7369 7265 643a 207b 776f 726b  r desired: {work
+0002de40: 6572 737d 2229 0a20 2020 2020 2020 2020  ers}").         
+0002de50: 2020 2073 6c65 6570 2836 3029 0a0a 2020     sleep(60)..  
+0002de60: 2020 6465 6620 7468 7265 6164 6564 5f77    def threaded_w
+0002de70: 6562 5f63 6f6e 736f 6c65 2873 656c 662c  eb_console(self,
+0002de80: 2070 6f72 742c 206e 616d 6529 3a0a 2020   port, name):.  
+0002de90: 2020 2020 2020 636f 6e73 6f6c 6520 3d20        console = 
+0002dea0: 4b6d 696e 6963 6f6e 736f 6c65 2863 6f6e  Kminiconsole(con
+0002deb0: 6669 673d 7365 6c66 2c20 706f 7274 3d70  fig=self, port=p
+0002dec0: 6f72 742c 206e 616d 653d 6e61 6d65 290a  ort, name=name).
+0002ded0: 2020 2020 2020 2020 636f 6e73 6f6c 652e          console.
+0002dee0: 7275 6e28 290a 0a20 2020 2064 6566 2077  run()..    def w
+0002def0: 6562 636f 6e73 6f6c 6528 7365 6c66 2c20  ebconsole(self, 
+0002df00: 6e61 6d65 293a 0a20 2020 2020 2020 2070  name):.        p
+0002df10: 6f72 7420 3d20 6765 745f 6672 6565 5f70  ort = get_free_p
+0002df20: 6f72 7428 290a 2020 2020 2020 2020 7420  ort().        t 
+0002df30: 3d20 7468 7265 6164 696e 672e 5468 7265  = threading.Thre
+0002df40: 6164 2874 6172 6765 743d 7365 6c66 2e74  ad(target=self.t
+0002df50: 6872 6561 6465 645f 7765 625f 636f 6e73  hreaded_web_cons
+0002df60: 6f6c 652c 2061 7267 733d 2870 6f72 742c  ole, args=(port,
+0002df70: 206e 616d 652c 2929 0a20 2020 2020 2020   name,)).       
+0002df80: 2074 2e73 7461 7274 2829 0a20 2020 2020   t.start().     
+0002df90: 2020 2077 6562 6272 6f77 7365 722e 6f70     webbrowser.op
+0002dfa0: 656e 2866 2268 7474 703a 2f2f 3132 372e  en(f"http://127.
+0002dfb0: 302e 302e 313a 7b70 6f72 747d 222c 206e  0.0.1:{port}", n
+0002dfc0: 6577 3d32 2c20 6175 746f 7261 6973 653d  ew=2, autoraise=
+0002dfd0: 5472 7565 290a 0a20 2020 2064 6566 2069  True)..    def i
+0002dfe0: 6e66 6f5f 6b75 6265 5f67 6b65 2873 656c  nfo_kube_gke(sel
+0002dff0: 662c 2063 6c75 7374 6572 293a 0a20 2020  f, cluster):.   
+0002e000: 2020 2020 2066 726f 6d20 6b76 6972 742e       from kvirt.
+0002e010: 636c 7573 7465 722e 676b 6520 696d 706f  cluster.gke impo
+0002e020: 7274 2069 6e66 6f20 6173 2067 6b65 5f69  rt info as gke_i
+0002e030: 6e66 6f0a 2020 2020 2020 2020 7265 7475  nfo.        retu
+0002e040: 726e 2067 6b65 5f69 6e66 6f28 7365 6c66  rn gke_info(self
+0002e050: 2c20 636c 7573 7465 722c 2073 656c 662e  , cluster, self.
+0002e060: 6465 6275 6729 0a                        debug).
```

## kvirt/examples.py

```diff
@@ -170,14 +170,21 @@
 # Do the same but customize some parameters
 $ kcli create kube generic -P ctlplanes=1 -P workers=2 mykube
 
 # Use a parameter file
 $ kcli create kube generic --paramfile=myparameters.yml mykube
 """
 
+kubegkecreate = """# Create a gke instance named mygke with default values
+$ kcli create kube gke mygke
+
+# Use a parameter file
+$ kcli create kube gke --paramfile=myparameters.yml mygke
+"""
+
 kubemicroshiftcreate = """# Create a kube microshift instance named mymicroshift with default values
 $ kcli create kube microshift mymicroshift
 
 # Create a kube microshift instance named mymicroshift providing rhn creds on the commandline
 $ kcli create kube microshift -P rhnuser=xxx@good.es -P rhnpassword=supercool mymicroshift
 
 # Use a parameter file
@@ -341,14 +348,22 @@
 # Scale both ctlplanes and workers
 $ kcli scale cluster generic -P ctlplanes=3 -P workers=2 myclu
 
 # Alternative way to indicate workers
 $ kcli scale cluster generic --workers 3 myclu
 """
 
+kubegkescale = """# Scale nodes from gke cluster mygke
+$ kcli scale cluster gke -P workers=3 mygke
+
+# Alternative way to indicate workers
+$ kcli scale cluster gke --workers 3 mygke
+
+"""
+
 kubek3sscale = """# Scale workers from k3s cluster myclu
 $ kcli scale cluster k3s -P workers=3 myclu
 
 # Scale ctlplanes
 $ kcli scale cluster k3s -P ctlplanes=3 myclu
 
 # Scale both ctlplanes and workers
```

## kvirt/cluster/k3s/__init__.py

```diff
@@ -71,15 +71,15 @@
 def create(config, plandir, cluster, overrides):
     platform = config.type
     data = {'kubetype': 'k3s', 'ctlplanes': 1, 'workers': 0, 'sdn': 'flannel', 'extra_scripts': [], 'autoscale': False,
             'network': 'default', 'cloud_lb': None, 'cloud_api_internal': False, 'reservedns': True, 'gcp_hack': True}
     data.update(overrides)
     data['cloud_lb'] = overrides.get('cloud_lb', platform in cloudplatforms and data['ctlplanes'] > 1)
     cloud_lb = data['cloud_lb']
-    data['cluster'] = overrides.get('cluster', cluster if cluster is not None else 'myk3s')
+    data['cluster'] = overrides.get('cluster') or cluster or 'myk3s'
     plan = cluster if cluster is not None else data['cluster']
     data['kube'] = data['cluster']
     autoscale = data['autoscale']
     ctlplanes = data['ctlplanes']
     workers = data['workers']
     network = data['network']
     reservedns = data['reservedns']
```

## kvirt/cluster/kubeadm/__init__.py

```diff
@@ -87,15 +87,15 @@
     data = {'kubetype': 'generic', 'sslip': False, 'domain': 'karmalabs.corp', 'wait_ready': False, 'extra_scripts': [],
             'calico_version': None, 'autoscale': False, 'token': None, 'async': False}
     async_install = data['async']
     data.update(overrides)
     if 'keys' not in overrides and get_ssh_pub_key() is None:
         msg = "No usable public key found, which is required for the deployment. Create one using ssh-keygen"
         return {'result': 'failure', 'reason': msg}
-    data['cluster'] = overrides.get('cluster', cluster if cluster is not None else 'mykube')
+    data['cluster'] = overrides.get('cluster') or cluster or 'mykube'
     plan = cluster if cluster is not None else data['cluster']
     data['kube'] = data['cluster']
     cloud_lb = data.get('cloud_lb', True)
     autoscale = data.get('autoscale')
     ctlplanes = data.get('ctlplanes', 1)
     if ctlplanes == 0:
         msg = "Invalid number of ctlplanes"
```

## kvirt/cluster/microshift/__init__.py

```diff
@@ -26,15 +26,15 @@
     if not valid_rhn_credentials(config, overrides):
         msg = "Using rhel image requires setting rhnuser/rhnpassword or rhnorg/rhnactivationkey "
         msg += "in your conf or as parameters"
         return {'result': 'failure', 'reason': msg}
     if 'keys' not in overrides and get_ssh_pub_key() is None:
         msg = "No usable public key found, which is required for the deployment. Create one using ssh-keygen"
         return {'result': 'failure', 'reason': msg}
-    data['cluster'] = overrides.get('cluster', cluster if cluster is not None else 'mymicroshift')
+    data['cluster'] = overrides.get('cluster') or cluster or 'mymicroshift'
     plan = cluster if cluster is not None else data['cluster']
     data['kube'] = data['cluster']
     cluster = data.get('cluster')
     nodes = data.get('nodes', 1)
     if nodes == 0:
         msg = "Invalid number of nodes"
         return {'result': 'failure', 'reason': msg}
```

## kvirt/cluster/openshift/__init__.py

```diff
@@ -507,20 +507,15 @@
             'contrail_version': '23.1',
             'contrail_ctl_network': 'contrail-ctl',
             'contrail_ctl_create': True,
             'contrail_ctl_cidr': '10.40.1.0/24',
             'contrail_ctl_gateway': '10.40.1.1',
             'retries': 2}
     data.update(overrides)
-    if 'cluster' in overrides:
-        clustervalue = overrides.get('cluster')
-    elif cluster is not None:
-        clustervalue = cluster
-    else:
-        clustervalue = 'myopenshift'
+    clustervalue = overrides.get('cluster') or cluster or 'myopenshift'
     if data['ctlplanes'] == 1 and data['workers'] == 0\
        and 'ctlplane_memory' not in overrides and 'memory' not in overrides:
         data['ctlplane_memory'] = 32768
         warning("Forcing memory of singe ctlplane vm to 32G")
     retries = data.get('retries')
     data['cluster'] = clustervalue
     domain = data.get('domain')
```

## kvirt/providers/gcp/__init__.py

```diff
@@ -62,20 +62,19 @@
             else:
                 check = conn.globalOperations().get(project=project, operation=operation).execute()
             if check['status'] == 'DONE':
                 done = True
             else:
                 sleep(1)
                 timeout += 1
-        if 'httpErrorMessage' in check:
-            httperror = check['httpErrorMessage']
-            code = check['error']['errors'][0]["code"]
-            message = check['error']['errors'][0]["message"]
-            error(f"Got {httperror} Code {code} Error {message}")
-        return
+            if 'httpErrorMessage' in check:
+                httperror = check['httpErrorMessage']
+                code = check['error']['errors'][0]["code"]
+                message = check['error']['errors'][0]["message"]
+                error(f"Got {httperror} Code {code} Error {message}")
 
     def close(self):
         return
 
     def exists(self, name):
         conn = self.conn
         project = self.project
```

## kvirt/version/git

```diff
@@ -1 +1 @@
-8f590fc 2023/06/08
+bac10bb 2023/06/09
```

## Comparing `kcli-99.0.202306081954.dist-info/LICENSE` & `kcli-99.0.202306091732.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `kcli-99.0.202306081954.dist-info/METADATA` & `kcli-99.0.202306091732.dist-info/METADATA`

 * *Files 14% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: kcli
-Version: 99.0.202306081954
+Version: 99.0.202306091732
 Summary: Provisioner/Manager for Libvirt/Vsphere/Aws/Gcp/Kubevirt/Ovirt/Openstack/IBM Cloud and containers
 Home-page: http://github.com/karmab/kcli
 Author: Karim Boumedhel
 Author-email: karimboumedhel@gmail.com
 License: ASL
 Platform: UNKNOWN
 License-File: LICENSE
@@ -14,14 +14,15 @@
 Requires-Dist: libvirt-python (>=2.0.0)
 Requires-Dist: prettytable
 Provides-Extra: all
 Requires-Dist: boto3 ; extra == 'all'
 Requires-Dist: docker (>=2.0) ; extra == 'all'
 Requires-Dist: google-api-python-client ; extra == 'all'
 Requires-Dist: google-auth-httplib2 ; extra == 'all'
+Requires-Dist: google-cloud-container ; extra == 'all'
 Requires-Dist: google-cloud-dns ; extra == 'all'
 Requires-Dist: google-cloud-storage ; extra == 'all'
 Requires-Dist: google-crc32c (==1.1.2) ; extra == 'all'
 Requires-Dist: ibm-cloud-networking-services ; extra == 'all'
 Requires-Dist: ibm-cos-sdk ; extra == 'all'
 Requires-Dist: ibm-platform-services ; extra == 'all'
 Requires-Dist: ibm-vpc ; extra == 'all'
@@ -39,14 +40,15 @@
 Requires-Dist: pyvmomi ; extra == 'all'
 Requires-Dist: websockify ; extra == 'all'
 Provides-Extra: aws
 Requires-Dist: boto3 ; extra == 'aws'
 Provides-Extra: gcp
 Requires-Dist: google-api-python-client ; extra == 'gcp'
 Requires-Dist: google-auth-httplib2 ; extra == 'gcp'
+Requires-Dist: google-cloud-container ; extra == 'gcp'
 Requires-Dist: google-cloud-dns ; extra == 'gcp'
 Requires-Dist: google-cloud-storage ; extra == 'gcp'
 Provides-Extra: ibm
 Requires-Dist: google-crc32c (==1.1.2) ; extra == 'ibm'
 Requires-Dist: ibm-cloud-networking-services ; extra == 'ibm'
 Requires-Dist: ibm-cos-sdk ; extra == 'ibm'
 Requires-Dist: ibm-platform-services ; extra == 'ibm'
```

## Comparing `kcli-99.0.202306081954.dist-info/RECORD` & `kcli-99.0.202306091732.dist-info/RECORD`

 * *Files 0% similar despite different names*

```diff
@@ -1,20 +1,25 @@
 kvirt/__init__.py,sha256=eoZ6GfifbqhMLNzjlqRDVil-yyBkOmVN9ujSgJWNBlY,15
-kvirt/baseconfig.py,sha256=SbEgU8_nLtyF_EHg5Ux7rG-oNXfBrt9-yRIdtFOVakc,100193
+kvirt/baseconfig.py,sha256=VXjU7ZuHfgSIAZuQYBYdILnYs0ccR3slSj8DugH8Ysc,100451
 kvirt/bottle.py,sha256=DMuCINuwVog8XC-D6nPFVzRmo6lnJZ1H3sNK2VICKKE,171487
-kvirt/cli.py,sha256=Xzh-7IVCfdbYpITGpS6P9g0JDNiqIZDQ_76JgQks9ss,250355
-kvirt/config.py,sha256=ZE4okfRsyyCkMQIFAXsUqbxd6Ll35-_t_MuOlez3BW4,186172
+kvirt/cli.py,sha256=uXjPStF9yOmtu6NrLuKSWaF78FNAdNPoQvijpRQgRXk,252835
+kvirt/config.py,sha256=_hyP3Oi63T4bEuANoQZ31t4_YSmyiWw_ilbEWQvNteY,188519
 kvirt/containerconfig.py,sha256=Pfp1wWU1u1S6S0IT00mWFEAa8FlbTV2qrFE21_cquWA,2851
 kvirt/defaults.py,sha256=ubmFntdFYHcZrhcNCBwaTgGBiaCUxffVc5msDmvNa_w,11514
-kvirt/examples.py,sha256=thZzqGzuj7lSmfivra4uaO28ieBzyTusfJDJz4eIwHI,19097
+kvirt/examples.py,sha256=-ao9VmT7XREmB1a3KI-jvW6jpzmaIlDHTbWMS-64JD8,19475
 kvirt/ignitionmerger.py,sha256=K22COM_XqYOG28ezUJzoRjQL-jbJqpFWgm7lUwDiVbE,4333
 kvirt/keywords.yaml,sha256=g3TM8gfKxhgjJFuUCvdnbwNNEsYk2M-zghnBCRFR-9Y,10074
 kvirt/klist.py,sha256=6rUa1Z7aH-Yx8MAVW-7TvB2DzteGkquBBlPQmei1p8E,3487
 kvirt/ansibleutils/__init__.py,sha256=uxy2it8uvuhDZSIlKOimpqPZtFTPsZ0AX_DLs5y7fSo,6009
 kvirt/cluster/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
+kvirt/cluster/sampleprovider.py,sha256=OA414n2t54Bd6EIV1K1hXpe3KndPBtRzoYTZRH5JWu4,204
+kvirt/cluster/gke/__init__.py,sha256=DnumhFyES_LIs6hssNesrrgFmd0xngTla4A3GBBo3Ss,8490
+kvirt/cluster/gke/fake.yml,sha256=pWlbBWME2LeLtXGiYDpd6yGuHSZCrvZ9O_mUWF1Om_w,16
+kvirt/cluster/gke/kcli_default.yml,sha256=1T1HFQGE8-SnB4om-fPG-pJg2qd6C2eW9o1fw5MvwAo,194
+kvirt/cluster/gke/kubeconfig.j2,sha256=56NOOo7asmKHB6pklx-3mhMQu_gweijjwtfwlf2Hzzc,312
 kvirt/cluster/hypershift/99-apps.yaml,sha256=nWmGvSlPFTU8roqqkO89Hd-1lDiCaMM8mp_G_f-7Epk,931
 kvirt/cluster/hypershift/99-forcedns,sha256=J53iIXocjMnmXRizQW2MiIOeg9MTqmA4xEKS6e5VXk8,694
 kvirt/cluster/hypershift/99-notifications.yaml,sha256=0Cd13fQNCOQKS7ERso7E05zUkctrtHaFzcK2jGCsl0s,1480
 kvirt/cluster/hypershift/Corefile,sha256=giwgQjGQvqwhY1hiMMu2oovV0LrDuiorzGnDi-o4rEg,653
 kvirt/cluster/hypershift/__init__.py,sha256=iW5AcUhdZwg3iXsZ4GjdVbqmMIMoDlAt2dZiwyx7tjQ,43440
 kvirt/cluster/hypershift/assisted_infra.yml,sha256=4j7OLvkCEkctaNUSoKwxIslOSRjUtWaHhrO9qEaBG6o,1121
 kvirt/cluster/hypershift/assisted_ingress.yml,sha256=5WGeyzXH_kaTxnOAI8jpXT55fVHYx05iPhkEe2adXwM,1269
@@ -33,27 +38,27 @@
 kvirt/cluster/hypershift/keepalived.conf,sha256=uy6hpQhNJ-Jg42VOwkqT0y_OJpjR5kzUpKafH1bV4_Q,502
 kvirt/cluster/hypershift/nmstateconfig.yml.j2,sha256=EjNalSAXko4ZVEN-tnMJn3l59s2_-uBYSDN_C2SWZ6c,1587
 kvirt/cluster/hypershift/nodepool.yaml,sha256=CMRrPOwGSLCZNkO3oZU5JePksgwggxR4w556UqEikJw,752
 kvirt/cluster/hypershift/nonlocalbind.conf,sha256=eRCLfWYHqx2UgY3QE1pbXm2iFwERatyihNySEEbeuE8,60
 kvirt/cluster/hypershift/staticpods/coredns.yml,sha256=pIs5vJ12RxTCH4nVuDWGECiGuGLecbT8qDDGVXmjfqs,1890
 kvirt/cluster/hypershift/staticpods/keepalived.yml,sha256=Y90jy_Y6pgiwOa_0QvUqus34c8oMEZZu4G-OI6jCV70,2142
 kvirt/cluster/hypershift/staticpods/mdns.yml,sha256=-gX6SyvdSEXND36uA_ppr-5wzAEFx13ZgvdU_IeIl2o,1619
-kvirt/cluster/k3s/__init__.py,sha256=A_nZoGX7ydJ98DEFjGzWlp4Xg5rpN4RouHfyA14OI6c,11471
+kvirt/cluster/k3s/__init__.py,sha256=73Y8qmlenBJI70NONtNKiGYfPe1vp05spxebDc35qto,11448
 kvirt/cluster/k3s/bootstrap.sh,sha256=INB2JoqetAaYwB7TX3gVtvwpAHQ2N-sKX-a-dZjnh_0,1117
 kvirt/cluster/k3s/bootstrap.yml,sha256=hQ6SyufxcFXp4p93_92lhL0mWh_Hr1ixg9kmHL5QeU8,1050
 kvirt/cluster/k3s/cloud_lb_api.yml,sha256=FaXCkoCEn1jzlrUJv3LD8f2d0MNRi5FO_9za--W_tDw,409
 kvirt/cluster/k3s/ctlplanes.sh,sha256=6ZoabY5couHlvgcUFJUBK4YURSQ5iYsMZhEnlTAtStQ,438
 kvirt/cluster/k3s/ctlplanes.yml,sha256=yUSEMtcTrp88s7FvD2Bu7SHbzPOu8dxs1iOuEPGV8ZE,1068
 kvirt/cluster/k3s/join.sh,sha256=0Rll_HelrKIWxEV0ena7IxXH6eXgFaK9XzlPzTVL5jY,374
 kvirt/cluster/k3s/kcli_default.yml,sha256=eTRZUf-ZmEMc33C3kSy7iDlFLXRXzjql6kulOEw-UnI,1260
 kvirt/cluster/k3s/keepalived.conf,sha256=XBC6ezpHtjHF2lUU9l3z7zvjp5YYHzGuAz30TXvsFCo,511
 kvirt/cluster/k3s/keepalived.sh,sha256=CpUcNspJekNZGqTBmLk6m_tCaulL5hmKEQLYj-Pxc5w,352
 kvirt/cluster/k3s/workers.sh,sha256=ErZ5T8uEV8iV7PczVHY4bHXtFC3fsKVtF3k5tS_0vkc,166
 kvirt/cluster/k3s/workers.yml,sha256=HD1MkMcRKwvFndoMJOS8fC1f_O1vfzi27PVwR4GN_7k,709
-kvirt/cluster/kubeadm/__init__.py,sha256=kMiMe-yQQL3jewhQ6Xl4gppNTOAD_Jht-37eZKdheWI,13543
+kvirt/cluster/kubeadm/__init__.py,sha256=fvfbUl6-V1OcTqlf37-3ZPpUG1KkAg9lm67Ikr8MDWM,13520
 kvirt/cluster/kubeadm/bootstrap.sh,sha256=bM-p97BDmSlYvof0MehCaqASOycYtSDzDg_0jaowv_k,2707
 kvirt/cluster/kubeadm/bootstrap.yml,sha256=_ir1VAcHlggxsLlclaypz7VZxQUN2_ly7bEqfFcXt9A,1621
 kvirt/cluster/kubeadm/cloud_lb_api.yml,sha256=GnSSmlp-GVhUgPpd3fqyXSxgilyKqA6BmadyQ9z_jO4,325
 kvirt/cluster/kubeadm/ctlplanes.yml,sha256=qgStzWZSSMmIq-qAamSK3sFipdocawNTNWDKRdpGpPc,1172
 kvirt/cluster/kubeadm/deploy.sh,sha256=iCqoY0QHMltWKYRPmhu4DdsVrn4WIsRe9LugeRZzxpk,343
 kvirt/cluster/kubeadm/join.sh,sha256=L-fjfac_zJifQl3tKyE6kJBPCB3jZIYAEKYjmvfWD7s,412
 kvirt/cluster/kubeadm/kcli_default.yml,sha256=cE53vjnAG5RgFN3fP5E8XhyrfNwqQsYRP0-wp28cyB8,1822
@@ -113,15 +118,15 @@
 kvirt/cluster/kubeadm/apps/rook/install.sh,sha256=mDFV9IdnmQShUJs_eS907WgaE_Sy5spFgfs193_JJUQ,572
 kvirt/cluster/kubeadm/apps/submariner/install.sh,sha256=K8gMdjrKqnO681-tDvnWaPdgymKRWopajBui2ZDEcKE,190
 kvirt/cluster/kubeadm/apps/submariner/kcli_default.yml,sha256=sr_PUCUmOMrPbq6ggJNcSi0kA4zDPzrqXkITYmLJCJY,22
 kvirt/cluster/kubeadm/apps/tekton/install.sh,sha256=T0LJz0AAiJHEpIoGpHNE6INn1tHWIhlQV9Jpaa8ScP8,277
 kvirt/cluster/kubeadm/apps/tekton/uninstall.sh,sha256=oGzSveeC7ZLpNeMGnjoHtRjsJg12T0fmfi8U80cEm_Y,278
 kvirt/cluster/kubecommon/__init__.py,sha256=Ki7FzCjBDKDDnwxePIWOzAgEIzgTUCV6ykE8PexCKas,2970
 kvirt/cluster/kubernetes/__init__.py,sha256=5woH_jnsspKVgz-VHyd0ARFUSzXECe1oyoRVGyyi-5c,9395
-kvirt/cluster/microshift/__init__.py,sha256=aGCU-GNzSr8JdZ_dnPZIrLN4Z50DLEg1oFQ66mD7NX0,4805
+kvirt/cluster/microshift/__init__.py,sha256=1q6CehI0i2kghNCK3ijVhW4jF7ZvjGixZacsGt0157I,4782
 kvirt/cluster/microshift/kcli_plan.yml,sha256=NZJUbJoV52tpxCDd9bPfG7Vp4SEDqzm_qacMLDQzlhI,603
 kvirt/cluster/microshift/kcli_plan_default.yml,sha256=C-E3aEJc0p3O0uFatAnCra0aABHPCEsCi_FTeWp__80,625
 kvirt/cluster/microshift/scripts/00_sslip.sh,sha256=sD2d5PwNGEw5hEr65O8DGJK282cy-TLG_aLWRXLnueE,262
 kvirt/cluster/microshift/scripts/01_clients.sh,sha256=VSti_e8ypOc5UcjkM6gimi1sGxFRSQoUlN7WOGk92BE,799
 kvirt/cluster/microshift/scripts/02_crio.sh,sha256=YUHhom4HAnMORVlVhOCS6kJbJ_zT2uI6xS881jB3ELs,183
 kvirt/cluster/microshift/scripts/03_microshift.sh,sha256=Kiont4XD341I4DNmM5DNmSCm_JCCy1NKqPJu3F8I1LU,538
 kvirt/cluster/microshift/scripts/04_kubeconfig.sh,sha256=4J8KC2CpdTk6AfRCot_jRUMIpBElDjXBBRLR6osz2mo,341
@@ -140,15 +145,15 @@
 kvirt/cluster/openshift/99-metal3-fake-machine.yaml,sha256=Bm1h00oD0PACNHk1QQJf-kfHQHD7f4VOkGRCQ9rfSUI,250
 kvirt/cluster/openshift/99-metal3-provisioning.yaml,sha256=HJ_rl-F-qNm6tQcvkqnDT8aAu-FwQLMOUXBZ9UxaDxg,162
 kvirt/cluster/openshift/99-notifications.yaml,sha256=SKdm2ujYhJD5HI7DjuwHhVSMi_M0QfSqYAflekjDkoE,1659
 kvirt/cluster/openshift/99-operatorhub.yaml,sha256=hBx14bZ3qYzkX1s-Q0EbJkMRXpBHvS4y7ckjdTKqs30,118
 kvirt/cluster/openshift/99-ovn.yaml,sha256=Ykx0HZVqokms1YjWHqKOSXAFwO55nXNv39ngbU0d33A,314
 kvirt/cluster/openshift/99-sno.yaml,sha256=IS88cxRPXMWDQn_xKo3ho6hH-oMHYanCow_z7QtO0gk,912
 kvirt/cluster/openshift/Corefile,sha256=VpjS3qzS1CrRr473hNp5mNgURxbVtNQNp9b6KVZ2mMQ,762
-kvirt/cluster/openshift/__init__.py,sha256=WAvhwjZh0amGDMYaAmdFcQry_IWUnMBtqm0vd-QkiLc,81585
+kvirt/cluster/openshift/__init__.py,sha256=ihWoFLSTUQIKt70PO4BeMtF604vy23BUZMkcYb6p4V0,81470
 kvirt/cluster/openshift/autoapprovercron.yml,sha256=MjxtA9fg-TzpQP3mu7tIc--IpmdOaze8hYoCKFSvx8E,1326
 kvirt/cluster/openshift/autorules.yml,sha256=YigI0IlT0ah7WhdqQTxJfsJgWnJvNdvjs00wDsmUQM4,987
 kvirt/cluster/openshift/bootstrap.yml,sha256=qAQFBBBofSxotTTqV-knV0h1H2qqNNSB14v-TQv4tlc,1630
 kvirt/cluster/openshift/calico.sh.j2,sha256=6HH46S3eM3V7sHIXzWiYk739QwUAqAWl5M0hmFqyKNU,250
 kvirt/cluster/openshift/chrony.conf,sha256=WYo7cseCaZMx-JP6p9RFnsmmwlHg8whKQA4DxLZx_jI,107
 kvirt/cluster/openshift/cloud_bootstrap.yml,sha256=X5-ib8HK_4iuJ4JnFYIG39LBXhbr7cdGIHP473wnlJ4,629
 kvirt/cluster/openshift/cloud_ctlplanes.yml,sha256=YyOZbZq7S9I8W4UQHKujBUJrS1Wy5gtAo7Ey5Ql9qus,792
@@ -328,30 +333,30 @@
 kvirt/ksushy/templates/virtualmedias.json,sha256=IocFk2ecKvgnzO8nyxsBhJEdU62X_KvX0m4EunVQscw,705
 kvirt/miniconsole/__init__.py,sha256=jCaDAk4Yq2fjOR_4GrnRxMq9CPLolxIJR81_hAk1eZg,2780
 kvirt/nameutils/__init__.py,sha256=f_9tUVxw9yIz_JRGU-L39ZHoYPjfkclabHjC7CVl1QQ,3488
 kvirt/providers/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kvirt/providers/sampleprovider.py,sha256=IJHdRbhSrL10r-i1OLwiKhFxhHXewTyzso9SWlotVnQ,8935
 kvirt/providers/aws/__init__.py,sha256=XQUV9ppWbCb1z70vfoLurawcFlxcGFCcKqk31HEhLYM,65812
 kvirt/providers/fake/__init__.py,sha256=ufPQ7JdEkz7fQAiwb-LfHwrKzBFZrpiwk-8Hh8oI_XI,479
-kvirt/providers/gcp/__init__.py,sha256=RD9sVtlxyOLG_oycocpHPqeyPUU4DK7OGC_E25SV4Xo,67762
+kvirt/providers/gcp/__init__.py,sha256=YHTIHwRjP3CoVBq5_M-O9r-nbWhvEwpXh0HIy8YQSFk,67767
 kvirt/providers/gcp/gcp-hack.service,sha256=gG35O6KTLlGqIMwrSBqb_id-h3SWm_us_yLkLfQelOw,175
 kvirt/providers/gcp/gcp-hack.sh,sha256=K4ZDgWo9AoysBEMAZW3pj_5_1KmQAz0th49EqamsLVY,231
 kvirt/providers/ibm/__init__.py,sha256=Y1oEDxZDGuQBsql1n6QdWg8H5NikfpLY8dtXFYy0Jnw,65048
 kvirt/providers/kubevirt/__init__.py,sha256=QCqYFLaH-kz7Jj5bjGRqpyhTT903IVmyDQ0t8UsfYJU,80962
 kvirt/providers/kvm/__init__.py,sha256=i7nd0DWNH-LBzAWW3F7KAcSaWvjKBeUNRgDjtXZg_nc,184246
 kvirt/providers/kvm/helpers.py,sha256=t2CLczaU-gWPXL6iglK2Mlu-85ErH59nkdSA50v18lM,1965
 kvirt/providers/openstack/__init__.py,sha256=BJE2buq7PFkJRF9h2dXEyZnI99Ji1MOvoO4n3a9OtmE,57076
 kvirt/providers/ovirt/__init__.py,sha256=C2l1aLs32sdJLAe33GljKpIC3nae8pUsSpRKi_2c0B4,62544
 kvirt/providers/packet/__init__.py,sha256=xLXZicNxBC4FFhlKtYOcwcGZsV99Ylb7TPF4hkUFWUo,31112
 kvirt/providers/vsphere/__init__.py,sha256=CxwZGLFgc0BrblERVUdbZrq9qirCLUf1bpYOUXNpMUc,73099
 kvirt/providers/vsphere/helpers.py,sha256=F1rB_AHISd8TFYQ6eRolQmCVqU8KFAa36CCwjDj-vqw,13655
 kvirt/providers/vsphere/tagging.py,sha256=7RqFIUETSzHAjS0F_8-j145-_8lca7aDUsCxs4DhQVQ,4893
 kvirt/providers/web/__init__.py,sha256=pwj9Bam4UaWXH4OjW7h0ooLsVEjtMmxOC2KtfbbncWM,21286
 kvirt/version/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-kvirt/version/git,sha256=qkmoAckfznXBuwNb5CKEOvnEt4Q00Ioo6-DaAvc4NoI,19
+kvirt/version/git,sha256=ya5rrEsa7kMS7MaSPw-dwwz4y082Zr4GggjuwF7GtKM,19
 kvirt/web/__init__.py,sha256=jR0jOtI73-MJQmyVnH4MHuf5UQpdWZe-lCFk1YtXy54,46592
 kvirt/web/main.py,sha256=DIb6tW3ce7wCc83kD9HBCG4ALJuLItp9uaP6tzdsm_Y,261
 kvirt/web/static/css/bootstrap-notify.css,sha256=ibUTW-jDj-F8d1T1KZ4DOujRmVTFfvMKL9y14QgEaPQ,408
 kvirt/web/static/css/bootstrap-theme.min.css,sha256=ZT4HPpdCOt2lvDkXokHuhJfdOKSPFLzeAJik5U_Q-l4,23409
 kvirt/web/static/css/bootstrap.min.css,sha256=E-dwlJxOS7dOrKCvR-5WCqiHCbIHLl59MMDVsfU4oiU,121125
 kvirt/web/static/css/dataTables.checkboxes.css,sha256=H-x4lWeyX3jMsghnkCUUTO2lXjRpJ8pxhUj3YAqaBrQ,399
 kvirt/web/static/css/jquery.dataTables.min.css,sha256=-Z1rYa3ys5OdZNUck5G7lBvb8A13OrYwvf-d8PfEaHQ,13587
@@ -585,13 +590,13 @@
 kvirt/web/templates/repos.html,sha256=HaFCTQjX3zSaqyV05Y_wG0vSkOWDpc-wj6Uj5TLbiFg,475
 kvirt/web/templates/repostable.html,sha256=6HH8sgdppR-yojQspdcI59ju4e9HZYVvV6uvnPxqbeo,1203
 kvirt/web/templates/vmcreate.html,sha256=FG3OoQEKTpeo8spJ1WiqYVkOp672saYRQKujNWOA3uQ,958
 kvirt/web/templates/vmprofiles.html,sha256=T65Cv7povhBtD2dyuWkWJE6byaA9EYtLSk5gtcQlHIU,486
 kvirt/web/templates/vmprofilestable.html,sha256=-8viNOqSvN_yzimENxq7Q0187zbflOn8p8zpgx0Vyek,1420
 kvirt/web/templates/vms.html,sha256=k2ptKeiLFdpzgfbk6xi__sduu0UALYXXrnrmDEmAfaQ,470
 kvirt/web/templates/vmstable.html,sha256=ikuYkIm_ocvGIBXFyJt1-tBjwQWCyqkgC08leoXgR54,4894
-kcli-99.0.202306081954.dist-info/LICENSE,sha256=z8d0m5b2O9McPEK1xHG_dWgUBT6EfBDz6wA0F7xSPTA,11358
-kcli-99.0.202306081954.dist-info/METADATA,sha256=w5obvRV_Qhyj3JwV63WCZagGbhbbKa7Z4og7JiqbS_Y,2914
-kcli-99.0.202306081954.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-kcli-99.0.202306081954.dist-info/entry_points.txt,sha256=Rks05_15yZkzTe2QTbrkV_O8uruW_WjUDzmfMApHUvw,209
-kcli-99.0.202306081954.dist-info/top_level.txt,sha256=FwVTxtMIWdr8QBk5mTfd0f_GheFlRR_vn4zl6p5N57s,6
-kcli-99.0.202306081954.dist-info/RECORD,,
+kcli-99.0.202306091732.dist-info/LICENSE,sha256=z8d0m5b2O9McPEK1xHG_dWgUBT6EfBDz6wA0F7xSPTA,11358
+kcli-99.0.202306091732.dist-info/METADATA,sha256=VeFmhF0B7aM9TD2caSRd46onsIWD23t6aZUYGa4thkA,3024
+kcli-99.0.202306091732.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+kcli-99.0.202306091732.dist-info/entry_points.txt,sha256=Rks05_15yZkzTe2QTbrkV_O8uruW_WjUDzmfMApHUvw,209
+kcli-99.0.202306091732.dist-info/top_level.txt,sha256=FwVTxtMIWdr8QBk5mTfd0f_GheFlRR_vn4zl6p5N57s,6
+kcli-99.0.202306091732.dist-info/RECORD,,
```

