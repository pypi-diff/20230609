# Comparing `tmp/odoo13_addon_base_view_inheritance_extension-13.0.1.1.1-py3-none-any.whl.zip` & `tmp/odoo13_addon_base_view_inheritance_extension-13.0.2.0.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,28 +1,28 @@
-Zip file size: 32798 bytes, number of entries: 26
--rw-r--r--  2.0 unx     3983 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/README.rst
--rw-r--r--  2.0 unx       21 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/__init__.py
--rw-r--r--  2.0 unx      580 b- defN 23-Jan-15 11:59 odoo/addons/base_view_inheritance_extension/__manifest__.py
--rw-r--r--  2.0 unx     1351 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/demo/ir_ui_view.xml
--rw-r--r--  2.0 unx      850 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/i18n/base_view_inheritance_extension.pot
--rw-r--r--  2.0 unx     1262 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/i18n/ca.po
--rw-r--r--  2.0 unx     1183 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/i18n/de.po
--rw-r--r--  2.0 unx     1252 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/i18n/es.po
--rw-r--r--  2.0 unx     1264 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/i18n/hr.po
--rw-r--r--  2.0 unx     1220 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/i18n/it.po
--rw-r--r--  2.0 unx     1265 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/i18n/sl.po
--rw-r--r--  2.0 unx     1272 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/i18n/tr.po
--rw-r--r--  2.0 unx       25 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/models/__init__.py
--rw-r--r--  2.0 unx     5320 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/models/ir_ui_view.py
--rw-r--r--  2.0 unx      168 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx       88 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx      224 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/readme/ROADMAP.rst
--rw-r--r--  2.0 unx      823 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/readme/USAGE.rst
--rw-r--r--  2.0 unx     9455 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/static/description/icon.png
--rw-r--r--  2.0 unx    14906 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/static/description/index.html
--rw-r--r--  2.0 unx       51 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/tests/__init__.py
--rw-r--r--  2.0 unx    11690 b- defN 23-Jan-15 11:58 odoo/addons/base_view_inheritance_extension/tests/test_base_view_inheritance_extension.py
--rw-r--r--  2.0 unx     4580 b- defN 23-Jan-15 12:01 odoo13_addon_base_view_inheritance_extension-13.0.1.1.1.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jan-15 12:01 odoo13_addon_base_view_inheritance_extension-13.0.1.1.1.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 23-Jan-15 12:01 odoo13_addon_base_view_inheritance_extension-13.0.1.1.1.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     3076 b- defN 23-Jan-15 12:01 odoo13_addon_base_view_inheritance_extension-13.0.1.1.1.dist-info/RECORD
-26 files, 66006 bytes uncompressed, 27472 bytes compressed:  58.4%
+Zip file size: 33935 bytes, number of entries: 26
+-rw-r--r--  2.0 unx     4496 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/README.rst
+-rw-r--r--  2.0 unx       21 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/__init__.py
+-rw-r--r--  2.0 unx      580 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/__manifest__.py
+-rw-r--r--  2.0 unx     3105 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/demo/ir_ui_view.xml
+-rw-r--r--  2.0 unx      677 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/i18n/base_view_inheritance_extension.pot
+-rw-r--r--  2.0 unx     1262 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/i18n/ca.po
+-rw-r--r--  2.0 unx     1183 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/i18n/de.po
+-rw-r--r--  2.0 unx     1252 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/i18n/es.po
+-rw-r--r--  2.0 unx     1264 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/i18n/hr.po
+-rw-r--r--  2.0 unx     1220 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/i18n/it.po
+-rw-r--r--  2.0 unx     1265 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/i18n/sl.po
+-rw-r--r--  2.0 unx     1272 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/i18n/tr.po
+-rw-r--r--  2.0 unx       25 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/models/__init__.py
+-rw-r--r--  2.0 unx     8701 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/models/ir_ui_view.py
+-rw-r--r--  2.0 unx      225 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx       88 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx      224 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/readme/ROADMAP.rst
+-rw-r--r--  2.0 unx     1279 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/readme/USAGE.rst
+-rw-r--r--  2.0 unx     9455 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/static/description/icon.png
+-rw-r--r--  2.0 unx    15953 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/static/description/index.html
+-rw-r--r--  2.0 unx       51 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/tests/__init__.py
+-rw-r--r--  2.0 unx     5010 b- defN 23-Jun-09 11:48 odoo/addons/base_view_inheritance_extension/tests/test_base_view_inheritance_extension.py
+-rw-r--r--  2.0 unx     5093 b- defN 23-Jun-09 11:48 odoo13_addon_base_view_inheritance_extension-13.0.2.0.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jun-09 11:48 odoo13_addon_base_view_inheritance_extension-13.0.2.0.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-Jun-09 11:48 odoo13_addon_base_view_inheritance_extension-13.0.2.0.0.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     3076 b- defN 23-Jun-09 11:48 odoo13_addon_base_view_inheritance_extension-13.0.2.0.0.dist-info/RECORD
+26 files, 66874 bytes uncompressed, 28609 bytes compressed:  57.2%
```

## zipnote {}

```diff
@@ -60,20 +60,20 @@
 
 Filename: odoo/addons/base_view_inheritance_extension/tests/__init__.py
 Comment: 
 
 Filename: odoo/addons/base_view_inheritance_extension/tests/test_base_view_inheritance_extension.py
 Comment: 
 
-Filename: odoo13_addon_base_view_inheritance_extension-13.0.1.1.1.dist-info/METADATA
+Filename: odoo13_addon_base_view_inheritance_extension-13.0.2.0.0.dist-info/METADATA
 Comment: 
 
-Filename: odoo13_addon_base_view_inheritance_extension-13.0.1.1.1.dist-info/WHEEL
+Filename: odoo13_addon_base_view_inheritance_extension-13.0.2.0.0.dist-info/WHEEL
 Comment: 
 
-Filename: odoo13_addon_base_view_inheritance_extension-13.0.1.1.1.dist-info/top_level.txt
+Filename: odoo13_addon_base_view_inheritance_extension-13.0.2.0.0.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo13_addon_base_view_inheritance_extension-13.0.1.1.1.dist-info/RECORD
+Filename: odoo13_addon_base_view_inheritance_extension-13.0.2.0.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/base_view_inheritance_extension/README.rst

```diff
@@ -60,14 +60,31 @@
 
 .. code-block:: xml
 
     <attribute name="$attribute" operation="list_remove">
         $remove_value(s)
     </attribute>
 
+**Add text after and/or before than original**
+
+.. code-block:: xml
+
+    <attribute name="$attribute" operation="text_add">
+        $text_before {old_value} $text_after
+    </attribute>
+
+**Add domain with AND/OR join operator (AND if missed) allowing conditional changes**
+
+.. code-block:: xml
+
+    <attribute name="$attribute" operation="domain_add"
+               condition="$field_condition" join_operator="OR">
+        $domain_to_add
+    </attribute>
+
 **Move an element in the view**
 
 This feature is now native, cf the `official Odoo documentation <https://www.odoo.com/documentation/12.0/reference/views.html#inheritance-specs>`_.
 
 Known issues / Roadmap
 ======================
 
@@ -94,15 +111,20 @@
 * Therp BV
 
 Contributors
 ~~~~~~~~~~~~
 
 * Holger Brunn <hbrunn@therp.nl>
 * Ronald Portier <rportier@therp.nl>
-* Sergio Teruel <sergio.teruel@tecnativa.com>
+* `Tecnativa <https://www.tecnativa.com>`_:
+
+  * Sergio Teruel
+  * Carlos Dauden
+  * Stefan ungureanu
+
 * Iv√°n Todorovich <ivan.todorovich@camptocamp.com>
 
 Maintainers
 ~~~~~~~~~~~
 
 This module is maintained by the OCA.
```

## odoo/addons/base_view_inheritance_extension/__manifest__.py

```diff
@@ -1,13 +1,13 @@
 # Copyright 2016 Therp BV <https://therp.nl>
 # Copyright 2018 Tecnativa - Sergio Teruel
 # License LGPL-3.0 or later (https://www.gnu.org/licenses/lgpl.html).
 {
     "name": "Extended view inheritance",
-    "version": "13.0.1.1.1",
+    "version": "13.0.2.0.0",
     "author": "Therp BV,Odoo Community Association (OCA)",
     "website": "https://github.com/OCA/server-tools",
     "license": "LGPL-3",
     "category": "Hidden/Dependency",
     "summary": "Adds more operators for view inheritance",
     "depends": ["base"],
     "external_dependencies": {"python": ["astor"]},
```

## odoo/addons/base_view_inheritance_extension/demo/ir_ui_view.xml

### odoo/addons/base_view_inheritance_extension/demo/ir_ui_view.xml

```diff
@@ -1,25 +1,50 @@
 <?xml version="1.0" encoding="utf-8"?>
 <odoo>
-  <record id="view_partner_simple_form" model="ir.ui.view">
+  <record id="view_partner_simple_form_2" model="ir.ui.view">
     <field name="model">res.partner</field>
-    <field name="inherit_id" ref="base.view_partner_simple_form"/>
+    <field name="inherit_id" ref="base.view_partner_form"/>
+    <field name="active">False</field>
     <field name="arch" type="xml">
-      <xpath expr="." position="attributes">
-        <attribute name="string">Partner form</attribute>
-      </xpath>
-      <field name="parent_id" position="attributes">
-        <attribute name="context" operation="python_dict" key="default_name">'The company name'</attribute>
-        <attribute name="context" operation="python_dict" key="default_company_id">context.get('company_id', context.get('company'))</attribute>
+      <field name="country_id" position="attributes">
+        <attribute name="domain" operation="domain_add" condition="">[('code', '=', 'es')]</attribute>
+      </field>
+      <field name="mobile" position="attributes">
+        <attribute name="string" operation="text_add">Pre-</attribute>
+        <attribute name="attrs" operation="python_dict" key="invisible">[('is_company', '=', False)]</attribute>
       </field>
-      <!-- without operations, the standard handler should be called /-->
       <field name="parent_id" position="attributes">
-        <attribute name="name">parent_id</attribute>
+        <attribute name="context" operation="python_dict" key="default_company_id">company_id</attribute>
+      </field>
+      <field name="function" position="attributes">
+        <attribute name="attrs" operation="python_dict" key="required">[('is_company', '=', False)]</attribute>
+      </field>
+      <field name="email" position="attributes">
+        <attribute name="attrs" operation="python_dict" key="required">[('is_company','=', False)]</attribute>
       </field>
-      <form position="inside">
-        <notebook>
-          <page string="Phone numbers" name="phone_book"/>
-        </notebook>
-      </form>
+      <field name="state_id" position="attributes">
+        <attribute name="context">{
+                'default_name': 'test_state',
+                'default_code': context.get('code')
+                }</attribute>
+        <attribute name="context" operation="python_dict" key="default_country_id">context.get('force_country_id') and country_id or False</attribute>
+      </field>
+    </field>
+  </record>
+  <record id="view_user_simple_form" model="ir.ui.view">
+    <field name="model">res.users</field>
+    <field name="inherit_id" ref="base.view_users_form"/>
+    <field name="active">False</field>
+    <field name="arch" type="xml">
+      <button name="action_show_groups" position="attributes">
+        <attribute name="state" operation="list_add">new</attribute>
+      </button>
+      <button name="action_show_accesses" position="attributes">
+        <attribute name="state" operation="list_add">new,active</attribute>
+      </button>
+      <button name="action_show_rules" position="attributes">
+        <attribute name="state">new,active</attribute>
+        <attribute name="state" operation="list_remove">active,new</attribute>
+      </button>
     </field>
   </record>
 </odoo>
```

## odoo/addons/base_view_inheritance_extension/i18n/base_view_inheritance_extension.pot

```diff
@@ -10,20 +10,15 @@
 "Language-Team: \n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: \n"
 "Plural-Forms: \n"
 
 #. module: base_view_inheritance_extension
-#: model_terms:ir.ui.view,arch_db:base_view_inheritance_extension.view_partner_simple_form
-msgid "Partner form"
-msgstr ""
-
-#. module: base_view_inheritance_extension
-#: model_terms:ir.ui.view,arch_db:base_view_inheritance_extension.view_partner_simple_form
-msgid "Phone numbers"
+#: model_terms:ir.ui.view,arch_db:base_view_inheritance_extension.view_partner_simple_form_2
+msgid "Pre-"
 msgstr ""
 
 #. module: base_view_inheritance_extension
 #: model:ir.model,name:base_view_inheritance_extension.model_ir_ui_view
 msgid "View"
 msgstr ""
```

## odoo/addons/base_view_inheritance_extension/models/ir_ui_view.py

```diff
@@ -1,17 +1,20 @@
 # Copyright 2016 Therp BV <https://therp.nl>
 # Copyright 2018 Tecnativa - Sergio Teruel
 # Copyright 2021 Camptocamp SA (https://www.camptocamp.com).
+# Copyright 2023 Tecnativa - Carlos Dauden
 # License LGPL-3.0 or later (https://www.gnu.org/licenses/lgpl.html).
 import ast
 import logging
+import re
 
 from lxml import etree
 
 from odoo import api, models
+from odoo.osv import expression
 
 try:
     import astor
 except ImportError as err:  # pragma: no cover
     _logger = logging.getLogger(__name__)
     _logger.debug(err)
 
@@ -82,19 +85,19 @@
             key_idx = next(
                 (
                     i
                     for i, k in enumerate(ast_dict.keys)
                     if (isinstance(k, ast.Str) and k.s == attr_key)
                     or (isinstance(k, ast.Constant) and k.value == attr_key)
                 ),
-                None,
+                -1,
             )
             # Update or create the key
             value = ast.parse(attribute_node.text.strip(), mode="eval").body
-            if key_idx:
+            if key_idx >= 0:
                 ast_dict.values[key_idx] = value
             else:
                 ast_dict.keys.append(ast.Str(attr_key))
                 ast_dict.values.append(value)
             # Dump the ast back to source
             # TODO: once odoo requires python >= 3.9; use `ast.unparse` instead
             node.attrib[attribute_node.get("name")] = astor.to_source(
@@ -110,15 +113,18 @@
                 $new_value
             </attribute>
         </$node>"""
         node = self.locate_node(source, specs)
         for attribute_node in specs:
             attribute_name = attribute_node.get("name")
             old_value = node.get(attribute_name) or ""
-            new_value = old_value + "," + attribute_node.text
+            new_value = "%s%s" % (
+                old_value + "," if old_value else "",
+                attribute_node.text,
+            )
             node.attrib[attribute_name] = new_value
         return source
 
     @api.model
     def inheritance_handler_attributes_list_remove(self, source, specs, inherit_id):
         """Implement
         <$node position="attributes">
@@ -130,7 +136,81 @@
         for attribute_node in specs:
             attribute_name = attribute_node.get("name")
             old_values = (node.get(attribute_name) or "").split(",")
             remove_values = attribute_node.text.split(",")
             new_values = [x for x in old_values if x not in remove_values]
             node.attrib[attribute_name] = ",".join([_f for _f in new_values if _f])
         return source
+
+    @api.model
+    def inheritance_handler_attributes_text_add(self, source, specs, inherit_id):
+        """Implement
+        <$node position="attributes">
+            <attribute name="$attribute" operation="text_add">
+                $text_before {old_value} $text_after
+            </attribute>
+        </$node>"""
+        node = self.locate_node(source, specs)
+        for attribute_node in specs:
+            attribute_name = attribute_node.get("name")
+            old_value = node.get(attribute_name) or ""
+            node.attrib[attribute_name] = attribute_node.text.format(
+                old_value=old_value
+            )
+        return source
+
+    @api.model
+    def inheritance_handler_attributes_domain_add(self, source, specs, inherit_id):
+        """Implement
+        <$node position="attributes">
+            <attribute name="$attribute" operation="domain_add"
+                       condition="$field_condition" join_operator="OR">
+                $domain_to_add
+            </attribute>
+        </$node>"""
+        node = self.locate_node(source, specs)
+        for attribute_node in specs:
+            attribute_name = attribute_node.get("name")
+            condition = attribute_node.get("condition")
+            join_operator = attribute_node.get("join_operator") or "AND"
+            old_value = node.get(attribute_name) or ""
+            if old_value:
+                old_domain = ast.literal_eval(
+                    self.var2str_domain_text(old_value.strip())
+                )
+                new_domain = ast.literal_eval(
+                    self.var2str_domain_text(attribute_node.text.strip())
+                )
+                if join_operator == "OR":
+                    new_value = str(expression.OR([old_domain, new_domain]))
+                else:
+                    new_value = str(expression.AND([old_domain, new_domain]))
+                new_value = self.str2var_domain_text(new_value)
+            else:
+                new_value = attribute_node.text
+            if condition:
+                new_value = "{condition} and {new_value} or {old_value}".format(
+                    condition=condition,
+                    new_value=new_value,
+                    old_value=old_value,
+                )
+            node.attrib[attribute_name] = new_value
+        return source
+
+    @api.model
+    def var2str_domain_text(self, domain_str):
+        """Replaces var names with str names to allow eval without defined vars"""
+        # Replace fields in 2 steps because 1 step returns "parent_sufix"."var_sufix"
+        regex_parent = re.compile(r"parent\.(\b\w+\b)")
+        domain_str = re.sub(
+            regex_parent, r"'parent.\1_is_a_var_to_replace'", domain_str
+        )
+        regex = re.compile(r"(?<!\')(\b\w+\b)(?!\')")
+        return re.sub(regex, r"'\1_is_a_var_to_replace'", domain_str)
+
+    @api.model
+    def str2var_domain_text(self, domain_str):
+        """Revert var2str_domain_text cleaning apostrophes and suffix in vars"""
+        pattern = re.compile(r"'(parent\.[^']+)_is_a_var_to_replace'")
+        domain_str = pattern.sub(r"\1", domain_str)
+        pattern = re.compile(r"'([^']+)_is_a_var_to_replace'")
+        return pattern.sub(r"\1", domain_str)
```

## odoo/addons/base_view_inheritance_extension/readme/CONTRIBUTORS.rst

```diff
@@ -1,4 +1,9 @@
 * Holger Brunn <hbrunn@therp.nl>
 * Ronald Portier <rportier@therp.nl>
-* Sergio Teruel <sergio.teruel@tecnativa.com>
+* `Tecnativa <https://www.tecnativa.com>`_:
+
+  * Sergio Teruel
+  * Carlos Dauden
+  * Stefan ungureanu
+
 * Iv√°n Todorovich <ivan.todorovich@camptocamp.com>
```

## odoo/addons/base_view_inheritance_extension/readme/USAGE.rst

```diff
@@ -22,10 +22,27 @@
 
 .. code-block:: xml
 
     <attribute name="$attribute" operation="list_remove">
         $remove_value(s)
     </attribute>
 
+**Add text after and/or before than original**
+
+.. code-block:: xml
+
+    <attribute name="$attribute" operation="text_add">
+        $text_before {old_value} $text_after
+    </attribute>
+
+**Add domain with AND/OR join operator (AND if missed) allowing conditional changes**
+
+.. code-block:: xml
+
+    <attribute name="$attribute" operation="domain_add"
+               condition="$field_condition" join_operator="OR">
+        $domain_to_add
+    </attribute>
+
 **Move an element in the view**
 
 This feature is now native, cf the `official Odoo documentation <https://www.odoo.com/documentation/12.0/reference/views.html#inheritance-specs>`_.
```

## odoo/addons/base_view_inheritance_extension/static/description/index.html

### odoo/addons/base_view_inheritance_extension/static/description/index.html

```diff
@@ -461,14 +461,44 @@
           <span class="na">operation=</span>
           <span class="s">&quot;list_remove&quot;</span>
           <span class="nt">&gt;</span>
           $remove_value(s)
           <span class="nt">&lt;/attribute&gt;</span>
         </pre>
         <p>
+          <strong>Add text after and/or before than original</strong>
+        </p>
+        <pre class="code xml literal-block">
+          <span class="nt">&lt;attribute</span>
+          <span class="na">name=</span>
+          <span class="s">&quot;$attribute&quot;</span>
+          <span class="na">operation=</span>
+          <span class="s">&quot;text_add&quot;</span>
+          <span class="nt">&gt;</span>
+          $text_before {old_value} $text_after
+          <span class="nt">&lt;/attribute&gt;</span>
+        </pre>
+        <p>
+          <strong>Add domain with AND/OR join operator (AND if missed) allowing conditional changes</strong>
+        </p>
+        <pre class="code xml literal-block">
+          <span class="nt">&lt;attribute</span>
+          <span class="na">name=</span>
+          <span class="s">&quot;$attribute&quot;</span>
+          <span class="na">operation=</span>
+          <span class="s">&quot;domain_add&quot;</span>
+          <span class="na">condition=</span>
+          <span class="s">&quot;$field_condition&quot;</span>
+          <span class="na">join_operator=</span>
+          <span class="s">&quot;OR&quot;</span>
+          <span class="nt">&gt;</span>
+          $domain_to_add
+          <span class="nt">&lt;/attribute&gt;</span>
+        </pre>
+        <p>
           <strong>Move an element in the view</strong>
         </p>
         <p>
           This feature is now native, cf the
           <a class="reference external" href="https://www.odoo.com/documentation/12.0/reference/views.html#inheritance-specs">official Odoo documentation</a>
           .
         </p>
@@ -543,17 +573,21 @@
             </li>
             <li>
               Ronald Portier &lt;
               <a class="reference external" href="mailto:rportier@therp.nl">rportier@therp.nl</a>
               &gt;
             </li>
             <li>
-              Sergio Teruel &lt;
-              <a class="reference external" href="mailto:sergio.teruel@tecnativa.com">sergio.teruel@tecnativa.com</a>
-              &gt;
+              <a class="reference external" href="https://www.tecnativa.com">Tecnativa</a>
+              :
+              <ul>
+                <li>Sergio Teruel</li>
+                <li>Carlos Dauden</li>
+                <li>Stefan ungureanu</li>
+              </ul>
             </li>
             <li>
               Iv√°n Todorovich &lt;
               <a class="reference external" href="mailto:ivan.todorovich@camptocamp.com">ivan.todorovich@camptocamp.com</a>
               &gt;
             </li>
           </ul>
```

## odoo/addons/base_view_inheritance_extension/tests/test_base_view_inheritance_extension.py

```diff
@@ -2,269 +2,75 @@
 # Copyright 2021 Camptocamp SA (https://www.camptocamp.com).
 # @author Iv√°n Todorovich <ivan.todorovich@camptocamp.com>
 # License LGPL-3.0 or later (https://www.gnu.org/licenses/lgpl.html).
 
 from lxml import etree
 
 from odoo.tests.common import SavepointCase
+from odoo.tools.safe_eval import safe_eval
 
 
 class TestBaseViewInheritanceExtension(SavepointCase):
     @classmethod
     def setUpClass(cls):
         super().setUpClass()
         cls.ViewModel = cls.env["ir.ui.view"]
 
-    def test_base_view_inheritance_extension(self):
-        view_id = self.env.ref("base.view_partner_simple_form").id
-        fields_view_get = self.env["res.partner"].fields_view_get(view_id=view_id)
-        view = etree.fromstring(fields_view_get["arch"])
-        # verify normal attributes work
-        self.assertEqual(view.xpath("//form")[0].get("string"), "Partner form")
-        # verify our extra context key worked
-        self.assertTrue(
-            "default_name" in view.xpath('//field[@name="parent_id"]')[0].get("context")
-        )
-        self.assertTrue(
-            "context.get('company_id', context.get('company'))"
-            in view.xpath('//field[@name="parent_id"]')[0].get("context")
-        )
-
-    def test_list_add(self):
-        view_model = self.env["ir.ui.view"]
-        inherit_id = self.env.ref("base.view_partner_form").id
-        source = etree.fromstring(
-            """\
-            <form>
-                <button name="test" states="draft,open"/>
-            </form>
-            """
-        )
-        # extend with single value
-        specs = etree.fromstring(
-            """\
-            <button name="test" position="attributes">
-                <attribute
-                    name="states"
-                    operation="list_add"
-                    >valid</attribute>
-            </button>
-            """
-        )
-        modified_source = view_model.inheritance_handler_attributes_list_add(
-            source, specs, inherit_id
-        )
-        button_node = modified_source.xpath('//button[@name="test"]')[0]
-        self.assertEqual(button_node.attrib["states"], "draft,open,valid")
-        # extend with list of values
-        specs = etree.fromstring(
-            """\
-            <button name="test" position="attributes">
-                <attribute
-                    name="states"
-                    operation="list_add"
-                    >payable,paid</attribute>
-            </button>
-            """
-        )
-        modified_source = view_model.inheritance_handler_attributes_list_add(
-            source, specs, inherit_id
-        )
-        button_node = modified_source.xpath('//button[@name="test"]')[0]
-        self.assertEqual(button_node.attrib["states"], "draft,open,valid,payable,paid")
-
-    def test_list_remove(self):
-        view_model = self.env["ir.ui.view"]
-        inherit_id = self.env.ref("base.view_partner_form").id
-        source = etree.fromstring(
-            """\
-            <form>
-                <button name="test" states="draft,open,valid,payable,paid"/>
-            </form>
-            """
-        )
-        # remove list of values
-        specs = etree.fromstring(
-            """\
-            <button name="test" position="attributes">
-                <attribute
-                    name="states"
-                    operation="list_remove"
-                    >open,payable</attribute>
-            </button>
-            """
-        )
-        modified_source = view_model.inheritance_handler_attributes_list_remove(
-            source, specs, inherit_id
-        )
-        button_node = modified_source.xpath('//button[@name="test"]')[0]
-        self.assertEqual(button_node.attrib["states"], "draft,valid,paid")
-
-    def test_python_dict_inheritance_context_default(self):
-        inherit_id = self.env.ref("base.view_partner_form").id
-        source = etree.fromstring(
-            """
-            <form>
-                <field name="account_move_id" context="{'default_journal_id': journal_id}" />
-            </form>
-            """
-        )
-        specs = etree.fromstring(
-            """
-            <field name="account_move_id" position="attributes">
-                <attribute name="context" operation="python_dict" key="default_company_id">
-                    company_id
-                </attribute>
-            </field>
-            """
-        )
-        res = self.ViewModel.inheritance_handler_attributes_python_dict(
-            source, specs, inherit_id
-        )
-        self.assertEqual(
-            res.xpath('//field[@name="account_move_id"]')[0].attrib["context"],
-            "{'default_journal_id': journal_id, 'default_company_id': company_id}",
-        )
-
-    def test_python_dict_inheritance_context_complex(self):
-        inherit_id = self.env.ref("base.view_partner_form").id
-        source = etree.fromstring(
-            """
-            <form>
-                <field
-                    name="invoice_line_ids"
-                    context="{
-                        'default_type': context.get('default_type'),
-                        'journal_id': journal_id,
-                        'default_partner_id': commercial_partner_id,
-                        'default_currency_id': (
-                            currency_id != company_currency_id and currency_id or False
-                        ),
-                        'default_name': 'The company name',
-                    }"
-                />
-            </form>
-            """
-        )
-        specs = etree.fromstring(
-            """
-            <field name="invoice_line_ids" position="attributes">
-                <attribute name="context" operation="python_dict" key="default_product_id">
-                    product_id
-                </attribute>
-                <attribute name="context" operation="python_dict" key="default_cost_center_id">
-                    context.get('handle_mrp_cost') and cost_center_id or False
-                </attribute>
-            </field>
-            """
-        )
-        res = self.ViewModel.inheritance_handler_attributes_python_dict(
-            source, specs, inherit_id
-        )
-        self.assertEqual(
-            res.xpath('//field[@name="invoice_line_ids"]')[0].attrib["context"],
-            "{'default_type': context.get('default_type'), 'journal_id': journal_id, "
-            "'default_partner_id': commercial_partner_id, 'default_currency_id': "
-            "currency_id != company_currency_id and currency_id or False, "
-            "'default_name': 'The company name', 'default_product_id': product_id, "
-            "'default_cost_center_id': context.get('handle_mrp_cost') and "
-            "cost_center_id or False}",
-        )
-
-    def test_python_dict_inheritance_attrs_add(self):
-        """Test that we can add new keys to an existing dict"""
-        inherit_id = self.env.ref("base.view_partner_form").id
-        source = etree.fromstring(
-            """
-            <form>
-                <field
-                    name="ref"
-                    attrs="{'invisible': [('state', '=', 'draft')]}"
-                />
-            </form>
-            """
-        )
-        specs = etree.fromstring(
-            """
-            <field name="ref" position="attributes">
-                <attribute name="attrs" operation="python_dict" key="required">
-                    [('state', '!=', 'draft')]
-                </attribute>
-            </field>
-            """
-        )
-        res = self.ViewModel.inheritance_handler_attributes_python_dict(
-            source, specs, inherit_id
-        )
-        self.assertEqual(
-            res.xpath('//field[@name="ref"]')[0].attrib["attrs"],
-            "{'invisible': [('state', '=', 'draft')], "
-            "'required': [('state', '!=', 'draft')]}",
-        )
-
-    def test_python_dict_inheritance_attrs_update(self):
-        """Test that we can replace an existing dict key"""
-        inherit_id = self.env.ref("base.view_partner_form").id
-        source = etree.fromstring(
-            """
-            <form>
-                <field
-                    name="ref"
-                    attrs="{
-                        'invisible': [('state', '=', 'draft')],
-                        'required': [('state', '=', False)],
-                    }"
-                />
-            </form>
-            """
-        )
-        specs = etree.fromstring(
-            """
-            <field name="ref" position="attributes">
-                <attribute name="attrs" operation="python_dict" key="required">
-                    [('state', '!=', 'draft')]
-                </attribute>
-            </field>
-            """
-        )
-        res = self.ViewModel.inheritance_handler_attributes_python_dict(
-            source, specs, inherit_id
-        )
-        self.assertEqual(
-            res.xpath('//field[@name="ref"]')[0].attrib["attrs"],
-            "{'invisible': [('state', '=', 'draft')], "
-            "'required': [('state', '!=', 'draft')]}",
-        )
-
-    def test_python_dict_inheritance_attrs_new(self):
-        """Test that we can add new keys by creating the dict if it's missing"""
-        inherit_id = self.env.ref("base.view_partner_form").id
-        source = etree.fromstring(
-            """
-            <form>
-                <field name="ref" />
-            </form>
-            """
-        )
-        specs = etree.fromstring(
-            """
-            <field name="ref" position="attributes">
-                <attribute name="attrs" operation="python_dict" key="required">
-                    [('state', '!=', 'draft')]
-                </attribute>
-            </field>
-            """
-        )
-        res = self.ViewModel.inheritance_handler_attributes_python_dict(
-            source, specs, inherit_id
-        )
-        self.assertEqual(
-            res.xpath('//field[@name="ref"]')[0].attrib["attrs"],
-            "{'required': [('state', '!=', 'draft')]}",
-        )
+    def test_partner_view_full_validation(self):
+        view = self.env.ref(
+            "base_view_inheritance_extension.view_partner_simple_form_2"
+        )
+        view.active = True
+        res = self.env["res.partner"].fields_view_get()
+        arch = etree.XML(res["arch"])
+        # Test adding domain to attribute
+        country_id = arch.xpath("//field[@name='country_id']")[0]
+        self.assertEqual(country_id.get("domain"), "[('code', '=', 'es')]")
+        # Test adding text to attribute
+        mobile = arch.xpath("//field[@name='mobile']")[0]
+        self.assertIn("Pre-", mobile.get("string"))
+        # Test adding key in context dict
+        parent = arch.xpath("//field[@name='parent_id']")[0]
+        self.assertIn("default_company_id", parent.get("context"))
+        self.assertIn("default_is_company", parent.get("context"))
+        # Test adding key inside existing dict
+        function = arch.xpath("//field[@name='function']")[0]
+        f_dict = safe_eval(function.get("attrs"))
+        self.assertEqual([("is_company", "=", False)], f_dict["required"])
+        self.assertEqual([("is_company", "=", True)], f_dict["invisible"])
+        # Test replacing dict key
+        email = arch.xpath("//field[@name='email']")[0]
+        e_dict = safe_eval(email.get("attrs"))
+        self.assertEqual([("is_company", "=", False)], e_dict["required"])
+        # Test adding keys if dict is missing
+        mobile_dict = safe_eval(mobile.get("attrs"))
+        self.assertEqual([("is_company", "=", False)], mobile_dict["invisible"])
+        # Test complex context
+        state = arch.xpath("//field[@name='state_id']")[0]
+        self.assertIn(
+            "'default_country_id': context.get('force_country_id') and country_id or False",
+            state.get("context"),
+        )
+
+    def test_list_add_remove(self):
+        view = self.env.ref("base_view_inheritance_extension.view_user_simple_form")
+        view.active = True
+        res = self.env["res.users"].fields_view_get(
+            view_id=self.env.ref("base.view_users_form").id
+        )
+        arch = etree.XML(res["arch"])
+        # Test adding value to list
+        button_groups = arch.xpath("//button[@name='action_show_groups']")[0]
+        self.assertEqual(button_groups.get("state"), "new")
+        # Test adding more than one value to list
+        button_access = arch.xpath("//button[@name='action_show_accesses']")[0]
+        self.assertEqual(button_access.get("state"), "new,active")
+        # Test removing values from list
+        button_rules = arch.xpath("//button[@name='action_show_rules']")[0]
+        self.assertEqual(button_rules.get("state"), "")
 
     def test_python_dict_inheritance_attrs_missing_key(self):
         """We should get an error if we try to update a dict without specifing a key"""
         inherit_id = self.env.ref("base.view_partner_form").id
         source = etree.fromstring(
             """
             <form>
```

## Comparing `odoo13_addon_base_view_inheritance_extension-13.0.1.1.1.dist-info/METADATA` & `odoo13_addon_base_view_inheritance_extension-13.0.2.0.0.dist-info/METADATA`

 * *Files 20% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: odoo13-addon-base-view-inheritance-extension
-Version: 13.0.1.1.1
+Version: 13.0.2.0.0
 Summary: Adds more operators for view inheritance
 Home-page: https://github.com/OCA/server-tools
 Author: Therp BV,Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: LGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
@@ -77,14 +77,31 @@
 
 .. code-block:: xml
 
     <attribute name="$attribute" operation="list_remove">
         $remove_value(s)
     </attribute>
 
+**Add text after and/or before than original**
+
+.. code-block:: xml
+
+    <attribute name="$attribute" operation="text_add">
+        $text_before {old_value} $text_after
+    </attribute>
+
+**Add domain with AND/OR join operator (AND if missed) allowing conditional changes**
+
+.. code-block:: xml
+
+    <attribute name="$attribute" operation="domain_add"
+               condition="$field_condition" join_operator="OR">
+        $domain_to_add
+    </attribute>
+
 **Move an element in the view**
 
 This feature is now native, cf the `official Odoo documentation <https://www.odoo.com/documentation/12.0/reference/views.html#inheritance-specs>`_.
 
 Known issues / Roadmap
 ======================
 
@@ -111,15 +128,20 @@
 * Therp BV
 
 Contributors
 ~~~~~~~~~~~~
 
 * Holger Brunn <hbrunn@therp.nl>
 * Ronald Portier <rportier@therp.nl>
-* Sergio Teruel <sergio.teruel@tecnativa.com>
+* `Tecnativa <https://www.tecnativa.com>`_:
+
+  * Sergio Teruel
+  * Carlos Dauden
+  * Stefan ungureanu
+
 * Iv√°n Todorovich <ivan.todorovich@camptocamp.com>
 
 Maintainers
 ~~~~~~~~~~~
 
 This module is maintained by the OCA.
```

## Comparing `odoo13_addon_base_view_inheritance_extension-13.0.1.1.1.dist-info/RECORD` & `odoo13_addon_base_view_inheritance_extension-13.0.2.0.0.dist-info/RECORD`

 * *Files 25% similar despite different names*

```diff
@@ -1,26 +1,26 @@
-odoo/addons/base_view_inheritance_extension/README.rst,sha256=5kJDBCiMobcCmQtIgcAXnBIj25wUqEN5o23xgIrkkac,3983
+odoo/addons/base_view_inheritance_extension/README.rst,sha256=j1trsgQnUevr9csf4ulZAXz7shL3ewB2LNffp-Kscj4,4496
 odoo/addons/base_view_inheritance_extension/__init__.py,sha256=X9EJGOE2GtZbS0G82PtSXmWSZ_R8jEM0rlJTDliQjp4,21
-odoo/addons/base_view_inheritance_extension/__manifest__.py,sha256=-rC_-Vxow9ER8qWYAe6iNHuffnoTquW278OvqLCBl9I,580
-odoo/addons/base_view_inheritance_extension/demo/ir_ui_view.xml,sha256=tj6-GY5rq7fzUf9tgAWE5MNb10r_fux4iw8dwvBOe4Y,1351
-odoo/addons/base_view_inheritance_extension/i18n/base_view_inheritance_extension.pot,sha256=ISp8OHqaofewqRUomv2tvyh8ni1OZeSuLZ0cYaaXmtI,850
+odoo/addons/base_view_inheritance_extension/__manifest__.py,sha256=u56WmxkmUHs2trRNc999SMRRNGbkllWB3lP2LNrTpvE,580
+odoo/addons/base_view_inheritance_extension/demo/ir_ui_view.xml,sha256=G5CbwppcVgMVLGoymcRYO3tz8uCX4loKv3FqVPkCCDg,3105
+odoo/addons/base_view_inheritance_extension/i18n/base_view_inheritance_extension.pot,sha256=EjCItFWJEvBLykkNN2DiZ6sq3rvXnwM6t7-8CWVbTAw,677
 odoo/addons/base_view_inheritance_extension/i18n/ca.po,sha256=xFKkpPiT_RVTTR0H7ZzB2PW6M7aDhRzYhdiCoiRq6mY,1262
 odoo/addons/base_view_inheritance_extension/i18n/de.po,sha256=MqXxL9L4jJ31fu7jIIqteOvyyznVG-NMTyOsalYrXdk,1183
 odoo/addons/base_view_inheritance_extension/i18n/es.po,sha256=qbu15kO8hRjkAYiG58kQQPUR_DE1sEVH71oAyXFMfIA,1252
 odoo/addons/base_view_inheritance_extension/i18n/hr.po,sha256=IqvTFDIf6tCbAw2lP9A-k5wu2jdkn_kPYcYA23W4yqg,1264
 odoo/addons/base_view_inheritance_extension/i18n/it.po,sha256=0gDsGhu0G-QUmhB_pHUNhZcXBlDjIo3ls4pTnqQxLjM,1220
 odoo/addons/base_view_inheritance_extension/i18n/sl.po,sha256=EY6zKcR8nRRsfpjrKK2_CVqFXnUVPjSBOAkI4-voRYw,1265
 odoo/addons/base_view_inheritance_extension/i18n/tr.po,sha256=xaYd2V2mHhQIeLqUpsE4VL3mHbT0DQVNbT9_jCXLc0I,1272
 odoo/addons/base_view_inheritance_extension/models/__init__.py,sha256=SjKfc8ocbCImvP5DpGQbS0hWmQRYPjtzJdyio6TPII0,25
-odoo/addons/base_view_inheritance_extension/models/ir_ui_view.py,sha256=5XWUAKYrnZwectJNttm_kKTFCeNNmosobqClxQOly6A,5320
-odoo/addons/base_view_inheritance_extension/readme/CONTRIBUTORS.rst,sha256=7oB_Qr-bAjS2RWkmUTOJC0Yhj6Qs2rIEc61Bj_a2ypA,168
+odoo/addons/base_view_inheritance_extension/models/ir_ui_view.py,sha256=_9OLc-H_vcIZpCZ9AfLI_dG4zfAQ1ruA9q7-mqf7JLg,8701
+odoo/addons/base_view_inheritance_extension/readme/CONTRIBUTORS.rst,sha256=Ilv-jDZjtj1HqIkdg2FrZI3B4chaJq28yvt-2OinrR0,225
 odoo/addons/base_view_inheritance_extension/readme/DESCRIPTION.rst,sha256=pamURJDYfLUcZtHl0ZvXTtzKO1LvHlhhYIND05AMzbk,88
 odoo/addons/base_view_inheritance_extension/readme/ROADMAP.rst,sha256=xsTKyxd1ezI54RRowWw7G141iWgBi3HpGrIJMvDY9kU,224
-odoo/addons/base_view_inheritance_extension/readme/USAGE.rst,sha256=lgARg9j3Ak_JmNHrxTZ2uRoqOCR-ghV_gUqwtH8TSQE,823
+odoo/addons/base_view_inheritance_extension/readme/USAGE.rst,sha256=9ithglWEXB4T6usgrxPdxW4yS1XBnbATc-3eHzpLUTY,1279
 odoo/addons/base_view_inheritance_extension/static/description/icon.png,sha256=6xBPJauaFOF0KDHfHgQopSc28kKvxMaeoQFQWZtfZDo,9455
-odoo/addons/base_view_inheritance_extension/static/description/index.html,sha256=tCft-mpQ3zSbY3hFOk0myKpq0d09Yq52cSezry5DIYQ,14906
+odoo/addons/base_view_inheritance_extension/static/description/index.html,sha256=hpmIfI98p9ixrK-SEq66Y6tGN729r7q-KZNpEQqh7_g,15953
 odoo/addons/base_view_inheritance_extension/tests/__init__.py,sha256=kTcGsgnWhpM7vII3sEdNX5XVxDHHqRc5KdrxInG6GSw,51
-odoo/addons/base_view_inheritance_extension/tests/test_base_view_inheritance_extension.py,sha256=YXKCx_YW6_VQvJsktXJzPXa_r21-dTmkNsaj-LFuGUs,11690
-odoo13_addon_base_view_inheritance_extension-13.0.1.1.1.dist-info/METADATA,sha256=e99IzYReuenVz5deKhNVIUjLctYaB79KtLMkCegFVp0,4580
-odoo13_addon_base_view_inheritance_extension-13.0.1.1.1.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-odoo13_addon_base_view_inheritance_extension-13.0.1.1.1.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo13_addon_base_view_inheritance_extension-13.0.1.1.1.dist-info/RECORD,,
+odoo/addons/base_view_inheritance_extension/tests/test_base_view_inheritance_extension.py,sha256=vPhMfBWJBHoNxZLF8AKi6XVzoYkmOw2BlQN7NwlhuJI,5010
+odoo13_addon_base_view_inheritance_extension-13.0.2.0.0.dist-info/METADATA,sha256=7ZZ_jfVBIoocfvQsWvksLNEWUQ_Wfstj6313YzkpbI8,5093
+odoo13_addon_base_view_inheritance_extension-13.0.2.0.0.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
+odoo13_addon_base_view_inheritance_extension-13.0.2.0.0.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo13_addon_base_view_inheritance_extension-13.0.2.0.0.dist-info/RECORD,,
```

